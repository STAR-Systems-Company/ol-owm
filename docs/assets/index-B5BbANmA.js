var r_=Object.defineProperty;var Cc=i=>{throw TypeError(i)};var o_=(i,t,e)=>t in i?r_(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var tn=(i,t,e)=>o_(i,typeof t!="symbol"?t+"":t,e),a_=(i,t,e)=>t.has(i)||Cc("Cannot "+e);var Wr=(i,t,e)=>(a_(i,t,"read from private field"),e?e.call(i):t.get(i)),Ec=(i,t,e)=>t.has(i)?Cc("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();const ae={ADD:"add",REMOVE:"remove"},es={PROPERTYCHANGE:"propertychange"},rt={CHANGE:"change",ERROR:"error",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class ko{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function l_(i,t,e){let n,s;e=e||mi;let o=0,a=i.length,h=!1;for(;o<a;)n=o+(a-o>>1),s=+e(i[n],t),s<0?o=n+1:(a=n,h=!s);return h?o:~o}function mi(i,t){return i>t?1:i<t?-1:0}function h_(i,t){return i<t?1:i>t?-1:0}function Rl(i,t,e){if(i[0]<=t)return 0;const n=i.length;if(t<=i[n-1])return n-1;if(typeof e=="function"){for(let s=1;s<n;++s){const o=i[s];if(o===t)return s;if(o<t)return e(t,i[s-1],o)>0?s-1:s}return n-1}if(e>0){for(let s=1;s<n;++s)if(i[s]<t)return s-1;return n-1}if(e<0){for(let s=1;s<n;++s)if(i[s]<=t)return s;return n-1}for(let s=1;s<n;++s){if(i[s]==t)return s;if(i[s]<t)return i[s-1]-t<t-i[s]?s-1:s}return n-1}function c_(i,t,e){for(;t<e;){const n=i[t];i[t]=i[e],i[e]=n,++t,--e}}function qe(i,t){const e=Array.isArray(t)?t:[t],n=e.length;for(let s=0;s<n;s++)i[i.length]=e[s]}function Ui(i,t){const e=i.length;if(e!==t.length)return!1;for(let n=0;n<e;n++)if(i[n]!==t[n])return!1;return!0}function u_(i,t,e){const n=t||mi;return i.every(function(s,o){if(o===0)return!0;const a=n(i[o-1],s);return!(a>0||a===0)})}function Vs(){return!0}function Do(){return!1}function Ks(){}function ed(i){let t,e,n;return function(){const s=Array.prototype.slice.call(arguments);return(!e||this!==n||!Ui(s,e))&&(n=this,e=s,t=i.apply(this,arguments)),t}}function d_(i){function t(){let e;try{e=i()}catch(n){return Promise.reject(n)}return e instanceof Promise?e:Promise.resolve(e)}return t()}function or(i){for(const t in i)delete i[t]}function mn(i){let t;for(t in i)return!1;return!t}class vi{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class Fo extends ko{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const n=this.listeners_||(this.listeners_={}),s=n[t]||(n[t]=[]);s.includes(e)||s.push(e)}dispatchEvent(t){const e=typeof t=="string",n=e?t:t.type,s=this.listeners_&&this.listeners_[n];if(!s)return;const o=e?new vi(t):t;o.target||(o.target=this.eventTarget_||this);const a=this.dispatching_||(this.dispatching_={}),h=this.pendingRemovals_||(this.pendingRemovals_={});n in a||(a[n]=0,h[n]=0),++a[n];let c;for(let d=0,f=s.length;d<f;++d)if("handleEvent"in s[d]?c=s[d].handleEvent(o):c=s[d].call(this,o),c===!1||o.propagationStopped){c=!1;break}if(--a[n]===0){let d=h[n];for(delete h[n];d--;)this.removeEventListener(n,Ks);delete a[n]}return c}disposeInternal(){this.listeners_&&or(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const n=this.listeners_[t];if(!n)return;const s=n.indexOf(e);s!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[s]=Ks,++this.pendingRemovals_[t]):(n.splice(s,1),n.length===0&&delete this.listeners_[t]))}}function _t(i,t,e,n,s){if(s){const a=e;e=function(h){return i.removeEventListener(t,e),a.call(n??this,h)}}else n&&n!==i&&(e=e.bind(n));const o={target:i,type:t,listener:e};return i.addEventListener(t,e),o}function co(i,t,e,n){return _t(i,t,e,n,!0)}function Lt(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),or(i))}class ar extends Fo{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(rt.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const n=t.length,s=new Array(n);for(let o=0;o<n;++o)s[o]=_t(this,t[o],e);return s}return _t(this,t,e)}onceInternal(t,e){let n;if(Array.isArray(t)){const s=t.length;n=new Array(s);for(let o=0;o<s;++o)n[o]=co(this,t[o],e)}else n=co(this,t,e);return e.ol_key=n,n}unInternal(t,e){const n=e.ol_key;if(n)f_(n);else if(Array.isArray(t))for(let s=0,o=t.length;s<o;++s)this.removeEventListener(t[s],e);else this.removeEventListener(t,e)}}ar.prototype.on;ar.prototype.once;ar.prototype.un;function f_(i){if(Array.isArray(i))for(let t=0,e=i.length;t<e;++t)Lt(i[t]);else Lt(i)}function st(){throw new Error("Unimplemented abstract method.")}let g_=0;function vt(i){return i.ol_uid||(i.ol_uid=String(++g_))}class bc extends vi{constructor(t,e,n){super(t),this.key=e,this.oldValue=n}}class Ne extends ar{constructor(t){super(),this.on,this.once,this.un,vt(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new bc(n,t,e)),n=es.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new bc(n,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,n){const s=this.values_||(this.values_={});if(n)s[t]=e;else{const o=s[t];s[t]=e,o!==e&&this.notify(t,o)}}setProperties(t,e){for(const n in t)this.set(n,t[n],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],mn(this.values_)&&(this.values_=null),e||this.notify(t,n)}}}const Tc={LENGTH:"length"};class Xr extends vi{constructor(t,e,n){super(t),this.element=e,this.index=n}}class Ke extends Ne{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let n=0,s=this.array_.length;n<s;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,n=t.length;e<n;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let n=0,s=e.length;n<s;++n)t(e[n],n,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(Tc.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new Xr(ae.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let n=0,s=e.length;n<s;++n)if(e[n]===t)return this.removeAt(n)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new Xr(ae.REMOVE,e,t)),e}setAt(t,e){const n=this.getLength();if(t>=n){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const s=this.array_[t];this.array_[t]=e,this.dispatchEvent(new Xr(ae.REMOVE,s,t)),this.dispatchEvent(new Xr(ae.ADD,e,t))}updateLength_(){this.set(Tc.LENGTH,this.array_.length)}assertUnique_(t,e){for(let n=0,s=this.array_.length;n<s;++n)if(this.array_[n]===t&&n!==e)throw new Error("Duplicate item added to a unique collection")}}class Xn extends vi{constructor(t,e,n){super(t),this.map=e,this.frameState=n!==void 0?n:null}}class ki extends Xn{constructor(t,e,n,s,o,a){super(t,e,o),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=s!==void 0?s:!1,this.activePointers=a}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const Rt={SINGLECLICK:"singleclick",CLICK:rt.CLICK,DBLCLICK:rt.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},pn=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",__=pn.includes("safari")&&!pn.includes("chrom");__&&(pn.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(pn));const m_=pn.includes("webkit")&&!pn.includes("edge"),id=pn.includes("macintosh"),p_=typeof devicePixelRatio<"u"?devicePixelRatio:1,nd=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,sd=typeof Image<"u"&&Image.prototype.decode,rd=function(){let i=!1;try{const t=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return i}(),hl={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown"};class y_ extends Fo{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e===void 0?1:e,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=_t(n,hl.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=_t(n,hl.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(rt.TOUCHMOVE,this.boundHandleTouchMove_,rd?{passive:!1}:!1)}emulateClick_(t){let e=new ki(Rt.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new ki(Rt.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const n=new ki(Rt.SINGLECLICK,this.map_,t);this.dispatchEvent(n)},250)}updateActivePointers_(t){const e=t,n=e.pointerId;if(e.type==Rt.POINTERUP||e.type==Rt.POINTERCANCEL){delete this.trackedTouches_[n];for(const s in this.trackedTouches_)if(this.trackedTouches_[s].target!==e.target){delete this.trackedTouches_[s];break}}else(e.type==Rt.POINTERDOWN||e.type==Rt.POINTERMOVE)&&(this.trackedTouches_[n]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new ki(Rt.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(Lt),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);const e=new ki(Rt.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(e),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),this.dragListenerKeys_.length===0){const n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(_t(n,Rt.POINTERMOVE,this.handlePointerMove_,this),_t(n,Rt.POINTERUP,this.handlePointerUp_,this),_t(this.element_,Rt.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(_t(this.element_.getRootNode(),Rt.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new ki(Rt.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new ki(Rt.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(Lt(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(rt.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(Lt(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Lt),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const gi={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},$t={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},q={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function xt(i,t){if(!i)throw new Error(t)}const uo=1/0;class v_{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,or(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,n=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const s=this.keyFunction_(n);return delete this.queuedElements_[s],n}enqueue(t){xt(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const e=this.priorityFunction_(t);return e!=uo?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,n=this.priorities_,s=e.length,o=e[t],a=n[t],h=t;for(;t<s>>1;){const c=this.getLeftChildIndex_(t),d=this.getRightChildIndex_(t),f=d<s&&n[d]<n[c]?d:c;e[t]=e[f],n[t]=n[f],t=f}e[t]=o,n[t]=a,this.siftDown_(h,t)}siftDown_(t,e){const n=this.elements_,s=this.priorities_,o=n[e],a=s[e];for(;e>t;){const h=this.getParentIndex_(e);if(s[h]>a)n[e]=n[h],s[e]=s[h],e=h;else break}n[e]=o,s[e]=a}reprioritize(){const t=this.priorityFunction_,e=this.elements_,n=this.priorities_;let s=0;const o=e.length;let a,h,c;for(h=0;h<o;++h)a=e[h],c=t(a),c==uo?delete this.queuedElements_[this.keyFunction_(a)]:(n[s]=c,e[s++]=a);e.length=s,n.length=s,this.heapify_()}}class x_ extends v_{constructor(t,e){super(n=>t.apply(null,n),n=>n[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(rt.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,n=e.getState();if(n===q.LOADED||n===q.ERROR||n===q.EMPTY){n!==q.ERROR&&e.removeEventListener(rt.CHANGE,this.boundHandleTileChange_);const s=e.getKey();s in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[s],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let n=0;for(;this.tilesLoading_<t&&n<e&&this.getCount()>0;){const s=this.dequeue()[0],o=s.getKey();s.getState()===q.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++n,s.load())}}}function w_(i,t,e,n,s){if(!i||!(e in i.wantedTiles)||!i.wantedTiles[e][t.getKey()])return uo;const o=i.viewState.center,a=n[0]-o[0],h=n[1]-o[1];return 65536*Math.log(s)+Math.sqrt(a*a+h*h)/s}const qt={ANIMATING:0,INTERACTING:1},Ae={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function Mt(i,t,e){return Math.min(Math.max(i,t),e)}function C_(i,t,e,n,s,o){const a=s-e,h=o-n;if(a!==0||h!==0){const c=((i-e)*a+(t-n)*h)/(a*a+h*h);c>1?(e=s,n=o):c>0&&(e+=a*c,n+=h*c)}return dn(i,t,e,n)}function dn(i,t,e,n){const s=e-i,o=n-t;return s*s+o*o}function E_(i){const t=i.length;for(let n=0;n<t;n++){let s=n,o=Math.abs(i[n][n]);for(let h=n+1;h<t;h++){const c=Math.abs(i[h][n]);c>o&&(o=c,s=h)}if(o===0)return null;const a=i[s];i[s]=i[n],i[n]=a;for(let h=n+1;h<t;h++){const c=-i[h][n]/i[n][n];for(let d=n;d<t+1;d++)n==d?i[h][d]=0:i[h][d]+=c*i[n][d]}}const e=new Array(t);for(let n=t-1;n>=0;n--){e[n]=i[n][t]/i[n][n];for(let s=n-1;s>=0;s--)i[s][t]-=i[s][n]*e[n]}return e}function Lc(i){return i*180/Math.PI}function Ni(i){return i*Math.PI/180}function fn(i,t){const e=i%t;return e*t<0?e+t:e}function ge(i,t,e){return i+e*(t-i)}function zo(i,t){const e=Math.pow(10,t);return Math.round(i*e)/e}function jr(i,t){return Math.floor(zo(i,t))}function Yr(i,t){return Math.ceil(zo(i,t))}function cl(i,t,e){if(i>=t&&i<e)return i;const n=e-t;return((i-t)%n+n)%n+t}function Sc(i,t,e){return function(n,s,o,a,h){if(!n)return;if(!s&&!t)return n;const c=t?0:o[0]*s,d=t?0:o[1]*s,f=h?h[0]:0,_=h?h[1]:0;let p=i[0]+c/2+f,y=i[2]-c/2+f,v=i[1]+d/2+_,w=i[3]-d/2+_;p>y&&(p=(y+p)/2,y=p),v>w&&(v=(w+v)/2,w=v);let C=Mt(n[0],p,y),E=Mt(n[1],v,w);if(a&&e&&s){const T=30*s;C+=-T*Math.log(1+Math.max(0,p-n[0])/T)+T*Math.log(1+Math.max(0,n[0]-y)/T),E+=-T*Math.log(1+Math.max(0,v-n[1])/T)+T*Math.log(1+Math.max(0,n[1]-w)/T)}return[C,E]}}function b_(i){return i}const Wt={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Pc(i){const t=Le();for(let e=0,n=i.length;e<n;++e)Ws(t,i[e]);return t}function Il(i,t,e){return e?(e[0]=i[0]-t,e[1]=i[1]-t,e[2]=i[2]+t,e[3]=i[3]+t,e):[i[0]-t,i[1]-t,i[2]+t,i[3]+t]}function od(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i.slice()}function xn(i,t,e){let n,s;return t<i[0]?n=i[0]-t:i[2]<t?n=t-i[2]:n=0,e<i[1]?s=i[1]-e:i[3]<e?s=e-i[3]:s=0,n*n+s*s}function yn(i,t){return Al(i,t[0],t[1])}function an(i,t){return i[0]<=t[0]&&t[2]<=i[2]&&i[1]<=t[1]&&t[3]<=i[3]}function Al(i,t,e){return i[0]<=t&&t<=i[2]&&i[1]<=e&&e<=i[3]}function ul(i,t){const e=i[0],n=i[1],s=i[2],o=i[3],a=t[0],h=t[1];let c=Wt.UNKNOWN;return a<e?c=c|Wt.LEFT:a>s&&(c=c|Wt.RIGHT),h<n?c=c|Wt.BELOW:h>o&&(c=c|Wt.ABOVE),c===Wt.UNKNOWN&&(c=Wt.INTERSECTING),c}function Le(){return[1/0,1/0,-1/0,-1/0]}function Wi(i,t,e,n,s){return s?(s[0]=i,s[1]=t,s[2]=e,s[3]=n,s):[i,t,e,n]}function lr(i){return Wi(1/0,1/0,-1/0,-1/0,i)}function ad(i,t){const e=i[0],n=i[1];return Wi(e,n,e,n,t)}function Ol(i,t,e,n,s){const o=lr(s);return hd(o,i,t,e,n)}function Hs(i,t){return i[0]==t[0]&&i[2]==t[2]&&i[1]==t[1]&&i[3]==t[3]}function ld(i,t){return t[0]<i[0]&&(i[0]=t[0]),t[2]>i[2]&&(i[2]=t[2]),t[1]<i[1]&&(i[1]=t[1]),t[3]>i[3]&&(i[3]=t[3]),i}function Ws(i,t){t[0]<i[0]&&(i[0]=t[0]),t[0]>i[2]&&(i[2]=t[0]),t[1]<i[1]&&(i[1]=t[1]),t[1]>i[3]&&(i[3]=t[1])}function hd(i,t,e,n,s){for(;e<n;e+=s)T_(i,t[e],t[e+1]);return i}function T_(i,t,e){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}function cd(i,t){let e;return e=t(No(i)),e||(e=t(Zo(i)),e)||(e=t(Go(i)),e)||(e=t(wn(i)),e)?e:!1}function dl(i){let t=0;return hr(i)||(t=Ct(i)*ie(i)),t}function No(i){return[i[0],i[1]]}function Zo(i){return[i[2],i[1]]}function Xi(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function L_(i,t){let e;if(t==="bottom-left")e=No(i);else if(t==="bottom-right")e=Zo(i);else if(t==="top-left")e=wn(i);else if(t==="top-right")e=Go(i);else throw new Error("Invalid corner");return e}function fl(i,t,e,n,s){const[o,a,h,c,d,f,_,p]=ud(i,t,e,n);return Wi(Math.min(o,h,d,_),Math.min(a,c,f,p),Math.max(o,h,d,_),Math.max(a,c,f,p),s)}function ud(i,t,e,n){const s=t*n[0]/2,o=t*n[1]/2,a=Math.cos(e),h=Math.sin(e),c=s*a,d=s*h,f=o*a,_=o*h,p=i[0],y=i[1];return[p-c+_,y-d-f,p-c-_,y-d+f,p+c-_,y+d+f,p+c+_,y+d-f,p-c+_,y-d-f]}function ie(i){return i[3]-i[1]}function Zi(i,t,e){const n=e||Le();return ee(i,t)?(i[0]>t[0]?n[0]=i[0]:n[0]=t[0],i[1]>t[1]?n[1]=i[1]:n[1]=t[1],i[2]<t[2]?n[2]=i[2]:n[2]=t[2],i[3]<t[3]?n[3]=i[3]:n[3]=t[3]):lr(n),n}function wn(i){return[i[0],i[3]]}function Go(i){return[i[2],i[3]]}function Ct(i){return i[2]-i[0]}function ee(i,t){return i[0]<=t[2]&&i[2]>=t[0]&&i[1]<=t[3]&&i[3]>=t[1]}function hr(i){return i[2]<i[0]||i[3]<i[1]}function S_(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i}function P_(i,t,e){let n=!1;const s=ul(i,t),o=ul(i,e);if(s===Wt.INTERSECTING||o===Wt.INTERSECTING)n=!0;else{const a=i[0],h=i[1],c=i[2],d=i[3],f=t[0],_=t[1],p=e[0],y=e[1],v=(y-_)/(p-f);let w,C;o&Wt.ABOVE&&!(s&Wt.ABOVE)&&(w=p-(y-d)/v,n=w>=a&&w<=c),!n&&o&Wt.RIGHT&&!(s&Wt.RIGHT)&&(C=y-(p-c)*v,n=C>=h&&C<=d),!n&&o&Wt.BELOW&&!(s&Wt.BELOW)&&(w=p-(y-h)/v,n=w>=a&&w<=c),!n&&o&Wt.LEFT&&!(s&Wt.LEFT)&&(C=y-(p-a)*v,n=C>=h&&C<=d)}return n}function dd(i,t){const e=t.getExtent(),n=Xi(i);if(t.canWrapX()&&(n[0]<e[0]||n[0]>=e[2])){const s=Ct(e),a=Math.floor((n[0]-e[0])/s)*s;i[0]-=a,i[2]-=a}return i}function fd(i,t,e){if(t.canWrapX()){const n=t.getExtent();if(!isFinite(i[0])||!isFinite(i[2]))return[[n[0],i[1],n[2],i[3]]];dd(i,t);const s=Ct(n);if(Ct(i)>s&&!e)return[[n[0],i[1],n[2],i[3]]];if(i[0]<n[0])return[[i[0]+s,i[1],n[2],i[3]],[n[0],i[1],i[2],i[3]]];if(i[2]>n[2])return[[i[0],i[1],n[2],i[3]],[n[0],i[1],i[2]-s,i[3]]]}return[i]}function M_(i,t){return i[0]+=+t[0],i[1]+=+t[1],i}function fo(i,t){let e=!0;for(let n=i.length-1;n>=0;--n)if(i[n]!=t[n]){e=!1;break}return e}function kl(i,t){const e=Math.cos(t),n=Math.sin(t),s=i[0]*e-i[1]*n,o=i[1]*e+i[0]*n;return i[0]=s,i[1]=o,i}function R_(i,t){return i[0]*=t,i[1]*=t,i}function gd(i,t){if(t.canWrapX()){const e=Ct(t.getExtent()),n=I_(i,t,e);n&&(i[0]-=n*e)}return i}function I_(i,t,e){const n=t.getExtent();let s=0;return t.canWrapX()&&(i[0]<n[0]||i[0]>n[2])&&(e=e||Ct(n),s=Math.floor((i[0]-n[0])/e)),s}function _d(i){return Math.pow(i,3)}function ls(i){return 1-_d(1-i)}function A_(i){return 3*i*i-2*i*i*i}function O_(i){return i}const k_=63710088e-1;function Mc(i,t,e){e=e||k_;const n=Ni(i[1]),s=Ni(t[1]),o=(s-n)/2,a=Ni(t[0]-i[0])/2,h=Math.sin(o)*Math.sin(o)+Math.sin(a)*Math.sin(a)*Math.cos(n)*Math.cos(s);return 2*e*Math.atan2(Math.sqrt(h),Math.sqrt(1-h))}function md(...i){console.warn(...i)}const Dl={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class Fl{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Dl[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const cr=6378137,Vn=Math.PI*cr,D_=[-Vn,-Vn,Vn,Vn],F_=[-180,-85,180,85],Ur=cr*Math.log(Math.tan(Math.PI/2));class Fn extends Fl{constructor(t){super({code:t,units:"m",extent:D_,global:!0,worldExtent:F_,getPointResolution:function(e,n){return e/Math.cosh(n[1]/cr)}})}}const Rc=[new Fn("EPSG:3857"),new Fn("EPSG:102100"),new Fn("EPSG:102113"),new Fn("EPSG:900913"),new Fn("http://www.opengis.net/def/crs/EPSG/0/3857"),new Fn("http://www.opengis.net/gml/srs/epsg.xml#3857")];function z_(i,t,e,n){const s=i.length;e=e>1?e:2,n=n??e,t===void 0&&(e>2?t=i.slice():t=new Array(s));for(let o=0;o<s;o+=n){t[o]=Vn*i[o]/180;let a=cr*Math.log(Math.tan(Math.PI*(+i[o+1]+90)/360));a>Ur?a=Ur:a<-Ur&&(a=-Ur),t[o+1]=a}return t}function N_(i,t,e,n){const s=i.length;e=e>1?e:2,n=n??e,t===void 0&&(e>2?t=i.slice():t=new Array(s));for(let o=0;o<s;o+=n)t[o]=180*i[o]/Vn,t[o+1]=360*Math.atan(Math.exp(i[o+1]/cr))/Math.PI-90;return t}const Z_=6378137,Ic=[-180,-90,180,90],G_=Math.PI*Z_/180;class en extends Fl{constructor(t,e){super({code:t,units:"degrees",extent:Ic,axisOrientation:e,global:!0,metersPerUnit:G_,worldExtent:Ic})}}const Ac=[new en("CRS:84"),new en("EPSG:4326","neu"),new en("urn:ogc:def:crs:OGC:1.3:CRS84"),new en("urn:ogc:def:crs:OGC:2:84"),new en("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new en("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new en("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let gl={};function B_(i){return gl[i]||gl[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function W_(i,t){gl[i]=t}let Hn={};function $s(i,t,e){const n=i.getCode(),s=t.getCode();n in Hn||(Hn[n]={}),Hn[n][s]=e}function Ma(i,t){return i in Hn&&t in Hn[i]?Hn[i][t]:null}const go=.9996,Te=.00669438,Bo=Te*Te,Wo=Bo*Te,ln=Te/(1-Te),Oc=Math.sqrt(1-Te),is=(1-Oc)/(1+Oc),pd=is*is,zl=pd*is,Nl=zl*is,yd=Nl*is,vd=1-Te/4-3*Bo/64-5*Wo/256,X_=3*Te/8+3*Bo/32+45*Wo/1024,j_=15*Bo/256+45*Wo/1024,Y_=35*Wo/3072,U_=3/2*is-27/32*zl+269/512*yd,V_=21/16*pd-55/32*Nl,K_=151/96*zl-417/128*yd,H_=1097/512*Nl,_o=6378137;function $_(i,t,e){const n=i-5e5,a=(e.north?t:t-1e7)/go/(_o*vd),h=a+U_*Math.sin(2*a)+V_*Math.sin(4*a)+K_*Math.sin(6*a)+H_*Math.sin(8*a),c=Math.sin(h),d=c*c,f=Math.cos(h),_=c/f,p=_*_,y=p*p,v=1-Te*d,w=Math.sqrt(1-Te*d),C=_o/w,E=(1-Te)/v,T=ln*f**2,M=T*T,S=n/(C*go),P=S*S,A=P*S,D=A*S,k=D*S,F=k*S,B=h-_/E*(P/2-D/24*(5+3*p+10*T-4*M-9*ln))+F/720*(61+90*p+298*T+45*y-252*ln-3*M);let X=(S-A/6*(1+2*p+T)+k/120*(5-2*T+28*p-3*M+8*ln+24*y))/f;return X=cl(X+Ni(xd(e.number)),-Math.PI,Math.PI),[Lc(X),Lc(B)]}const kc=-80,Dc=84,q_=-180,J_=180;function Q_(i,t,e){i=cl(i,q_,J_),t<kc?t=kc:t>Dc&&(t=Dc);const n=Ni(t),s=Math.sin(n),o=Math.cos(n),a=s/o,h=a*a,c=h*h,d=Ni(i),f=xd(e.number),_=Ni(f),p=_o/Math.sqrt(1-Te*s**2),y=ln*o**2,v=o*cl(d-_,-Math.PI,Math.PI),w=v*v,C=w*v,E=C*v,T=E*v,M=T*v,S=_o*(vd*n-X_*Math.sin(2*n)+j_*Math.sin(4*n)-Y_*Math.sin(6*n)),P=go*p*(v+C/6*(1-h+y)+T/120*(5-18*h+c+72*y-58*ln))+5e5;let A=go*(S+p*a*(w/2+E/24*(5-h+9*y+4*y**2)+M/720*(61-58*h+c+600*y-330*ln)));return e.north||(A+=1e7),[P,A]}function xd(i){return(i-1)*6-180+3}const tm=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function wd(i){let t=0;for(const s of tm){const o=i.match(s);if(o){t=parseInt(o[1]);break}}if(!t)return null;let e=0,n=!1;return t>32700&&t<32761?e=t-32700:t>32600&&t<32661&&(n=!0,e=t-32600),e?{number:e,north:n}:null}function Fc(i,t){return function(e,n,s,o){const a=e.length;s=s>1?s:2,o=o??s,n||(s>2?n=e.slice():n=new Array(a));for(let h=0;h<a;h+=o){const c=e[h],d=e[h+1],f=i(c,d,t);n[h]=f[0],n[h+1]=f[1]}return n}}function em(i){return wd(i)?new Fl({code:i,units:"m"}):null}function im(i){const t=wd(i.getCode());return t?{forward:Fc(Q_,t),inverse:Fc($_,t)}:null}const nm=[im],sm=[em];let _l=!0;function Cd(i){_l=!1}function Zl(i,t){if(t!==void 0){for(let e=0,n=i.length;e<n;++e)t[e]=i[e];t=t}else t=i.slice();return t}function ml(i){W_(i.getCode(),i),$s(i,i,Zl)}function rm(i){i.forEach(ml)}function It(i){if(typeof i!="string")return i;const t=B_(i);if(t)return t;for(const e of sm){const n=e(i);if(n)return n}return null}function zc(i,t,e,n){i=It(i);let s;const o=i.getPointResolutionFunc();if(o)s=o(t,e);else{const a=i.getUnits();if(a=="degrees"||n=="degrees")s=t;else{const h=Bl(i,It("EPSG:4326"));if(!h&&a!=="degrees")s=t*i.getMetersPerUnit();else{let d=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];d=h(d,d,2);const f=Mc(d.slice(0,2),d.slice(2,4)),_=Mc(d.slice(4,6),d.slice(6,8));s=(f+_)/2}const c=i.getMetersPerUnit();c!==void 0&&(s/=c)}}return s}function Nc(i){rm(i),i.forEach(function(t){i.forEach(function(e){t!==e&&$s(t,e,Zl)})})}function om(i,t,e,n){i.forEach(function(s){t.forEach(function(o){$s(s,o,e),$s(o,s,n)})})}function Gl(i,t){return i?typeof i=="string"?It(i):i:It(t)}function am(i){return function(t,e,n,s){const o=t.length;n=n!==void 0?n:2,s=s??n,e=e!==void 0?e:new Array(o);for(let a=0;a<o;a+=s){const h=i(t.slice(a,a+n)),c=h.length;for(let d=0,f=s;d<f;++d)e[a+d]=d>=c?t[a+d]:h[d]}return e}}function lm(i,t){return Cd(),gn(i,"EPSG:4326","EPSG:3857")}function Ra(i,t){const e=gn(i,"EPSG:3857","EPSG:4326"),n=e[0];return(n<-180||n>180)&&(e[0]=fn(n+180,360)-180),e}function ro(i,t){if(i===t)return!0;const e=i.getUnits()===t.getUnits();return(i.getCode()===t.getCode()||Bl(i,t)===Zl)&&e}function Bl(i,t){const e=i.getCode(),n=t.getCode();let s=Ma(e,n);if(s)return s;let o=null,a=null;for(const c of nm)o||(o=c(i)),a||(a=c(t));if(!o&&!a)return null;const h="EPSG:4326";if(a)if(o)s=Ia(o.inverse,a.forward);else{const c=Ma(e,h);c&&(s=Ia(c,a.forward))}else{const c=Ma(h,n);c&&(s=Ia(o.inverse,c))}return s&&(ml(i),ml(t),$s(i,t,s)),s}function Ia(i,t){return function(e,n,s,o){return n=i(e,n,s,o),t(n,n,s,o)}}function qs(i,t){const e=It(i),n=It(t);return Bl(e,n)}function gn(i,t,e){const n=qs(t,e);if(!n){const s=It(t).getCode(),o=It(e).getCode();throw new Error(`No transform available between ${s} and ${o}`)}return n(i,void 0,i.length)}function mo(i,t){return i}function ke(i,t){return _l&&!fo(i,[0,0])&&i[0]>=-180&&i[0]<=180&&i[1]>=-90&&i[1]<=90&&(_l=!1,md("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),i}function Ed(i,t){return i}function He(i,t){return i}function hm(){Nc(Rc),Nc(Ac),om(Ac,Rc,z_,N_)}hm();new Array(6);function me(){return[1,0,0,1,0,0]}function cm(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i}function zt(i,t){const e=t[0],n=t[1];return t[0]=i[0]*e+i[2]*n+i[4],t[1]=i[1]*e+i[3]*n+i[5],t}function Qe(i,t,e,n,s,o,a,h){const c=Math.sin(o),d=Math.cos(o);return i[0]=n*d,i[1]=s*c,i[2]=-n*c,i[3]=s*d,i[4]=a*n*d-h*n*c+t,i[5]=a*s*c+h*s*d+e,i}function Wl(i,t){const e=um(t);xt(e!==0,"Transformation matrix cannot be inverted");const n=t[0],s=t[1],o=t[2],a=t[3],h=t[4],c=t[5];return i[0]=a/e,i[1]=-s/e,i[2]=-o/e,i[3]=n/e,i[4]=(o*c-a*h)/e,i[5]=-(n*c-s*h)/e,i}function um(i){return i[0]*i[3]-i[1]*i[2]}const dm=[1e5,1e5,1e5,1e5,2,2];function bd(i){return"matrix("+i.join(", ")+")"}function Zc(i){return i.substring(7,i.length-1).split(",").map(parseFloat)}function fm(i,t){const e=Zc(i),n=Zc(t);for(let s=0;s<6;++s)if(Math.round((e[s]-n[s])*dm[s])!==0)return!1;return!0}function Gi(i,t,e,n,s,o,a){o=o||[],a=a||2;let h=0;for(let c=t;c<e;c+=n){const d=i[c],f=i[c+1];o[h++]=s[0]*d+s[2]*f+s[4],o[h++]=s[1]*d+s[3]*f+s[5];for(let _=2;_<a;_++)o[h++]=i[c+_]}return o&&o.length!=h&&(o.length=h),o}function Td(i,t,e,n,s,o,a){a=a||[];const h=Math.cos(s),c=Math.sin(s),d=o[0],f=o[1];let _=0;for(let p=t;p<e;p+=n){const y=i[p]-d,v=i[p+1]-f;a[_++]=d+y*h-v*c,a[_++]=f+y*c+v*h;for(let w=p+2;w<p+n;++w)a[_++]=i[w]}return a&&a.length!=_&&(a.length=_),a}function gm(i,t,e,n,s,o,a,h){h=h||[];const c=a[0],d=a[1];let f=0;for(let _=t;_<e;_+=n){const p=i[_]-c,y=i[_+1]-d;h[f++]=c+s*p,h[f++]=d+o*y;for(let v=_+2;v<_+n;++v)h[f++]=i[v]}return h&&h.length!=f&&(h.length=f),h}function _m(i,t,e,n,s,o,a){a=a||[];let h=0;for(let c=t;c<e;c+=n){a[h++]=i[c]+s,a[h++]=i[c+1]+o;for(let d=c+2;d<c+n;++d)a[h++]=i[d]}return a&&a.length!=h&&(a.length=h),a}const Gc=me(),mm=[NaN,NaN];class Ld extends Ne{constructor(){super(),this.extent_=Le(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=ed((t,e,n)=>{if(!n)return this.getSimplifiedGeometry(e);const s=this.clone();return s.applyTransform(n),s.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return st()}closestPointXY(t,e,n,s){return st()}containsXY(t,e){return this.closestPointXY(t,e,mm,Number.MIN_VALUE)===0}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return st()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&lr(e),this.extentRevision_=this.getRevision()}return S_(this.extent_,t)}rotate(t,e){st()}scale(t,e,n){st()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return st()}getType(){return st()}applyTransform(t){st()}intersectsExtent(t){return st()}translate(t,e){st()}transform(t,e){const n=It(t),s=n.getUnits()=="tile-pixels"?function(o,a,h){const c=n.getExtent(),d=n.getWorldExtent(),f=ie(d)/ie(c);Qe(Gc,d[0],d[3],f,-f,0,0,0);const _=Gi(o,0,o.length,h,Gc,a),p=qs(n,e);return p?p(_,_,h):_}:qs(n,e);return this.applyTransform(s),this}}class Cn extends Ld{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return Ol(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return st()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=Bc(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){st()}setLayout(t,e,n){let s;if(t)s=Bc(t);else{for(let o=0;o<n;++o){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}s=e.length,t=En(s)}this.layout=t,this.stride=s}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(t,e){const n=this.getFlatCoordinates();if(n){const s=this.getStride();Td(n,0,n.length,s,t,e,n),this.changed()}}scale(t,e,n){e===void 0&&(e=t),n||(n=Xi(this.getExtent()));const s=this.getFlatCoordinates();if(s){const o=this.getStride();gm(s,0,s.length,o,t,e,n,s),this.changed()}}translate(t,e){const n=this.getFlatCoordinates();if(n){const s=this.getStride();_m(n,0,n.length,s,t,e,n),this.changed()}}}function En(i){let t;return i==2?t="XY":i==3?t="XYZ":i==4&&(t="XYZM"),t}function Bc(i){let t;return i=="XY"?t=2:i=="XYZ"||i=="XYM"?t=3:i=="XYZM"&&(t=4),t}function pm(i,t,e){const n=i.getFlatCoordinates();if(!n)return null;const s=i.getStride();return Gi(n,0,n.length,s,t,e)}function Sd(i,t,e,n){let s=0;const o=i[e-n],a=i[e-n+1];let h=0,c=0;for(;t<e;t+=n){const d=i[t]-o,f=i[t+1]-a;s+=c*d-h*f,h=d,c=f}return s/2}function Pd(i,t,e,n){let s=0;for(let o=0,a=e.length;o<a;++o){const h=e[o];s+=Sd(i,t,h,n),t=h}return s}function ym(i,t,e,n){let s=0;for(let o=0,a=e.length;o<a;++o){const h=e[o];s+=Pd(i,t,h,n),t=h[h.length-1]}return s}function Wc(i,t,e,n,s,o,a){const h=i[t],c=i[t+1],d=i[e]-h,f=i[e+1]-c;let _;if(d===0&&f===0)_=t;else{const p=((s-h)*d+(o-c)*f)/(d*d+f*f);if(p>1)_=e;else if(p>0){for(let y=0;y<n;++y)a[y]=ge(i[t+y],i[e+y],p);a.length=n;return}else _=t}for(let p=0;p<n;++p)a[p]=i[_+p];a.length=n}function Xl(i,t,e,n,s){let o=i[t],a=i[t+1];for(t+=n;t<e;t+=n){const h=i[t],c=i[t+1],d=dn(o,a,h,c);d>s&&(s=d),o=h,a=c}return s}function jl(i,t,e,n,s){for(let o=0,a=e.length;o<a;++o){const h=e[o];s=Xl(i,t,h,n,s),t=h}return s}function vm(i,t,e,n,s){for(let o=0,a=e.length;o<a;++o){const h=e[o];s=jl(i,t,h,n,s),t=h[h.length-1]}return s}function Yl(i,t,e,n,s,o,a,h,c,d,f){if(t==e)return d;let _,p;if(s===0){if(p=dn(a,h,i[t],i[t+1]),p<d){for(_=0;_<n;++_)c[_]=i[t+_];return c.length=n,p}return d}f=f||[NaN,NaN];let y=t+n;for(;y<e;)if(Wc(i,y-n,y,n,a,h,f),p=dn(a,h,f[0],f[1]),p<d){for(d=p,_=0;_<n;++_)c[_]=f[_];c.length=n,y+=n}else y+=n*Math.max((Math.sqrt(p)-Math.sqrt(d))/s|0,1);if(o&&(Wc(i,e-n,t,n,a,h,f),p=dn(a,h,f[0],f[1]),p<d)){for(d=p,_=0;_<n;++_)c[_]=f[_];c.length=n}return d}function Ul(i,t,e,n,s,o,a,h,c,d,f){f=f||[NaN,NaN];for(let _=0,p=e.length;_<p;++_){const y=e[_];d=Yl(i,t,y,n,s,o,a,h,c,d,f),t=y}return d}function xm(i,t,e,n,s,o,a,h,c,d,f){f=f||[NaN,NaN];for(let _=0,p=e.length;_<p;++_){const y=e[_];d=Ul(i,t,y,n,s,o,a,h,c,d,f),t=y[y.length-1]}return d}function wm(i,t,e,n){for(let s=0,o=e.length;s<o;++s)i[t++]=e[s];return t}function Xo(i,t,e,n){for(let s=0,o=e.length;s<o;++s){const a=e[s];for(let h=0;h<n;++h)i[t++]=a[h]}return t}function ur(i,t,e,n,s){s=s||[];let o=0;for(let a=0,h=e.length;a<h;++a){const c=Xo(i,t,e[a],n);s[o++]=c,t=c}return s.length=o,s}function Md(i,t,e,n,s){s=s||[];let o=0;for(let a=0,h=e.length;a<h;++a){const c=ur(i,t,e[a],n,s[o]);c.length===0&&(c[0]=t),s[o++]=c,t=c[c.length-1]}return s.length=o,s}function Fi(i,t,e,n,s){s=s!==void 0?s:[];let o=0;for(let a=t;a<e;a+=n)s[o++]=i.slice(a,a+n);return s.length=o,s}function Js(i,t,e,n,s){s=s!==void 0?s:[];let o=0;for(let a=0,h=e.length;a<h;++a){const c=e[a];s[o++]=Fi(i,t,c,n,s[o]),t=c}return s.length=o,s}function pl(i,t,e,n,s){s=s!==void 0?s:[];let o=0;for(let a=0,h=e.length;a<h;++a){const c=e[a];s[o++]=c.length===1&&c[0]===t?[]:Js(i,t,c,n,s[o]),t=c[c.length-1]}return s.length=o,s}function jo(i,t,e,n,s,o,a){const h=(e-t)/n;if(h<3){for(;t<e;t+=n)o[a++]=i[t],o[a++]=i[t+1];return a}const c=new Array(h);c[0]=1,c[h-1]=1;const d=[t,e-n];let f=0;for(;d.length>0;){const _=d.pop(),p=d.pop();let y=0;const v=i[p],w=i[p+1],C=i[_],E=i[_+1];for(let T=p+n;T<_;T+=n){const M=i[T],S=i[T+1],P=C_(M,S,v,w,C,E);P>y&&(f=T,y=P)}y>s&&(c[(f-t)/n]=1,p+n<f&&d.push(p,f),f+n<_&&d.push(f,_))}for(let _=0;_<h;++_)c[_]&&(o[a++]=i[t+_*n],o[a++]=i[t+_*n+1]);return a}function Rd(i,t,e,n,s,o,a,h){for(let c=0,d=e.length;c<d;++c){const f=e[c];a=jo(i,t,f,n,s,o,a),h.push(a),t=f}return a}function rn(i,t){return t*Math.round(i/t)}function Cm(i,t,e,n,s,o,a){if(t==e)return a;let h=rn(i[t],s),c=rn(i[t+1],s);t+=n,o[a++]=h,o[a++]=c;let d,f;do if(d=rn(i[t],s),f=rn(i[t+1],s),t+=n,t==e)return o[a++]=d,o[a++]=f,a;while(d==h&&f==c);for(;t<e;){const _=rn(i[t],s),p=rn(i[t+1],s);if(t+=n,_==d&&p==f)continue;const y=d-h,v=f-c,w=_-h,C=p-c;if(y*C==v*w&&(y<0&&w<y||y==w||y>0&&w>y)&&(v<0&&C<v||v==C||v>0&&C>v)){d=_,f=p;continue}o[a++]=d,o[a++]=f,h=d,c=f,d=_,f=p}return o[a++]=d,o[a++]=f,a}function Vl(i,t,e,n,s,o,a,h){for(let c=0,d=e.length;c<d;++c){const f=e[c];a=Cm(i,t,f,n,s,o,a),h.push(a),t=f}return a}function Em(i,t,e,n,s,o,a,h){for(let c=0,d=e.length;c<d;++c){const f=e[c],_=[];a=Vl(i,t,f,n,s,o,a,_),h.push(_),t=f[f.length-1]}return a}class Qs extends Cn{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new Qs(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,n,s){return s<xn(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Xl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Yl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,n,s))}getArea(){return Sd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Fi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=jo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Qs(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Xo(this.flatCoordinates,0,t,this.stride),this.changed()}}class ns extends Cn{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new ns(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,s){const o=this.flatCoordinates,a=dn(t,e,o[0],o[1]);if(a<s){const h=this.stride;for(let c=0;c<h;++c)n[c]=o[c];return n.length=h,a}return s}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return ad(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return Al(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=wm(this.flatCoordinates,0,t,this.stride),this.changed()}}function bm(i,t,e,n,s){return!cd(s,function(a){return!hn(i,t,e,n,a[0],a[1])})}function hn(i,t,e,n,s,o){let a=0,h=i[e-n],c=i[e-n+1];for(;t<e;t+=n){const d=i[t],f=i[t+1];c<=o?f>o&&(d-h)*(o-c)-(s-h)*(f-c)>0&&a++:f<=o&&(d-h)*(o-c)-(s-h)*(f-c)<0&&a--,h=d,c=f}return a!==0}function Kl(i,t,e,n,s,o){if(e.length===0||!hn(i,t,e[0],n,s,o))return!1;for(let a=1,h=e.length;a<h;++a)if(hn(i,e[a-1],e[a],n,s,o))return!1;return!0}function Tm(i,t,e,n,s,o){if(e.length===0)return!1;for(let a=0,h=e.length;a<h;++a){const c=e[a];if(Kl(i,t,c,n,s,o))return!0;t=c[c.length-1]}return!1}function Hl(i,t,e,n,s,o,a){let h,c,d,f,_,p,y;const v=s[o+1],w=[];for(let T=0,M=e.length;T<M;++T){const S=e[T];for(f=i[S-n],p=i[S-n+1],h=t;h<S;h+=n)_=i[h],y=i[h+1],(v<=p&&y<=v||p<=v&&v<=y)&&(d=(v-p)/(y-p)*(_-f)+f,w.push(d)),f=_,p=y}let C=NaN,E=-1/0;for(w.sort(mi),f=w[0],h=1,c=w.length;h<c;++h){_=w[h];const T=Math.abs(_-f);T>E&&(d=(f+_)/2,Kl(i,t,e,n,d,v)&&(C=d,E=T)),f=_}return isNaN(C)&&(C=s[o]),a?(a.push(C,v,E),a):[C,v,E]}function Id(i,t,e,n,s){let o=[];for(let a=0,h=e.length;a<h;++a){const c=e[a];o=Hl(i,t,c,n,s,2*a,o),t=c[c.length-1]}return o}function Ad(i,t,e,n,s){let o;for(t+=n;t<e;t+=n)if(o=s(i.slice(t-n,t),i.slice(t,t+n)),o)return o;return!1}function Yo(i,t,e,n,s,o){return o=o??hd(Le(),i,t,e,n),ee(s,o)?o[0]>=s[0]&&o[2]<=s[2]||o[1]>=s[1]&&o[3]<=s[3]?!0:Ad(i,t,e,n,function(a,h){return P_(s,a,h)}):!1}function Lm(i,t,e,n,s){for(let o=0,a=e.length;o<a;++o){if(Yo(i,t,e[o],n,s))return!0;t=e[o]}return!1}function Od(i,t,e,n,s){return!!(Yo(i,t,e,n,s)||hn(i,t,e,n,s[0],s[1])||hn(i,t,e,n,s[0],s[3])||hn(i,t,e,n,s[2],s[1])||hn(i,t,e,n,s[2],s[3]))}function kd(i,t,e,n,s){if(!Od(i,t,e[0],n,s))return!1;if(e.length===1)return!0;for(let o=1,a=e.length;o<a;++o)if(bm(i,e[o-1],e[o],n,s)&&!Yo(i,e[o-1],e[o],n,s))return!1;return!0}function Sm(i,t,e,n,s){for(let o=0,a=e.length;o<a;++o){const h=e[o];if(kd(i,t,h,n,s))return!0;t=h[h.length-1]}return!1}function Pm(i,t,e,n){for(;t<e-n;){for(let s=0;s<n;++s){const o=i[t+s];i[t+s]=i[e-n+s],i[e-n+s]=o}t+=n,e-=n}}function $l(i,t,e,n){let s=0,o=i[e-n],a=i[e-n+1];for(;t<e;t+=n){const h=i[t],c=i[t+1];s+=(h-o)*(c+a),o=h,a=c}return s===0?void 0:s>0}function ql(i,t,e,n,s){s=s!==void 0?s:!1;for(let o=0,a=e.length;o<a;++o){const h=e[o],c=$l(i,t,h,n);if(o===0){if(s&&c||!s&&!c)return!1}else if(s&&!c||!s&&c)return!1;t=h}return!0}function Dd(i,t,e,n,s){for(let o=0,a=e.length;o<a;++o){const h=e[o];if(!ql(i,t,h,n,s))return!1;h.length&&(t=h[h.length-1])}return!0}function po(i,t,e,n,s){s=s!==void 0?s:!1;for(let o=0,a=e.length;o<a;++o){const h=e[o],c=$l(i,t,h,n);(o===0?s&&c||!s&&!c:s&&!c||!s&&c)&&Pm(i,t,h,n),t=h}return t}function yl(i,t,e,n,s){for(let o=0,a=e.length;o<a;++o)t=po(i,t,e[o],n,s);return t}function Mm(i,t){const e=[];let n=0,s=0,o;for(let a=0,h=t.length;a<h;++a){const c=t[a],d=$l(i,n,c,2);if(o===void 0&&(o=d),d===o)e.push(t.slice(s,a+1));else{if(e.length===0)continue;e[e.length-1].push(t[s])}s=a+1,n=c}return e}class ji extends Cn{constructor(t,e,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&n?(this.setFlatCoordinates(e,t),this.ends_=n):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?qe(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new ji(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,s){return s<xn(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(jl(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ul(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,n,s))}containsXY(t,e){return Kl(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return Pd(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),po(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,Js(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=Xi(this.getExtent());this.flatInteriorPoint_=Hl(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new ns(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new Qs(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,n=this.ends_,s=[];let o=0;for(let a=0,h=n.length;a<h;++a){const c=n[a],d=new Qs(e.slice(o,c),t);s.push(d),o=c}return s}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;ql(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=po(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=Vl(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,n),new ji(e,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return kd(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=ur(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}function Xc(i){if(hr(i))throw new Error("Cannot create polygon from empty extent");const t=i[0],e=i[1],n=i[2],s=i[3],o=[t,e,t,s,n,s,n,e,t,e];return new ji(o,"XY",[o.length])}function Jl(i,t,e,n){const s=Ct(t)/e[0],o=ie(t)/e[1];return n?Math.min(i,Math.max(s,o)):Math.min(i,Math.min(s,o))}function Ql(i,t,e){let n=Math.min(i,t);const s=50;return n*=Math.log(1+s*Math.max(0,i/t-1))/s+1,e&&(n=Math.max(n,e),n/=Math.log(1+s*Math.max(0,e/i-1))/s+1),Mt(n,e/2,t*2)}function Rm(i,t,e,n){return t=t!==void 0?t:!0,function(s,o,a,h){if(s!==void 0){const c=i[0],d=i[i.length-1],f=e?Jl(c,e,a,n):c;if(h)return t?Ql(s,f,d):Mt(s,d,f);const _=Math.min(f,s),p=Math.floor(Rl(i,_,o));return i[p]>f&&p<i.length-1?i[p+1]:i[p]}}}function Im(i,t,e,n,s,o){return n=n!==void 0?n:!0,e=e!==void 0?e:0,function(a,h,c,d){if(a!==void 0){const f=s?Jl(t,s,c,o):t;if(d)return n?Ql(a,f,e):Mt(a,e,f);const _=1e-9,p=Math.ceil(Math.log(t/f)/Math.log(i)-_),y=-h*(.5-_)+.5,v=Math.min(f,a),w=Math.floor(Math.log(t/v)/Math.log(i)+y),C=Math.max(p,w),E=t/Math.pow(i,C);return Mt(E,e,f)}}}function jc(i,t,e,n,s){return e=e!==void 0?e:!0,function(o,a,h,c){if(o!==void 0){const d=n?Jl(i,n,h,s):i;return!e||!c?Mt(o,t,d):Ql(o,d,t)}}}function th(i){if(i!==void 0)return 0}function Yc(i){if(i!==void 0)return i}function Am(i){const t=2*Math.PI/i;return function(e,n){if(n)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function Om(i){const t=Ni(5);return function(e,n){return n||e===void 0?e:Math.abs(e)<=t?0:e}}const km=42,eh=256,Aa=0;class Ue extends Ne{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Gl(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&Cd(),t.center&&(t.center=ke(t.center,this.projection_)),t.extent&&(t.extent=He(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const h in Ae)delete e[h];this.setProperties(e,!0);const n=Fm(t);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=n.minZoom;const s=Dm(t),o=n.constraint,a=zm(t);this.constraints_={center:s,resolution:o,rotation:a},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const n=this.getCenterInternal();if(n){const s=t||[0,0,0,0];e=e||[0,0,0,0];const o=this.getResolution(),a=o/2*(s[3]-e[3]+e[1]-s[1]),h=o/2*(s[0]-e[0]+e[2]-s[2]);this.setCenterInternal([n[0]+a,n[1]-h])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let n=0;n<e.length;++n){let s=arguments[n];s.center&&(s=Object.assign({},s),s.center=ke(s.center,this.getProjection())),s.anchor&&(s=Object.assign({},s),s.anchor=ke(s.anchor,this.getProjection())),e[n]=s}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,n;e>1&&typeof arguments[e-1]=="function"&&(n=arguments[e-1],--e);let s=0;for(;s<e&&!this.isDef();++s){const f=arguments[s];f.center&&this.setCenterInternal(f.center),f.zoom!==void 0?this.setZoom(f.zoom):f.resolution&&this.setResolution(f.resolution),f.rotation!==void 0&&this.setRotation(f.rotation)}if(s===e){n&&Vr(n,!0);return}let o=Date.now(),a=this.targetCenter_.slice(),h=this.targetResolution_,c=this.targetRotation_;const d=[];for(;s<e;++s){const f=arguments[s],_={start:o,complete:!1,anchor:f.anchor,duration:f.duration!==void 0?f.duration:1e3,easing:f.easing||A_,callback:n};if(f.center&&(_.sourceCenter=a,_.targetCenter=f.center.slice(),a=_.targetCenter),f.zoom!==void 0?(_.sourceResolution=h,_.targetResolution=this.getResolutionForZoom(f.zoom),h=_.targetResolution):f.resolution&&(_.sourceResolution=h,_.targetResolution=f.resolution,h=_.targetResolution),f.rotation!==void 0){_.sourceRotation=c;const p=fn(f.rotation-c+Math.PI,2*Math.PI)-Math.PI;_.targetRotation=c+p,c=_.targetRotation}Nm(_)?_.complete=!0:o+=_.duration,d.push(_)}this.animations_.push(d),this.setHint(qt.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[qt.ANIMATING]>0}getInteracting(){return this.hints_[qt.INTERACTING]>0}cancelAnimations(){this.setHint(qt.ANIMATING,-this.hints_[qt.ANIMATING]);let t;for(let e=0,n=this.animations_.length;e<n;++e){const s=this.animations_[e];if(s[0].callback&&Vr(s[0].callback,!1),!t)for(let o=0,a=s.length;o<a;++o){const h=s[o];if(!h.complete){t=h.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let n=this.animations_.length-1;n>=0;--n){const s=this.animations_[n];let o=!0;for(let a=0,h=s.length;a<h;++a){const c=s[a];if(c.complete)continue;const d=t-c.start;let f=c.duration>0?d/c.duration:1;f>=1?(c.complete=!0,f=1):o=!1;const _=c.easing(f);if(c.sourceCenter){const p=c.sourceCenter[0],y=c.sourceCenter[1],v=c.targetCenter[0],w=c.targetCenter[1];this.nextCenter_=c.targetCenter;const C=p+_*(v-p),E=y+_*(w-y);this.targetCenter_=[C,E]}if(c.sourceResolution&&c.targetResolution){const p=_===1?c.targetResolution:c.sourceResolution+_*(c.targetResolution-c.sourceResolution);if(c.anchor){const y=this.getViewportSize_(this.getRotation()),v=this.constraints_.resolution(p,0,y,!0);this.targetCenter_=this.calculateCenterZoom(v,c.anchor)}this.nextResolution_=c.targetResolution,this.targetResolution_=p,this.applyTargetState_(!0)}if(c.sourceRotation!==void 0&&c.targetRotation!==void 0){const p=_===1?fn(c.targetRotation+Math.PI,2*Math.PI)-Math.PI:c.sourceRotation+_*(c.targetRotation-c.sourceRotation);if(c.anchor){const y=this.constraints_.rotation(p,!0);this.targetCenter_=this.calculateCenterRotate(y,c.anchor)}this.nextRotation_=c.targetRotation,this.targetRotation_=p}if(this.applyTargetState_(!0),e=!0,!c.complete)break}if(o){this.animations_[n]=null,this.setHint(qt.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const a=s[0].callback;a&&Vr(a,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let n;const s=this.getCenterInternal();return s!==void 0&&(n=[s[0]-e[0],s[1]-e[1]],kl(n,t-this.getRotation()),M_(n,e)),n}calculateCenterZoom(t,e){let n;const s=this.getCenterInternal(),o=this.getResolution();if(s!==void 0&&o!==void 0){const a=e[0]-t*(e[0]-s[0])/o,h=e[1]-t*(e[1]-s[1])/o;n=[a,h]}return n}getViewportSize_(t){const e=this.viewportSize_;if(t){const n=e[0],s=e[1];return[Math.abs(n*Math.cos(t))+Math.abs(s*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(s*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&mo(t,this.getProjection())}getCenterInternal(){return this.get(Ae.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return Ed(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();xt(e,"The view center is not defined");const n=this.getResolution();xt(n!==void 0,"The view resolution is not defined");const s=this.getRotation();return xt(s!==void 0,"The view rotation is not defined"),fl(e,n,s,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(Ae.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(He(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const n=Ct(t)/e[0],s=ie(t)/e[1];return Math.max(n,s)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,s=Math.log(e/n)/Math.log(t);return function(o){return e/Math.pow(t,o*s)}}getRotation(){return this.get(Ae.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),s=this.minResolution_,o=Math.log(n/s)/e;return function(a){return Math.log(n/a)/e/o}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const n=this.padding_;return n&&(e=[e[0]-n[1]-n[3],e[1]-n[0]-n[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),n=this.getRotation();let s=this.getCenterInternal();const o=this.padding_;if(o){const a=this.getViewportSizeMinusPadding_();s=Oa(s,this.getViewportSize_(),[a[0]/2+o[3],a[1]/2+o[0]],e,n)}return{center:s.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,n,s;if(this.resolutions_){const o=Rl(this.resolutions_,t,1);e=o,n=this.resolutions_[o],o==this.resolutions_.length-1?s=2:s=n/this.resolutions_[o+1]}else n=this.maxResolution_,s=this.zoomFactor_;return e+Math.log(n/t)/Math.log(s)}getResolutionForZoom(t){var e;if((e=this.resolutions_)!=null&&e.length){if(this.resolutions_.length===1)return this.resolutions_[0];const n=Mt(Math.floor(t),0,this.resolutions_.length-2),s=this.resolutions_[n]/this.resolutions_[n+1];return this.resolutions_[n]/Math.pow(s,Mt(t-n,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let n;if(xt(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){xt(!hr(t),"Cannot fit empty extent provided as `geometry`");const s=He(t,this.getProjection());n=Xc(s)}else if(t.getType()==="Circle"){const s=He(t.getExtent(),this.getProjection());n=Xc(s),n.rotate(this.getRotation(),Xi(s))}else n=t;this.fitInternal(n,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),n=Math.cos(e),s=Math.sin(-e),o=t.getFlatCoordinates(),a=t.getStride();let h=1/0,c=1/0,d=-1/0,f=-1/0;for(let _=0,p=o.length;_<p;_+=a){const y=o[_]*n-o[_+1]*s,v=o[_]*s+o[_+1]*n;h=Math.min(h,y),c=Math.min(c,v),d=Math.max(d,y),f=Math.max(f,v)}return[h,c,d,f]}fitInternal(t,e){e=e||{};let n=e.size;n||(n=this.getViewportSizeMinusPadding_());const s=e.padding!==void 0?e.padding:[0,0,0,0],o=e.nearest!==void 0?e.nearest:!1;let a;e.minResolution!==void 0?a=e.minResolution:e.maxZoom!==void 0?a=this.getResolutionForZoom(e.maxZoom):a=0;const h=this.rotatedExtentForGeometry(t);let c=this.getResolutionForExtentInternal(h,[n[0]-s[1]-s[3],n[1]-s[0]-s[2]]);c=isNaN(c)?a:Math.max(c,a),c=this.getConstrainedResolution(c,o?0:1);const d=this.getRotation(),f=Math.sin(d),_=Math.cos(d),p=Xi(h);p[0]+=(s[1]-s[3])/2*c,p[1]+=(s[0]-s[2])/2*c;const y=p[0]*_-p[1]*f,v=p[1]*_+p[0]*f,w=this.getConstrainedCenter([y,v],c),C=e.callback?e.callback:Ks;e.duration!==void 0?this.animateInternal({resolution:c,center:w,duration:e.duration,easing:e.easing},C):(this.targetResolution_=c,this.targetCenter_=w,this.applyTargetState_(!1,!0),Vr(C,!0))}centerOn(t,e,n){this.centerOnInternal(ke(t,this.getProjection()),e,n)}centerOnInternal(t,e,n){this.setCenterInternal(Oa(t,e,n,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,n,s){let o;const a=this.padding_;if(a&&t){const h=this.getViewportSizeMinusPadding_(-n),c=Oa(t,s,[h[0]/2+a[3],h[1]/2+a[0]],e,n);o=[t[0]-c[0],t[1]-c[1]]}return o}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=mo(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&ke(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const n=this.getAnimating()||this.getInteracting(),s=this.getViewportSize_(this.getRotation()),o=this.constraints_.resolution(this.targetResolution_*t,0,s,n);e&&(this.targetCenter_=this.calculateCenterZoom(o,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=ke(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const n=this.getAnimating()||this.getInteracting(),s=this.constraints_.rotation(this.targetRotation_+t,n);e&&(this.targetCenter_=this.calculateCenterRotate(s,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&ke(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const n=this.getAnimating()||this.getInteracting()||e,s=this.constraints_.rotation(this.targetRotation_,n),o=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,0,o,n),h=this.constraints_.center(this.targetCenter_,a,o,n,this.calculateCenterShift(this.targetCenter_,a,s,o));this.get(Ae.ROTATION)!==s&&this.set(Ae.ROTATION,s),this.get(Ae.RESOLUTION)!==a&&(this.set(Ae.RESOLUTION,a),this.set("zoom",this.getZoom(),!0)),(!h||!this.get(Ae.CENTER)||!fo(this.get(Ae.CENTER),h))&&this.set(Ae.CENTER,h),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,n){t=t!==void 0?t:200;const s=e||0,o=this.constraints_.rotation(this.targetRotation_),a=this.getViewportSize_(o),h=this.constraints_.resolution(this.targetResolution_,s,a),c=this.constraints_.center(this.targetCenter_,h,a,!1,this.calculateCenterShift(this.targetCenter_,h,o,a));if(t===0&&!this.cancelAnchor_){this.targetResolution_=h,this.targetRotation_=o,this.targetCenter_=c,this.applyTargetState_();return}n=n||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==h||this.getRotation()!==o||!this.getCenterInternal()||!fo(this.getCenterInternal(),c))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:o,center:c,resolution:h,duration:t,easing:ls,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(qt.INTERACTING,1)}endInteraction(t,e,n){n=n&&ke(n,this.getProjection()),this.endInteractionInternal(t,e,n)}endInteractionInternal(t,e,n){this.getInteracting()&&(this.setHint(qt.INTERACTING,-1),this.resolveConstraints(t,e,n))}getConstrainedCenter(t,e){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),n)}getConstrainedZoom(t,e){const n=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(n,e))}getConstrainedResolution(t,e){e=e||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,n)}}function Vr(i,t){setTimeout(function(){i(t)},0)}function Dm(i){if(i.extent!==void 0){const e=i.smoothExtentConstraint!==void 0?i.smoothExtentConstraint:!0;return Sc(i.extent,i.constrainOnlyCenter,e)}const t=Gl(i.projection,"EPSG:3857");if(i.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,Sc(e,!1,!1)}return b_}function Fm(i){let t,e,n,a=i.minZoom!==void 0?i.minZoom:Aa,h=i.maxZoom!==void 0?i.maxZoom:28;const c=i.zoomFactor!==void 0?i.zoomFactor:2,d=i.multiWorld!==void 0?i.multiWorld:!1,f=i.smoothResolutionConstraint!==void 0?i.smoothResolutionConstraint:!0,_=i.showFullExtent!==void 0?i.showFullExtent:!1,p=Gl(i.projection,"EPSG:3857"),y=p.getExtent();let v=i.constrainOnlyCenter,w=i.extent;if(!d&&!w&&p.isGlobal()&&(v=!1,w=y),i.resolutions!==void 0){const C=i.resolutions;e=C[a],n=C[h]!==void 0?C[h]:C[C.length-1],i.constrainResolution?t=Rm(C,f,!v&&w,_):t=jc(e,n,f,!v&&w,_)}else{const E=(y?Math.max(Ct(y),ie(y)):360*Dl.degrees/p.getMetersPerUnit())/eh/Math.pow(2,Aa),T=E/Math.pow(2,28-Aa);e=i.maxResolution,e!==void 0?a=0:e=E/Math.pow(c,a),n=i.minResolution,n===void 0&&(i.maxZoom!==void 0?i.maxResolution!==void 0?n=e/Math.pow(c,h):n=E/Math.pow(c,h):n=T),h=a+Math.floor(Math.log(e/n)/Math.log(c)),n=e/Math.pow(c,h-a),i.constrainResolution?t=Im(c,e,n,f,!v&&w,_):t=jc(e,n,f,!v&&w,_)}return{constraint:t,maxResolution:e,minResolution:n,minZoom:a,zoomFactor:c}}function zm(i){if(i.enableRotation!==void 0?i.enableRotation:!0){const e=i.constrainRotation;return e===void 0||e===!0?Om():e===!1?Yc:typeof e=="number"?Am(e):Yc}return th}function Nm(i){return!(i.sourceCenter&&i.targetCenter&&!fo(i.sourceCenter,i.targetCenter)||i.sourceResolution!==i.targetResolution||i.sourceRotation!==i.targetRotation)}function Oa(i,t,e,n,s){const o=Math.cos(-s);let a=Math.sin(-s),h=i[0]*o-i[1]*a,c=i[1]*o+i[0]*a;h+=(t[0]/2-e[0])*n,c+=(e[1]-t[1]/2)*n,a=-a;const d=h*o-c*a,f=c*o+h*a;return[d,f]}const Kr="ol-hidden",Zm="ol-selectable",Uo="ol-unselectable",ih="ol-control",Uc="ol-collapsed",Gm=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z0-9]+?)\\s*$`].join(""),"i"),Vc=["style","variant","weight","size","lineHeight","family"],Fd=function(i){const t=i.match(Gm);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let n=0,s=Vc.length;n<s;++n){const o=t[n+1];o!==void 0&&(e[Vc[n]]=o)}return e.families=e.family.split(/,\s?/),e};function Gt(i,t,e,n){let s;return e&&e.length?s=e.shift():nd?s=new OffscreenCanvas(i||300,t||300):s=document.createElement("canvas"),i&&(s.width=i),t&&(s.height=t),s.getContext("2d",n)}let ka;function yo(){return ka||(ka=Gt(1,1)),ka}function Vo(i){const t=i.canvas;t.width=1,t.height=1,i.clearRect(0,0,1,1)}function Bm(i){let t=i.offsetWidth;const e=getComputedStyle(i);return t+=parseInt(e.marginLeft,10)+parseInt(e.marginRight,10),t}function Wm(i){let t=i.offsetHeight;const e=getComputedStyle(i);return t+=parseInt(e.marginTop,10)+parseInt(e.marginBottom,10),t}function Kc(i,t){const e=t.parentNode;e&&e.replaceChild(i,t)}function zd(i){for(;i.lastChild;)i.lastChild.remove()}function Xm(i,t){const e=i.childNodes;for(let n=0;;++n){const s=e[n],o=t[n];if(!s&&!o)break;if(s!==o){if(!s){i.appendChild(o);continue}if(!o){i.removeChild(s),--n;continue}i.insertBefore(o,s)}}}class nh extends Ne{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){var t;(t=this.element)==null||t.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(t){var e;this.map_&&((e=this.element)==null||e.remove());for(let n=0,s=this.listenerKeys.length;n<s;++n)Lt(this.listenerKeys[n]);if(this.listenerKeys.length=0,this.map_=t,t){const n=this.target_??t.getOverlayContainerStopEvent();this.element&&n.appendChild(this.element),this.render!==Ks&&this.listenerKeys.push(_t(t,gi.POSTRENDER,this.render,this)),t.render()}}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}class jm extends nh{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=t.attributions;const e=t.className!==void 0?t.className:"ol-attribution",n=t.tipLabel!==void 0?t.tipLabel:"Attributions",s=t.expandClassName!==void 0?t.expandClassName:e+"-expand",o=t.collapseLabel!==void 0?t.collapseLabel:"›",a=t.collapseClassName!==void 0?t.collapseClassName:e+"-collapse";typeof o=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=o,this.collapseLabel_.className=a):this.collapseLabel_=o;const h=t.label!==void 0?t.label:"i";typeof h=="string"?(this.label_=document.createElement("span"),this.label_.textContent=h,this.label_.className=s):this.label_=h;const c=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(c),this.toggleButton_.addEventListener(rt.CLICK,this.handleClick_.bind(this),!1);const d=e+" "+Uo+" "+ih+(this.collapsed_&&this.collapsible_?" "+Uc:"")+(this.collapsible_?"":" ol-uncollapsible"),f=this.element;f.className=d,f.appendChild(this.toggleButton_),f.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e=this.getMap().getAllLayers(),n=new Set(e.flatMap(s=>s.getAttributions(t)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(s=>n.add(s)):n.add(this.attributions_)),!this.overrideCollapsible_){const s=!e.some(o=>{var a;return((a=o.getSource())==null?void 0:a.getAttributionsCollapsible())===!1});this.setCollapsible(s)}return Array.from(n)}async updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=await Promise.all(this.collectSourceAttributions_(t).map(s=>d_(()=>s))),n=e.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!Ui(e,this.renderedAttributions_)){zd(this.ulElement_);for(let s=0,o=e.length;s<o;++s){const a=document.createElement("li");a.innerHTML=e[s],this.ulElement_.appendChild(a)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Uc),this.collapsed_?Kc(this.collapseLabel_,this.label_):Kc(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}}class Ym extends nh{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=t.className!==void 0?t.className:"ol-rotate",n=t.label!==void 0?t.label:"⇧",s=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=s,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(s));const o=t.tipLabel?t.tipLabel:"Reset rotation",a=document.createElement("button");a.className=e+"-reset",a.setAttribute("type","button"),a.title=o,a.appendChild(this.label_),a.addEventListener(rt.CLICK,this.handleClick_.bind(this),!1);const h=e+" "+Uo+" "+ih,c=this.element;c.className=h,c.appendChild(a),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Kr)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const n=e.getRotation();n!==void 0&&(this.duration_>0&&n%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:ls}):e.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const n=e.viewState.rotation;if(n!=this.rotation_){const s="rotate("+n+"rad)";if(this.autoHide_){const o=this.element.classList.contains(Kr);!o&&n===0?this.element.classList.add(Kr):o&&n!==0&&this.element.classList.remove(Kr)}this.label_.style.transform=s}this.rotation_=n}}class Um extends nh{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=t.className!==void 0?t.className:"ol-zoom",n=t.delta!==void 0?t.delta:1,s=t.zoomInClassName!==void 0?t.zoomInClassName:e+"-in",o=t.zoomOutClassName!==void 0?t.zoomOutClassName:e+"-out",a=t.zoomInLabel!==void 0?t.zoomInLabel:"+",h=t.zoomOutLabel!==void 0?t.zoomOutLabel:"–",c=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",d=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",f=document.createElement("button");f.className=s,f.setAttribute("type","button"),f.title=c,f.appendChild(typeof a=="string"?document.createTextNode(a):a),f.addEventListener(rt.CLICK,this.handleClick_.bind(this,n),!1);const _=document.createElement("button");_.className=o,_.setAttribute("type","button"),_.title=d,_.appendChild(typeof h=="string"?document.createTextNode(h):h),_.addEventListener(rt.CLICK,this.handleClick_.bind(this,-n),!1);const p=e+" "+Uo+" "+ih,y=this.element;y.className=p,y.appendChild(f),y.appendChild(_),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const n=this.getMap().getView();if(!n)return;const s=n.getZoom();if(s!==void 0){const o=n.getConstrainedZoom(s+t);this.duration_>0?(n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:o,duration:this.duration_,easing:ls})):n.setZoom(o)}}}function Vm(i){i=i||{};const t=new Ke;return(i.zoom!==void 0?i.zoom:!0)&&t.push(new Um(i.zoomOptions)),(i.rotate!==void 0?i.rotate:!0)&&t.push(new Ym(i.rotateOptions)),(i.attribution!==void 0?i.attribution:!0)&&t.push(new jm(i.attributionOptions)),t}class Km{constructor(t,e,n){this.decay_=t,this.minVelocity_=e,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let n=e-3;for(;n>0&&this.points_[n+2]>t;)n-=3;const s=this.points_[e+2]-this.points_[n+2];if(s<1e3/60)return!1;const o=this.points_[e]-this.points_[n],a=this.points_[e+1]-this.points_[n+1];return this.angle_=Math.atan2(a,o),this.initialVelocity_=Math.sqrt(o*o+a*a)/s,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const Hc={ACTIVE:"active"};class dr extends Ne{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Hc.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(Hc.ACTIVE,t)}setMap(t){this.map_=t}}function Hm(i,t,e){const n=i.getCenterInternal();if(n){const s=[n[0]+t[0],n[1]+t[1]];i.animateInternal({duration:e!==void 0?e:250,easing:O_,center:i.getConstrainedCenter(s)})}}function sh(i,t,e,n){const s=i.getZoom();if(s===void 0)return;const o=i.getConstrainedZoom(s+t),a=i.getResolutionForZoom(o);i.getAnimating()&&i.cancelAnimations(),i.animate({resolution:a,anchor:e,duration:n!==void 0?n:250,easing:ls})}class Nd extends dr{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let e=!1;if(t.type==Rt.DBLCLICK){const n=t.originalEvent,s=t.map,o=t.coordinate,a=n.shiftKey?-this.delta_:this.delta_,h=s.getView();sh(h,a,o,this.duration_),n.preventDefault(),e=!0}return!e}}function vl(i){const t=arguments;return function(e){let n=!0;for(let s=0,o=t.length;s<o&&(n=n&&t[s](e),!!n);++s);return n}}const $m=function(i){const t=i.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},qm=function(i){const t=i.map.getTargetElement(),e=t.getRootNode(),n=i.map.getOwnerDocument().activeElement;return e instanceof ShadowRoot?e.host.contains(n):t.contains(n)},Zd=function(i){const t=i.map.getTargetElement(),e=t.getRootNode();return(e instanceof ShadowRoot?e.host:t).hasAttribute("tabindex")?qm(i):!0},Jm=Vs,Gd=function(i){const t=i.originalEvent;return t instanceof PointerEvent&&t.button==0&&!(m_&&id&&t.ctrlKey)},Bd=function(i){const t=i.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},Qm=function(i){const t=i.originalEvent;return id?t.metaKey:t.ctrlKey},tp=function(i){const t=i.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},Wd=function(i){const t=i.originalEvent,e=t.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"&&!t.target.isContentEditable},Da=function(i){const t=i.originalEvent;return t instanceof PointerEvent&&t.pointerType=="mouse"},ep=function(i){const t=i.originalEvent;return t instanceof PointerEvent&&t.isPrimary&&t.button===0};class fr extends dr{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==Rt.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==Rt.POINTERUP){const n=this.handleUpEvent(t);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(t.type==Rt.POINTERDOWN){const n=this.handleDownEvent(t);this.handlingDownUpSequence=n,e=this.stopDown(n)}else t.type==Rt.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}}function rh(i){const t=i.length;let e=0,n=0;for(let s=0;s<t;s++)e+=i[s].clientX,n+=i[s].clientY;return{clientX:e/t,clientY:n/t}}class ip extends fr{constructor(t){super({stopDown:Do}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:vl(Bd,ep);this.condition_=t.onFocusOnly?vl(Zd,e):e,this.noKinetic_=!1}handleDragEvent(t){const e=t.map;this.panning_||(this.panning_=!0,e.getView().beginInteraction());const n=this.targetPointers,s=e.getEventPixel(rh(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(s[0],s[1]),this.lastCentroid){const o=[this.lastCentroid[0]-s[0],s[1]-this.lastCentroid[1]],h=t.map.getView();R_(o,h.getResolution()),kl(o,h.getRotation()),h.adjustCenterInternal(o)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=s,this.lastPointersCount_=n.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,n=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const s=this.kinetic_.getDistance(),o=this.kinetic_.getAngle(),a=n.getCenterInternal(),h=e.getPixelFromCoordinateInternal(a),c=e.getCoordinateFromPixelInternal([h[0]-s*Math.cos(o),h[1]-s*Math.sin(o)]);n.animateInternal({center:n.getConstrainedCenter(c),duration:500,easing:ls})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const n=t.map.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class np extends fr{constructor(t){t=t||{},super({stopDown:Do}),this.condition_=t.condition?t.condition:$m,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!Da(t))return;const e=t.map,n=e.getView();if(n.getConstraints().rotation===th)return;const s=e.getSize(),o=t.pixel,a=Math.atan2(s[1]/2-o[1],o[0]-s[0]/2);if(this.lastAngle_!==void 0){const h=a-this.lastAngle_;n.adjustRotationInternal(-h)}this.lastAngle_=a}handleUpEvent(t){return Da(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return Da(t)&&Gd(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class sp extends ko{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,n="px",s=this.element_.style;s.left=Math.min(t[0],e[0])+n,s.top=Math.min(t[1],e[1])+n,s.width=Math.abs(e[0]-t[0])+n,s.height=Math.abs(e[1]-t[1])+n}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const t=this.startPixel_,e=this.endPixel_,s=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);s[4]=s[0].slice(),this.geometry_?this.geometry_.setCoordinates([s]):this.geometry_=new ji([s])}getGeometry(){return this.geometry_}}const zn={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class Ms extends vi{constructor(t,e,n){super(t),this.coordinate=e,this.mapBrowserEvent=n}}class rp extends fr{constructor(t){super(),this.on,this.once,this.un,t=t??{},this.box_=new sp(t.className||"ol-dragbox"),this.minArea_=t.minArea??64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition??Gd,this.boxEndCondition_=t.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,n){const s=n[0]-e[0],o=n[1]-e[1];return s*s+o*o>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.startPixel_&&(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new Ms(zn.BOXDRAG,t.coordinate,t)))}handleUpEvent(t){if(!this.startPixel_)return!1;const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new Ms(e?zn.BOXEND:zn.BOXCANCEL,t.coordinate,t)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Ms(zn.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}setActive(t){t||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new Ms(zn.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(t)}setMap(t){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new Ms(zn.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(t)}}class op extends rp{constructor(t){t=t||{};const e=t.condition?t.condition:tp;super({condition:e,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){const n=this.getMap().getView();let s=this.getGeometry();if(this.out_){const o=n.rotatedExtentForGeometry(s),a=n.getResolutionForExtentInternal(o),h=n.getResolution()/a;s=s.clone(),s.scale(h*h)}n.fitInternal(s,{duration:this.duration_,easing:ls})}}const nn={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class ap extends dr{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return Bd(e)&&Wd(e)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==rt.KEYDOWN){const n=t.originalEvent,s=n.key;if(this.condition_(t)&&(s==nn.DOWN||s==nn.LEFT||s==nn.RIGHT||s==nn.UP)){const a=t.map.getView(),h=a.getResolution()*this.pixelDelta_;let c=0,d=0;s==nn.DOWN?d=-h:s==nn.LEFT?c=-h:s==nn.RIGHT?c=h:d=h;const f=[c,d];kl(f,a.getRotation()),Hm(a,f,this.duration_),n.preventDefault(),e=!0}}return!e}}class lp extends dr{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:function(e){return!Qm(e)&&Wd(e)},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let e=!1;if(t.type==rt.KEYDOWN||t.type==rt.KEYPRESS){const n=t.originalEvent,s=n.key;if(this.condition_(t)&&(s==="+"||s==="-")){const o=t.map,a=s==="+"?this.delta_:-this.delta_,h=o.getView();sh(h,a,void 0,this.duration_),n.preventDefault(),e=!0}}return!e}}class hp extends dr{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;const e=t.condition?t.condition:Jm;this.condition_=t.onFocusOnly?vl(Zd,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(t){if(!this.condition_(t)||t.type!==rt.WHEEL)return!0;const n=t.map,s=t.originalEvent;s.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.pixel);let o;if(t.type==rt.WHEEL&&(o=s.deltaY,s.deltaMode===WheelEvent.DOM_DELTA_LINE&&(o*=40)),o===0)return!1;this.lastDelta_=o;const a=Date.now();this.startTime_===void 0&&(this.startTime_=a),(!this.mode_||a-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(o)<4?"trackpad":"wheel");const h=n.getView();if(this.mode_==="trackpad"&&!(h.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(h.getAnimating()&&h.cancelAnimations(),h.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),h.adjustZoom(-o/this.deltaPerZoom_,this.lastAnchor_?n.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=a,!1;this.totalDelta_+=o;const c=Math.max(this.timeout_-(a-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),c),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let n=-Mt(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),sh(e,n,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}}class cp extends fr{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=Do),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let e=0;const n=this.targetPointers[0],s=this.targetPointers[1],o=Math.atan2(s.clientY-n.clientY,s.clientX-n.clientX);if(this.lastAngle_!==void 0){const c=o-this.lastAngle_;this.rotationDelta_+=c,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=c}this.lastAngle_=o;const a=t.map,h=a.getView();h.getConstraints().rotation!==th&&(this.anchor_=a.getCoordinateFromPixelInternal(a.getEventPixel(rh(this.targetPointers))),this.rotating_&&(a.render(),h.adjustRotationInternal(e,this.anchor_)))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}class up extends fr{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=Do),super(e),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const n=this.targetPointers[0],s=this.targetPointers[1],o=n.clientX-s.clientX,a=n.clientY-s.clientY,h=Math.sqrt(o*o+a*a);this.lastDistance_!==void 0&&(e=this.lastDistance_/h),this.lastDistance_=h;const c=t.map,d=c.getView();e!=1&&(this.lastScaleDelta_=e),this.anchor_=c.getCoordinateFromPixelInternal(c.getEventPixel(rh(this.targetPointers))),c.render(),d.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const n=t.map.getView(),s=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,s),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}function dp(i){i=i||{};const t=new Ke,e=new Km(-.005,.05,100);return(i.altShiftDragRotate!==void 0?i.altShiftDragRotate:!0)&&t.push(new np),(i.doubleClickZoom!==void 0?i.doubleClickZoom:!0)&&t.push(new Nd({delta:i.zoomDelta,duration:i.zoomDuration})),(i.dragPan!==void 0?i.dragPan:!0)&&t.push(new ip({onFocusOnly:i.onFocusOnly,kinetic:e})),(i.pinchRotate!==void 0?i.pinchRotate:!0)&&t.push(new cp),(i.pinchZoom!==void 0?i.pinchZoom:!0)&&t.push(new up({duration:i.zoomDuration})),(i.keyboard!==void 0?i.keyboard:!0)&&(t.push(new ap),t.push(new lp({delta:i.zoomDelta,duration:i.zoomDuration}))),(i.mouseWheelZoom!==void 0?i.mouseWheelZoom:!0)&&t.push(new hp({onFocusOnly:i.onFocusOnly,duration:i.zoomDuration})),(i.shiftDragZoom!==void 0?i.shiftDragZoom:!0)&&t.push(new op({duration:i.zoomDuration})),t}const wt={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};let Xd=class extends Ne{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[wt.OPACITY]=t.opacity!==void 0?t.opacity:1,xt(typeof e[wt.OPACITY]=="number","Layer opacity must be a number"),e[wt.VISIBLE]=t.visible!==void 0?t.visible:!0,e[wt.Z_INDEX]=t.zIndex,e[wt.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[wt.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[wt.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[wt.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},n=this.getZIndex();return e.opacity=Mt(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=n===void 0&&!e.managed?1/0:n,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return st()}getLayerStatesArray(t){return st()}getExtent(){return this.get(wt.EXTENT)}getMaxResolution(){return this.get(wt.MAX_RESOLUTION)}getMinResolution(){return this.get(wt.MIN_RESOLUTION)}getMinZoom(){return this.get(wt.MIN_ZOOM)}getMaxZoom(){return this.get(wt.MAX_ZOOM)}getOpacity(){return this.get(wt.OPACITY)}getSourceState(){return st()}getVisible(){return this.get(wt.VISIBLE)}getZIndex(){return this.get(wt.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(wt.EXTENT,t)}setMaxResolution(t){this.set(wt.MAX_RESOLUTION,t)}setMinResolution(t){this.set(wt.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(wt.MAX_ZOOM,t)}setMinZoom(t){this.set(wt.MIN_ZOOM,t)}setOpacity(t){xt(typeof t=="number","Layer opacity must be a number"),this.set(wt.OPACITY,t)}setVisible(t){this.set(wt.VISIBLE,t)}setZIndex(t){this.set(wt.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}};class Di extends vi{constructor(t,e){super(t),this.layer=e}}const Fa={LAYERS:"layers"};class hs extends Xd{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let n=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Fa.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new Ke(n.slice(),{unique:!0}):xt(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new Ke(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(Lt),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(_t(t,ae.ADD,this.handleLayersAdd_,this),_t(t,ae.REMOVE,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(Lt);or(this.listenerKeys_);const e=t.getArray();for(let n=0,s=e.length;n<s;n++){const o=e[n];this.registerLayerListeners_(o),this.dispatchEvent(new Di("addlayer",o))}this.changed()}registerLayerListeners_(t){const e=[_t(t,es.PROPERTYCHANGE,this.handleLayerChange_,this),_t(t,rt.CHANGE,this.handleLayerChange_,this)];t instanceof hs&&e.push(_t(t,"addlayer",this.handleLayerGroupAdd_,this),_t(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[vt(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new Di("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new Di("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new Di("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,n=vt(e);this.listenerKeys_[n].forEach(Lt),delete this.listenerKeys_[n],this.dispatchEvent(new Di("removelayer",e)),this.changed()}getLayers(){return this.get(Fa.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const n=e.getArray();for(let s=0,o=n.length;s<o;++s)this.dispatchEvent(new Di("removelayer",n[s]))}this.set(Fa.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],n=e.length;this.getLayers().forEach(function(a){a.getLayerStatesArray(e)});const s=this.getLayerState();let o=s.zIndex;!t&&s.zIndex===void 0&&(o=0);for(let a=n,h=e.length;a<h;a++){const c=e[a];c.opacity*=s.opacity,c.visible=c.visible&&s.visible,c.maxResolution=Math.min(c.maxResolution,s.maxResolution),c.minResolution=Math.max(c.minResolution,s.minResolution),c.minZoom=Math.max(c.minZoom,s.minZoom),c.maxZoom=Math.min(c.maxZoom,s.maxZoom),s.extent!==void 0&&(c.extent!==void 0?c.extent=Zi(c.extent,s.extent):c.extent=s.extent),c.zIndex===void 0&&(c.zIndex=o)}return e}getSourceState(){return"ready"}}const Ce={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class gr extends Xd{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(wt.SOURCE,this.handleSourcePropertyChange_);const n=t.source?t.source:null;this.setSource(n)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(wt.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Lt(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=_t(t,rt.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0)),this.clearRenderer()),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e;const n=this.getMapInternal();!t&&n&&(t=n.getView()),t instanceof Ue?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&n&&(e.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let s;if(e.layerStatesArray){if(s=e.layerStatesArray.find(a=>a.layer===this),!s)return!1}else s=this.getLayerState();const o=this.getExtent();return oh(s,e.viewState)&&(!o||ee(o,e.extent))}getAttributions(t){var o;if(!this.isVisible(t))return[];const e=(o=this.getSource())==null?void 0:o.getAttributions();if(!e)return[];const n=t instanceof Ue?t.getViewStateAndExtent():t;let s=e(n);return Array.isArray(s)||(s=[s]),s}render(t,e){const n=this.getRenderer();return n.prepareFrame(t)?(this.rendered=!0,n.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){const e=this.getRenderer();e&&e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(wt.MAP,t)}getMapInternal(){return this.get(wt.MAP)}setMap(t){this.mapPrecomposeKey_&&(Lt(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(Lt(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=_t(t,Ce.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=_t(this,rt.CHANGE,t.render,t),this.changed())}handlePrecompose_(t){const e=t.frameState.layerStatesArray,n=this.getLayerState(!1);xt(!e.some(s=>s.layer===n.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),e.push(n)}setSource(t){this.set(wt.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}}function oh(i,t){if(!i.visible)return!1;const e=t.resolution;if(e<i.minResolution||e>=i.maxResolution)return!1;const n=t.zoom;return n>i.minZoom&&n<=i.maxZoom}function jd(i,t,e=0,n=i.length-1,s=fp){for(;n>e;){if(n-e>600){const c=n-e+1,d=t-e+1,f=Math.log(c),_=.5*Math.exp(2*f/3),p=.5*Math.sqrt(f*_*(c-_)/c)*(d-c/2<0?-1:1),y=Math.max(e,Math.floor(t-d*_/c+p)),v=Math.min(n,Math.floor(t+(c-d)*_/c+p));jd(i,t,y,v,s)}const o=i[t];let a=e,h=n;for(Rs(i,e,t),s(i[n],o)>0&&Rs(i,e,n);a<h;){for(Rs(i,a,h),a++,h--;s(i[a],o)<0;)a++;for(;s(i[h],o)>0;)h--}s(i[e],o)===0?Rs(i,e,h):(h++,Rs(i,h,n)),h<=t&&(e=h+1),t<=h&&(n=h-1)}}function Rs(i,t,e){const n=i[t];i[t]=i[e],i[e]=n}function fp(i,t){return i<t?-1:i>t?1:0}let Yd=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const n=[];if(!$r(t,e))return n;const s=this.toBBox,o=[];for(;e;){for(let a=0;a<e.children.length;a++){const h=e.children[a],c=e.leaf?s(h):h;$r(t,c)&&(e.leaf?n.push(h):Na(t,c)?this._all(h,n):o.push(h))}e=o.pop()}return n}collides(t){let e=this.data;if(!$r(t,e))return!1;const n=[];for(;e;){for(let s=0;s<e.children.length;s++){const o=e.children[s],a=e.leaf?this.toBBox(o):o;if($r(t,a)){if(e.leaf||Na(t,a))return!0;n.push(o)}}e=n.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let n=0;n<t.length;n++)this.insert(t[n]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const n=this.data;this.data=e,e=n}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=jn([]),this}remove(t,e){if(!t)return this;let n=this.data;const s=this.toBBox(t),o=[],a=[];let h,c,d;for(;n||o.length;){if(n||(n=o.pop(),c=o[o.length-1],h=a.pop(),d=!0),n.leaf){const f=gp(t,n.children,e);if(f!==-1)return n.children.splice(f,1),o.push(n),this._condense(o),this}!d&&!n.leaf&&Na(n,s)?(o.push(n),a.push(h),h=0,c=n,n=n.children[0]):c?(h++,n=c.children[h],d=!1):n=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const n=[];for(;t;)t.leaf?e.push(...t.children):n.push(...t.children),t=n.pop();return e}_build(t,e,n,s){const o=n-e+1;let a=this._maxEntries,h;if(o<=a)return h=jn(t.slice(e,n+1)),Nn(h,this.toBBox),h;s||(s=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,s-1))),h=jn([]),h.leaf=!1,h.height=s;const c=Math.ceil(o/a),d=c*Math.ceil(Math.sqrt(a));$c(t,e,n,d,this.compareMinX);for(let f=e;f<=n;f+=d){const _=Math.min(f+d-1,n);$c(t,f,_,c,this.compareMinY);for(let p=f;p<=_;p+=c){const y=Math.min(p+c-1,_);h.children.push(this._build(t,p,y,s-1))}}return Nn(h,this.toBBox),h}_chooseSubtree(t,e,n,s){for(;s.push(e),!(e.leaf||s.length-1===n);){let o=1/0,a=1/0,h;for(let c=0;c<e.children.length;c++){const d=e.children[c],f=za(d),_=pp(t,d)-f;_<a?(a=_,o=f<o?f:o,h=d):_===a&&f<o&&(o=f,h=d)}e=h||e.children[0]}return e}_insert(t,e,n){const s=n?t:this.toBBox(t),o=[],a=this._chooseSubtree(s,this.data,e,o);for(a.children.push(t),Ds(a,s);e>=0&&o[e].children.length>this._maxEntries;)this._split(o,e),e--;this._adjustParentBBoxes(s,o,e)}_split(t,e){const n=t[e],s=n.children.length,o=this._minEntries;this._chooseSplitAxis(n,o,s);const a=this._chooseSplitIndex(n,o,s),h=jn(n.children.splice(a,n.children.length-a));h.height=n.height,h.leaf=n.leaf,Nn(n,this.toBBox),Nn(h,this.toBBox),e?t[e-1].children.push(h):this._splitRoot(n,h)}_splitRoot(t,e){this.data=jn([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Nn(this.data,this.toBBox)}_chooseSplitIndex(t,e,n){let s,o=1/0,a=1/0;for(let h=e;h<=n-e;h++){const c=ks(t,0,h,this.toBBox),d=ks(t,h,n,this.toBBox),f=yp(c,d),_=za(c)+za(d);f<o?(o=f,s=h,a=_<a?_:a):f===o&&_<a&&(a=_,s=h)}return s||n-e}_chooseSplitAxis(t,e,n){const s=t.leaf?this.compareMinX:_p,o=t.leaf?this.compareMinY:mp,a=this._allDistMargin(t,e,n,s),h=this._allDistMargin(t,e,n,o);a<h&&t.children.sort(s)}_allDistMargin(t,e,n,s){t.children.sort(s);const o=this.toBBox,a=ks(t,0,e,o),h=ks(t,n-e,n,o);let c=Hr(a)+Hr(h);for(let d=e;d<n-e;d++){const f=t.children[d];Ds(a,t.leaf?o(f):f),c+=Hr(a)}for(let d=n-e-1;d>=e;d--){const f=t.children[d];Ds(h,t.leaf?o(f):f),c+=Hr(h)}return c}_adjustParentBBoxes(t,e,n){for(let s=n;s>=0;s--)Ds(e[s],t)}_condense(t){for(let e=t.length-1,n;e>=0;e--)t[e].children.length===0?e>0?(n=t[e-1].children,n.splice(n.indexOf(t[e]),1)):this.clear():Nn(t[e],this.toBBox)}};function gp(i,t,e){if(!e)return t.indexOf(i);for(let n=0;n<t.length;n++)if(e(i,t[n]))return n;return-1}function Nn(i,t){ks(i,0,i.children.length,t,i)}function ks(i,t,e,n,s){s||(s=jn(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let o=t;o<e;o++){const a=i.children[o];Ds(s,i.leaf?n(a):a)}return s}function Ds(i,t){return i.minX=Math.min(i.minX,t.minX),i.minY=Math.min(i.minY,t.minY),i.maxX=Math.max(i.maxX,t.maxX),i.maxY=Math.max(i.maxY,t.maxY),i}function _p(i,t){return i.minX-t.minX}function mp(i,t){return i.minY-t.minY}function za(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function Hr(i){return i.maxX-i.minX+(i.maxY-i.minY)}function pp(i,t){return(Math.max(t.maxX,i.maxX)-Math.min(t.minX,i.minX))*(Math.max(t.maxY,i.maxY)-Math.min(t.minY,i.minY))}function yp(i,t){const e=Math.max(i.minX,t.minX),n=Math.max(i.minY,t.minY),s=Math.min(i.maxX,t.maxX),o=Math.min(i.maxY,t.maxY);return Math.max(0,s-e)*Math.max(0,o-n)}function Na(i,t){return i.minX<=t.minX&&i.minY<=t.minY&&t.maxX<=i.maxX&&t.maxY<=i.maxY}function $r(i,t){return t.minX<=i.maxX&&t.minY<=i.maxY&&t.maxX>=i.minX&&t.maxY>=i.minY}function jn(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function $c(i,t,e,n,s){const o=[t,e];for(;o.length;){if(e=o.pop(),t=o.pop(),e-t<=n)continue;const a=t+Math.ceil((e-t)/n/2)*n;jd(i,a,t,e,s),o.push(t,a,a,e)}}const ah=[NaN,NaN,NaN,0];let Za;function vp(){return Za||(Za=Gt(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),Za}const xp=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,wp=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,Cp=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,Ep=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function qr(i,t){return i.endsWith("%")?Number(i.substring(0,i.length-1))/t:Number(i)}function Xs(i){throw new Error('failed to parse "'+i+'" as color')}function Ud(i){if(i.toLowerCase().startsWith("rgb")){const o=i.match(wp)||i.match(xp)||i.match(Cp);if(o){const a=o[4],h=100/255;return[Mt(qr(o[1],h)+.5|0,0,255),Mt(qr(o[2],h)+.5|0,0,255),Mt(qr(o[3],h)+.5|0,0,255),a!==void 0?Mt(qr(a,100),0,1):1]}Xs(i)}if(i.startsWith("#")){if(Ep.test(i)){const o=i.substring(1),a=o.length<=4?1:2,h=[0,0,0,255];for(let c=0,d=o.length;c<d;c+=a){let f=parseInt(o.substring(c,c+a),16);a===1&&(f+=f<<4),h[c/a]=f}return h[3]=h[3]/255,h}Xs(i)}const t=vp();t.fillStyle="#abcdef";let e=t.fillStyle;t.fillStyle=i,t.fillStyle===e&&(t.fillStyle="#fedcba",e=t.fillStyle,t.fillStyle=i,t.fillStyle===e&&Xs(i));const n=t.fillStyle;if(n.startsWith("#")||n.startsWith("rgba"))return Ud(n);t.clearRect(0,0,1,1),t.fillRect(0,0,1,1);const s=Array.from(t.getImageData(0,0,1,1).data);return s[3]=zo(s[3]/255,3),s}function bp(i){return typeof i=="string"?i:hh(i)}const Tp=1024,Is={};let Ga=0;function Lp(i){if(i.length===4)return i;const t=i.slice();return t[3]=1,t}function Ba(i){return i>.0031308?Math.pow(i,1/2.4)*269.025-14.025:i*3294.6}function Wa(i){return i>.2068965?Math.pow(i,3):(i-4/29)*(108/841)}function Xa(i){return i>10.314724?Math.pow((i+14.025)/269.025,2.4):i/3294.6}function ja(i){return i>.0088564?Math.pow(i,1/3):i/(108/841)+4/29}function qc(i){const t=Xa(i[0]),e=Xa(i[1]),n=Xa(i[2]),s=ja(t*.222488403+e*.716873169+n*.06060791),o=500*(ja(t*.452247074+e*.399439023+n*.148375274)-s),a=200*(s-ja(t*.016863605+e*.117638439+n*.865350722)),h=Math.atan2(a,o)*(180/Math.PI);return[116*s-16,Math.sqrt(o*o+a*a),h<0?h+360:h,i[3]]}function Sp(i){const t=(i[0]+16)/116,e=i[1],n=i[2]*Math.PI/180,s=Wa(t),o=Wa(t+e/500*Math.cos(n)),a=Wa(t-e/200*Math.sin(n)),h=Ba(o*3.021973625-s*1.617392459-a*.404875592),c=Ba(o*-.943766287+s*1.916279586+a*.027607165),d=Ba(o*.069407491-s*.22898585+a*1.159737864);return[Mt(h+.5|0,0,255),Mt(c+.5|0,0,255),Mt(d+.5|0,0,255),i[3]]}function lh(i){if(i==="none")return ah;if(Is.hasOwnProperty(i))return Is[i];if(Ga>=Tp){let e=0;for(const n in Is)(e++&3)===0&&(delete Is[n],--Ga)}const t=Ud(i);t.length!==4&&Xs(i);for(const e of t)isNaN(e)&&Xs(i);return Is[i]=t,++Ga,t}function ss(i){return Array.isArray(i)?i:lh(i)}function hh(i){let t=i[0];t!=(t|0)&&(t=t+.5|0);let e=i[1];e!=(e|0)&&(e=e+.5|0);let n=i[2];n!=(n|0)&&(n=n+.5|0);const s=i[3]===void 0?1:Math.round(i[3]*1e3)/1e3;return"rgba("+t+","+e+","+n+","+s+")"}function Jc(i){return i[0]>0&&i[1]>0}function Pp(i,t,e){return e===void 0&&(e=[0,0]),e[0]=i[0]*t+.5|0,e[1]=i[1]*t+.5|0,e}function ue(i,t){return Array.isArray(i)?i:(t===void 0?t=[i,i]:(t[0]=i,t[1]=i),t)}let bn=0;const te=1<<bn++,ft=1<<bn++,le=1<<bn++,De=1<<bn++,vn=1<<bn++,Fs=1<<bn++,Jr=Math.pow(2,bn)-1,ch={[te]:"boolean",[ft]:"number",[le]:"string",[De]:"color",[vn]:"number[]",[Fs]:"size"},Mp=Object.keys(ch).map(Number).sort(mi);function Rp(i){return i in ch}function zs(i){const t=[];for(const e of Mp)Ns(i,e)&&t.push(ch[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function Ns(i,t){return(i&t)===t}function Mi(i,t){return i===t}class Zt{constructor(t,e){if(!Rp(t))throw new Error(`literal expressions must have a specific type, got ${zs(t)}`);this.type=t,this.value=e}}class Ip{constructor(t,e,...n){this.type=t,this.operator=e,this.args=n}}function Vd(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function Vt(i,t,e){switch(typeof i){case"boolean":{if(Mi(t,le))return new Zt(le,i?"true":"false");if(!Ns(t,te))throw new Error(`got a boolean, but expected ${zs(t)}`);return new Zt(te,i)}case"number":{if(Mi(t,Fs))return new Zt(Fs,ue(i));if(Mi(t,te))return new Zt(te,!!i);if(Mi(t,le))return new Zt(le,i.toString());if(!Ns(t,ft))throw new Error(`got a number, but expected ${zs(t)}`);return new Zt(ft,i)}case"string":{if(Mi(t,De))return new Zt(De,lh(i));if(Mi(t,te))return new Zt(te,!!i);if(!Ns(t,le))throw new Error(`got a string, but expected ${zs(t)}`);return new Zt(le,i)}}if(!Array.isArray(i))throw new Error("expression must be an array or a primitive value");if(i.length===0)throw new Error("empty expression");if(typeof i[0]=="string")return Wp(i,t,e);for(const n of i)if(typeof n!="number")throw new Error("expected an array of numbers");if(Mi(t,Fs)){if(i.length!==2)throw new Error(`expected an array of two values for a size, got ${i.length}`);return new Zt(Fs,i)}if(Mi(t,De)){if(i.length===3)return new Zt(De,[...i,1]);if(i.length===4)return new Zt(De,i);throw new Error(`expected an array of 3 or 4 values for a color, got ${i.length}`)}if(!Ns(t,vn))throw new Error(`got an array of numbers, but expected ${zs(t)}`);return new Zt(vn,i)}const O={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},Ap={[O.Get]:nt(lt(1,1/0),Qc),[O.Var]:nt(lt(1,1),Op),[O.Has]:nt(lt(1,1/0),Qc),[O.Id]:nt(kp,Zn),[O.Concat]:nt(lt(2,1/0),yt(le)),[O.GeometryType]:nt(Dp,Zn),[O.LineMetric]:nt(Zn),[O.Resolution]:nt(Ya,Zn),[O.Zoom]:nt(Ya,Zn),[O.Time]:nt(Ya,Zn),[O.Any]:nt(lt(2,1/0),yt(te)),[O.All]:nt(lt(2,1/0),yt(te)),[O.Not]:nt(lt(1,1),yt(te)),[O.Equal]:nt(lt(2,2),yt(Jr)),[O.NotEqual]:nt(lt(2,2),yt(Jr)),[O.GreaterThan]:nt(lt(2,2),yt(ft)),[O.GreaterThanOrEqualTo]:nt(lt(2,2),yt(ft)),[O.LessThan]:nt(lt(2,2),yt(ft)),[O.LessThanOrEqualTo]:nt(lt(2,2),yt(ft)),[O.Multiply]:nt(lt(2,1/0),tu),[O.Coalesce]:nt(lt(2,1/0),tu),[O.Divide]:nt(lt(2,2),yt(ft)),[O.Add]:nt(lt(2,1/0),yt(ft)),[O.Subtract]:nt(lt(2,2),yt(ft)),[O.Clamp]:nt(lt(3,3),yt(ft)),[O.Mod]:nt(lt(2,2),yt(ft)),[O.Pow]:nt(lt(2,2),yt(ft)),[O.Abs]:nt(lt(1,1),yt(ft)),[O.Floor]:nt(lt(1,1),yt(ft)),[O.Ceil]:nt(lt(1,1),yt(ft)),[O.Round]:nt(lt(1,1),yt(ft)),[O.Sin]:nt(lt(1,1),yt(ft)),[O.Cos]:nt(lt(1,1),yt(ft)),[O.Atan]:nt(lt(1,2),yt(ft)),[O.Sqrt]:nt(lt(1,1),yt(ft)),[O.Match]:nt(lt(4,1/0),eu,zp),[O.Between]:nt(lt(3,3),yt(ft)),[O.Interpolate]:nt(lt(6,1/0),eu,Np),[O.Case]:nt(lt(3,1/0),Fp,Zp),[O.In]:nt(lt(2,2),Gp),[O.Number]:nt(lt(1,1/0),yt(Jr)),[O.String]:nt(lt(1,1/0),yt(Jr)),[O.Array]:nt(lt(1,1/0),yt(ft)),[O.Color]:nt(lt(1,4),yt(ft)),[O.Band]:nt(lt(1,3),yt(ft)),[O.Palette]:nt(lt(2,2),Bp),[O.ToString]:nt(lt(1,1),yt(te|ft|le|De))};function Qc(i,t,e){const n=i.length-1,s=new Array(n);for(let o=0;o<n;++o){const a=i[o+1];switch(typeof a){case"number":{s[o]=new Zt(ft,a);break}case"string":{s[o]=new Zt(le,a);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${a}`)}o===0&&e.properties.add(String(a))}return s}function Op(i,t,e){const n=i[1];if(typeof n!="string")throw new Error("expected a string argument for var operation");return e.variables.add(n),[new Zt(le,n)]}function kp(i,t,e){e.featureId=!0}function Dp(i,t,e){e.geometryType=!0}function Ya(i,t,e){e.mapState=!0}function Zn(i,t,e){const n=i[0];if(i.length!==1)throw new Error(`expected no arguments for ${n} operation`);return[]}function lt(i,t){return function(e,n,s){const o=e[0],a=e.length-1;if(i===t){if(a!==i){const h=i===1?"":"s";throw new Error(`expected ${i} argument${h} for ${o}, got ${a}`)}}else if(a<i||a>t){const h=t===1/0?`${i} or more`:`${i} to ${t}`;throw new Error(`expected ${h} arguments for ${o}, got ${a}`)}}}function tu(i,t,e){const n=i.length-1,s=new Array(n);for(let o=0;o<n;++o){const a=Vt(i[o+1],t,e);s[o]=a}return s}function yt(i){return function(t,e,n){const s=t.length-1,o=new Array(s);for(let a=0;a<s;++a){const h=Vt(t[a+1],i,n);o[a]=h}return o}}function Fp(i,t,e){const n=i[0],s=i.length-1;if(s%2===0)throw new Error(`expected an odd number of arguments for ${n}, got ${s} instead`)}function eu(i,t,e){const n=i[0],s=i.length-1;if(s%2===1)throw new Error(`expected an even number of arguments for operation ${n}, got ${s} instead`)}function zp(i,t,e){const n=i.length-1,s=le|ft|te,o=Vt(i[1],s,e),a=Vt(i[i.length-1],t,e),h=new Array(n-2);for(let c=0;c<n-2;c+=2){try{const d=Vt(i[c+2],o.type,e);h[c]=d}catch(d){throw new Error(`failed to parse argument ${c+1} of match expression: ${d.message}`)}try{const d=Vt(i[c+3],a.type,e);h[c+1]=d}catch(d){throw new Error(`failed to parse argument ${c+2} of match expression: ${d.message}`)}}return[o,...h,a]}function Np(i,t,e){const n=i[1];let s;switch(n[0]){case"linear":s=1;break;case"exponential":const c=n[1];if(typeof c!="number"||c<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(c)} instead`);s=c;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(n)}`)}const o=new Zt(ft,s);let a;try{a=Vt(i[2],ft,e)}catch(c){throw new Error(`failed to parse argument 1 in interpolate expression: ${c.message}`)}const h=new Array(i.length-3);for(let c=0;c<h.length;c+=2){try{const d=Vt(i[c+3],ft,e);h[c]=d}catch(d){throw new Error(`failed to parse argument ${c+2} for interpolate expression: ${d.message}`)}try{const d=Vt(i[c+4],t,e);h[c+1]=d}catch(d){throw new Error(`failed to parse argument ${c+3} for interpolate expression: ${d.message}`)}}return[o,a,...h]}function Zp(i,t,e){const n=Vt(i[i.length-1],t,e),s=new Array(i.length-1);for(let o=0;o<s.length-1;o+=2){try{const a=Vt(i[o+1],te,e);s[o]=a}catch(a){throw new Error(`failed to parse argument ${o} of case expression: ${a.message}`)}try{const a=Vt(i[o+2],n.type,e);s[o+1]=a}catch(a){throw new Error(`failed to parse argument ${o+1} of case expression: ${a.message}`)}}return s[s.length-1]=n,s}function Gp(i,t,e){let n=i[2];if(!Array.isArray(n))throw new Error('the second argument for the "in" operator must be an array');let s;if(typeof n[0]=="string"){if(n[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(n[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');n=n[1],s=le}else s=ft;const o=new Array(n.length);for(let h=0;h<o.length;h++)try{const c=Vt(n[h],s,e);o[h]=c}catch(c){throw new Error(`failed to parse haystack item ${h} for "in" expression: ${c.message}`)}return[Vt(i[1],s,e),...o]}function Bp(i,t,e){let n;try{n=Vt(i[1],ft,e)}catch(a){throw new Error(`failed to parse first argument in palette expression: ${a.message}`)}const s=i[2];if(!Array.isArray(s))throw new Error("the second argument of palette must be an array");const o=new Array(s.length);for(let a=0;a<o.length;a++){let h;try{h=Vt(s[a],De,e)}catch(c){throw new Error(`failed to parse color at index ${a} in palette expression: ${c.message}`)}if(!(h instanceof Zt))throw new Error(`the palette color at index ${a} must be a literal value`);o[a]=h}return[n,...o]}function nt(...i){return function(t,e,n){const s=t[0];let o;for(let a=0;a<i.length;a++){const h=i[a](t,e,n);if(a==i.length-1){if(!h)throw new Error("expected last argument validator to return the parsed args");o=h}}return new Ip(e,s,...o)}}function Wp(i,t,e){const n=i[0],s=Ap[n];if(!s)throw new Error(`unknown operator: ${n}`);return s(i,t,e)}function Kd(i){if(!i)return"";const t=i.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return Kd(i.getGeometries()[0]);default:return""}}function Hd(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function xi(i,t,e){const n=Vt(i,t,e);return Fe(n)}function Fe(i,t){if(i instanceof Zt){if(i.type===De&&typeof i.value=="string"){const n=lh(i.value);return function(){return n}}return function(){return i.value}}const e=i.operator;switch(e){case O.Number:case O.String:case O.Coalesce:return Xp(i);case O.Get:case O.Var:case O.Has:return jp(i);case O.Id:return n=>n.featureId;case O.GeometryType:return n=>n.geometryType;case O.Concat:{const n=i.args.map(s=>Fe(s));return s=>"".concat(...n.map(o=>o(s).toString()))}case O.Resolution:return n=>n.resolution;case O.Any:case O.All:case O.Between:case O.In:case O.Not:return Up(i);case O.Equal:case O.NotEqual:case O.LessThan:case O.LessThanOrEqualTo:case O.GreaterThan:case O.GreaterThanOrEqualTo:return Yp(i);case O.Multiply:case O.Divide:case O.Add:case O.Subtract:case O.Clamp:case O.Mod:case O.Pow:case O.Abs:case O.Floor:case O.Ceil:case O.Round:case O.Sin:case O.Cos:case O.Atan:case O.Sqrt:return Vp(i);case O.Case:return Kp(i);case O.Match:return Hp(i);case O.Interpolate:return $p(i);case O.ToString:return qp(i);default:throw new Error(`Unsupported operator ${e}`)}}function Xp(i,t){const e=i.operator,n=i.args.length,s=new Array(n);for(let o=0;o<n;++o)s[o]=Fe(i.args[o]);switch(e){case O.Coalesce:return o=>{for(let a=0;a<n;++a){const h=s[a](o);if(typeof h<"u"&&h!==null)return h}throw new Error("Expected one of the values to be non-null")};case O.Number:case O.String:return o=>{for(let a=0;a<n;++a){const h=s[a](o);if(typeof h===e)return h}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function jp(i,t){const n=i.args[0].value;switch(i.operator){case O.Get:return s=>{const o=i.args;let a=s.properties[n];for(let h=1,c=o.length;h<c;++h){const f=o[h].value;a=a[f]}return a};case O.Var:return s=>s.variables[n];case O.Has:return s=>{const o=i.args;if(!(n in s.properties))return!1;let a=s.properties[n];for(let h=1,c=o.length;h<c;++h){const f=o[h].value;if(!a||!Object.hasOwn(a,f))return!1;a=a[f]}return!0};default:throw new Error(`Unsupported accessor operator ${i.operator}`)}}function Yp(i,t){const e=i.operator,n=Fe(i.args[0]),s=Fe(i.args[1]);switch(e){case O.Equal:return o=>n(o)===s(o);case O.NotEqual:return o=>n(o)!==s(o);case O.LessThan:return o=>n(o)<s(o);case O.LessThanOrEqualTo:return o=>n(o)<=s(o);case O.GreaterThan:return o=>n(o)>s(o);case O.GreaterThanOrEqualTo:return o=>n(o)>=s(o);default:throw new Error(`Unsupported comparison operator ${e}`)}}function Up(i,t){const e=i.operator,n=i.args.length,s=new Array(n);for(let o=0;o<n;++o)s[o]=Fe(i.args[o]);switch(e){case O.Any:return o=>{for(let a=0;a<n;++a)if(s[a](o))return!0;return!1};case O.All:return o=>{for(let a=0;a<n;++a)if(!s[a](o))return!1;return!0};case O.Between:return o=>{const a=s[0](o),h=s[1](o),c=s[2](o);return a>=h&&a<=c};case O.In:return o=>{const a=s[0](o);for(let h=1;h<n;++h)if(a===s[h](o))return!0;return!1};case O.Not:return o=>!s[0](o);default:throw new Error(`Unsupported logical operator ${e}`)}}function Vp(i,t){const e=i.operator,n=i.args.length,s=new Array(n);for(let o=0;o<n;++o)s[o]=Fe(i.args[o]);switch(e){case O.Multiply:return o=>{let a=1;for(let h=0;h<n;++h)a*=s[h](o);return a};case O.Divide:return o=>s[0](o)/s[1](o);case O.Add:return o=>{let a=0;for(let h=0;h<n;++h)a+=s[h](o);return a};case O.Subtract:return o=>s[0](o)-s[1](o);case O.Clamp:return o=>{const a=s[0](o),h=s[1](o);if(a<h)return h;const c=s[2](o);return a>c?c:a};case O.Mod:return o=>s[0](o)%s[1](o);case O.Pow:return o=>Math.pow(s[0](o),s[1](o));case O.Abs:return o=>Math.abs(s[0](o));case O.Floor:return o=>Math.floor(s[0](o));case O.Ceil:return o=>Math.ceil(s[0](o));case O.Round:return o=>Math.round(s[0](o));case O.Sin:return o=>Math.sin(s[0](o));case O.Cos:return o=>Math.cos(s[0](o));case O.Atan:return n===2?o=>Math.atan2(s[0](o),s[1](o)):o=>Math.atan(s[0](o));case O.Sqrt:return o=>Math.sqrt(s[0](o));default:throw new Error(`Unsupported numeric operator ${e}`)}}function Kp(i,t){const e=i.args.length,n=new Array(e);for(let s=0;s<e;++s)n[s]=Fe(i.args[s]);return s=>{for(let o=0;o<e-1;o+=2)if(n[o](s))return n[o+1](s);return n[e-1](s)}}function Hp(i,t){const e=i.args.length,n=new Array(e);for(let s=0;s<e;++s)n[s]=Fe(i.args[s]);return s=>{const o=n[0](s);for(let a=1;a<e-1;a+=2)if(o===n[a](s))return n[a+1](s);return n[e-1](s)}}function $p(i,t){const e=i.args.length,n=new Array(e);for(let s=0;s<e;++s)n[s]=Fe(i.args[s]);return s=>{const o=n[0](s),a=n[1](s);let h,c;for(let d=2;d<e;d+=2){const f=n[d](s);let _=n[d+1](s);const p=Array.isArray(_);if(p&&(_=Lp(_)),f>=a)return d===2?_:p?Jp(o,a,h,c,f,_):Zs(o,a,h,c,f,_);h=f,c=_}return c}}function qp(i,t){const e=i.operator,n=i.args.length,s=new Array(n);for(let o=0;o<n;++o)s[o]=Fe(i.args[o]);switch(e){case O.ToString:return o=>{const a=s[0](o);return i.args[0].type===De?hh(a):a.toString()};default:throw new Error(`Unsupported convert operator ${e}`)}}function Zs(i,t,e,n,s,o){const a=s-e;if(a===0)return n;const h=t-e,c=i===1?h/a:(Math.pow(i,h)-1)/(Math.pow(i,a)-1);return n+c*(o-n)}function Jp(i,t,e,n,s,o){if(s-e===0)return n;const h=qc(n),c=qc(o);let d=c[2]-h[2];d>180?d-=360:d<-180&&(d+=360);const f=[Zs(i,t,e,h[0],s,c[0]),Zs(i,t,e,h[1],s,c[1]),h[2]+Zs(i,t,e,0,s,d),Zs(i,t,e,n[3],s,o[3])];return Sp(f)}const ct={IDLE:0,LOADING:1,LOADED:2,ERROR:3};function Qp(i,t,e){const n=i;let s=!0,o=!1,a=!1;const h=[co(n,rt.LOAD,function(){a=!0,o||t()})];return n.src&&sd?(o=!0,n.decode().then(function(){s&&t()}).catch(function(c){s&&(a?t():e())})):h.push(co(n,rt.ERROR,e)),function(){s=!1,h.forEach(Lt)}}function t0(i,t){return new Promise((e,n)=>{function s(){a(),e(i)}function o(){a(),n(new Error("Image load error"))}function a(){i.removeEventListener("load",s),i.removeEventListener("error",o)}i.addEventListener("load",s),i.addEventListener("error",o)})}function e0(i,t){return t&&(i.src=t),i.src&&sd?new Promise((e,n)=>i.decode().then(()=>e(i)).catch(s=>i.complete&&i.width?e(i):n(s))):t0(i)}class i0{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const n=this.cache_[e];(t++&3)===0&&!n.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,n){const s=Ua(t,e,n);return s in this.cache_?this.cache_[s]:null}getPattern(t,e,n){const s=Ua(t,e,n);return s in this.patternCache_?this.patternCache_[s]:null}set(t,e,n,s,o){const a=Ua(t,e,n),h=a in this.cache_;this.cache_[a]=s,o&&(s.getImageState()===ct.IDLE&&s.load(),s.getImageState()===ct.LOADING?s.ready().then(()=>{this.patternCache_[a]=yo().createPattern(s.getImage(1),"repeat")}):this.patternCache_[a]=yo().createPattern(s.getImage(1),"repeat")),h||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function Ua(i,t,e){const n=e?ss(e):"null";return t+":"+i+":"+n}const Ee=new i0;let As=null;class $d extends Fo{constructor(t,e,n,s,o){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=o,this.imageState_=s===void 0?ct.IDLE:s,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===ct.LOADED){As||(As=Gt(1,1,void 0,{willReadFrequently:!0})),As.drawImage(this.image_,0,0);try{As.getImageData(0,0,1,1),this.tainted_=!1}catch{As=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(rt.CHANGE)}handleImageError_(){this.imageState_=ct.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=ct.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],n=Gt(t,e);n.fillRect(0,0,t,e),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===ct.IDLE){this.image_||this.initializeImage_(),this.imageState_=ct.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&e0(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==ct.LOADED)return;const e=this.image_,n=Gt(Math.ceil(e.width*t),Math.ceil(e.height*t)),s=n.canvas;n.scale(t,t),n.drawImage(e,0,0),n.globalCompositeOperation="multiply",n.fillStyle=bp(this.color_),n.fillRect(0,0,s.width/t,s.height/t),n.globalCompositeOperation="destination-in",n.drawImage(e,0,0),this.canvas_[t]=s}ready(){return this.ready_||(this.ready_=new Promise(t=>{if(this.imageState_===ct.LOADED||this.imageState_===ct.ERROR)t();else{const e=()=>{(this.imageState_===ct.LOADED||this.imageState_===ct.ERROR)&&(this.removeEventListener(rt.CHANGE,e),t())};this.addEventListener(rt.CHANGE,e)}})),this.ready_}}function uh(i,t,e,n,s,o){let a=t===void 0?void 0:Ee.get(t,e,s);return a||(a=new $d(i,i&&"src"in i?i.src||void 0:t,e,n,s),Ee.set(t,e,s,a,o)),o&&a&&!Ee.getPattern(t,e,s)&&Ee.set(t,e,s,a,o),a}function $e(i){return i?Array.isArray(i)?hh(i):typeof i=="object"&&"src"in i?n0(i):i:null}function n0(i){if(!i.offset||!i.size)return Ee.getPattern(i.src,"anonymous",i.color);const t=i.src+":"+i.offset,e=Ee.getPattern(t,void 0,i.color);if(e)return e;const n=Ee.get(i.src,"anonymous",null);if(n.getImageState()!==ct.LOADED)return null;const s=Gt(i.size[0],i.size[1]);return s.drawImage(n.getImage(1),i.offset[0],i.offset[1],i.size[0],i.size[1],0,0,i.size[0],i.size[1]),uh(s.canvas,t,void 0,ct.LOADED,i.color,!0),Ee.getPattern(t,void 0,i.color)}const qd="10px sans-serif",he="#000",rs="round",pi=[],yi=0,os="round",tr=10,er="#000",ir="center",vo="middle",cn=[0,0,0,0],nr=1,fi=new Ne;let Yn=null,xl;const wl={},s0=function(){const t="32px ",e=["monospace","serif"],n=e.length,s="wmytzilWMYTZIL@#/&?$%10";let o,a;function h(d,f,_){let p=!0;for(let y=0;y<n;++y){const v=e[y];if(a=xo(d+" "+f+" "+t+v,s),_!=v){const w=xo(d+" "+f+" "+t+_+","+v,s);p=p&&w!=a}}return!!p}function c(){let d=!0;const f=fi.getKeys();for(let _=0,p=f.length;_<p;++_){const y=f[_];if(fi.get(y)<100){const[v,w,C]=y.split(`
`);h(v,w,C)?(or(wl),Yn=null,xl=void 0,fi.set(y,100)):(fi.set(y,fi.get(y)+1,!0),d=!1)}}d&&(clearInterval(o),o=void 0)}return function(d){const f=Fd(d);if(!f)return;const _=f.families;for(let p=0,y=_.length;p<y;++p){const v=_[p],w=f.style+`
`+f.weight+`
`+v;fi.get(w)===void 0&&(fi.set(w,100,!0),h(f.style,f.weight,v)||(fi.set(w,0,!0),o===void 0&&(o=setInterval(c,32))))}}}(),r0=function(){let i;return function(t){let e=wl[t];if(e==null){if(nd){const n=Fd(t),s=Jd(t,"Žg");e=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(s.actualBoundingBoxAscent+s.actualBoundingBoxDescent)}else i||(i=document.createElement("div"),i.innerHTML="M",i.style.minHeight="0",i.style.maxHeight="none",i.style.height="auto",i.style.padding="0",i.style.border="none",i.style.position="absolute",i.style.display="block",i.style.left="-99999px"),i.style.font=t,document.body.appendChild(i),e=i.offsetHeight,document.body.removeChild(i);wl[t]=e}return e}}();function Jd(i,t){return Yn||(Yn=Gt(1,1)),i!=xl&&(Yn.font=i,xl=Yn.font),Yn.measureText(t)}function xo(i,t){return Jd(i,t).width}function iu(i,t,e){if(t in e)return e[t];const n=t.split(`
`).reduce((s,o)=>Math.max(s,xo(i,o)),0);return e[t]=n,n}function o0(i,t){const e=[],n=[],s=[];let o=0,a=0,h=0,c=0;for(let d=0,f=t.length;d<=f;d+=2){const _=t[d];if(_===`
`||d===f){o=Math.max(o,a),s.push(a),a=0,h+=c,c=0;continue}const p=t[d+1]||i.font,y=xo(p,_);e.push(y),a+=y;const v=r0(p);n.push(v),c=Math.max(c,v)}return{width:o,height:h,widths:e,heights:n,lineWidths:s}}function a0(i,t,e,n,s,o,a,h,c,d,f){i.save(),e!==1&&(i.globalAlpha===void 0?i.globalAlpha=_=>_.globalAlpha*=e:i.globalAlpha*=e),t&&i.transform.apply(i,t),n.contextInstructions?(i.translate(c,d),i.scale(f[0],f[1]),l0(n,i)):f[0]<0||f[1]<0?(i.translate(c,d),i.scale(f[0],f[1]),i.drawImage(n,s,o,a,h,0,0,a,h)):i.drawImage(n,s,o,a,h,c,d,a*f[0],h*f[1]),i.restore()}function l0(i,t){const e=i.contextInstructions;for(let n=0,s=e.length;n<s;n+=2)Array.isArray(e[n+1])?t[e[n]].apply(t,e[n+1]):t[e[n]]=e[n+1]}class Ko{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=ue(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Ko({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return st()}getImage(t){return st()}getHitDetectionImage(){return st()}getPixelRatio(t){return 1}getImageState(){return st()}getImageSize(){return st()}getOrigin(){return st()}getSize(){return st()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=ue(t)}listenImageChange(t){st()}load(){st()}unlistenImageChange(t){st()}ready(){return Promise.resolve()}}class Ho extends Ko{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?ct.LOADING:ct.LOADED,this.imageState_===ct.LOADING&&this.ready().then(()=>this.imageState_=ct.LOADED),this.render()}clone(){const t=this.getScale(),e=new Ho({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),n=this.getScaleArray();return[t[0]/2-e[0]/n[0],t[1]/2+e[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){var o,a;const e=(o=this.fill_)==null?void 0:o.getKey(),n=`${t},${this.angle_},${this.radius},${this.radius2_},${this.points_},${e}`+Object.values(this.renderOptions_).join(",");let s=(a=Ee.get(n,null,null))==null?void 0:a.getImage(1);if(!s){const h=this.renderOptions_,c=Math.ceil(h.size*t),d=Gt(c,c);this.draw_(h,d,t),s=d.canvas,Ee.set(n,null,null,new $d(s,void 0,null,ct.LOADED,null))}return s}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,n){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let s=this.radius,o=this.radius2_===void 0?s:this.radius2_;if(s<o){const A=s;s=o,o=A}const a=this.radius2_===void 0?this.points_:this.points_*2,h=2*Math.PI/a,c=o*Math.sin(h),d=Math.sqrt(o*o-c*c),f=s-d,_=Math.sqrt(c*c+f*f),p=_/c;if(t==="miter"&&p<=n)return p*e;const y=e/2/p,v=e/2*(f/_),C=Math.sqrt((s+y)*(s+y)+v*v)-s;if(this.radius2_===void 0||t==="bevel")return C*2;const E=s*Math.sin(h),T=Math.sqrt(s*s-E*E),M=o-T,P=Math.sqrt(E*E+M*M)/E;if(P<=n){const A=P*e/2-o-s;return 2*Math.max(C,A)}return C*2}createRenderOptions(){let t=rs,e=os,n=0,s=null,o=0,a,h=0;this.stroke_&&(a=$e(this.stroke_.getColor()??er),h=this.stroke_.getWidth()??nr,s=this.stroke_.getLineDash(),o=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??os,t=this.stroke_.getLineCap()??rs,n=this.stroke_.getMiterLimit()??tr);const c=this.calculateLineJoinSize_(e,h,n),d=Math.max(this.radius,this.radius2_||0),f=Math.ceil(2*d+c);return{strokeStyle:a,strokeWidth:h,size:f,lineCap:t,lineDash:s,lineDashOffset:o,lineJoin:e,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,n){if(e.scale(n,n),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let s=this.fill_.getColor();s===null&&(s=he),e.fillStyle=$e(s),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let n=this.fill_.getColor(),s=0;typeof n=="string"&&(n=ss(n)),n===null?s=1:Array.isArray(n)&&(s=n.length===4?n[3]:1),s===0&&(e=Gt(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const n=this.radius;if(e===1/0)t.arc(0,0,n,0,2*Math.PI);else{const s=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(e*=2);const o=this.angle_-Math.PI/2,a=2*Math.PI/e;for(let h=0;h<e;h++){const c=o+h*a,d=h%2===0?n:s;t.lineTo(d*Math.cos(c),d*Math.sin(c))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=he,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class $o extends Ho{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new $o({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius=t,this.render()}}class Bi{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new Bi({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=uh(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===ct.IDLE&&e.load(),e.getImageState()===ct.LOADING&&(this.patternImage_=e)}this.color_=t}getKey(){const t=this.getColor();return t?t instanceof CanvasPattern||t instanceof CanvasGradient?vt(t):typeof t=="object"&&"src"in t?t.src+":"+t.offset:ss(t).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}function nu(i,t,e,n){return e!==void 0&&n!==void 0?[e/i,n/t]:e!==void 0?e/i:n!==void 0?n/t:1}class _r extends Ko{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,n=t.rotation!==void 0?t.rotation:0,s=t.scale!==void 0?t.scale:1,o=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:n,scale:s,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:o,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const a=t.img!==void 0?t.img:null;let h=t.src;xt(!(h!==void 0&&a),"`image` and `src` cannot be provided at the same time"),(h===void 0||h.length===0)&&a&&(h=a.src||vt(a)),xt(h!==void 0&&h.length>0,"A defined and non-empty `src` or `image` must be provided"),xt(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let c;if(t.src!==void 0?c=ct.IDLE:a!==void 0&&("complete"in a?a.complete?c=a.src?ct.LOADED:ct.IDLE:c=ct.LOADING:c=ct.LOADED),this.color_=t.color!==void 0?ss(t.color):null,this.iconImage_=uh(a,h,this.crossOrigin_,c,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,this.initialOptions_,t.width!==void 0||t.height!==void 0){let d,f;if(t.size)[d,f]=t.size;else{const _=this.getImage(1);if(_.width&&_.height)d=_.width,f=_.height;else if(_ instanceof HTMLImageElement){this.initialOptions_=t;const p=()=>{if(this.unlistenImageChange(p),!this.initialOptions_)return;const y=this.iconImage_.getSize();this.setScale(nu(y[0],y[1],t.width,t.height))};this.listenImageChange(p);return}}d!==void 0&&this.setScale(nu(d,f,t.width,t.height))}}clone(){let t,e,n;return this.initialOptions_?(e=this.initialOptions_.width,n=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new _r({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const s=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!s)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=s[0]),this.anchorYUnits_=="fraction"&&(t[1]*=s[1])}if(this.anchorOrigin_!="top-left"){if(!s)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+s[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+s[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),n=this.getScaleArray();return[t[0]-e[0]/n[0],t[1]+e[1]/n[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),n=this.iconImage_.getSize();if(!e||!n)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=n[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=n[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==ct.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==ct.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(rt.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(rt.CHANGE,t)}ready(){return this.iconImage_.ready()}}class _n{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new _n({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}class Je{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=su,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new Je({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=su,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function h0(i){let t;if(typeof i=="function")t=i;else{let e;Array.isArray(i)?e=i:(xt(typeof i.getZIndex=="function","Expected an `Style` or an array of `Style`"),e=[i]),t=function(){return e}}return t}let Va=null;function Qd(i,t){if(!Va){const e=new Bi({color:"rgba(255,255,255,0.4)"}),n=new _n({color:"#3399CC",width:1.25});Va=[new Je({image:new $o({fill:e,stroke:n,radius:5}),fill:e,stroke:n})]}return Va}function su(i){return i.getGeometry()}const c0="#333";class $n{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.keepUpright_=t.keepUpright,this.scale_=t.scale,this.scaleArray_=ue(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new Bi({color:c0}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new $n({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setKeepUpright(t){this.keepUpright_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=ue(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}function u0(i){return!0}function d0(i){const t=Vd(),e=f0(i,t),n=Hd();return function(s,o){if(n.properties=s.getPropertiesInternal(),n.resolution=o,t.featureId){const a=s.getId();a!==void 0?n.featureId=a:n.featureId=null}return t.geometryType&&(n.geometryType=Kd(s.getGeometry())),e(n)}}function ru(i){const t=Vd(),e=i.length,n=new Array(e);for(let a=0;a<e;++a)n[a]=Cl(i[a],t);const s=Hd(),o=new Array(e);return function(a,h){if(s.properties=a.getPropertiesInternal(),s.resolution=h,t.featureId){const d=a.getId();d!==void 0?s.featureId=d:s.featureId=null}let c=0;for(let d=0;d<e;++d){const f=n[d](s);f&&(o[c]=f,c+=1)}return o.length=c,o}}function f0(i,t){const e=i.length,n=new Array(e);for(let s=0;s<e;++s){const o=i[s],a="filter"in o?xi(o.filter,te,t):u0;let h;if(Array.isArray(o.style)){const c=o.style.length;h=new Array(c);for(let d=0;d<c;++d)h[d]=Cl(o.style[d],t)}else h=[Cl(o.style,t)];n[s]={filter:a,styles:h}}return function(s){const o=[];let a=!1;for(let h=0;h<e;++h){const c=n[h].filter;if(c(s)&&!(i[h].else&&a)){a=!0;for(const d of n[h].styles){const f=d(s);f&&o.push(f)}}}return o}}function Cl(i,t){const e=sr(i,"",t),n=rr(i,"",t),s=g0(i,t),o=_0(i,t),a=ce(i,"z-index",t);if(!e&&!n&&!s&&!o&&!mn(i))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(i));const h=new Je;return function(c){let d=!0;if(e){const f=e(c);f&&(d=!1),h.setFill(f)}if(n){const f=n(c);f&&(d=!1),h.setStroke(f)}if(s){const f=s(c);f&&(d=!1),h.setText(f)}if(o){const f=o(c);f&&(d=!1),h.setImage(f)}return a&&h.setZIndex(a(c)),d?null:h}}function sr(i,t,e){let n;if(t+"fill-pattern-src"in i)n=v0(i,t+"fill-",e);else{if(i[t+"fill-color"]==="none")return o=>null;n=dh(i,t+"fill-color",e)}if(!n)return null;const s=new Bi;return function(o){const a=n(o);return a===ah?null:(s.setColor(a),s)}}function rr(i,t,e){const n=ce(i,t+"stroke-width",e),s=dh(i,t+"stroke-color",e);if(!n&&!s)return null;const o=_i(i,t+"stroke-line-cap",e),a=_i(i,t+"stroke-line-join",e),h=tf(i,t+"stroke-line-dash",e),c=ce(i,t+"stroke-line-dash-offset",e),d=ce(i,t+"stroke-miter-limit",e),f=new _n;return function(_){if(s){const p=s(_);if(p===ah)return null;f.setColor(p)}if(n&&f.setWidth(n(_)),o){const p=o(_);if(p!=="butt"&&p!=="round"&&p!=="square")throw new Error("Expected butt, round, or square line cap");f.setLineCap(p)}if(a){const p=a(_);if(p!=="bevel"&&p!=="round"&&p!=="miter")throw new Error("Expected bevel, round, or miter line join");f.setLineJoin(p)}return h&&f.setLineDash(h(_)),c&&f.setLineDashOffset(c(_)),d&&f.setMiterLimit(d(_)),f}}function g0(i,t){const e="text-",n=_i(i,e+"value",t);if(!n)return null;const s=sr(i,e,t),o=sr(i,e+"background-",t),a=rr(i,e,t),h=rr(i,e+"background-",t),c=_i(i,e+"font",t),d=ce(i,e+"max-angle",t),f=ce(i,e+"offset-x",t),_=ce(i,e+"offset-y",t),p=qn(i,e+"overflow",t),y=_i(i,e+"placement",t),v=ce(i,e+"repeat",t),w=qo(i,e+"scale",t),C=qn(i,e+"rotate-with-view",t),E=ce(i,e+"rotation",t),T=_i(i,e+"align",t),M=_i(i,e+"justify",t),S=_i(i,e+"baseline",t),P=qn(i,e+"keep-upright",t),A=tf(i,e+"padding",t),D=Jo(i,e+"declutter-mode"),k=new $n({declutterMode:D});return function(F){if(k.setText(n(F)),s&&k.setFill(s(F)),o&&k.setBackgroundFill(o(F)),a&&k.setStroke(a(F)),h&&k.setBackgroundStroke(h(F)),c&&k.setFont(c(F)),d&&k.setMaxAngle(d(F)),f&&k.setOffsetX(f(F)),_&&k.setOffsetY(_(F)),p&&k.setOverflow(p(F)),y){const B=y(F);if(B!=="point"&&B!=="line")throw new Error("Expected point or line for text-placement");k.setPlacement(B)}if(v&&k.setRepeat(v(F)),w&&k.setScale(w(F)),C&&k.setRotateWithView(C(F)),E&&k.setRotation(E(F)),T){const B=T(F);if(B!=="left"&&B!=="center"&&B!=="right"&&B!=="end"&&B!=="start")throw new Error("Expected left, right, center, start, or end for text-align");k.setTextAlign(B)}if(M){const B=M(F);if(B!=="left"&&B!=="right"&&B!=="center")throw new Error("Expected left, right, or center for text-justify");k.setJustify(B)}if(S){const B=S(F);if(B!=="bottom"&&B!=="top"&&B!=="middle"&&B!=="alphabetic"&&B!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");k.setTextBaseline(B)}return A&&k.setPadding(A(F)),P&&k.setKeepUpright(P(F)),k}}function _0(i,t){return"icon-src"in i?m0(i,t):"shape-points"in i?p0(i,t):"circle-radius"in i?y0(i,t):null}function m0(i,t){const e="icon-",n=e+"src",s=ef(i[n],n),o=wo(i,e+"anchor",t),a=qo(i,e+"scale",t),h=ce(i,e+"opacity",t),c=wo(i,e+"displacement",t),d=ce(i,e+"rotation",t),f=qn(i,e+"rotate-with-view",t),_=au(i,e+"anchor-origin"),p=lu(i,e+"anchor-x-units"),y=lu(i,e+"anchor-y-units"),v=E0(i,e+"color"),w=w0(i,e+"cross-origin"),C=C0(i,e+"offset"),E=au(i,e+"offset-origin"),T=Co(i,e+"width"),M=Co(i,e+"height"),S=x0(i,e+"size"),P=Jo(i,e+"declutter-mode"),A=new _r({src:s,anchorOrigin:_,anchorXUnits:p,anchorYUnits:y,color:v,crossOrigin:w,offset:C,offsetOrigin:E,height:M,width:T,size:S,declutterMode:P});return function(D){return h&&A.setOpacity(h(D)),c&&A.setDisplacement(c(D)),d&&A.setRotation(d(D)),f&&A.setRotateWithView(f(D)),a&&A.setScale(a(D)),o&&A.setAnchor(o(D)),A}}function p0(i,t){const e="shape-",n=e+"points",s=e+"radius",o=El(i[n],n),a=El(i[s],s),h=sr(i,e,t),c=rr(i,e,t),d=qo(i,e+"scale",t),f=wo(i,e+"displacement",t),_=ce(i,e+"rotation",t),p=qn(i,e+"rotate-with-view",t),y=Co(i,e+"radius2"),v=Co(i,e+"angle"),w=Jo(i,e+"declutter-mode"),C=new Ho({points:o,radius:a,radius2:y,angle:v,declutterMode:w});return function(E){return h&&C.setFill(h(E)),c&&C.setStroke(c(E)),f&&C.setDisplacement(f(E)),_&&C.setRotation(_(E)),p&&C.setRotateWithView(p(E)),d&&C.setScale(d(E)),C}}function y0(i,t){const e="circle-",n=sr(i,e,t),s=rr(i,e,t),o=ce(i,e+"radius",t),a=qo(i,e+"scale",t),h=wo(i,e+"displacement",t),c=ce(i,e+"rotation",t),d=qn(i,e+"rotate-with-view",t),f=Jo(i,e+"declutter-mode"),_=new $o({radius:5,declutterMode:f});return function(p){return o&&_.setRadius(o(p)),n&&_.setFill(n(p)),s&&_.setStroke(s(p)),h&&_.setDisplacement(h(p)),c&&_.setRotation(c(p)),d&&_.setRotateWithView(d(p)),a&&_.setScale(a(p)),_}}function ce(i,t,e){if(!(t in i))return;const n=xi(i[t],ft,e);return function(s){return El(n(s),t)}}function _i(i,t,e){if(!(t in i))return null;const n=xi(i[t],le,e);return function(s){return ef(n(s),t)}}function v0(i,t,e){const n=_i(i,t+"pattern-src",e),s=ou(i,t+"pattern-offset",e),o=ou(i,t+"pattern-size",e),a=dh(i,t+"color",e);return function(h){return{src:n(h),offset:s&&s(h),size:o&&o(h),color:a&&a(h)}}}function qn(i,t,e){if(!(t in i))return null;const n=xi(i[t],te,e);return function(s){const o=n(s);if(typeof o!="boolean")throw new Error(`Expected a boolean for ${t}`);return o}}function dh(i,t,e){if(!(t in i))return null;const n=xi(i[t],De,e);return function(s){return nf(n(s),t)}}function tf(i,t,e){if(!(t in i))return null;const n=xi(i[t],vn,e);return function(s){return mr(n(s),t)}}function wo(i,t,e){if(!(t in i))return null;const n=xi(i[t],vn,e);return function(s){const o=mr(n(s),t);if(o.length!==2)throw new Error(`Expected two numbers for ${t}`);return o}}function ou(i,t,e){if(!(t in i))return null;const n=xi(i[t],vn,e);return function(s){return sf(n(s),t)}}function qo(i,t,e){if(!(t in i))return null;const n=xi(i[t],vn|ft,e);return function(s){return b0(n(s),t)}}function Co(i,t){const e=i[t];if(e!==void 0){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}}function x0(i,t){const e=i[t];if(e!==void 0){if(typeof e=="number")return ue(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${t}`);if(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return e}}function w0(i,t){const e=i[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}}function au(i,t){const e=i[t];if(e!==void 0){if(e!=="bottom-left"&&e!=="bottom-right"&&e!=="top-left"&&e!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return e}}function lu(i,t){const e=i[t];if(e!==void 0){if(e!=="pixels"&&e!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return e}}function C0(i,t){const e=i[t];if(e!==void 0)return mr(e,t)}function Jo(i,t){const e=i[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);if(e!=="declutter"&&e!=="obstacle"&&e!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return e}}function E0(i,t){const e=i[t];if(e!==void 0)return nf(e,t)}function mr(i,t){if(!Array.isArray(i))throw new Error(`Expected an array for ${t}`);const e=i.length;for(let n=0;n<e;++n)if(typeof i[n]!="number")throw new Error(`Expected an array of numbers for ${t}`);return i}function ef(i,t){if(typeof i!="string")throw new Error(`Expected a string for ${t}`);return i}function El(i,t){if(typeof i!="number")throw new Error(`Expected a number for ${t}`);return i}function nf(i,t){if(typeof i=="string")return i;const e=mr(i,t),n=e.length;if(n<3||n>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return e}function sf(i,t){const e=mr(i,t);if(e.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return e}function b0(i,t){return typeof i=="number"?i:sf(i,t)}const hu={RENDER_ORDER:"renderOrder"};class rf extends gr{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(hu.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){const n=this.getDeclutter();n in t.declutter||(t.declutter[n]=new Yd(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set(hu.RENDER_ORDER,t)}setStyle(t){this.style_=t===void 0?Qd:t;const e=T0(t);this.styleFunction_=t===null?void 0:h0(e),this.changed()}setDeclutter(t){this.declutter_=t?String(t):void 0,this.changed()}}function T0(i){if(i===void 0)return Qd;if(!i)return null;if(typeof i=="function"||i instanceof Je)return i;if(!Array.isArray(i))return ru([i]);if(i.length===0)return[];const t=i.length,e=i[0];if(e instanceof Je){const s=new Array(t);for(let o=0;o<t;++o){const a=i[o];if(!(a instanceof Je))throw new Error("Expected a list of style instances");s[o]=a}return s}if("style"in e){const s=new Array(t);for(let o=0;o<t;++o){const a=i[o];if(!("style"in a))throw new Error("Expected a list of rules with a style property");s[o]=a}return d0(s)}return ru(i)}class of extends vi{constructor(t,e,n,s){super(t),this.inversePixelTransform=e,this.frameState=n,this.context=s}}class L0 extends ko{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){st()}calculateMatrices2D(t){const e=t.viewState,n=t.coordinateToPixelTransform,s=t.pixelToCoordinateTransform;Qe(n,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),Wl(s,n)}forEachFeatureAtCoordinate(t,e,n,s,o,a,h,c){let d;const f=e.viewState;function _(S,P,A,D){return o.call(a,P,S?A:null,D)}const p=f.projection,y=gd(t.slice(),p),v=[[0,0]];if(p.canWrapX()&&s){const S=p.getExtent(),P=Ct(S);v.push([-P,0],[P,0])}const w=e.layerStatesArray,C=w.length,E=[],T=[];for(let S=0;S<v.length;S++)for(let P=C-1;P>=0;--P){const A=w[P],D=A.layer;if(D.hasRenderer()&&oh(A,f)&&h.call(c,D)){const k=D.getRenderer(),F=D.getSource();if(k&&F){const B=F.getWrapX()?y:t,X=_.bind(null,A.managed);T[0]=B[0]+v[S][0],T[1]=B[1]+v[S][1],d=k.forEachFeatureAtCoordinate(T,e,n,X,E)}if(d)return d}}if(E.length===0)return;const M=1/E.length;return E.forEach((S,P)=>S.distanceSq+=P*M),E.sort((S,P)=>S.distanceSq-P.distanceSq),E.some(S=>d=S.callback(S.feature,S.layer,S.geometry)),d}hasFeatureAtCoordinate(t,e,n,s,o,a){return this.forEachFeatureAtCoordinate(t,e,n,s,Vs,this,o,a)!==void 0}getMap(){return this.map_}renderFrame(t){st()}scheduleExpireIconCache(t){Ee.canExpireCache()&&t.postRenderFunctions.push(S0)}}function S0(i,t){Ee.expire()}class P0 extends L0{constructor(t){super(t),this.fontChangeListenerKey_=_t(fi,es.PROPERTYCHANGE,t.redrawText,t),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=Uo+" ol-layers";const n=t.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const n=this.getMap();if(n.hasListener(t)){const s=new of(t,void 0,e);n.dispatchEvent(s)}}disposeInternal(){Lt(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(Ce.PRECOMPOSE,t);const e=t.layerStatesArray.sort((h,c)=>h.zIndex-c.zIndex);e.some(h=>h.layer instanceof rf&&h.layer.getDeclutter())&&(t.declutter={});const s=t.viewState;this.children_.length=0;const o=[];let a=null;for(let h=0,c=e.length;h<c;++h){const d=e[h];t.layerIndex=h;const f=d.layer,_=f.getSourceState();if(!oh(d,s)||_!="ready"&&_!="undefined"){f.unrender();continue}const p=f.render(t,a);p&&(p!==a&&(this.children_.push(p),a=p),o.push(d))}this.declutter(t,o),Xm(this.element_,this.children_),this.dispatchRenderEvent(Ce.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}declutter(t,e){if(t.declutter){for(let n=e.length-1;n>=0;--n){const s=e[n],o=s.layer;o.getDeclutter()&&o.renderDeclutter(t,s)}e.forEach(n=>n.layer.renderDeferred(t))}}}function af(i){if(i instanceof gr){i.setMapInternal(null);return}i instanceof hs&&i.getLayers().forEach(af)}function lf(i,t){if(i instanceof gr){i.setMapInternal(t);return}if(i instanceof hs){const e=i.getLayers().getArray();for(let n=0,s=e.length;n<s;++n)lf(e[n],t)}}class M0 extends Ne{constructor(t){super(),t=t||{},this.on,this.once,this.un;const e=R0(t);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:p_,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=me(),this.pixelToCoordinateTransform_=me(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=e.controls||Vm(),this.interactions=e.interactions||dp({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new x_(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener($t.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener($t.VIEW,this.handleViewChanged_),this.addChangeListener($t.SIZE,this.handleSizeChanged_),this.addChangeListener($t.TARGET,this.handleTargetChanged_),this.setProperties(e.values);const n=this;t.view&&!(t.view instanceof Ue)&&t.view.then(function(s){n.setView(new Ue(s))}),this.controls.addEventListener(ae.ADD,s=>{s.element.setMap(this)}),this.controls.addEventListener(ae.REMOVE,s=>{s.element.setMap(null)}),this.interactions.addEventListener(ae.ADD,s=>{s.element.setMap(this)}),this.interactions.addEventListener(ae.REMOVE,s=>{s.element.setMap(null)}),this.overlays_.addEventListener(ae.ADD,s=>{this.addOverlayInternal_(s.element)}),this.overlays_.addEventListener(ae.REMOVE,s=>{const o=s.element.getId();o!==void 0&&delete this.overlayIdIndex_[o.toString()],s.element.setMap(null)}),this.controls.forEach(s=>{s.setMap(this)}),this.interactions.forEach(s=>{s.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){lf(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,n){if(!this.frameState_||!this.renderer_)return;const s=this.getCoordinateFromPixelInternal(t);n=n!==void 0?n:{};const o=n.hitTolerance!==void 0?n.hitTolerance:0,a=n.layerFilter!==void 0?n.layerFilter:Vs,h=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(s,this.frameState_,o,h,e,null,a,null)}getFeaturesAtPixel(t,e){const n=[];return this.forEachFeatureAtPixel(t,function(s){n.push(s)},e),n}getAllLayers(){const t=[];function e(n){n.forEach(function(s){s instanceof hs?e(s.getLayers()):t.push(s)})}return e(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const n=this.getCoordinateFromPixelInternal(t);e=e!==void 0?e:{};const s=e.layerFilter!==void 0?e.layerFilter:Vs,o=e.hitTolerance!==void 0?e.hitTolerance:0,a=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,o,a,s,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const n=this.viewport_.getBoundingClientRect(),s=this.getSize(),o=n.width/s[0],a=n.height/s[1],h="changedTouches"in t?t.changedTouches[0]:t;return[(h.clientX-n.left)/o,(h.clientY-n.top)/a]}getTarget(){return this.get($t.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return mo(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?zt(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return e!==void 0?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get($t.LAYERGROUP)}setLayers(t){const e=this.getLayerGroup();if(t instanceof Ke){e.setLayers(t);return}const n=e.getLayers();n.clear(),n.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,n=t.length;e<n;++e){const s=t[e];if(!s.visible)continue;const o=s.layer.getRenderer();if(o&&!o.ready)return!0;const a=s.layer.getSource();if(a&&a.loading)return!0}return!1}getPixelFromCoordinate(t){const e=ke(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?zt(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get($t.SIZE)}getView(){return this.get($t.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,n,s){return w_(this.frameState_,t,e,n,s)}handleBrowserEvent(t,e){e=e||t.type;const n=new ki(e,this,t);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,n=e.type;if(n===hl.POINTERDOWN||n===rt.WHEEL||n===rt.KEYDOWN){const s=this.getOwnerDocument(),o=this.viewport_.getRootNode?this.viewport_.getRootNode():s,a=e.target,h=o instanceof ShadowRoot?o.host===a?o.host.ownerDocument:o:o===s?s.documentElement:o;if(this.overlayContainerStopEvent_.contains(a)||!h.contains(a))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){const s=this.getInteractions().getArray().slice();for(let o=s.length-1;o>=0;o--){const a=s[o];if(a.getMap()!==this||!a.getActive()||!this.getTargetElement())continue;if(!a.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let s=this.maxTilesLoading_,o=s;if(t){const a=t.viewHints;if(a[qt.ANIMATING]||a[qt.INTERACTING]){const h=Date.now()-t.time>8;s=h?0:8,o=h?0:2}}e.getTilesLoading()<s&&(e.reprioritize(),e.loadMoreTiles(s,o))}t&&this.renderer_&&!t.animate&&(this.renderComplete_?(this.hasListener(Ce.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(Ce.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Xn(gi.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Xn(gi.LOADSTART,this,t))));const n=this.postRenderFunctions_;if(t)for(let s=0,o=n.length;s<o;++s)n[s](this,t);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let n=0,s=this.targetChangeHandlerKeys_.length;n<s;++n)Lt(this.targetChangeHandlerKeys_[n]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(rt.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(rt.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const n=this.targetElement_.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.unobserve(n.host),this.setSize(void 0)}const t=this.getTarget(),e=typeof t=="string"?document.getElementById(t):t;if(this.targetElement_=e,!e)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new P0(this)),this.mapBrowserEventHandler_=new y_(this,this.moveTolerance_);for(const o in Rt)this.mapBrowserEventHandler_.addEventListener(Rt[o],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(rt.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(rt.WHEEL,this.boundHandleBrowserEvent_,rd?{passive:!1}:!1);let n;if(this.keyboardEventTarget_)n=this.keyboardEventTarget_;else{const o=e.getRootNode();n=o instanceof ShadowRoot?o.host:e}this.targetChangeHandlerKeys_=[_t(n,rt.KEYDOWN,this.handleBrowserEvent,this),_t(n,rt.KEYPRESS,this.handleBrowserEvent,this)];const s=e.getRootNode();s instanceof ShadowRoot&&this.resizeObserver_.observe(s.host),this.resizeObserver_.observe(e)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(Lt(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Lt(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=_t(t,es.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=_t(t,rt.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Lt),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new Di("addlayer",t)),this.layerGroupPropertyListenerKeys_=[_t(t,es.PROPERTYCHANGE,this.render,this),_t(t,rt.CHANGE,this.render,this),_t(t,"addlayer",this.handleLayerAdd_,this),_t(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,n=t.length;e<n;++e){const s=t[e].layer;s.hasRenderer()&&s.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){af(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),n=this.getView(),s=this.frameState_;let o=null;if(e!==void 0&&Jc(e)&&n&&n.isDef()){const a=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),h=n.getState();if(o={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:fl(h.center,h.resolution,h.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:h,viewHints:a,wantedTiles:{},mapId:vt(this),renderTargets:{}},h.nextCenter&&h.nextResolution){const c=isNaN(h.nextRotation)?h.rotation:h.nextRotation;o.nextExtent=fl(h.nextCenter,h.nextResolution,c,e)}}this.frameState_=o,this.renderer_.renderFrame(o),o&&(o.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,o.postRenderFunctions),s&&(!this.previousExtent_||!hr(this.previousExtent_)&&!Hs(o.extent,this.previousExtent_))&&(this.dispatchEvent(new Xn(gi.MOVESTART,this,s)),this.previousExtent_=lr(this.previousExtent_)),this.previousExtent_&&!o.viewHints[qt.ANIMATING]&&!o.viewHints[qt.INTERACTING]&&!Hs(o.extent,this.previousExtent_)&&(this.dispatchEvent(new Xn(gi.MOVEEND,this,o)),od(o.extent,this.previousExtent_))),this.dispatchEvent(new Xn(gi.POSTRENDER,this,o)),this.renderComplete_=(this.hasListener(gi.LOADSTART)||this.hasListener(gi.LOADEND)||this.hasListener(Ce.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new Di("removelayer",e)),this.set($t.LAYERGROUP,t)}setSize(t){this.set($t.SIZE,t)}setTarget(t){this.set($t.TARGET,t)}setView(t){if(!t||t instanceof Ue){this.set($t.VIEW,t);return}this.set($t.VIEW,new Ue);const e=this;t.then(function(n){e.setView(new Ue(n))})}updateSize(){const t=this.getTargetElement();let e;if(t){const s=getComputedStyle(t),o=t.offsetWidth-parseFloat(s.borderLeftWidth)-parseFloat(s.paddingLeft)-parseFloat(s.paddingRight)-parseFloat(s.borderRightWidth),a=t.offsetHeight-parseFloat(s.borderTopWidth)-parseFloat(s.paddingTop)-parseFloat(s.paddingBottom)-parseFloat(s.borderBottomWidth);!isNaN(o)&&!isNaN(a)&&(e=[Math.max(0,o),Math.max(0,a)],!Jc(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&md("No map visible because the map container's width or height are 0."))}const n=this.getSize();e&&(!n||!Ui(e,n))&&(this.setSize(e),this.updateViewportSize_(e))}updateViewportSize_(t){const e=this.getView();e&&e.setViewportSize(t)}}function R0(i){let t=null;i.keyboardEventTarget!==void 0&&(t=typeof i.keyboardEventTarget=="string"?document.getElementById(i.keyboardEventTarget):i.keyboardEventTarget);const e={},n=i.layers&&typeof i.layers.getLayers=="function"?i.layers:new hs({layers:i.layers});e[$t.LAYERGROUP]=n,e[$t.TARGET]=i.target,e[$t.VIEW]=i.view instanceof Ue?i.view:new Ue;let s;i.controls!==void 0&&(Array.isArray(i.controls)?s=new Ke(i.controls.slice()):(xt(typeof i.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),s=i.controls));let o;i.interactions!==void 0&&(Array.isArray(i.interactions)?o=new Ke(i.interactions.slice()):(xt(typeof i.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),o=i.interactions));let a;return i.overlays!==void 0?Array.isArray(i.overlays)?a=new Ke(i.overlays.slice()):(xt(typeof i.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),a=i.overlays):a=new Ke,{controls:s,interactions:o,keyboardEventTarget:t,overlays:a,values:e}}class fh extends Fo{constructor(t,e,n){super(),n=n||{},this.tileCoord=t,this.state=e,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(rt.CHANGE)}release(){this.setState(q.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==q.EMPTY){if(this.state!==q.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}}load(){st()}getAlpha(t,e){if(!this.transition_)return 1;let n=this.transitionStarts_[t];if(!n)n=e,this.transitionStarts_[t]=n;else if(n===-1)return 1;const s=e-n+1e3/60;return s>=this.transition_?1:_d(s/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}disposeInternal(){this.release(),super.disposeInternal()}}function bl(i){return i instanceof Image||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageBitmap?i:null}const I0=new Error("disposed"),A0=[256,256];class cu extends fh{constructor(t){const e=q.IDLE;super(t.tileCoord,e,{transition:t.transition,interpolate:t.interpolate}),this.loader_=t.loader,this.data_=null,this.error_=null,this.size_=t.size||null,this.controller_=t.controller||null}getSize(){if(this.size_)return this.size_;const t=bl(this.data_);return t?[t.width,t.height]:A0}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==q.IDLE&&this.state!==q.ERROR)return;this.state=q.LOADING,this.changed();const t=this;this.loader_().then(function(e){t.data_=e,t.state=q.LOADED,t.changed()}).catch(function(e){t.error_=e,t.state=q.ERROR,t.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(I0),this.controller_=null),super.disposeInternal()}}class hf extends fh{constructor(t,e,n,s,o,a){super(t,e,a),this.crossOrigin_=s,this.src_=n,this.key=n,this.image_=new Image,s!==null&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=o}getImage(){return this.image_}setImage(t){this.image_=t,this.state=q.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=q.ERROR,this.unlistenImage_(),this.image_=O0(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=q.LOADED:this.state=q.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==q.ERROR&&(this.state=q.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==q.IDLE&&(this.state=q.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Qp(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}function O0(){const i=Gt(1,1);return i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1),i.canvas}class gh{constructor(t,e,n,s){this.minX=t,this.maxX=e,this.minY=n,this.maxY=s}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function Gn(i,t,e,n,s){return s!==void 0?(s.minX=i,s.maxX=t,s.minY=e,s.maxY=n,s):new gh(i,t,e,n)}let Ka;const Jn=[];function uu(i,t,e,n,s){i.beginPath(),i.moveTo(0,0),i.lineTo(t,e),i.lineTo(n,s),i.closePath(),i.save(),i.clip(),i.fillRect(0,0,Math.max(t,n)+1,Math.max(e,s)),i.restore()}function Ha(i,t){return Math.abs(i[t*4]-210)>2||Math.abs(i[t*4+3]-.75*255)>2}function k0(){if(Ka===void 0){const i=Gt(6,6,Jn);i.globalCompositeOperation="lighter",i.fillStyle="rgba(210, 0, 0, 0.75)",uu(i,4,5,4,0),uu(i,4,5,0,5);const t=i.getImageData(0,0,3,3).data;Ka=Ha(t,0)||Ha(t,4)||Ha(t,8),Vo(i),Jn.push(i.canvas)}return Ka}function du(i,t,e,n){const s=gn(e,t,i);let o=zc(t,n,e);const a=t.getMetersPerUnit();a!==void 0&&(o*=a);const h=i.getMetersPerUnit();h!==void 0&&(o/=h);const c=i.getExtent();if(!c||yn(c,s)){const d=zc(i,o,s)/o;isFinite(d)&&d>0&&(o/=d)}return o}function D0(i,t,e,n){const s=Xi(e);let o=du(i,t,s,n);return(!isFinite(o)||o<=0)&&cd(e,function(a){return o=du(i,t,a,n),isFinite(o)&&o>0}),o}function F0(i,t,e,n,s,o,a,h,c,d,f,_,p,y){const v=Gt(Math.round(e*i),Math.round(e*t),Jn);if(_||(v.imageSmoothingEnabled=!1),c.length===0)return v.canvas;v.scale(e,e);function w(P){return Math.round(P*e)/e}v.globalCompositeOperation="lighter";const C=Le();c.forEach(function(P,A,D){ld(C,P.extent)});let E;const T=e/n,M=(_?1:1+Math.pow(2,-24))/T;E=Gt(Math.round(Ct(C)*T),Math.round(ie(C)*T),Jn),_||(E.imageSmoothingEnabled=!1),c.forEach(function(P,A,D){if(P.image.width>0&&P.image.height>0){if(P.clipExtent){E.save();const W=(P.clipExtent[0]-C[0])*T,Y=-(P.clipExtent[3]-C[3])*T,Z=Ct(P.clipExtent)*T,Q=ie(P.clipExtent)*T;E.rect(_?W:Math.round(W),_?Y:Math.round(Y),_?Z:Math.round(W+Z)-Math.round(W),_?Q:Math.round(Y+Q)-Math.round(Y)),E.clip()}const k=(P.extent[0]-C[0])*T,F=-(P.extent[3]-C[3])*T,B=Ct(P.extent)*T,X=ie(P.extent)*T;E.drawImage(P.image,d,d,P.image.width-2*d,P.image.height-2*d,_?k:Math.round(k),_?F:Math.round(F),_?B:Math.round(k+B)-Math.round(k),_?X:Math.round(F+X)-Math.round(F)),P.clipExtent&&E.restore()}});const S=wn(a);return h.getTriangles().forEach(function(P,A,D){const k=P.source,F=P.target;let B=k[0][0],X=k[0][1],W=k[1][0],Y=k[1][1],Z=k[2][0],Q=k[2][1];const V=w((F[0][0]-S[0])/o),J=w(-(F[0][1]-S[1])/o),G=w((F[1][0]-S[0])/o),ot=w(-(F[1][1]-S[1])/o),j=w((F[2][0]-S[0])/o),$=w(-(F[2][1]-S[1])/o),N=B,pt=X;B=0,X=0,W-=N,Y-=pt,Z-=N,Q-=pt;const dt=[[W,Y,0,0,G-V],[Z,Q,0,0,j-V],[0,0,W,Y,ot-J],[0,0,Z,Q,$-J]],tt=E_(dt);if(!tt)return;if(v.save(),v.beginPath(),k0()||!_){v.moveTo(G,ot);const bt=4,Nt=V-G,ne=J-ot;for(let jt=0;jt<bt;jt++)v.lineTo(G+w((jt+1)*Nt/bt),ot+w(jt*ne/(bt-1))),jt!=bt-1&&v.lineTo(G+w((jt+1)*Nt/bt),ot+w((jt+1)*ne/(bt-1)));v.lineTo(j,$)}else v.moveTo(G,ot),v.lineTo(V,J),v.lineTo(j,$);v.clip(),v.transform(tt[0],tt[2],tt[1],tt[3],V,J),v.translate(C[0]-N,C[3]-pt);let it;if(E)it=E.canvas,v.scale(M,-M);else{const bt=c[0],Nt=bt.extent;it=bt.image,v.scale(Ct(Nt)/it.width,-ie(Nt)/it.height)}v.drawImage(it,0,0),v.restore()}),E&&(Vo(E),Jn.push(E.canvas)),f&&(v.save(),v.globalCompositeOperation="source-over",v.strokeStyle="black",v.lineWidth=1,h.getTriangles().forEach(function(P,A,D){const k=P.target,F=(k[0][0]-S[0])/o,B=-(k[0][1]-S[1])/o,X=(k[1][0]-S[0])/o,W=-(k[1][1]-S[1])/o,Y=(k[2][0]-S[0])/o,Z=-(k[2][1]-S[1])/o;v.beginPath(),v.moveTo(X,W),v.lineTo(F,B),v.lineTo(Y,Z),v.closePath(),v.stroke()}),v.restore()),v.canvas}const z0=10,fu=.25;class N0{constructor(t,e,n,s,o,a,h){this.sourceProj_=t,this.targetProj_=e;let c={};const d=h?am(M=>zt(h,gn(M,this.targetProj_,this.sourceProj_))):qs(this.targetProj_,this.sourceProj_);this.transformInv_=function(M){const S=M[0]+"/"+M[1];return c[S]||(c[S]=d(M)),c[S]},this.maxSourceExtent_=s,this.errorThresholdSquared_=o*o,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&Ct(s)>=Ct(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Ct(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Ct(this.targetProj_.getExtent()):null;const f=wn(n),_=Go(n),p=Zo(n),y=No(n),v=this.transformInv_(f),w=this.transformInv_(_),C=this.transformInv_(p),E=this.transformInv_(y),T=z0+(a?Math.max(0,Math.ceil(Math.log2(dl(n)/(a*a*256*256)))):0);if(this.addQuad_(f,_,p,y,v,w,C,E,T),this.wrapsXInSource_){let M=1/0;this.triangles_.forEach(function(S,P,A){M=Math.min(M,S.source[0][0],S.source[1][0],S.source[2][0])}),this.triangles_.forEach(S=>{if(Math.max(S.source[0][0],S.source[1][0],S.source[2][0])-M>this.sourceWorldWidth_/2){const P=[[S.source[0][0],S.source[0][1]],[S.source[1][0],S.source[1][1]],[S.source[2][0],S.source[2][1]]];P[0][0]-M>this.sourceWorldWidth_/2&&(P[0][0]-=this.sourceWorldWidth_),P[1][0]-M>this.sourceWorldWidth_/2&&(P[1][0]-=this.sourceWorldWidth_),P[2][0]-M>this.sourceWorldWidth_/2&&(P[2][0]-=this.sourceWorldWidth_);const A=Math.min(P[0][0],P[1][0],P[2][0]);Math.max(P[0][0],P[1][0],P[2][0])-A<this.sourceWorldWidth_/2&&(S.source=P)}})}c={}}addTriangle_(t,e,n,s,o,a){this.triangles_.push({source:[s,o,a],target:[t,e,n]})}addQuad_(t,e,n,s,o,a,h,c,d){const f=Pc([o,a,h,c]),_=this.sourceWorldWidth_?Ct(f)/this.sourceWorldWidth_:null,p=this.sourceWorldWidth_,y=this.sourceProj_.canWrapX()&&_>.5&&_<1;let v=!1;if(d>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const C=Pc([t,e,n,s]);v=Ct(C)/this.targetWorldWidth_>fu||v}!y&&this.sourceProj_.isGlobal()&&_&&(v=_>fu||v)}if(!v&&this.maxSourceExtent_&&isFinite(f[0])&&isFinite(f[1])&&isFinite(f[2])&&isFinite(f[3])&&!ee(f,this.maxSourceExtent_))return;let w=0;if(!v&&(!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(h[0])||!isFinite(h[1])||!isFinite(c[0])||!isFinite(c[1]))){if(d>0)v=!0;else if(w=(!isFinite(o[0])||!isFinite(o[1])?8:0)+(!isFinite(a[0])||!isFinite(a[1])?4:0)+(!isFinite(h[0])||!isFinite(h[1])?2:0)+(!isFinite(c[0])||!isFinite(c[1])?1:0),w!=1&&w!=2&&w!=4&&w!=8)return}if(d>0){if(!v){const C=[(t[0]+n[0])/2,(t[1]+n[1])/2],E=this.transformInv_(C);let T;y?T=(fn(o[0],p)+fn(h[0],p))/2-fn(E[0],p):T=(o[0]+h[0])/2-E[0];const M=(o[1]+h[1])/2-E[1];v=T*T+M*M>this.errorThresholdSquared_}if(v){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){const C=[(e[0]+n[0])/2,(e[1]+n[1])/2],E=this.transformInv_(C),T=[(s[0]+t[0])/2,(s[1]+t[1])/2],M=this.transformInv_(T);this.addQuad_(t,e,C,T,o,a,E,M,d-1),this.addQuad_(T,C,n,s,M,E,h,c,d-1)}else{const C=[(t[0]+e[0])/2,(t[1]+e[1])/2],E=this.transformInv_(C),T=[(n[0]+s[0])/2,(n[1]+s[1])/2],M=this.transformInv_(T);this.addQuad_(t,C,T,s,o,E,M,c,d-1),this.addQuad_(C,e,n,T,E,a,h,M,d-1)}return}}if(y){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(w&11)==0&&this.addTriangle_(t,n,s,o,h,c),(w&14)==0&&this.addTriangle_(t,n,e,o,h,a),w&&((w&13)==0&&this.addTriangle_(e,s,t,a,c,o),(w&7)==0&&this.addTriangle_(e,s,n,a,c,h))}calculateSourceExtent(){const t=Le();return this.triangles_.forEach(function(e,n,s){const o=e.source;Ws(t,o[0]),Ws(t,o[1]),Ws(t,o[2])}),t}getTriangles(){return this.triangles_}}const Z0=.5;class cf extends fh{constructor(t,e,n,s,o,a,h,c,d,f,_,p){super(o,q.IDLE,p),this.renderEdges_=_!==void 0?_:!1,this.pixelRatio_=h,this.gutter_=c,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=s,this.wrappedTileCoord_=a||o,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;const y=s.getTileCoordExtent(this.wrappedTileCoord_),v=this.targetTileGrid_.getExtent();let w=this.sourceTileGrid_.getExtent();const C=v?Zi(y,v):y;if(dl(C)===0){this.state=q.EMPTY;return}const E=t.getExtent();E&&(w?w=Zi(w,E):w=E);const T=s.getResolution(this.wrappedTileCoord_[0]),M=D0(t,n,C,T);if(!isFinite(M)||M<=0){this.state=q.EMPTY;return}const S=f!==void 0?f:Z0;if(this.triangulation_=new N0(t,n,C,w,M*S,T),this.triangulation_.getTriangles().length===0){this.state=q.EMPTY;return}this.sourceZ_=e.getZForResolution(M);let P=this.triangulation_.calculateSourceExtent();if(w&&(t.canWrapX()?(P[1]=Mt(P[1],w[1],w[3]),P[3]=Mt(P[3],w[1],w[3])):P=Zi(P,w)),!dl(P))this.state=q.EMPTY;else{let A=0,D=0;t.canWrapX()&&(A=Ct(E),D=Math.floor((P[0]-E[0])/A)),fd(P.slice(),t,!0).forEach(F=>{const B=e.getTileRangeForExtentAndZ(F,this.sourceZ_);for(let X=B.minX;X<=B.maxX;X++)for(let W=B.minY;W<=B.maxY;W++){const Y=d(this.sourceZ_,X,W,h);if(Y){const Z=D*A;this.sourceTiles_.push({tile:Y,offset:Z})}}++D}),this.sourceTiles_.length===0&&(this.state=q.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{var s;const n=e.tile;if(n&&n.getState()==q.LOADED){const o=this.sourceTileGrid_.getTileCoordExtent(n.tileCoord);o[0]+=e.offset,o[2]+=e.offset;const a=(s=this.clipExtent_)==null?void 0:s.slice();a&&(a[0]+=e.offset,a[2]+=e.offset),t.push({extent:o,clipExtent:a,image:n.getImage()})}}),this.sourceTiles_.length=0,t.length===0)this.state=q.ERROR;else{const e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),s=typeof n=="number"?n:n[0],o=typeof n=="number"?n:n[1],a=this.targetTileGrid_.getResolution(e),h=this.sourceTileGrid_.getResolution(this.sourceZ_),c=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=F0(s,o,this.pixelRatio_,h,this.sourceTileGrid_.getExtent(),a,c,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=q.LOADED}this.changed()}load(){if(this.state==q.IDLE){this.state=q.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const n=e.getState();if(n==q.IDLE||n==q.LOADING){t++;const s=_t(e,rt.CHANGE,o=>{const a=e.getState();(a==q.LOADED||a==q.ERROR||a==q.EMPTY)&&(Lt(s),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(s)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},n,s){e.getState()==q.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(Lt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Vo(this.canvas_.getContext("2d")),Jn.push(this.canvas_),this.canvas_=null),super.release()}}class G0{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const t=this.pop();t instanceof ko&&t.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const n=this.entries_[t];return xt(n!==void 0,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(t){const e=this.entries_[t];return xt(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.key_;return t}getValues(){const t=new Array(this.count_);let e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){var e;return(e=this.entries_[t])==null?void 0:e.value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){xt(!(t in this.entries_),"Tried to set a value for a key that is used already");const n={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_}setSize(t){this.highWaterMark=t}}function Eo(i,t,e,n){return n!==void 0?(n[0]=i,n[1]=t,n[2]=e,n):[i,t,e]}function B0(i,t,e){return i+"/"+t+"/"+e}function W0(i){return X0(i[0],i[1],i[2])}function X0(i,t,e){return(t<<i)+e}function j0(i,t){const e=i[0],n=i[1],s=i[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const o=t.getFullTileRange(e);return o?o.containsXY(n,s):!0}class uf{constructor(){tn(this,"pushMethodArgs_",(...t)=>(this.push_(t),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(yo(),{get:(t,e)=>{if(typeof yo()[e]=="function")return this.push_(e),this.pushMethodArgs_},set:(t,e,n)=>(this.push_(e,n),!0)})}push_(...t){const e=this.instructions_,n=this.zIndex+this.offset_;e[n]||(e[n]=[]),e[n].push(...t)}pushFunction(t){this.push_(t)}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let n=0,s=e.length;n<s;++n){const o=e[n];if(typeof o=="function"){o(t);continue}const a=e[++n];if(typeof t[o]=="function")t[o](...a);else{if(typeof a=="function"){t[o]=a(t);continue}t[o]=a}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const Y0=5;class U0 extends ar{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.staleKeys_=new Array,this.maxStaleKeys=Y0}getStaleKeys(){return this.staleKeys_}prependStaleKey(t){this.staleKeys_.unshift(t),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(t){return st()}getData(t){return null}prepareFrame(t){return st()}renderFrame(t,e){return st()}forEachFeatureAtCoordinate(t,e,n,s,o){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===ct.LOADED||e.getState()===ct.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=ct.LOADED&&e!=ct.ERROR&&t.addEventListener(rt.CHANGE,this.boundHandleImageChange_),e==ct.IDLE&&(t.load(),e=t.getState()),e==ct.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const gu=[];let Un=null;function V0(){Un=Gt(1,1,void 0,{willReadFrequently:!0})}class _h extends U0{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=me(),this.pixelTransform=me(),this.inversePixelTransform=me(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(t,e,n){Un||V0(),Un.clearRect(0,0,1,1);let s;try{Un.drawImage(t,e,n,1,1,0,0,1,1),s=Un.getImageData(0,0,1,1).data}catch{return Un=null,null}return s}getBackground(t){let n=this.getLayer().getBackground();return typeof n=="function"&&(n=n(t.viewState.resolution)),n||void 0}useContainer(t,e,n){const s=this.getLayer().getClassName();let o,a;if(t&&t.className===s&&(!n||t&&t.style.backgroundColor&&Ui(ss(t.style.backgroundColor),ss(n)))){const h=t.firstElementChild;h instanceof HTMLCanvasElement&&(a=h.getContext("2d"))}if(a&&fm(a.canvas.style.transform,e)?(this.container=t,this.context=a,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){o=document.createElement("div"),o.className=s;let h=o.style;h.position="absolute",h.width="100%",h.height="100%",a=Gt();const c=a.canvas;o.appendChild(c),h=c.style,h.position="absolute",h.left="0",h.transformOrigin="top left",this.container=o,this.context=a}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(t,e,n){const s=wn(n),o=Go(n),a=Zo(n),h=No(n);zt(e.coordinateToPixelTransform,s),zt(e.coordinateToPixelTransform,o),zt(e.coordinateToPixelTransform,a),zt(e.coordinateToPixelTransform,h);const c=this.inversePixelTransform;zt(c,s),zt(c,o),zt(c,a),zt(c,h),t.save(),t.beginPath(),t.moveTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.lineTo(Math.round(h[0]),Math.round(h[1])),t.clip()}prepareContainer(t,e){const n=t.extent,s=t.viewState.resolution,o=t.viewState.rotation,a=t.pixelRatio,h=Math.round(Ct(n)/s*a),c=Math.round(ie(n)/s*a);Qe(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/a,1/a,o,-h/2,-c/2),Wl(this.inversePixelTransform,this.pixelTransform);const d=bd(this.pixelTransform);if(this.useContainer(e,d,this.getBackground(t)),!this.containerReused){const f=this.context.canvas;f.width!=h||f.height!=c?(f.width=h,f.height=c):this.context.clearRect(0,0,h,c),d!==f.style.transform&&(f.style.transform=d)}}dispatchRenderEvent_(t,e,n){const s=this.getLayer();if(s.hasListener(t)){const o=new of(t,this.inversePixelTransform,n,e);s.dispatchEvent(o)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(Ce.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(Ce.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new uf),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(Ce.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(Ce.POSTRENDER,this.context,t))}getRenderTransform(t,e,n,s,o,a,h){const c=o/2,d=a/2,f=s/e,_=-f,p=-t[0]+h,y=-t[1];return Qe(this.tempTransform,c,d,f,_,-n,p,y)}disposeInternal(){delete this.frameState,super.disposeInternal()}}function $a(i,t,e,n){return`${i},${B0(t,e,n)}`}function qa(i,t,e){if(!(e in i))return i[e]=new Set([t]),!0;const n=i[e],s=n.has(t);return s||n.add(t),!s}function K0(i,t,e){const n=i[e];return n?n.delete(t):!1}function _u(i,t){const e=i.layerStatesArray[i.layerIndex];e.extent&&(t=Zi(t,He(e.extent,i.viewState.projection)));const n=e.layer.getRenderSource();if(!n.getWrapX()){const s=n.getTileGridForProjection(i.viewState.projection).getExtent();s&&(t=Zi(t,s))}return t}class H0 extends _h{constructor(t,e){super(t),e=e||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision_,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=Le(),this.tempTileRange_=new gh(0,0,0,0),this.tempTileCoord_=Eo(0,0,0);const n=e.cacheSize!==void 0?e.cacheSize:512;this.tileCache_=new G0(n),this.maxStaleKeys=n*.5}getTileCache(){return this.tileCache_}getOrCreateTile(t,e,n,s){const o=this.tileCache_,h=this.getLayer().getSource(),c=$a(h.getKey(),t,e,n);let d;if(o.containsKey(c))d=o.get(c);else{if(d=h.getTile(t,e,n,s.pixelRatio,s.viewState.projection),!d)return null;o.set(c,d)}return d}getTile(t,e,n,s){const o=this.getOrCreateTile(t,e,n,s);return o||null}getData(t){const e=this.frameState;if(!e)return null;const n=this.getLayer(),s=zt(e.pixelToCoordinateTransform,t.slice()),o=n.getExtent();if(o&&!yn(o,s))return null;const a=e.viewState,h=n.getRenderSource(),c=h.getTileGridForProjection(a.projection),d=h.getTilePixelRatio(e.pixelRatio);for(let f=c.getZForResolution(a.resolution);f>=c.getMinZoom();--f){const _=c.getTileCoordForCoordAndZ(s,f),p=this.getTile(f,_[1],_[2],e);if(!p||p.getState()!==q.LOADED)continue;const y=c.getOrigin(f),v=ue(c.getTileSize(f)),w=c.getResolution(f);let C;if(p instanceof hf||p instanceof cf)C=p.getImage();else if(p instanceof cu){if(C=bl(p.getData()),!C)continue}else continue;const E=Math.floor(d*((s[0]-y[0])/w-_[1]*v[0])),T=Math.floor(d*((y[1]-s[1])/w-_[2]*v[1])),M=Math.round(d*h.getGutterForProjection(a.projection));return this.getImageData(C,E+M,T+M)}return null}prepareFrame(t){this.renderedProjection?t.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=t.viewState.projection):this.renderedProjection=t.viewState.projection;const e=this.getLayer().getSource();if(!e)return!1;const n=e.getRevision();return this.renderedRevision_?this.renderedRevision_!==n&&(this.renderedRevision_=n,this.renderedSourceKey_===e.getKey()&&this.tileCache_.clear()):this.renderedRevision_=n,!0}enqueueTiles(t,e,n,s,o){const a=t.viewState,h=this.getLayer(),c=h.getRenderSource(),d=c.getTileGridForProjection(a.projection),f=vt(c);f in t.wantedTiles||(t.wantedTiles[f]={});const _=t.wantedTiles[f],p=h.getMapInternal(),y=Math.max(n-o,d.getMinZoom(),d.getZForResolution(Math.min(h.getMaxResolution(),p?p.getView().getResolutionForZoom(Math.max(h.getMinZoom(),0)):d.getResolution(0)),c.zDirection)),v=a.rotation,w=v?ud(a.center,a.resolution,v,t.size):void 0;for(let C=n;C>=y;--C){const E=d.getTileRangeForExtentAndZ(e,C,this.tempTileRange_),T=d.getResolution(C);for(let M=E.minX;M<=E.maxX;++M)for(let S=E.minY;S<=E.maxY;++S){if(v&&!d.tileCoordIntersectsViewport([C,M,S],w))continue;const P=this.getTile(C,M,S,t);if(!P||!qa(s,P,C))continue;const D=P.getKey();if(_[D]=!0,P.getState()===q.IDLE&&!t.tileQueue.isKeyQueued(D)){const k=Eo(C,M,S,this.tempTileCoord_);t.tileQueue.enqueue([P,f,d.getTileCoordCenter(k),T])}}}}findStaleTile_(t,e){const n=this.tileCache_,s=t[0],o=t[1],a=t[2],h=this.getStaleKeys();for(let c=0;c<h.length;++c){const d=$a(h[c],s,o,a);if(n.containsKey(d)){const f=n.peek(d);if(f.getState()===q.LOADED)return f.endTransition(vt(this)),qa(e,f,s),!0}}return!1}findAltTiles_(t,e,n,s){const o=t.getTileRangeForTileCoordAndZ(e,n,this.tempTileRange_);if(!o)return!1;let a=!0;const h=this.tileCache_,d=this.getLayer().getRenderSource().getKey();for(let f=o.minX;f<=o.maxX;++f)for(let _=o.minY;_<=o.maxY;++_){const p=$a(d,n,f,_);let y=!1;if(h.containsKey(p)){const v=h.peek(p);v.getState()===q.LOADED&&(qa(s,v,n),y=!0)}y||(a=!1)}return a}renderFrame(t,e){this.renderComplete=!0;const n=t.layerStatesArray[t.layerIndex],s=t.viewState,o=s.projection,a=s.resolution,h=s.center,c=t.pixelRatio,d=this.getLayer(),f=d.getSource(),_=f.getTileGridForProjection(o),p=_.getZForResolution(a,f.zDirection),y=_.getResolution(p),v=f.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==v&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=v):this.renderedSourceKey_=v;let w=t.extent;const C=f.getTilePixelRatio(c);this.prepareContainer(t,e);const E=this.context.canvas.width,T=this.context.canvas.height,M=n.extent&&He(n.extent);M&&(w=Zi(w,He(n.extent)));const S=y*E/2/C,P=y*T/2/C,A=[h[0]-S,h[1]-P,h[0]+S,h[1]+P],D={};this.renderedTiles.length=0;const k=d.getPreload();if(t.nextExtent){const G=_.getZForResolution(s.nextResolution,f.zDirection),ot=_u(t,t.nextExtent);this.enqueueTiles(t,ot,G,D,k)}const F=_u(t,w);if(this.enqueueTiles(t,F,p,D,0),k>0&&setTimeout(()=>{this.enqueueTiles(t,F,p-1,D,k-1)},0),!(p in D))return this.container;const B=vt(this),X=t.time;for(const G of D[p]){const ot=G.getState();if(ot===q.EMPTY)continue;const j=G.tileCoord;if(ot===q.LOADED&&G.getAlpha(B,X)===1){G.endTransition(B);continue}if(ot!==q.ERROR&&(this.renderComplete=!1),this.findStaleTile_(j,D)){K0(D,G,p),t.animate=!0;continue}if(this.findAltTiles_(_,j,p+1,D))continue;const pt=_.getMinZoom();for(let dt=p-1;dt>=pt&&!this.findAltTiles_(_,j,dt,D);--dt);}const W=y/a*c/C,Y=this.getRenderContext(t);Qe(this.tempTransform,E/2,T/2,W,W,0,-E/2,-T/2),n.extent&&this.clipUnrotated(Y,t,M),f.getInterpolate()||(Y.imageSmoothingEnabled=!1),this.preRender(Y,t);const Z=Object.keys(D).map(Number);Z.sort(mi);let Q;const V=[],J=[];for(let G=Z.length-1;G>=0;--G){const ot=Z[G],j=f.getTilePixelSize(ot,c,o),N=_.getResolution(ot)/y,pt=j[0]*N*W,dt=j[1]*N*W,tt=_.getTileCoordForCoordAndZ(wn(A),ot),it=_.getTileCoordExtent(tt),bt=zt(this.tempTransform,[C*(it[0]-A[0])/y,C*(A[3]-it[3])/y]),Nt=C*f.getGutterForProjection(o);for(const ne of D[ot]){if(ne.getState()!==q.LOADED)continue;const jt=ne.tileCoord,wi=tt[1]-jt[1],ti=Math.round(bt[0]-(wi-1)*pt),ei=tt[2]-jt[2],ii=Math.round(bt[1]-(ei-1)*dt),Jt=Math.round(bt[0]-wi*pt),de=Math.round(bt[1]-ei*dt),Ze=ti-Jt,Se=ii-de,Vi=Z.length===1;let Ge=!1;Q=[Jt,de,Jt+Ze,de,Jt+Ze,de+Se,Jt,de+Se];for(let Be=0,ni=V.length;Be<ni;++Be)if(!Vi&&ot<J[Be]){const At=V[Be];ee([Jt,de,Jt+Ze,de+Se],[At[0],At[3],At[4],At[7]])&&(Ge||(Y.save(),Ge=!0),Y.beginPath(),Y.moveTo(Q[0],Q[1]),Y.lineTo(Q[2],Q[3]),Y.lineTo(Q[4],Q[5]),Y.lineTo(Q[6],Q[7]),Y.moveTo(At[6],At[7]),Y.lineTo(At[4],At[5]),Y.lineTo(At[2],At[3]),Y.lineTo(At[0],At[1]),Y.clip())}V.push(Q),J.push(ot),this.drawTile(ne,t,Jt,de,Ze,Se,Nt,Vi),Ge&&Y.restore(),this.renderedTiles.unshift(ne),this.updateUsedTiles(t.usedTiles,f,ne)}}if(this.renderedResolution=y,this.extentChanged=!this.renderedExtent_||!Hs(this.renderedExtent_,A),this.renderedExtent_=A,this.renderedPixelRatio=c,this.postRender(this.context,t),n.extent&&Y.restore(),Y.imageSmoothingEnabled=!0,this.renderComplete){const G=(ot,j)=>{const $=vt(f),N=j.wantedTiles[$],pt=N?Object.keys(N).length:0;this.updateCacheSize(pt),this.tileCache_.expireCache()};t.postRenderFunctions.push(G)}return this.container}updateCacheSize(t){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,t*2)}drawTile(t,e,n,s,o,a,h,c){let d;if(t instanceof cu){if(d=bl(t.getData()),!d)throw new Error("Rendering array data is not yet supported")}else d=this.getTileImage(t);if(!d)return;const f=this.getRenderContext(e),_=vt(this),p=e.layerStatesArray[e.layerIndex],y=p.opacity*(c?t.getAlpha(_,e.time):1),v=y!==f.globalAlpha;v&&(f.save(),f.globalAlpha=y),f.drawImage(d,h,h,d.width-2*h,d.height-2*h,n,s,o,a),v&&f.restore(),y!==p.opacity?e.animate=!0:c&&t.endTransition(_)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}updateUsedTiles(t,e,n){const s=vt(e);s in t||(t[s]={}),t[s][n.getKey()]=!0}}const Qr={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class $0 extends gr{constructor(t){t=t||{};const e=Object.assign({},t),n=t.cacheSize;delete t.cacheSize,delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.cacheSize_=n,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(Qr.PRELOAD)}setPreload(t){this.set(Qr.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(Qr.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(Qr.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}class df extends $0{constructor(t){super(t)}createRenderer(){return new H0(this,{cacheSize:this.getCacheSize()})}}const Bn=[0,0,0],Ri=5;class ff{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,xt(u_(this.resolutions_,(s,o)=>o-s),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let s=0,o=this.resolutions_.length-1;s<o;++s)if(!e)e=this.resolutions_[s]/this.resolutions_[s+1];else if(this.resolutions_[s]/this.resolutions_[s+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,xt(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const n=t.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=wn(n)),xt(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,xt(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:eh,xt(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((s,o)=>{const a=new gh(Math.min(0,s[0]),Math.max(s[0]-1,-1),Math.min(0,s[1]),Math.max(s[1]-1,-1));if(n){const h=this.getTileRangeForExtentAndZ(n,o);a.minX=Math.max(h.minX,a.minX),a.maxX=Math.min(h.maxX,a.maxX),a.minY=Math.max(h.minY,a.minY),a.maxY=Math.min(h.maxY,a.maxY)}return a}):n&&this.calculateTileRanges_(n)}forEachTileCoord(t,e,n){const s=this.getTileRangeForExtentAndZ(t,e);for(let o=s.minX,a=s.maxX;o<=a;++o)for(let h=s.minY,c=s.maxY;h<=c;++h)n([e,o,h])}forEachTileCoordParentTileRange(t,e,n,s){let o,a,h,c=null,d=t[0]-1;for(this.zoomFactor_===2?(a=t[1],h=t[2]):c=this.getTileCoordExtent(t,s);d>=this.minZoom;){if(a!==void 0&&h!==void 0?(a=Math.floor(a/2),h=Math.floor(h/2),o=Gn(a,a,h,h,n)):o=this.getTileRangeForExtentAndZ(c,d,n),e(d,o))return!0;--d}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,n){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const o=t[1]*2,a=t[2]*2;return Gn(o,o+1,a,a+1,e)}const s=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,n){if(e>this.maxZoom||e<this.minZoom)return null;const s=t[0],o=t[1],a=t[2];if(e===s)return Gn(o,a,o,a,n);if(this.zoomFactor_){const c=Math.pow(this.zoomFactor_,e-s),d=Math.floor(o*c),f=Math.floor(a*c);if(e<s)return Gn(d,d,f,f,n);const _=Math.floor(c*(o+1))-1,p=Math.floor(c*(a+1))-1;return Gn(d,_,f,p,n)}const h=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(h,e,n)}getTileRangeForExtentAndZ(t,e,n){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,Bn);const s=Bn[1],o=Bn[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,Bn);const a=Bn[1],h=Bn[2];return Gn(s,a,o,h,n)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),n=this.getResolution(t[0]),s=ue(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*s[0]*n,e[1]-(t[2]+.5)*s[1]*n]}getTileCoordExtent(t,e){const n=this.getOrigin(t[0]),s=this.getResolution(t[0]),o=ue(this.getTileSize(t[0]),this.tmpSize_),a=n[0]+t[1]*o[0]*s,h=n[1]-(t[2]+1)*o[1]*s,c=a+o[0]*s,d=h+o[1]*s;return Wi(a,h,c,d,e)}getTileCoordForCoordAndResolution(t,e,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,n)}getTileCoordForXYAndResolution_(t,e,n,s,o){const a=this.getZForResolution(n),h=n/this.getResolution(a),c=this.getOrigin(a),d=ue(this.getTileSize(a),this.tmpSize_);let f=h*(t-c[0])/n/d[0],_=h*(c[1]-e)/n/d[1];return s?(f=Yr(f,Ri)-1,_=Yr(_,Ri)-1):(f=jr(f,Ri),_=jr(_,Ri)),Eo(a,f,_,o)}getTileCoordForXYAndZ_(t,e,n,s,o){const a=this.getOrigin(n),h=this.getResolution(n),c=ue(this.getTileSize(n),this.tmpSize_);let d=(t-a[0])/h/c[0],f=(a[1]-e)/h/c[1];return s?(d=Yr(d,Ri)-1,f=Yr(f,Ri)-1):(d=jr(d,Ri),f=jr(f,Ri)),Eo(n,d,f,o)}getTileCoordForCoordAndZ(t,e,n){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,n)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const n=Rl(this.resolutions_,t,e||0);return Mt(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return Od(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,n=new Array(e);for(let s=this.minZoom;s<e;++s)n[s]=this.getTileRangeForExtentAndZ(t,s);this.fullTileRanges_=n}}function gf(i){let t=i.getDefaultTileGrid();return t||(t=t1(i),i.setDefaultTileGrid(t)),t}function q0(i,t,e){const n=t[0],s=i.getTileCoordCenter(t),o=mh(e);if(!yn(o,s)){const a=Ct(o),h=Math.ceil((o[0]-s[0])/a);return s[0]+=a*h,i.getTileCoordForCoordAndZ(s,n)}return t}function J0(i,t,e,n){n=n!==void 0?n:"top-left";const s=_f(i,t,e);return new ff({extent:i,origin:L_(i,n),resolutions:s,tileSize:e})}function Q0(i){const t=i||{},e=t.extent||It("EPSG:3857").getExtent(),n={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:_f(e,t.maxZoom,t.tileSize,t.maxResolution)};return new ff(n)}function _f(i,t,e,n){t=t!==void 0?t:km,e=ue(e!==void 0?e:eh);const s=ie(i),o=Ct(i);n=n>0?n:Math.max(o/e[0],s/e[1]);const a=t+1,h=new Array(a);for(let c=0;c<a;++c)h[c]=n/Math.pow(2,c);return h}function t1(i,t,e,n){const s=mh(i);return J0(s,t,e,n)}function mh(i){i=It(i);let t=i.getExtent();if(!t){const e=180*Dl.degrees/i.getMetersPerUnit();t=Wi(-e,-e,e,e)}return t}const e1=/\{z\}/g,i1=/\{x\}/g,n1=/\{y\}/g,s1=/\{-y\}/g;function r1(i,t,e,n,s){return i.replace(e1,t.toString()).replace(i1,e.toString()).replace(n1,n.toString()).replace(s1,function(){if(s===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(s-n).toString()})}function o1(i){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(i);if(e){const n=e[1].charCodeAt(0),s=e[2].charCodeAt(0);let o;for(o=n;o<=s;++o)t.push(i.replace(e[0],String.fromCharCode(o)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(i),e){const n=parseInt(e[2],10);for(let s=parseInt(e[1],10);s<=n;s++)t.push(i.replace(e[0],s.toString()));return t}return t.push(i),t}function a1(i,t){return function(e,n,s){if(!e)return;let o;const a=e[0];if(t){const h=t.getFullTileRange(a);h&&(o=h.getHeight()-1)}return r1(i,a,e[1],e[2],o)}}function l1(i,t){const e=i.length,n=new Array(e);for(let s=0;s<e;++s)n[s]=a1(i[s],t);return h1(n)}function h1(i){return i.length===1?i[0]:function(t,e,n){if(!t)return;const s=W0(t),o=fn(s,i.length);return i[o](t,e,n)}}class mf extends Ne{constructor(t){super(),this.projection=It(t.projection),this.attributions_=mu(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible??!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(n,s){e.viewResolver=n,e.viewRejector=s})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=mu(t),this.changed()}setState(t){this.state_=t,this.changed()}}function mu(i){return i?typeof i=="function"?i:(Array.isArray(i)||(i=[i]),t=>i):null}class c1 extends mf{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&ue(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tmpSize=[0,0],this.key_=t.key||vt(this),this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,n,s,o){return st()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:gf(t)}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,n){const s=this.getTileGridForProjection(n),o=this.getTilePixelRatio(e),a=ue(s.getTileSize(t),this.tmpSize);return o==1?a:Pp(a,o,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){const n=e!==void 0?e:this.getProjection(),s=e!==void 0?this.getTileGridForProjection(n):this.tileGrid||this.getTileGridForProjection(n);return this.getWrapX()&&n.isGlobal()&&(t=q0(s,t,n)),j0(t,s)?t:null}clear(){}refresh(){this.clear(),super.refresh()}}class u1 extends vi{constructor(t,e){super(t),this.tile=e}}const Ja={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class ph extends c1{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===ph.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,n=vt(e),s=e.getState();let o;s==q.LOADING?(this.tileLoadingKeys_[n]=!0,o=Ja.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],o=s==q.ERROR?Ja.TILELOADERROR:s==q.LOADED?Ja.TILELOADEND:void 0),o!=null&&this.dispatchEvent(new u1(o,e))}setTileLoadFunction(t){this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=o1(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(l1(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,n){}}class d1 extends ph{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:f1,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:hf,this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(t){return this.getProjection()&&t&&!ro(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||ro(e,t)))return this.tileGrid;const n=vt(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=gf(t)),this.tileGridForProjection[n]}createTile_(t,e,n,s,o,a){const h=[t,e,n],c=this.getTileCoordForTileUrlFunction(h,o),d=c?this.tileUrlFunction(c,s,o):void 0,f=new this.tileClass(h,d!==void 0?q.IDLE:q.EMPTY,d!==void 0?d:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return f.key=a,f.addEventListener(rt.CHANGE,this.handleTileChange.bind(this)),f}getTile(t,e,n,s,o){const a=this.getProjection();if(!a||!o||ro(a,o))return this.getTileInternal(t,e,n,s,a||o);const h=[t,e,n],c=this.getKey(),d=this.getTileGridForProjection(a),f=this.getTileGridForProjection(o),_=this.getTileCoordForTileUrlFunction(h,o),p=new cf(a,d,o,f,h,_,this.getTilePixelRatio(s),this.getGutter(),(y,v,w,C)=>this.getTileInternal(y,v,w,C,a),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return p.key=c,p}getTileInternal(t,e,n,s,o){const a=this.getKey();return this.createTile_(t,e,n,s,o,a)}setRenderReprojectionEdges(t){this.renderReprojectionEdges_!=t&&(this.renderReprojectionEdges_=t,this.changed())}setTileGridForProjection(t,e){const n=It(t);if(n){const s=vt(n);s in this.tileGridForProjection||(this.tileGridForProjection[s]=e)}}}function f1(i,t){i.getImage().src=t}class pf extends d1{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",n=t.tileGrid!==void 0?t.tileGrid:Q0({extent:mh(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}const g1='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class _1 extends pf{constructor(t){t=t||{};let e;t.attributions!==void 0?e=t.attributions:e=[g1];const n=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",s=t.url!==void 0?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:n,interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:19,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:s,wrapX:t.wrapX,zDirection:t.zDirection})}}function m1(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Gs={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */var p1=Gs.exports,pu;function y1(){return pu||(pu=1,function(i,t){(function(e,n){n(t)})(p1,function(e){var n="1.9.4";function s(r){var l,u,g,m;for(u=1,g=arguments.length;u<g;u++){m=arguments[u];for(l in m)r[l]=m[l]}return r}var o=Object.create||function(){function r(){}return function(l){return r.prototype=l,new r}}();function a(r,l){var u=Array.prototype.slice;if(r.bind)return r.bind.apply(r,u.call(arguments,1));var g=u.call(arguments,2);return function(){return r.apply(l,g.length?g.concat(u.call(arguments)):arguments)}}var h=0;function c(r){return"_leaflet_id"in r||(r._leaflet_id=++h),r._leaflet_id}function d(r,l,u){var g,m,x,b;return b=function(){g=!1,m&&(x.apply(u,m),m=!1)},x=function(){g?m=arguments:(r.apply(u,arguments),setTimeout(b,l),g=!0)},x}function f(r,l,u){var g=l[1],m=l[0],x=g-m;return r===g&&u?r:((r-m)%x+x)%x+m}function _(){return!1}function p(r,l){if(l===!1)return r;var u=Math.pow(10,l===void 0?6:l);return Math.round(r*u)/u}function y(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function v(r){return y(r).split(/\s+/)}function w(r,l){Object.prototype.hasOwnProperty.call(r,"options")||(r.options=r.options?o(r.options):{});for(var u in l)r.options[u]=l[u];return r.options}function C(r,l,u){var g=[];for(var m in r)g.push(encodeURIComponent(u?m.toUpperCase():m)+"="+encodeURIComponent(r[m]));return(!l||l.indexOf("?")===-1?"?":"&")+g.join("&")}var E=/\{ *([\w_ -]+) *\}/g;function T(r,l){return r.replace(E,function(u,g){var m=l[g];if(m===void 0)throw new Error("No value provided for variable "+u);return typeof m=="function"&&(m=m(l)),m})}var M=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"};function S(r,l){for(var u=0;u<r.length;u++)if(r[u]===l)return u;return-1}var P="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function A(r){return window["webkit"+r]||window["moz"+r]||window["ms"+r]}var D=0;function k(r){var l=+new Date,u=Math.max(0,16-(l-D));return D=l+u,window.setTimeout(r,u)}var F=window.requestAnimationFrame||A("RequestAnimationFrame")||k,B=window.cancelAnimationFrame||A("CancelAnimationFrame")||A("CancelRequestAnimationFrame")||function(r){window.clearTimeout(r)};function X(r,l,u){if(u&&F===k)r.call(l);else return F.call(window,a(r,l))}function W(r){r&&B.call(window,r)}var Y={__proto__:null,extend:s,create:o,bind:a,get lastId(){return h},stamp:c,throttle:d,wrapNum:f,falseFn:_,formatNum:p,trim:y,splitWords:v,setOptions:w,getParamString:C,template:T,isArray:M,indexOf:S,emptyImageUrl:P,requestFn:F,cancelFn:B,requestAnimFrame:X,cancelAnimFrame:W};function Z(){}Z.extend=function(r){var l=function(){w(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},u=l.__super__=this.prototype,g=o(u);g.constructor=l,l.prototype=g;for(var m in this)Object.prototype.hasOwnProperty.call(this,m)&&m!=="prototype"&&m!=="__super__"&&(l[m]=this[m]);return r.statics&&s(l,r.statics),r.includes&&(Q(r.includes),s.apply(null,[g].concat(r.includes))),s(g,r),delete g.statics,delete g.includes,g.options&&(g.options=u.options?o(u.options):{},s(g.options,r.options)),g._initHooks=[],g.callInitHooks=function(){if(!this._initHooksCalled){u.callInitHooks&&u.callInitHooks.call(this),this._initHooksCalled=!0;for(var x=0,b=g._initHooks.length;x<b;x++)g._initHooks[x].call(this)}},l},Z.include=function(r){var l=this.prototype.options;return s(this.prototype,r),r.options&&(this.prototype.options=l,this.mergeOptions(r.options)),this},Z.mergeOptions=function(r){return s(this.prototype.options,r),this},Z.addInitHook=function(r){var l=Array.prototype.slice.call(arguments,1),u=typeof r=="function"?r:function(){this[r].apply(this,l)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(u),this};function Q(r){if(!(typeof L>"u"||!L||!L.Mixin)){r=M(r)?r:[r];for(var l=0;l<r.length;l++)r[l]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var V={on:function(r,l,u){if(typeof r=="object")for(var g in r)this._on(g,r[g],l);else{r=v(r);for(var m=0,x=r.length;m<x;m++)this._on(r[m],l,u)}return this},off:function(r,l,u){if(!arguments.length)delete this._events;else if(typeof r=="object")for(var g in r)this._off(g,r[g],l);else{r=v(r);for(var m=arguments.length===1,x=0,b=r.length;x<b;x++)m?this._off(r[x]):this._off(r[x],l,u)}return this},_on:function(r,l,u,g){if(typeof l!="function"){console.warn("wrong listener type: "+typeof l);return}if(this._listens(r,l,u)===!1){u===this&&(u=void 0);var m={fn:l,ctx:u};g&&(m.once=!0),this._events=this._events||{},this._events[r]=this._events[r]||[],this._events[r].push(m)}},_off:function(r,l,u){var g,m,x;if(this._events&&(g=this._events[r],!!g)){if(arguments.length===1){if(this._firingCount)for(m=0,x=g.length;m<x;m++)g[m].fn=_;delete this._events[r];return}if(typeof l!="function"){console.warn("wrong listener type: "+typeof l);return}var b=this._listens(r,l,u);if(b!==!1){var R=g[b];this._firingCount&&(R.fn=_,this._events[r]=g=g.slice()),g.splice(b,1)}}},fire:function(r,l,u){if(!this.listens(r,u))return this;var g=s({},l,{type:r,target:this,sourceTarget:l&&l.sourceTarget||this});if(this._events){var m=this._events[r];if(m){this._firingCount=this._firingCount+1||1;for(var x=0,b=m.length;x<b;x++){var R=m[x],I=R.fn;R.once&&this.off(r,I,R.ctx),I.call(R.ctx||this,g)}this._firingCount--}}return u&&this._propagateEvent(g),this},listens:function(r,l,u,g){typeof r!="string"&&console.warn('"string" type argument expected');var m=l;typeof l!="function"&&(g=!!l,m=void 0,u=void 0);var x=this._events&&this._events[r];if(x&&x.length&&this._listens(r,m,u)!==!1)return!0;if(g){for(var b in this._eventParents)if(this._eventParents[b].listens(r,l,u,g))return!0}return!1},_listens:function(r,l,u){if(!this._events)return!1;var g=this._events[r]||[];if(!l)return!!g.length;u===this&&(u=void 0);for(var m=0,x=g.length;m<x;m++)if(g[m].fn===l&&g[m].ctx===u)return m;return!1},once:function(r,l,u){if(typeof r=="object")for(var g in r)this._on(g,r[g],l,!0);else{r=v(r);for(var m=0,x=r.length;m<x;m++)this._on(r[m],l,u,!0)}return this},addEventParent:function(r){return this._eventParents=this._eventParents||{},this._eventParents[c(r)]=r,this},removeEventParent:function(r){return this._eventParents&&delete this._eventParents[c(r)],this},_propagateEvent:function(r){for(var l in this._eventParents)this._eventParents[l].fire(r.type,s({layer:r.target,propagatedFrom:r.target},r),!0)}};V.addEventListener=V.on,V.removeEventListener=V.clearAllEventListeners=V.off,V.addOneTimeEventListener=V.once,V.fireEvent=V.fire,V.hasEventListeners=V.listens;var J=Z.extend(V);function G(r,l,u){this.x=u?Math.round(r):r,this.y=u?Math.round(l):l}var ot=Math.trunc||function(r){return r>0?Math.floor(r):Math.ceil(r)};G.prototype={clone:function(){return new G(this.x,this.y)},add:function(r){return this.clone()._add(j(r))},_add:function(r){return this.x+=r.x,this.y+=r.y,this},subtract:function(r){return this.clone()._subtract(j(r))},_subtract:function(r){return this.x-=r.x,this.y-=r.y,this},divideBy:function(r){return this.clone()._divideBy(r)},_divideBy:function(r){return this.x/=r,this.y/=r,this},multiplyBy:function(r){return this.clone()._multiplyBy(r)},_multiplyBy:function(r){return this.x*=r,this.y*=r,this},scaleBy:function(r){return new G(this.x*r.x,this.y*r.y)},unscaleBy:function(r){return new G(this.x/r.x,this.y/r.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=ot(this.x),this.y=ot(this.y),this},distanceTo:function(r){r=j(r);var l=r.x-this.x,u=r.y-this.y;return Math.sqrt(l*l+u*u)},equals:function(r){return r=j(r),r.x===this.x&&r.y===this.y},contains:function(r){return r=j(r),Math.abs(r.x)<=Math.abs(this.x)&&Math.abs(r.y)<=Math.abs(this.y)},toString:function(){return"Point("+p(this.x)+", "+p(this.y)+")"}};function j(r,l,u){return r instanceof G?r:M(r)?new G(r[0],r[1]):r==null?r:typeof r=="object"&&"x"in r&&"y"in r?new G(r.x,r.y):new G(r,l,u)}function $(r,l){if(r)for(var u=l?[r,l]:r,g=0,m=u.length;g<m;g++)this.extend(u[g])}$.prototype={extend:function(r){var l,u;if(!r)return this;if(r instanceof G||typeof r[0]=="number"||"x"in r)l=u=j(r);else if(r=N(r),l=r.min,u=r.max,!l||!u)return this;return!this.min&&!this.max?(this.min=l.clone(),this.max=u.clone()):(this.min.x=Math.min(l.x,this.min.x),this.max.x=Math.max(u.x,this.max.x),this.min.y=Math.min(l.y,this.min.y),this.max.y=Math.max(u.y,this.max.y)),this},getCenter:function(r){return j((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,r)},getBottomLeft:function(){return j(this.min.x,this.max.y)},getTopRight:function(){return j(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(r){var l,u;return typeof r[0]=="number"||r instanceof G?r=j(r):r=N(r),r instanceof $?(l=r.min,u=r.max):l=u=r,l.x>=this.min.x&&u.x<=this.max.x&&l.y>=this.min.y&&u.y<=this.max.y},intersects:function(r){r=N(r);var l=this.min,u=this.max,g=r.min,m=r.max,x=m.x>=l.x&&g.x<=u.x,b=m.y>=l.y&&g.y<=u.y;return x&&b},overlaps:function(r){r=N(r);var l=this.min,u=this.max,g=r.min,m=r.max,x=m.x>l.x&&g.x<u.x,b=m.y>l.y&&g.y<u.y;return x&&b},isValid:function(){return!!(this.min&&this.max)},pad:function(r){var l=this.min,u=this.max,g=Math.abs(l.x-u.x)*r,m=Math.abs(l.y-u.y)*r;return N(j(l.x-g,l.y-m),j(u.x+g,u.y+m))},equals:function(r){return r?(r=N(r),this.min.equals(r.getTopLeft())&&this.max.equals(r.getBottomRight())):!1}};function N(r,l){return!r||r instanceof $?r:new $(r,l)}function pt(r,l){if(r)for(var u=l?[r,l]:r,g=0,m=u.length;g<m;g++)this.extend(u[g])}pt.prototype={extend:function(r){var l=this._southWest,u=this._northEast,g,m;if(r instanceof tt)g=r,m=r;else if(r instanceof pt){if(g=r._southWest,m=r._northEast,!g||!m)return this}else return r?this.extend(it(r)||dt(r)):this;return!l&&!u?(this._southWest=new tt(g.lat,g.lng),this._northEast=new tt(m.lat,m.lng)):(l.lat=Math.min(g.lat,l.lat),l.lng=Math.min(g.lng,l.lng),u.lat=Math.max(m.lat,u.lat),u.lng=Math.max(m.lng,u.lng)),this},pad:function(r){var l=this._southWest,u=this._northEast,g=Math.abs(l.lat-u.lat)*r,m=Math.abs(l.lng-u.lng)*r;return new pt(new tt(l.lat-g,l.lng-m),new tt(u.lat+g,u.lng+m))},getCenter:function(){return new tt((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new tt(this.getNorth(),this.getWest())},getSouthEast:function(){return new tt(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(r){typeof r[0]=="number"||r instanceof tt||"lat"in r?r=it(r):r=dt(r);var l=this._southWest,u=this._northEast,g,m;return r instanceof pt?(g=r.getSouthWest(),m=r.getNorthEast()):g=m=r,g.lat>=l.lat&&m.lat<=u.lat&&g.lng>=l.lng&&m.lng<=u.lng},intersects:function(r){r=dt(r);var l=this._southWest,u=this._northEast,g=r.getSouthWest(),m=r.getNorthEast(),x=m.lat>=l.lat&&g.lat<=u.lat,b=m.lng>=l.lng&&g.lng<=u.lng;return x&&b},overlaps:function(r){r=dt(r);var l=this._southWest,u=this._northEast,g=r.getSouthWest(),m=r.getNorthEast(),x=m.lat>l.lat&&g.lat<u.lat,b=m.lng>l.lng&&g.lng<u.lng;return x&&b},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(r,l){return r?(r=dt(r),this._southWest.equals(r.getSouthWest(),l)&&this._northEast.equals(r.getNorthEast(),l)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function dt(r,l){return r instanceof pt?r:new pt(r,l)}function tt(r,l,u){if(isNaN(r)||isNaN(l))throw new Error("Invalid LatLng object: ("+r+", "+l+")");this.lat=+r,this.lng=+l,u!==void 0&&(this.alt=+u)}tt.prototype={equals:function(r,l){if(!r)return!1;r=it(r);var u=Math.max(Math.abs(this.lat-r.lat),Math.abs(this.lng-r.lng));return u<=(l===void 0?1e-9:l)},toString:function(r){return"LatLng("+p(this.lat,r)+", "+p(this.lng,r)+")"},distanceTo:function(r){return Nt.distance(this,it(r))},wrap:function(){return Nt.wrapLatLng(this)},toBounds:function(r){var l=180*r/40075017,u=l/Math.cos(Math.PI/180*this.lat);return dt([this.lat-l,this.lng-u],[this.lat+l,this.lng+u])},clone:function(){return new tt(this.lat,this.lng,this.alt)}};function it(r,l,u){return r instanceof tt?r:M(r)&&typeof r[0]!="object"?r.length===3?new tt(r[0],r[1],r[2]):r.length===2?new tt(r[0],r[1]):null:r==null?r:typeof r=="object"&&"lat"in r?new tt(r.lat,"lng"in r?r.lng:r.lon,r.alt):l===void 0?null:new tt(r,l,u)}var bt={latLngToPoint:function(r,l){var u=this.projection.project(r),g=this.scale(l);return this.transformation._transform(u,g)},pointToLatLng:function(r,l){var u=this.scale(l),g=this.transformation.untransform(r,u);return this.projection.unproject(g)},project:function(r){return this.projection.project(r)},unproject:function(r){return this.projection.unproject(r)},scale:function(r){return 256*Math.pow(2,r)},zoom:function(r){return Math.log(r/256)/Math.LN2},getProjectedBounds:function(r){if(this.infinite)return null;var l=this.projection.bounds,u=this.scale(r),g=this.transformation.transform(l.min,u),m=this.transformation.transform(l.max,u);return new $(g,m)},infinite:!1,wrapLatLng:function(r){var l=this.wrapLng?f(r.lng,this.wrapLng,!0):r.lng,u=this.wrapLat?f(r.lat,this.wrapLat,!0):r.lat,g=r.alt;return new tt(u,l,g)},wrapLatLngBounds:function(r){var l=r.getCenter(),u=this.wrapLatLng(l),g=l.lat-u.lat,m=l.lng-u.lng;if(g===0&&m===0)return r;var x=r.getSouthWest(),b=r.getNorthEast(),R=new tt(x.lat-g,x.lng-m),I=new tt(b.lat-g,b.lng-m);return new pt(R,I)}},Nt=s({},bt,{wrapLng:[-180,180],R:6371e3,distance:function(r,l){var u=Math.PI/180,g=r.lat*u,m=l.lat*u,x=Math.sin((l.lat-r.lat)*u/2),b=Math.sin((l.lng-r.lng)*u/2),R=x*x+Math.cos(g)*Math.cos(m)*b*b,I=2*Math.atan2(Math.sqrt(R),Math.sqrt(1-R));return this.R*I}}),ne=6378137,jt={R:ne,MAX_LATITUDE:85.0511287798,project:function(r){var l=Math.PI/180,u=this.MAX_LATITUDE,g=Math.max(Math.min(u,r.lat),-u),m=Math.sin(g*l);return new G(this.R*r.lng*l,this.R*Math.log((1+m)/(1-m))/2)},unproject:function(r){var l=180/Math.PI;return new tt((2*Math.atan(Math.exp(r.y/this.R))-Math.PI/2)*l,r.x*l/this.R)},bounds:function(){var r=ne*Math.PI;return new $([-r,-r],[r,r])}()};function wi(r,l,u,g){if(M(r)){this._a=r[0],this._b=r[1],this._c=r[2],this._d=r[3];return}this._a=r,this._b=l,this._c=u,this._d=g}wi.prototype={transform:function(r,l){return this._transform(r.clone(),l)},_transform:function(r,l){return l=l||1,r.x=l*(this._a*r.x+this._b),r.y=l*(this._c*r.y+this._d),r},untransform:function(r,l){return l=l||1,new G((r.x/l-this._b)/this._a,(r.y/l-this._d)/this._c)}};function ti(r,l,u,g){return new wi(r,l,u,g)}var ei=s({},Nt,{code:"EPSG:3857",projection:jt,transformation:function(){var r=.5/(Math.PI*jt.R);return ti(r,.5,-r,.5)}()}),ii=s({},ei,{code:"EPSG:900913"});function Jt(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function de(r,l){var u="",g,m,x,b,R,I;for(g=0,x=r.length;g<x;g++){for(R=r[g],m=0,b=R.length;m<b;m++)I=R[m],u+=(m?"L":"M")+I.x+" "+I.y;u+=l?K.svg?"z":"x":""}return u||"M0 0"}var Ze=document.documentElement.style,Se="ActiveXObject"in window,Vi=Se&&!document.addEventListener,Ge="msLaunchUri"in navigator&&!("documentMode"in document),Be=kt("webkit"),ni=kt("android"),At=kt("android 2")||kt("android 3"),us=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),ds=ni&&kt("Google")&&us<537&&!("AudioNode"in window),Ci=!!window.opera,Ki=!Ge&&kt("chrome"),vr=kt("gecko")&&!Be&&!Ci&&!Se,xr=!Ki&&kt("safari"),fs=kt("phantom"),Tn="OTransition"in Ze,ea=navigator.platform.indexOf("Win")===0,wr=Se&&"transition"in Ze,Ln="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!At,gs="MozPerspective"in Ze,_s=!window.L_DISABLE_3D&&(wr||Ln||gs)&&!Tn&&!fs,Ei=typeof orientation<"u"||kt("mobile"),ia=Ei&&Be,ms=Ei&&Ln,bi=!window.PointerEvent&&window.MSPointerEvent,Ti=!!(window.PointerEvent||bi),Li="ontouchstart"in window||!!window.TouchEvent,Cr=!window.L_NO_TOUCH&&(Li||Ti),Er=Ei&&Ci,se=Ei&&vr,si=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,re=function(){var r=!1;try{var l=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("testPassiveEventSupport",_,l),window.removeEventListener("testPassiveEventSupport",_,l)}catch{}return r}(),pe=function(){return!!document.createElement("canvas").getContext}(),Kt=!!(document.createElementNS&&Jt("svg").createSVGRect),Pe=!!Kt&&function(){var r=document.createElement("div");return r.innerHTML="<svg/>",(r.firstChild&&r.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),Me=!Kt&&function(){try{var r=document.createElement("div");r.innerHTML='<v:shape adj="1"/>';var l=r.firstChild;return l.style.behavior="url(#default#VML)",l&&typeof l.adj=="object"}catch{return!1}}(),St=navigator.platform.indexOf("Mac")===0,Yt=navigator.platform.indexOf("Linux")===0;function kt(r){return navigator.userAgent.toLowerCase().indexOf(r)>=0}var K={ie:Se,ielt9:Vi,edge:Ge,webkit:Be,android:ni,android23:At,androidStock:ds,opera:Ci,chrome:Ki,gecko:vr,safari:xr,phantom:fs,opera12:Tn,win:ea,ie3d:wr,webkit3d:Ln,gecko3d:gs,any3d:_s,mobile:Ei,mobileWebkit:ia,mobileWebkit3d:ms,msPointer:bi,pointer:Ti,touch:Cr,touchNative:Li,mobileOpera:Er,mobileGecko:se,retina:si,passiveEvents:re,canvas:pe,svg:Kt,vml:Me,inlineSvg:Pe,mac:St,linux:Yt},Sh=K.msPointer?"MSPointerDown":"pointerdown",Ph=K.msPointer?"MSPointerMove":"pointermove",Mh=K.msPointer?"MSPointerUp":"pointerup",Rh=K.msPointer?"MSPointerCancel":"pointercancel",na={touchstart:Sh,touchmove:Ph,touchend:Mh,touchcancel:Rh},Ih={touchstart:rg,touchmove:br,touchend:br,touchcancel:br},Sn={},Ah=!1;function tg(r,l,u){return l==="touchstart"&&sg(),Ih[l]?(u=Ih[l].bind(this,u),r.addEventListener(na[l],u,!1),u):(console.warn("wrong event specified:",l),_)}function eg(r,l,u){if(!na[l]){console.warn("wrong event specified:",l);return}r.removeEventListener(na[l],u,!1)}function ig(r){Sn[r.pointerId]=r}function ng(r){Sn[r.pointerId]&&(Sn[r.pointerId]=r)}function Oh(r){delete Sn[r.pointerId]}function sg(){Ah||(document.addEventListener(Sh,ig,!0),document.addEventListener(Ph,ng,!0),document.addEventListener(Mh,Oh,!0),document.addEventListener(Rh,Oh,!0),Ah=!0)}function br(r,l){if(l.pointerType!==(l.MSPOINTER_TYPE_MOUSE||"mouse")){l.touches=[];for(var u in Sn)l.touches.push(Sn[u]);l.changedTouches=[l],r(l)}}function rg(r,l){l.MSPOINTER_TYPE_TOUCH&&l.pointerType===l.MSPOINTER_TYPE_TOUCH&&Ut(l),br(r,l)}function og(r){var l={},u,g;for(g in r)u=r[g],l[g]=u&&u.bind?u.bind(r):u;return r=l,l.type="dblclick",l.detail=2,l.isTrusted=!1,l._simulated=!0,l}var ag=200;function lg(r,l){r.addEventListener("dblclick",l);var u=0,g;function m(x){if(x.detail!==1){g=x.detail;return}if(!(x.pointerType==="mouse"||x.sourceCapabilities&&!x.sourceCapabilities.firesTouchEvents)){var b=Nh(x);if(!(b.some(function(I){return I instanceof HTMLLabelElement&&I.attributes.for})&&!b.some(function(I){return I instanceof HTMLInputElement||I instanceof HTMLSelectElement}))){var R=Date.now();R-u<=ag?(g++,g===2&&l(og(x))):g=1,u=R}}}return r.addEventListener("click",m),{dblclick:l,simDblclick:m}}function hg(r,l){r.removeEventListener("dblclick",l.dblclick),r.removeEventListener("click",l.simDblclick)}var sa=Sr(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ps=Sr(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),kh=ps==="webkitTransition"||ps==="OTransition"?ps+"End":"transitionend";function Dh(r){return typeof r=="string"?document.getElementById(r):r}function ys(r,l){var u=r.style[l]||r.currentStyle&&r.currentStyle[l];if((!u||u==="auto")&&document.defaultView){var g=document.defaultView.getComputedStyle(r,null);u=g?g[l]:null}return u==="auto"?null:u}function mt(r,l,u){var g=document.createElement(r);return g.className=l||"",u&&u.appendChild(g),g}function Pt(r){var l=r.parentNode;l&&l.removeChild(r)}function Tr(r){for(;r.firstChild;)r.removeChild(r.firstChild)}function Pn(r){var l=r.parentNode;l&&l.lastChild!==r&&l.appendChild(r)}function Mn(r){var l=r.parentNode;l&&l.firstChild!==r&&l.insertBefore(r,l.firstChild)}function ra(r,l){if(r.classList!==void 0)return r.classList.contains(l);var u=Lr(r);return u.length>0&&new RegExp("(^|\\s)"+l+"(\\s|$)").test(u)}function ht(r,l){if(r.classList!==void 0)for(var u=v(l),g=0,m=u.length;g<m;g++)r.classList.add(u[g]);else if(!ra(r,l)){var x=Lr(r);oa(r,(x?x+" ":"")+l)}}function Ot(r,l){r.classList!==void 0?r.classList.remove(l):oa(r,y((" "+Lr(r)+" ").replace(" "+l+" "," ")))}function oa(r,l){r.className.baseVal===void 0?r.className=l:r.className.baseVal=l}function Lr(r){return r.correspondingElement&&(r=r.correspondingElement),r.className.baseVal===void 0?r.className:r.className.baseVal}function ye(r,l){"opacity"in r.style?r.style.opacity=l:"filter"in r.style&&cg(r,l)}function cg(r,l){var u=!1,g="DXImageTransform.Microsoft.Alpha";try{u=r.filters.item(g)}catch{if(l===1)return}l=Math.round(l*100),u?(u.Enabled=l!==100,u.Opacity=l):r.style.filter+=" progid:"+g+"(opacity="+l+")"}function Sr(r){for(var l=document.documentElement.style,u=0;u<r.length;u++)if(r[u]in l)return r[u];return!1}function Hi(r,l,u){var g=l||new G(0,0);r.style[sa]=(K.ie3d?"translate("+g.x+"px,"+g.y+"px)":"translate3d("+g.x+"px,"+g.y+"px,0)")+(u?" scale("+u+")":"")}function Dt(r,l){r._leaflet_pos=l,K.any3d?Hi(r,l):(r.style.left=l.x+"px",r.style.top=l.y+"px")}function $i(r){return r._leaflet_pos||new G(0,0)}var vs,xs,aa;if("onselectstart"in document)vs=function(){at(window,"selectstart",Ut)},xs=function(){Tt(window,"selectstart",Ut)};else{var ws=Sr(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);vs=function(){if(ws){var r=document.documentElement.style;aa=r[ws],r[ws]="none"}},xs=function(){ws&&(document.documentElement.style[ws]=aa,aa=void 0)}}function la(){at(window,"dragstart",Ut)}function ha(){Tt(window,"dragstart",Ut)}var Pr,ca;function ua(r){for(;r.tabIndex===-1;)r=r.parentNode;r.style&&(Mr(),Pr=r,ca=r.style.outlineStyle,r.style.outlineStyle="none",at(window,"keydown",Mr))}function Mr(){Pr&&(Pr.style.outlineStyle=ca,Pr=void 0,ca=void 0,Tt(window,"keydown",Mr))}function Fh(r){do r=r.parentNode;while((!r.offsetWidth||!r.offsetHeight)&&r!==document.body);return r}function da(r){var l=r.getBoundingClientRect();return{x:l.width/r.offsetWidth||1,y:l.height/r.offsetHeight||1,boundingClientRect:l}}var ug={__proto__:null,TRANSFORM:sa,TRANSITION:ps,TRANSITION_END:kh,get:Dh,getStyle:ys,create:mt,remove:Pt,empty:Tr,toFront:Pn,toBack:Mn,hasClass:ra,addClass:ht,removeClass:Ot,setClass:oa,getClass:Lr,setOpacity:ye,testProp:Sr,setTransform:Hi,setPosition:Dt,getPosition:$i,get disableTextSelection(){return vs},get enableTextSelection(){return xs},disableImageDrag:la,enableImageDrag:ha,preventOutline:ua,restoreOutline:Mr,getSizedParentNode:Fh,getScale:da};function at(r,l,u,g){if(l&&typeof l=="object")for(var m in l)ga(r,m,l[m],u);else{l=v(l);for(var x=0,b=l.length;x<b;x++)ga(r,l[x],u,g)}return this}var We="_leaflet_events";function Tt(r,l,u,g){if(arguments.length===1)zh(r),delete r[We];else if(l&&typeof l=="object")for(var m in l)_a(r,m,l[m],u);else if(l=v(l),arguments.length===2)zh(r,function(R){return S(l,R)!==-1});else for(var x=0,b=l.length;x<b;x++)_a(r,l[x],u,g);return this}function zh(r,l){for(var u in r[We]){var g=u.split(/\d/)[0];(!l||l(g))&&_a(r,g,null,null,u)}}var fa={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function ga(r,l,u,g){var m=l+c(u)+(g?"_"+c(g):"");if(r[We]&&r[We][m])return this;var x=function(R){return u.call(g||r,R||window.event)},b=x;!K.touchNative&&K.pointer&&l.indexOf("touch")===0?x=tg(r,l,x):K.touch&&l==="dblclick"?x=lg(r,x):"addEventListener"in r?l==="touchstart"||l==="touchmove"||l==="wheel"||l==="mousewheel"?r.addEventListener(fa[l]||l,x,K.passiveEvents?{passive:!1}:!1):l==="mouseenter"||l==="mouseleave"?(x=function(R){R=R||window.event,pa(r,R)&&b(R)},r.addEventListener(fa[l],x,!1)):r.addEventListener(l,b,!1):r.attachEvent("on"+l,x),r[We]=r[We]||{},r[We][m]=x}function _a(r,l,u,g,m){m=m||l+c(u)+(g?"_"+c(g):"");var x=r[We]&&r[We][m];if(!x)return this;!K.touchNative&&K.pointer&&l.indexOf("touch")===0?eg(r,l,x):K.touch&&l==="dblclick"?hg(r,x):"removeEventListener"in r?r.removeEventListener(fa[l]||l,x,!1):r.detachEvent("on"+l,x),r[We][m]=null}function qi(r){return r.stopPropagation?r.stopPropagation():r.originalEvent?r.originalEvent._stopped=!0:r.cancelBubble=!0,this}function ma(r){return ga(r,"wheel",qi),this}function Cs(r){return at(r,"mousedown touchstart dblclick contextmenu",qi),r._leaflet_disable_click=!0,this}function Ut(r){return r.preventDefault?r.preventDefault():r.returnValue=!1,this}function Ji(r){return Ut(r),qi(r),this}function Nh(r){if(r.composedPath)return r.composedPath();for(var l=[],u=r.target;u;)l.push(u),u=u.parentNode;return l}function Zh(r,l){if(!l)return new G(r.clientX,r.clientY);var u=da(l),g=u.boundingClientRect;return new G((r.clientX-g.left)/u.x-l.clientLeft,(r.clientY-g.top)/u.y-l.clientTop)}var dg=K.linux&&K.chrome?window.devicePixelRatio:K.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Gh(r){return K.edge?r.wheelDeltaY/2:r.deltaY&&r.deltaMode===0?-r.deltaY/dg:r.deltaY&&r.deltaMode===1?-r.deltaY*20:r.deltaY&&r.deltaMode===2?-r.deltaY*60:r.deltaX||r.deltaZ?0:r.wheelDelta?(r.wheelDeltaY||r.wheelDelta)/2:r.detail&&Math.abs(r.detail)<32765?-r.detail*20:r.detail?r.detail/-32765*60:0}function pa(r,l){var u=l.relatedTarget;if(!u)return!0;try{for(;u&&u!==r;)u=u.parentNode}catch{return!1}return u!==r}var fg={__proto__:null,on:at,off:Tt,stopPropagation:qi,disableScrollPropagation:ma,disableClickPropagation:Cs,preventDefault:Ut,stop:Ji,getPropagationPath:Nh,getMousePosition:Zh,getWheelDelta:Gh,isExternalTarget:pa,addListener:at,removeListener:Tt},Bh=J.extend({run:function(r,l,u,g){this.stop(),this._el=r,this._inProgress=!0,this._duration=u||.25,this._easeOutPower=1/Math.max(g||.5,.2),this._startPos=$i(r),this._offset=l.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=X(this._animate,this),this._step()},_step:function(r){var l=+new Date-this._startTime,u=this._duration*1e3;l<u?this._runFrame(this._easeOut(l/u),r):(this._runFrame(1),this._complete())},_runFrame:function(r,l){var u=this._startPos.add(this._offset.multiplyBy(r));l&&u._round(),Dt(this._el,u),this.fire("step")},_complete:function(){W(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(r){return 1-Math.pow(1-r,this._easeOutPower)}}),gt=J.extend({options:{crs:ei,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(r,l){l=w(this,l),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(r),this._initLayout(),this._onResize=a(this._onResize,this),this._initEvents(),l.maxBounds&&this.setMaxBounds(l.maxBounds),l.zoom!==void 0&&(this._zoom=this._limitZoom(l.zoom)),l.center&&l.zoom!==void 0&&this.setView(it(l.center),l.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ps&&K.any3d&&!K.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),at(this._proxy,kh,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(r,l,u){if(l=l===void 0?this._zoom:this._limitZoom(l),r=this._limitCenter(it(r),l,this.options.maxBounds),u=u||{},this._stop(),this._loaded&&!u.reset&&u!==!0){u.animate!==void 0&&(u.zoom=s({animate:u.animate},u.zoom),u.pan=s({animate:u.animate,duration:u.duration},u.pan));var g=this._zoom!==l?this._tryAnimatedZoom&&this._tryAnimatedZoom(r,l,u.zoom):this._tryAnimatedPan(r,u.pan);if(g)return clearTimeout(this._sizeTimer),this}return this._resetView(r,l,u.pan&&u.pan.noMoveStart),this},setZoom:function(r,l){return this._loaded?this.setView(this.getCenter(),r,{zoom:l}):(this._zoom=r,this)},zoomIn:function(r,l){return r=r||(K.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+r,l)},zoomOut:function(r,l){return r=r||(K.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-r,l)},setZoomAround:function(r,l,u){var g=this.getZoomScale(l),m=this.getSize().divideBy(2),x=r instanceof G?r:this.latLngToContainerPoint(r),b=x.subtract(m).multiplyBy(1-1/g),R=this.containerPointToLatLng(m.add(b));return this.setView(R,l,{zoom:u})},_getBoundsCenterZoom:function(r,l){l=l||{},r=r.getBounds?r.getBounds():dt(r);var u=j(l.paddingTopLeft||l.padding||[0,0]),g=j(l.paddingBottomRight||l.padding||[0,0]),m=this.getBoundsZoom(r,!1,u.add(g));if(m=typeof l.maxZoom=="number"?Math.min(l.maxZoom,m):m,m===1/0)return{center:r.getCenter(),zoom:m};var x=g.subtract(u).divideBy(2),b=this.project(r.getSouthWest(),m),R=this.project(r.getNorthEast(),m),I=this.unproject(b.add(R).divideBy(2).add(x),m);return{center:I,zoom:m}},fitBounds:function(r,l){if(r=dt(r),!r.isValid())throw new Error("Bounds are not valid.");var u=this._getBoundsCenterZoom(r,l);return this.setView(u.center,u.zoom,l)},fitWorld:function(r){return this.fitBounds([[-90,-180],[90,180]],r)},panTo:function(r,l){return this.setView(r,this._zoom,{pan:l})},panBy:function(r,l){if(r=j(r).round(),l=l||{},!r.x&&!r.y)return this.fire("moveend");if(l.animate!==!0&&!this.getSize().contains(r))return this._resetView(this.unproject(this.project(this.getCenter()).add(r)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Bh,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),l.noMoveStart||this.fire("movestart"),l.animate!==!1){ht(this._mapPane,"leaflet-pan-anim");var u=this._getMapPanePos().subtract(r).round();this._panAnim.run(this._mapPane,u,l.duration||.25,l.easeLinearity)}else this._rawPanBy(r),this.fire("move").fire("moveend");return this},flyTo:function(r,l,u){if(u=u||{},u.animate===!1||!K.any3d)return this.setView(r,l,u);this._stop();var g=this.project(this.getCenter()),m=this.project(r),x=this.getSize(),b=this._zoom;r=it(r),l=l===void 0?b:l;var R=Math.max(x.x,x.y),I=R*this.getZoomScale(b,l),z=m.distanceTo(g)||1,U=1.42,et=U*U;function ut(Ft){var Br=Ft?-1:1,e_=Ft?I:R,i_=I*I-R*R+Br*et*et*z*z,n_=2*e_*et*z,Pa=i_/n_,wc=Math.sqrt(Pa*Pa+1)-Pa,s_=wc<1e-9?-18:Math.log(wc);return s_}function Qt(Ft){return(Math.exp(Ft)-Math.exp(-Ft))/2}function Bt(Ft){return(Math.exp(Ft)+Math.exp(-Ft))/2}function xe(Ft){return Qt(Ft)/Bt(Ft)}var oe=ut(0);function Dn(Ft){return R*(Bt(oe)/Bt(oe+U*Ft))}function qg(Ft){return R*(Bt(oe)*xe(oe+U*Ft)-Qt(oe))/et}function Jg(Ft){return 1-Math.pow(1-Ft,1.5)}var Qg=Date.now(),vc=(ut(1)-oe)/U,t_=u.duration?1e3*u.duration:1e3*vc*.8;function xc(){var Ft=(Date.now()-Qg)/t_,Br=Jg(Ft)*vc;Ft<=1?(this._flyToFrame=X(xc,this),this._move(this.unproject(g.add(m.subtract(g).multiplyBy(qg(Br)/z)),b),this.getScaleZoom(R/Dn(Br),b),{flyTo:!0})):this._move(r,l)._moveEnd(!0)}return this._moveStart(!0,u.noMoveStart),xc.call(this),this},flyToBounds:function(r,l){var u=this._getBoundsCenterZoom(r,l);return this.flyTo(u.center,u.zoom,l)},setMaxBounds:function(r){return r=dt(r),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),r.isValid()?(this.options.maxBounds=r,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(r){var l=this.options.minZoom;return this.options.minZoom=r,this._loaded&&l!==r&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(r):this},setMaxZoom:function(r){var l=this.options.maxZoom;return this.options.maxZoom=r,this._loaded&&l!==r&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(r):this},panInsideBounds:function(r,l){this._enforcingBounds=!0;var u=this.getCenter(),g=this._limitCenter(u,this._zoom,dt(r));return u.equals(g)||this.panTo(g,l),this._enforcingBounds=!1,this},panInside:function(r,l){l=l||{};var u=j(l.paddingTopLeft||l.padding||[0,0]),g=j(l.paddingBottomRight||l.padding||[0,0]),m=this.project(this.getCenter()),x=this.project(r),b=this.getPixelBounds(),R=N([b.min.add(u),b.max.subtract(g)]),I=R.getSize();if(!R.contains(x)){this._enforcingBounds=!0;var z=x.subtract(R.getCenter()),U=R.extend(x).getSize().subtract(I);m.x+=z.x<0?-U.x:U.x,m.y+=z.y<0?-U.y:U.y,this.panTo(this.unproject(m),l),this._enforcingBounds=!1}return this},invalidateSize:function(r){if(!this._loaded)return this;r=s({animate:!1,pan:!0},r===!0?{animate:!0}:r);var l=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var u=this.getSize(),g=l.divideBy(2).round(),m=u.divideBy(2).round(),x=g.subtract(m);return!x.x&&!x.y?this:(r.animate&&r.pan?this.panBy(x):(r.pan&&this._rawPanBy(x),this.fire("move"),r.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(a(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:l,newSize:u}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(r){if(r=this._locateOptions=s({timeout:1e4,watch:!1},r),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var l=a(this._handleGeolocationResponse,this),u=a(this._handleGeolocationError,this);return r.watch?this._locationWatchId=navigator.geolocation.watchPosition(l,u,r):navigator.geolocation.getCurrentPosition(l,u,r),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(r){if(this._container._leaflet_id){var l=r.code,u=r.message||(l===1?"permission denied":l===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:l,message:"Geolocation error: "+u+"."})}},_handleGeolocationResponse:function(r){if(this._container._leaflet_id){var l=r.coords.latitude,u=r.coords.longitude,g=new tt(l,u),m=g.toBounds(r.coords.accuracy*2),x=this._locateOptions;if(x.setView){var b=this.getBoundsZoom(m);this.setView(g,x.maxZoom?Math.min(b,x.maxZoom):b)}var R={latlng:g,bounds:m,timestamp:r.timestamp};for(var I in r.coords)typeof r.coords[I]=="number"&&(R[I]=r.coords[I]);this.fire("locationfound",R)}},addHandler:function(r,l){if(!l)return this;var u=this[r]=new l(this);return this._handlers.push(u),this.options[r]&&u.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Pt(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(W(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var r;for(r in this._layers)this._layers[r].remove();for(r in this._panes)Pt(this._panes[r]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(r,l){var u="leaflet-pane"+(r?" leaflet-"+r.replace("Pane","")+"-pane":""),g=mt("div",u,l||this._mapPane);return r&&(this._panes[r]=g),g},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var r=this.getPixelBounds(),l=this.unproject(r.getBottomLeft()),u=this.unproject(r.getTopRight());return new pt(l,u)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(r,l,u){r=dt(r),u=j(u||[0,0]);var g=this.getZoom()||0,m=this.getMinZoom(),x=this.getMaxZoom(),b=r.getNorthWest(),R=r.getSouthEast(),I=this.getSize().subtract(u),z=N(this.project(R,g),this.project(b,g)).getSize(),U=K.any3d?this.options.zoomSnap:1,et=I.x/z.x,ut=I.y/z.y,Qt=l?Math.max(et,ut):Math.min(et,ut);return g=this.getScaleZoom(Qt,g),U&&(g=Math.round(g/(U/100))*(U/100),g=l?Math.ceil(g/U)*U:Math.floor(g/U)*U),Math.max(m,Math.min(x,g))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new G(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(r,l){var u=this._getTopLeftPoint(r,l);return new $(u,u.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(r){return this.options.crs.getProjectedBounds(r===void 0?this.getZoom():r)},getPane:function(r){return typeof r=="string"?this._panes[r]:r},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(r,l){var u=this.options.crs;return l=l===void 0?this._zoom:l,u.scale(r)/u.scale(l)},getScaleZoom:function(r,l){var u=this.options.crs;l=l===void 0?this._zoom:l;var g=u.zoom(r*u.scale(l));return isNaN(g)?1/0:g},project:function(r,l){return l=l===void 0?this._zoom:l,this.options.crs.latLngToPoint(it(r),l)},unproject:function(r,l){return l=l===void 0?this._zoom:l,this.options.crs.pointToLatLng(j(r),l)},layerPointToLatLng:function(r){var l=j(r).add(this.getPixelOrigin());return this.unproject(l)},latLngToLayerPoint:function(r){var l=this.project(it(r))._round();return l._subtract(this.getPixelOrigin())},wrapLatLng:function(r){return this.options.crs.wrapLatLng(it(r))},wrapLatLngBounds:function(r){return this.options.crs.wrapLatLngBounds(dt(r))},distance:function(r,l){return this.options.crs.distance(it(r),it(l))},containerPointToLayerPoint:function(r){return j(r).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(r){return j(r).add(this._getMapPanePos())},containerPointToLatLng:function(r){var l=this.containerPointToLayerPoint(j(r));return this.layerPointToLatLng(l)},latLngToContainerPoint:function(r){return this.layerPointToContainerPoint(this.latLngToLayerPoint(it(r)))},mouseEventToContainerPoint:function(r){return Zh(r,this._container)},mouseEventToLayerPoint:function(r){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(r))},mouseEventToLatLng:function(r){return this.layerPointToLatLng(this.mouseEventToLayerPoint(r))},_initContainer:function(r){var l=this._container=Dh(r);if(l){if(l._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");at(l,"scroll",this._onScroll,this),this._containerId=c(l)},_initLayout:function(){var r=this._container;this._fadeAnimated=this.options.fadeAnimation&&K.any3d,ht(r,"leaflet-container"+(K.touch?" leaflet-touch":"")+(K.retina?" leaflet-retina":"")+(K.ielt9?" leaflet-oldie":"")+(K.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var l=ys(r,"position");l!=="absolute"&&l!=="relative"&&l!=="fixed"&&l!=="sticky"&&(r.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var r=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Dt(this._mapPane,new G(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(ht(r.markerPane,"leaflet-zoom-hide"),ht(r.shadowPane,"leaflet-zoom-hide"))},_resetView:function(r,l,u){Dt(this._mapPane,new G(0,0));var g=!this._loaded;this._loaded=!0,l=this._limitZoom(l),this.fire("viewprereset");var m=this._zoom!==l;this._moveStart(m,u)._move(r,l)._moveEnd(m),this.fire("viewreset"),g&&this.fire("load")},_moveStart:function(r,l){return r&&this.fire("zoomstart"),l||this.fire("movestart"),this},_move:function(r,l,u,g){l===void 0&&(l=this._zoom);var m=this._zoom!==l;return this._zoom=l,this._lastCenter=r,this._pixelOrigin=this._getNewPixelOrigin(r),g?u&&u.pinch&&this.fire("zoom",u):((m||u&&u.pinch)&&this.fire("zoom",u),this.fire("move",u)),this},_moveEnd:function(r){return r&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return W(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(r){Dt(this._mapPane,this._getMapPanePos().subtract(r))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(r){this._targets={},this._targets[c(this._container)]=this;var l=r?Tt:at;l(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&l(window,"resize",this._onResize,this),K.any3d&&this.options.transform3DLimit&&(r?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){W(this._resizeRequest),this._resizeRequest=X(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var r=this._getMapPanePos();Math.max(Math.abs(r.x),Math.abs(r.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(r,l){for(var u=[],g,m=l==="mouseout"||l==="mouseover",x=r.target||r.srcElement,b=!1;x;){if(g=this._targets[c(x)],g&&(l==="click"||l==="preclick")&&this._draggableMoved(g)){b=!0;break}if(g&&g.listens(l,!0)&&(m&&!pa(x,r)||(u.push(g),m))||x===this._container)break;x=x.parentNode}return!u.length&&!b&&!m&&this.listens(l,!0)&&(u=[this]),u},_isClickDisabled:function(r){for(;r&&r!==this._container;){if(r._leaflet_disable_click)return!0;r=r.parentNode}},_handleDOMEvent:function(r){var l=r.target||r.srcElement;if(!(!this._loaded||l._leaflet_disable_events||r.type==="click"&&this._isClickDisabled(l))){var u=r.type;u==="mousedown"&&ua(l),this._fireDOMEvent(r,u)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(r,l,u){if(r.type==="click"){var g=s({},r);g.type="preclick",this._fireDOMEvent(g,g.type,u)}var m=this._findEventTargets(r,l);if(u){for(var x=[],b=0;b<u.length;b++)u[b].listens(l,!0)&&x.push(u[b]);m=x.concat(m)}if(m.length){l==="contextmenu"&&Ut(r);var R=m[0],I={originalEvent:r};if(r.type!=="keypress"&&r.type!=="keydown"&&r.type!=="keyup"){var z=R.getLatLng&&(!R._radius||R._radius<=10);I.containerPoint=z?this.latLngToContainerPoint(R.getLatLng()):this.mouseEventToContainerPoint(r),I.layerPoint=this.containerPointToLayerPoint(I.containerPoint),I.latlng=z?R.getLatLng():this.layerPointToLatLng(I.layerPoint)}for(b=0;b<m.length;b++)if(m[b].fire(l,I,!0),I.originalEvent._stopped||m[b].options.bubblingMouseEvents===!1&&S(this._mouseEvents,l)!==-1)return}},_draggableMoved:function(r){return r=r.dragging&&r.dragging.enabled()?r:this,r.dragging&&r.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var r=0,l=this._handlers.length;r<l;r++)this._handlers[r].disable()},whenReady:function(r,l){return this._loaded?r.call(l||this,{target:this}):this.on("load",r,l),this},_getMapPanePos:function(){return $i(this._mapPane)||new G(0,0)},_moved:function(){var r=this._getMapPanePos();return r&&!r.equals([0,0])},_getTopLeftPoint:function(r,l){var u=r&&l!==void 0?this._getNewPixelOrigin(r,l):this.getPixelOrigin();return u.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(r,l){var u=this.getSize()._divideBy(2);return this.project(r,l)._subtract(u)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(r,l,u){var g=this._getNewPixelOrigin(u,l);return this.project(r,l)._subtract(g)},_latLngBoundsToNewLayerBounds:function(r,l,u){var g=this._getNewPixelOrigin(u,l);return N([this.project(r.getSouthWest(),l)._subtract(g),this.project(r.getNorthWest(),l)._subtract(g),this.project(r.getSouthEast(),l)._subtract(g),this.project(r.getNorthEast(),l)._subtract(g)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(r){return this.latLngToLayerPoint(r).subtract(this._getCenterLayerPoint())},_limitCenter:function(r,l,u){if(!u)return r;var g=this.project(r,l),m=this.getSize().divideBy(2),x=new $(g.subtract(m),g.add(m)),b=this._getBoundsOffset(x,u,l);return Math.abs(b.x)<=1&&Math.abs(b.y)<=1?r:this.unproject(g.add(b),l)},_limitOffset:function(r,l){if(!l)return r;var u=this.getPixelBounds(),g=new $(u.min.add(r),u.max.add(r));return r.add(this._getBoundsOffset(g,l))},_getBoundsOffset:function(r,l,u){var g=N(this.project(l.getNorthEast(),u),this.project(l.getSouthWest(),u)),m=g.min.subtract(r.min),x=g.max.subtract(r.max),b=this._rebound(m.x,-x.x),R=this._rebound(m.y,-x.y);return new G(b,R)},_rebound:function(r,l){return r+l>0?Math.round(r-l)/2:Math.max(0,Math.ceil(r))-Math.max(0,Math.floor(l))},_limitZoom:function(r){var l=this.getMinZoom(),u=this.getMaxZoom(),g=K.any3d?this.options.zoomSnap:1;return g&&(r=Math.round(r/g)*g),Math.max(l,Math.min(u,r))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Ot(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(r,l){var u=this._getCenterOffset(r)._trunc();return(l&&l.animate)!==!0&&!this.getSize().contains(u)?!1:(this.panBy(u,l),!0)},_createAnimProxy:function(){var r=this._proxy=mt("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(r),this.on("zoomanim",function(l){var u=sa,g=this._proxy.style[u];Hi(this._proxy,this.project(l.center,l.zoom),this.getZoomScale(l.zoom,1)),g===this._proxy.style[u]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Pt(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var r=this.getCenter(),l=this.getZoom();Hi(this._proxy,this.project(r,l),this.getZoomScale(l,1))},_catchTransitionEnd:function(r){this._animatingZoom&&r.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(r,l,u){if(this._animatingZoom)return!0;if(u=u||{},!this._zoomAnimated||u.animate===!1||this._nothingToAnimate()||Math.abs(l-this._zoom)>this.options.zoomAnimationThreshold)return!1;var g=this.getZoomScale(l),m=this._getCenterOffset(r)._divideBy(1-1/g);return u.animate!==!0&&!this.getSize().contains(m)?!1:(X(function(){this._moveStart(!0,u.noMoveStart||!1)._animateZoom(r,l,!0)},this),!0)},_animateZoom:function(r,l,u,g){this._mapPane&&(u&&(this._animatingZoom=!0,this._animateToCenter=r,this._animateToZoom=l,ht(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:r,zoom:l,noUpdate:g}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(a(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Ot(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function gg(r,l){return new gt(r,l)}var Re=Z.extend({options:{position:"topright"},initialize:function(r){w(this,r)},getPosition:function(){return this.options.position},setPosition:function(r){var l=this._map;return l&&l.removeControl(this),this.options.position=r,l&&l.addControl(this),this},getContainer:function(){return this._container},addTo:function(r){this.remove(),this._map=r;var l=this._container=this.onAdd(r),u=this.getPosition(),g=r._controlCorners[u];return ht(l,"leaflet-control"),u.indexOf("bottom")!==-1?g.insertBefore(l,g.firstChild):g.appendChild(l),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Pt(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(r){this._map&&r&&r.screenX>0&&r.screenY>0&&this._map.getContainer().focus()}}),Es=function(r){return new Re(r)};gt.include({addControl:function(r){return r.addTo(this),this},removeControl:function(r){return r.remove(),this},_initControlPos:function(){var r=this._controlCorners={},l="leaflet-",u=this._controlContainer=mt("div",l+"control-container",this._container);function g(m,x){var b=l+m+" "+l+x;r[m+x]=mt("div",b,u)}g("top","left"),g("top","right"),g("bottom","left"),g("bottom","right")},_clearControlPos:function(){for(var r in this._controlCorners)Pt(this._controlCorners[r]);Pt(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Wh=Re.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(r,l,u,g){return u<g?-1:g<u?1:0}},initialize:function(r,l,u){w(this,u),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var g in r)this._addLayer(r[g],g);for(g in l)this._addLayer(l[g],g,!0)},onAdd:function(r){this._initLayout(),this._update(),this._map=r,r.on("zoomend",this._checkDisabledLayers,this);for(var l=0;l<this._layers.length;l++)this._layers[l].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(r){return Re.prototype.addTo.call(this,r),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var r=0;r<this._layers.length;r++)this._layers[r].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(r,l){return this._addLayer(r,l),this._map?this._update():this},addOverlay:function(r,l){return this._addLayer(r,l,!0),this._map?this._update():this},removeLayer:function(r){r.off("add remove",this._onLayerChange,this);var l=this._getLayer(c(r));return l&&this._layers.splice(this._layers.indexOf(l),1),this._map?this._update():this},expand:function(){ht(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var r=this._map.getSize().y-(this._container.offsetTop+50);return r<this._section.clientHeight?(ht(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=r+"px"):Ot(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Ot(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var r="leaflet-control-layers",l=this._container=mt("div",r),u=this.options.collapsed;l.setAttribute("aria-haspopup",!0),Cs(l),ma(l);var g=this._section=mt("section",r+"-list");u&&(this._map.on("click",this.collapse,this),at(l,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var m=this._layersLink=mt("a",r+"-toggle",l);m.href="#",m.title="Layers",m.setAttribute("role","button"),at(m,{keydown:function(x){x.keyCode===13&&this._expandSafely()},click:function(x){Ut(x),this._expandSafely()}},this),u||this.expand(),this._baseLayersList=mt("div",r+"-base",g),this._separator=mt("div",r+"-separator",g),this._overlaysList=mt("div",r+"-overlays",g),l.appendChild(g)},_getLayer:function(r){for(var l=0;l<this._layers.length;l++)if(this._layers[l]&&c(this._layers[l].layer)===r)return this._layers[l]},_addLayer:function(r,l,u){this._map&&r.on("add remove",this._onLayerChange,this),this._layers.push({layer:r,name:l,overlay:u}),this.options.sortLayers&&this._layers.sort(a(function(g,m){return this.options.sortFunction(g.layer,m.layer,g.name,m.name)},this)),this.options.autoZIndex&&r.setZIndex&&(this._lastZIndex++,r.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Tr(this._baseLayersList),Tr(this._overlaysList),this._layerControlInputs=[];var r,l,u,g,m=0;for(u=0;u<this._layers.length;u++)g=this._layers[u],this._addItem(g),l=l||g.overlay,r=r||!g.overlay,m+=g.overlay?0:1;return this.options.hideSingleBase&&(r=r&&m>1,this._baseLayersList.style.display=r?"":"none"),this._separator.style.display=l&&r?"":"none",this},_onLayerChange:function(r){this._handlingClick||this._update();var l=this._getLayer(c(r.target)),u=l.overlay?r.type==="add"?"overlayadd":"overlayremove":r.type==="add"?"baselayerchange":null;u&&this._map.fire(u,l)},_createRadioElement:function(r,l){var u='<input type="radio" class="leaflet-control-layers-selector" name="'+r+'"'+(l?' checked="checked"':"")+"/>",g=document.createElement("div");return g.innerHTML=u,g.firstChild},_addItem:function(r){var l=document.createElement("label"),u=this._map.hasLayer(r.layer),g;r.overlay?(g=document.createElement("input"),g.type="checkbox",g.className="leaflet-control-layers-selector",g.defaultChecked=u):g=this._createRadioElement("leaflet-base-layers_"+c(this),u),this._layerControlInputs.push(g),g.layerId=c(r.layer),at(g,"click",this._onInputClick,this);var m=document.createElement("span");m.innerHTML=" "+r.name;var x=document.createElement("span");l.appendChild(x),x.appendChild(g),x.appendChild(m);var b=r.overlay?this._overlaysList:this._baseLayersList;return b.appendChild(l),this._checkDisabledLayers(),l},_onInputClick:function(){if(!this._preventClick){var r=this._layerControlInputs,l,u,g=[],m=[];this._handlingClick=!0;for(var x=r.length-1;x>=0;x--)l=r[x],u=this._getLayer(l.layerId).layer,l.checked?g.push(u):l.checked||m.push(u);for(x=0;x<m.length;x++)this._map.hasLayer(m[x])&&this._map.removeLayer(m[x]);for(x=0;x<g.length;x++)this._map.hasLayer(g[x])||this._map.addLayer(g[x]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var r=this._layerControlInputs,l,u,g=this._map.getZoom(),m=r.length-1;m>=0;m--)l=r[m],u=this._getLayer(l.layerId).layer,l.disabled=u.options.minZoom!==void 0&&g<u.options.minZoom||u.options.maxZoom!==void 0&&g>u.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var r=this._section;this._preventClick=!0,at(r,"click",Ut),this.expand();var l=this;setTimeout(function(){Tt(r,"click",Ut),l._preventClick=!1})}}),_g=function(r,l,u){return new Wh(r,l,u)},ya=Re.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(r){var l="leaflet-control-zoom",u=mt("div",l+" leaflet-bar"),g=this.options;return this._zoomInButton=this._createButton(g.zoomInText,g.zoomInTitle,l+"-in",u,this._zoomIn),this._zoomOutButton=this._createButton(g.zoomOutText,g.zoomOutTitle,l+"-out",u,this._zoomOut),this._updateDisabled(),r.on("zoomend zoomlevelschange",this._updateDisabled,this),u},onRemove:function(r){r.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(r){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(r.shiftKey?3:1))},_zoomOut:function(r){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(r.shiftKey?3:1))},_createButton:function(r,l,u,g,m){var x=mt("a",u,g);return x.innerHTML=r,x.href="#",x.title=l,x.setAttribute("role","button"),x.setAttribute("aria-label",l),Cs(x),at(x,"click",Ji),at(x,"click",m,this),at(x,"click",this._refocusOnMap,this),x},_updateDisabled:function(){var r=this._map,l="leaflet-disabled";Ot(this._zoomInButton,l),Ot(this._zoomOutButton,l),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||r._zoom===r.getMinZoom())&&(ht(this._zoomOutButton,l),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||r._zoom===r.getMaxZoom())&&(ht(this._zoomInButton,l),this._zoomInButton.setAttribute("aria-disabled","true"))}});gt.mergeOptions({zoomControl:!0}),gt.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new ya,this.addControl(this.zoomControl))});var mg=function(r){return new ya(r)},Xh=Re.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(r){var l="leaflet-control-scale",u=mt("div",l),g=this.options;return this._addScales(g,l+"-line",u),r.on(g.updateWhenIdle?"moveend":"move",this._update,this),r.whenReady(this._update,this),u},onRemove:function(r){r.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(r,l,u){r.metric&&(this._mScale=mt("div",l,u)),r.imperial&&(this._iScale=mt("div",l,u))},_update:function(){var r=this._map,l=r.getSize().y/2,u=r.distance(r.containerPointToLatLng([0,l]),r.containerPointToLatLng([this.options.maxWidth,l]));this._updateScales(u)},_updateScales:function(r){this.options.metric&&r&&this._updateMetric(r),this.options.imperial&&r&&this._updateImperial(r)},_updateMetric:function(r){var l=this._getRoundNum(r),u=l<1e3?l+" m":l/1e3+" km";this._updateScale(this._mScale,u,l/r)},_updateImperial:function(r){var l=r*3.2808399,u,g,m;l>5280?(u=l/5280,g=this._getRoundNum(u),this._updateScale(this._iScale,g+" mi",g/u)):(m=this._getRoundNum(l),this._updateScale(this._iScale,m+" ft",m/l))},_updateScale:function(r,l,u){r.style.width=Math.round(this.options.maxWidth*u)+"px",r.innerHTML=l},_getRoundNum:function(r){var l=Math.pow(10,(Math.floor(r)+"").length-1),u=r/l;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:1,l*u}}),pg=function(r){return new Xh(r)},yg='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',va=Re.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(K.inlineSvg?yg+" ":"")+"Leaflet</a>"},initialize:function(r){w(this,r),this._attributions={}},onAdd:function(r){r.attributionControl=this,this._container=mt("div","leaflet-control-attribution"),Cs(this._container);for(var l in r._layers)r._layers[l].getAttribution&&this.addAttribution(r._layers[l].getAttribution());return this._update(),r.on("layeradd",this._addAttribution,this),this._container},onRemove:function(r){r.off("layeradd",this._addAttribution,this)},_addAttribution:function(r){r.layer.getAttribution&&(this.addAttribution(r.layer.getAttribution()),r.layer.once("remove",function(){this.removeAttribution(r.layer.getAttribution())},this))},setPrefix:function(r){return this.options.prefix=r,this._update(),this},addAttribution:function(r){return r?(this._attributions[r]||(this._attributions[r]=0),this._attributions[r]++,this._update(),this):this},removeAttribution:function(r){return r?(this._attributions[r]&&(this._attributions[r]--,this._update()),this):this},_update:function(){if(this._map){var r=[];for(var l in this._attributions)this._attributions[l]&&r.push(l);var u=[];this.options.prefix&&u.push(this.options.prefix),r.length&&u.push(r.join(", ")),this._container.innerHTML=u.join(' <span aria-hidden="true">|</span> ')}}});gt.mergeOptions({attributionControl:!0}),gt.addInitHook(function(){this.options.attributionControl&&new va().addTo(this)});var vg=function(r){return new va(r)};Re.Layers=Wh,Re.Zoom=ya,Re.Scale=Xh,Re.Attribution=va,Es.layers=_g,Es.zoom=mg,Es.scale=pg,Es.attribution=vg;var Xe=Z.extend({initialize:function(r){this._map=r},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Xe.addTo=function(r,l){return r.addHandler(l,this),this};var xg={Events:V},jh=K.touch?"touchstart mousedown":"mousedown",Si=J.extend({options:{clickTolerance:3},initialize:function(r,l,u,g){w(this,g),this._element=r,this._dragStartTarget=l||r,this._preventOutline=u},enable:function(){this._enabled||(at(this._dragStartTarget,jh,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Si._dragging===this&&this.finishDrag(!0),Tt(this._dragStartTarget,jh,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(r){if(this._enabled&&(this._moved=!1,!ra(this._element,"leaflet-zoom-anim"))){if(r.touches&&r.touches.length!==1){Si._dragging===this&&this.finishDrag();return}if(!(Si._dragging||r.shiftKey||r.which!==1&&r.button!==1&&!r.touches)&&(Si._dragging=this,this._preventOutline&&ua(this._element),la(),vs(),!this._moving)){this.fire("down");var l=r.touches?r.touches[0]:r,u=Fh(this._element);this._startPoint=new G(l.clientX,l.clientY),this._startPos=$i(this._element),this._parentScale=da(u);var g=r.type==="mousedown";at(document,g?"mousemove":"touchmove",this._onMove,this),at(document,g?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(r){if(this._enabled){if(r.touches&&r.touches.length>1){this._moved=!0;return}var l=r.touches&&r.touches.length===1?r.touches[0]:r,u=new G(l.clientX,l.clientY)._subtract(this._startPoint);!u.x&&!u.y||Math.abs(u.x)+Math.abs(u.y)<this.options.clickTolerance||(u.x/=this._parentScale.x,u.y/=this._parentScale.y,Ut(r),this._moved||(this.fire("dragstart"),this._moved=!0,ht(document.body,"leaflet-dragging"),this._lastTarget=r.target||r.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),ht(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(u),this._moving=!0,this._lastEvent=r,this._updatePosition())}},_updatePosition:function(){var r={originalEvent:this._lastEvent};this.fire("predrag",r),Dt(this._element,this._newPos),this.fire("drag",r)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(r){Ot(document.body,"leaflet-dragging"),this._lastTarget&&(Ot(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Tt(document,"mousemove touchmove",this._onMove,this),Tt(document,"mouseup touchend touchcancel",this._onUp,this),ha(),xs();var l=this._moved&&this._moving;this._moving=!1,Si._dragging=!1,l&&this.fire("dragend",{noInertia:r,distance:this._newPos.distanceTo(this._startPos)})}});function Yh(r,l,u){var g,m=[1,4,2,8],x,b,R,I,z,U,et,ut;for(x=0,U=r.length;x<U;x++)r[x]._code=Qi(r[x],l);for(R=0;R<4;R++){for(et=m[R],g=[],x=0,U=r.length,b=U-1;x<U;b=x++)I=r[x],z=r[b],I._code&et?z._code&et||(ut=Rr(z,I,et,l,u),ut._code=Qi(ut,l),g.push(ut)):(z._code&et&&(ut=Rr(z,I,et,l,u),ut._code=Qi(ut,l),g.push(ut)),g.push(I));r=g}return r}function Uh(r,l){var u,g,m,x,b,R,I,z,U;if(!r||r.length===0)throw new Error("latlngs not passed");ve(r)||(console.warn("latlngs are not flat! Only the first ring will be used"),r=r[0]);var et=it([0,0]),ut=dt(r),Qt=ut.getNorthWest().distanceTo(ut.getSouthWest())*ut.getNorthEast().distanceTo(ut.getNorthWest());Qt<1700&&(et=xa(r));var Bt=r.length,xe=[];for(u=0;u<Bt;u++){var oe=it(r[u]);xe.push(l.project(it([oe.lat-et.lat,oe.lng-et.lng])))}for(R=I=z=0,u=0,g=Bt-1;u<Bt;g=u++)m=xe[u],x=xe[g],b=m.y*x.x-x.y*m.x,I+=(m.x+x.x)*b,z+=(m.y+x.y)*b,R+=b*3;R===0?U=xe[0]:U=[I/R,z/R];var Dn=l.unproject(j(U));return it([Dn.lat+et.lat,Dn.lng+et.lng])}function xa(r){for(var l=0,u=0,g=0,m=0;m<r.length;m++){var x=it(r[m]);l+=x.lat,u+=x.lng,g++}return it([l/g,u/g])}var wg={__proto__:null,clipPolygon:Yh,polygonCenter:Uh,centroid:xa};function Vh(r,l){if(!l||!r.length)return r.slice();var u=l*l;return r=bg(r,u),r=Eg(r,u),r}function Kh(r,l,u){return Math.sqrt(bs(r,l,u,!0))}function Cg(r,l,u){return bs(r,l,u)}function Eg(r,l){var u=r.length,g=typeof Uint8Array<"u"?Uint8Array:Array,m=new g(u);m[0]=m[u-1]=1,wa(r,m,l,0,u-1);var x,b=[];for(x=0;x<u;x++)m[x]&&b.push(r[x]);return b}function wa(r,l,u,g,m){var x=0,b,R,I;for(R=g+1;R<=m-1;R++)I=bs(r[R],r[g],r[m],!0),I>x&&(b=R,x=I);x>u&&(l[b]=1,wa(r,l,u,g,b),wa(r,l,u,b,m))}function bg(r,l){for(var u=[r[0]],g=1,m=0,x=r.length;g<x;g++)Tg(r[g],r[m])>l&&(u.push(r[g]),m=g);return m<x-1&&u.push(r[x-1]),u}var Hh;function $h(r,l,u,g,m){var x=g?Hh:Qi(r,u),b=Qi(l,u),R,I,z;for(Hh=b;;){if(!(x|b))return[r,l];if(x&b)return!1;R=x||b,I=Rr(r,l,R,u,m),z=Qi(I,u),R===x?(r=I,x=z):(l=I,b=z)}}function Rr(r,l,u,g,m){var x=l.x-r.x,b=l.y-r.y,R=g.min,I=g.max,z,U;return u&8?(z=r.x+x*(I.y-r.y)/b,U=I.y):u&4?(z=r.x+x*(R.y-r.y)/b,U=R.y):u&2?(z=I.x,U=r.y+b*(I.x-r.x)/x):u&1&&(z=R.x,U=r.y+b*(R.x-r.x)/x),new G(z,U,m)}function Qi(r,l){var u=0;return r.x<l.min.x?u|=1:r.x>l.max.x&&(u|=2),r.y<l.min.y?u|=4:r.y>l.max.y&&(u|=8),u}function Tg(r,l){var u=l.x-r.x,g=l.y-r.y;return u*u+g*g}function bs(r,l,u,g){var m=l.x,x=l.y,b=u.x-m,R=u.y-x,I=b*b+R*R,z;return I>0&&(z=((r.x-m)*b+(r.y-x)*R)/I,z>1?(m=u.x,x=u.y):z>0&&(m+=b*z,x+=R*z)),b=r.x-m,R=r.y-x,g?b*b+R*R:new G(m,x)}function ve(r){return!M(r[0])||typeof r[0][0]!="object"&&typeof r[0][0]<"u"}function qh(r){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),ve(r)}function Jh(r,l){var u,g,m,x,b,R,I,z;if(!r||r.length===0)throw new Error("latlngs not passed");ve(r)||(console.warn("latlngs are not flat! Only the first ring will be used"),r=r[0]);var U=it([0,0]),et=dt(r),ut=et.getNorthWest().distanceTo(et.getSouthWest())*et.getNorthEast().distanceTo(et.getNorthWest());ut<1700&&(U=xa(r));var Qt=r.length,Bt=[];for(u=0;u<Qt;u++){var xe=it(r[u]);Bt.push(l.project(it([xe.lat-U.lat,xe.lng-U.lng])))}for(u=0,g=0;u<Qt-1;u++)g+=Bt[u].distanceTo(Bt[u+1])/2;if(g===0)z=Bt[0];else for(u=0,x=0;u<Qt-1;u++)if(b=Bt[u],R=Bt[u+1],m=b.distanceTo(R),x+=m,x>g){I=(x-g)/m,z=[R.x-I*(R.x-b.x),R.y-I*(R.y-b.y)];break}var oe=l.unproject(j(z));return it([oe.lat+U.lat,oe.lng+U.lng])}var Lg={__proto__:null,simplify:Vh,pointToSegmentDistance:Kh,closestPointOnSegment:Cg,clipSegment:$h,_getEdgeIntersection:Rr,_getBitCode:Qi,_sqClosestPointOnSegment:bs,isFlat:ve,_flat:qh,polylineCenter:Jh},Ca={project:function(r){return new G(r.lng,r.lat)},unproject:function(r){return new tt(r.y,r.x)},bounds:new $([-180,-90],[180,90])},Ea={R:6378137,R_MINOR:6356752314245179e-9,bounds:new $([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(r){var l=Math.PI/180,u=this.R,g=r.lat*l,m=this.R_MINOR/u,x=Math.sqrt(1-m*m),b=x*Math.sin(g),R=Math.tan(Math.PI/4-g/2)/Math.pow((1-b)/(1+b),x/2);return g=-u*Math.log(Math.max(R,1e-10)),new G(r.lng*l*u,g)},unproject:function(r){for(var l=180/Math.PI,u=this.R,g=this.R_MINOR/u,m=Math.sqrt(1-g*g),x=Math.exp(-r.y/u),b=Math.PI/2-2*Math.atan(x),R=0,I=.1,z;R<15&&Math.abs(I)>1e-7;R++)z=m*Math.sin(b),z=Math.pow((1-z)/(1+z),m/2),I=Math.PI/2-2*Math.atan(x*z)-b,b+=I;return new tt(b*l,r.x*l/u)}},Sg={__proto__:null,LonLat:Ca,Mercator:Ea,SphericalMercator:jt},Pg=s({},Nt,{code:"EPSG:3395",projection:Ea,transformation:function(){var r=.5/(Math.PI*Ea.R);return ti(r,.5,-r,.5)}()}),Qh=s({},Nt,{code:"EPSG:4326",projection:Ca,transformation:ti(1/180,1,-1/180,.5)}),Mg=s({},bt,{projection:Ca,transformation:ti(1,0,-1,0),scale:function(r){return Math.pow(2,r)},zoom:function(r){return Math.log(r)/Math.LN2},distance:function(r,l){var u=l.lng-r.lng,g=l.lat-r.lat;return Math.sqrt(u*u+g*g)},infinite:!0});bt.Earth=Nt,bt.EPSG3395=Pg,bt.EPSG3857=ei,bt.EPSG900913=ii,bt.EPSG4326=Qh,bt.Simple=Mg;var Ie=J.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(r){return r.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(r){return r&&r.removeLayer(this),this},getPane:function(r){return this._map.getPane(r?this.options[r]||r:this.options.pane)},addInteractiveTarget:function(r){return this._map._targets[c(r)]=this,this},removeInteractiveTarget:function(r){return delete this._map._targets[c(r)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(r){var l=r.target;if(l.hasLayer(this)){if(this._map=l,this._zoomAnimated=l._zoomAnimated,this.getEvents){var u=this.getEvents();l.on(u,this),this.once("remove",function(){l.off(u,this)},this)}this.onAdd(l),this.fire("add"),l.fire("layeradd",{layer:this})}}});gt.include({addLayer:function(r){if(!r._layerAdd)throw new Error("The provided object is not a Layer.");var l=c(r);return this._layers[l]?this:(this._layers[l]=r,r._mapToAdd=this,r.beforeAdd&&r.beforeAdd(this),this.whenReady(r._layerAdd,r),this)},removeLayer:function(r){var l=c(r);return this._layers[l]?(this._loaded&&r.onRemove(this),delete this._layers[l],this._loaded&&(this.fire("layerremove",{layer:r}),r.fire("remove")),r._map=r._mapToAdd=null,this):this},hasLayer:function(r){return c(r)in this._layers},eachLayer:function(r,l){for(var u in this._layers)r.call(l,this._layers[u]);return this},_addLayers:function(r){r=r?M(r)?r:[r]:[];for(var l=0,u=r.length;l<u;l++)this.addLayer(r[l])},_addZoomLimit:function(r){(!isNaN(r.options.maxZoom)||!isNaN(r.options.minZoom))&&(this._zoomBoundLayers[c(r)]=r,this._updateZoomLevels())},_removeZoomLimit:function(r){var l=c(r);this._zoomBoundLayers[l]&&(delete this._zoomBoundLayers[l],this._updateZoomLevels())},_updateZoomLevels:function(){var r=1/0,l=-1/0,u=this._getZoomSpan();for(var g in this._zoomBoundLayers){var m=this._zoomBoundLayers[g].options;r=m.minZoom===void 0?r:Math.min(r,m.minZoom),l=m.maxZoom===void 0?l:Math.max(l,m.maxZoom)}this._layersMaxZoom=l===-1/0?void 0:l,this._layersMinZoom=r===1/0?void 0:r,u!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Rn=Ie.extend({initialize:function(r,l){w(this,l),this._layers={};var u,g;if(r)for(u=0,g=r.length;u<g;u++)this.addLayer(r[u])},addLayer:function(r){var l=this.getLayerId(r);return this._layers[l]=r,this._map&&this._map.addLayer(r),this},removeLayer:function(r){var l=r in this._layers?r:this.getLayerId(r);return this._map&&this._layers[l]&&this._map.removeLayer(this._layers[l]),delete this._layers[l],this},hasLayer:function(r){var l=typeof r=="number"?r:this.getLayerId(r);return l in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(r){var l=Array.prototype.slice.call(arguments,1),u,g;for(u in this._layers)g=this._layers[u],g[r]&&g[r].apply(g,l);return this},onAdd:function(r){this.eachLayer(r.addLayer,r)},onRemove:function(r){this.eachLayer(r.removeLayer,r)},eachLayer:function(r,l){for(var u in this._layers)r.call(l,this._layers[u]);return this},getLayer:function(r){return this._layers[r]},getLayers:function(){var r=[];return this.eachLayer(r.push,r),r},setZIndex:function(r){return this.invoke("setZIndex",r)},getLayerId:function(r){return c(r)}}),Rg=function(r,l){return new Rn(r,l)},ri=Rn.extend({addLayer:function(r){return this.hasLayer(r)?this:(r.addEventParent(this),Rn.prototype.addLayer.call(this,r),this.fire("layeradd",{layer:r}))},removeLayer:function(r){return this.hasLayer(r)?(r in this._layers&&(r=this._layers[r]),r.removeEventParent(this),Rn.prototype.removeLayer.call(this,r),this.fire("layerremove",{layer:r})):this},setStyle:function(r){return this.invoke("setStyle",r)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var r=new pt;for(var l in this._layers){var u=this._layers[l];r.extend(u.getBounds?u.getBounds():u.getLatLng())}return r}}),Ig=function(r,l){return new ri(r,l)},In=Z.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(r){w(this,r)},createIcon:function(r){return this._createIcon("icon",r)},createShadow:function(r){return this._createIcon("shadow",r)},_createIcon:function(r,l){var u=this._getIconUrl(r);if(!u){if(r==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var g=this._createImg(u,l&&l.tagName==="IMG"?l:null);return this._setIconStyles(g,r),(this.options.crossOrigin||this.options.crossOrigin==="")&&(g.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),g},_setIconStyles:function(r,l){var u=this.options,g=u[l+"Size"];typeof g=="number"&&(g=[g,g]);var m=j(g),x=j(l==="shadow"&&u.shadowAnchor||u.iconAnchor||m&&m.divideBy(2,!0));r.className="leaflet-marker-"+l+" "+(u.className||""),x&&(r.style.marginLeft=-x.x+"px",r.style.marginTop=-x.y+"px"),m&&(r.style.width=m.x+"px",r.style.height=m.y+"px")},_createImg:function(r,l){return l=l||document.createElement("img"),l.src=r,l},_getIconUrl:function(r){return K.retina&&this.options[r+"RetinaUrl"]||this.options[r+"Url"]}});function Ag(r){return new In(r)}var Ts=In.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(r){return typeof Ts.imagePath!="string"&&(Ts.imagePath=this._detectIconPath()),(this.options.imagePath||Ts.imagePath)+In.prototype._getIconUrl.call(this,r)},_stripUrl:function(r){var l=function(u,g,m){var x=g.exec(u);return x&&x[m]};return r=l(r,/^url\((['"])?(.+)\1\)$/,2),r&&l(r,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var r=mt("div","leaflet-default-icon-path",document.body),l=ys(r,"background-image")||ys(r,"backgroundImage");if(document.body.removeChild(r),l=this._stripUrl(l),l)return l;var u=document.querySelector('link[href$="leaflet.css"]');return u?u.href.substring(0,u.href.length-11-1):""}}),tc=Xe.extend({initialize:function(r){this._marker=r},addHooks:function(){var r=this._marker._icon;this._draggable||(this._draggable=new Si(r,r,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),ht(r,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Ot(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(r){var l=this._marker,u=l._map,g=this._marker.options.autoPanSpeed,m=this._marker.options.autoPanPadding,x=$i(l._icon),b=u.getPixelBounds(),R=u.getPixelOrigin(),I=N(b.min._subtract(R).add(m),b.max._subtract(R).subtract(m));if(!I.contains(x)){var z=j((Math.max(I.max.x,x.x)-I.max.x)/(b.max.x-I.max.x)-(Math.min(I.min.x,x.x)-I.min.x)/(b.min.x-I.min.x),(Math.max(I.max.y,x.y)-I.max.y)/(b.max.y-I.max.y)-(Math.min(I.min.y,x.y)-I.min.y)/(b.min.y-I.min.y)).multiplyBy(g);u.panBy(z,{animate:!1}),this._draggable._newPos._add(z),this._draggable._startPos._add(z),Dt(l._icon,this._draggable._newPos),this._onDrag(r),this._panRequest=X(this._adjustPan.bind(this,r))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(r){this._marker.options.autoPan&&(W(this._panRequest),this._panRequest=X(this._adjustPan.bind(this,r)))},_onDrag:function(r){var l=this._marker,u=l._shadow,g=$i(l._icon),m=l._map.layerPointToLatLng(g);u&&Dt(u,g),l._latlng=m,r.latlng=m,r.oldLatLng=this._oldLatLng,l.fire("move",r).fire("drag",r)},_onDragEnd:function(r){W(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",r)}}),Ir=Ie.extend({options:{icon:new Ts,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(r,l){w(this,l),this._latlng=it(r)},onAdd:function(r){this._zoomAnimated=this._zoomAnimated&&r.options.markerZoomAnimation,this._zoomAnimated&&r.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(r){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&r.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(r){var l=this._latlng;return this._latlng=it(r),this.update(),this.fire("move",{oldLatLng:l,latlng:this._latlng})},setZIndexOffset:function(r){return this.options.zIndexOffset=r,this.update()},getIcon:function(){return this.options.icon},setIcon:function(r){return this.options.icon=r,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var r=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(r)}return this},_initIcon:function(){var r=this.options,l="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),u=r.icon.createIcon(this._icon),g=!1;u!==this._icon&&(this._icon&&this._removeIcon(),g=!0,r.title&&(u.title=r.title),u.tagName==="IMG"&&(u.alt=r.alt||"")),ht(u,l),r.keyboard&&(u.tabIndex="0",u.setAttribute("role","button")),this._icon=u,r.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&at(u,"focus",this._panOnFocus,this);var m=r.icon.createShadow(this._shadow),x=!1;m!==this._shadow&&(this._removeShadow(),x=!0),m&&(ht(m,l),m.alt=""),this._shadow=m,r.opacity<1&&this._updateOpacity(),g&&this.getPane().appendChild(this._icon),this._initInteraction(),m&&x&&this.getPane(r.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Tt(this._icon,"focus",this._panOnFocus,this),Pt(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Pt(this._shadow),this._shadow=null},_setPos:function(r){this._icon&&Dt(this._icon,r),this._shadow&&Dt(this._shadow,r),this._zIndex=r.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(r){this._icon&&(this._icon.style.zIndex=this._zIndex+r)},_animateZoom:function(r){var l=this._map._latLngToNewLayerPoint(this._latlng,r.zoom,r.center).round();this._setPos(l)},_initInteraction:function(){if(this.options.interactive&&(ht(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),tc)){var r=this.options.draggable;this.dragging&&(r=this.dragging.enabled(),this.dragging.disable()),this.dragging=new tc(this),r&&this.dragging.enable()}},setOpacity:function(r){return this.options.opacity=r,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var r=this.options.opacity;this._icon&&ye(this._icon,r),this._shadow&&ye(this._shadow,r)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var r=this._map;if(r){var l=this.options.icon.options,u=l.iconSize?j(l.iconSize):j(0,0),g=l.iconAnchor?j(l.iconAnchor):j(0,0);r.panInside(this._latlng,{paddingTopLeft:g,paddingBottomRight:u.subtract(g)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Og(r,l){return new Ir(r,l)}var Pi=Ie.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(r){this._renderer=r.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(r){return w(this,r),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&r&&Object.prototype.hasOwnProperty.call(r,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Ar=Pi.extend({options:{fill:!0,radius:10},initialize:function(r,l){w(this,l),this._latlng=it(r),this._radius=this.options.radius},setLatLng:function(r){var l=this._latlng;return this._latlng=it(r),this.redraw(),this.fire("move",{oldLatLng:l,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(r){return this.options.radius=this._radius=r,this.redraw()},getRadius:function(){return this._radius},setStyle:function(r){var l=r&&r.radius||this._radius;return Pi.prototype.setStyle.call(this,r),this.setRadius(l),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var r=this._radius,l=this._radiusY||r,u=this._clickTolerance(),g=[r+u,l+u];this._pxBounds=new $(this._point.subtract(g),this._point.add(g))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(r){return r.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function kg(r,l){return new Ar(r,l)}var ba=Ar.extend({initialize:function(r,l,u){if(typeof l=="number"&&(l=s({},u,{radius:l})),w(this,l),this._latlng=it(r),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(r){return this._mRadius=r,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var r=[this._radius,this._radiusY||this._radius];return new pt(this._map.layerPointToLatLng(this._point.subtract(r)),this._map.layerPointToLatLng(this._point.add(r)))},setStyle:Pi.prototype.setStyle,_project:function(){var r=this._latlng.lng,l=this._latlng.lat,u=this._map,g=u.options.crs;if(g.distance===Nt.distance){var m=Math.PI/180,x=this._mRadius/Nt.R/m,b=u.project([l+x,r]),R=u.project([l-x,r]),I=b.add(R).divideBy(2),z=u.unproject(I).lat,U=Math.acos((Math.cos(x*m)-Math.sin(l*m)*Math.sin(z*m))/(Math.cos(l*m)*Math.cos(z*m)))/m;(isNaN(U)||U===0)&&(U=x/Math.cos(Math.PI/180*l)),this._point=I.subtract(u.getPixelOrigin()),this._radius=isNaN(U)?0:I.x-u.project([z,r-U]).x,this._radiusY=I.y-b.y}else{var et=g.unproject(g.project(this._latlng).subtract([this._mRadius,0]));this._point=u.latLngToLayerPoint(this._latlng),this._radius=this._point.x-u.latLngToLayerPoint(et).x}this._updateBounds()}});function Dg(r,l,u){return new ba(r,l,u)}var oi=Pi.extend({options:{smoothFactor:1,noClip:!1},initialize:function(r,l){w(this,l),this._setLatLngs(r)},getLatLngs:function(){return this._latlngs},setLatLngs:function(r){return this._setLatLngs(r),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(r){for(var l=1/0,u=null,g=bs,m,x,b=0,R=this._parts.length;b<R;b++)for(var I=this._parts[b],z=1,U=I.length;z<U;z++){m=I[z-1],x=I[z];var et=g(r,m,x,!0);et<l&&(l=et,u=g(r,m,x))}return u&&(u.distance=Math.sqrt(l)),u},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Jh(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(r,l){return l=l||this._defaultShape(),r=it(r),l.push(r),this._bounds.extend(r),this.redraw()},_setLatLngs:function(r){this._bounds=new pt,this._latlngs=this._convertLatLngs(r)},_defaultShape:function(){return ve(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(r){for(var l=[],u=ve(r),g=0,m=r.length;g<m;g++)u?(l[g]=it(r[g]),this._bounds.extend(l[g])):l[g]=this._convertLatLngs(r[g]);return l},_project:function(){var r=new $;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,r),this._bounds.isValid()&&r.isValid()&&(this._rawPxBounds=r,this._updateBounds())},_updateBounds:function(){var r=this._clickTolerance(),l=new G(r,r);this._rawPxBounds&&(this._pxBounds=new $([this._rawPxBounds.min.subtract(l),this._rawPxBounds.max.add(l)]))},_projectLatlngs:function(r,l,u){var g=r[0]instanceof tt,m=r.length,x,b;if(g){for(b=[],x=0;x<m;x++)b[x]=this._map.latLngToLayerPoint(r[x]),u.extend(b[x]);l.push(b)}else for(x=0;x<m;x++)this._projectLatlngs(r[x],l,u)},_clipPoints:function(){var r=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(r))){if(this.options.noClip){this._parts=this._rings;return}var l=this._parts,u,g,m,x,b,R,I;for(u=0,m=0,x=this._rings.length;u<x;u++)for(I=this._rings[u],g=0,b=I.length;g<b-1;g++)R=$h(I[g],I[g+1],r,g,!0),R&&(l[m]=l[m]||[],l[m].push(R[0]),(R[1]!==I[g+1]||g===b-2)&&(l[m].push(R[1]),m++))}},_simplifyPoints:function(){for(var r=this._parts,l=this.options.smoothFactor,u=0,g=r.length;u<g;u++)r[u]=Vh(r[u],l)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(r,l){var u,g,m,x,b,R,I=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(r))return!1;for(u=0,x=this._parts.length;u<x;u++)for(R=this._parts[u],g=0,b=R.length,m=b-1;g<b;m=g++)if(!(!l&&g===0)&&Kh(r,R[m],R[g])<=I)return!0;return!1}});function Fg(r,l){return new oi(r,l)}oi._flat=qh;var An=oi.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Uh(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(r){var l=oi.prototype._convertLatLngs.call(this,r),u=l.length;return u>=2&&l[0]instanceof tt&&l[0].equals(l[u-1])&&l.pop(),l},_setLatLngs:function(r){oi.prototype._setLatLngs.call(this,r),ve(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return ve(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var r=this._renderer._bounds,l=this.options.weight,u=new G(l,l);if(r=new $(r.min.subtract(u),r.max.add(u)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(r))){if(this.options.noClip){this._parts=this._rings;return}for(var g=0,m=this._rings.length,x;g<m;g++)x=Yh(this._rings[g],r,!0),x.length&&this._parts.push(x)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(r){var l=!1,u,g,m,x,b,R,I,z;if(!this._pxBounds||!this._pxBounds.contains(r))return!1;for(x=0,I=this._parts.length;x<I;x++)for(u=this._parts[x],b=0,z=u.length,R=z-1;b<z;R=b++)g=u[b],m=u[R],g.y>r.y!=m.y>r.y&&r.x<(m.x-g.x)*(r.y-g.y)/(m.y-g.y)+g.x&&(l=!l);return l||oi.prototype._containsPoint.call(this,r,!0)}});function zg(r,l){return new An(r,l)}var ai=ri.extend({initialize:function(r,l){w(this,l),this._layers={},r&&this.addData(r)},addData:function(r){var l=M(r)?r:r.features,u,g,m;if(l){for(u=0,g=l.length;u<g;u++)m=l[u],(m.geometries||m.geometry||m.features||m.coordinates)&&this.addData(m);return this}var x=this.options;if(x.filter&&!x.filter(r))return this;var b=Or(r,x);return b?(b.feature=Fr(r),b.defaultOptions=b.options,this.resetStyle(b),x.onEachFeature&&x.onEachFeature(r,b),this.addLayer(b)):this},resetStyle:function(r){return r===void 0?this.eachLayer(this.resetStyle,this):(r.options=s({},r.defaultOptions),this._setLayerStyle(r,this.options.style),this)},setStyle:function(r){return this.eachLayer(function(l){this._setLayerStyle(l,r)},this)},_setLayerStyle:function(r,l){r.setStyle&&(typeof l=="function"&&(l=l(r.feature)),r.setStyle(l))}});function Or(r,l){var u=r.type==="Feature"?r.geometry:r,g=u?u.coordinates:null,m=[],x=l&&l.pointToLayer,b=l&&l.coordsToLatLng||Ta,R,I,z,U;if(!g&&!u)return null;switch(u.type){case"Point":return R=b(g),ec(x,r,R,l);case"MultiPoint":for(z=0,U=g.length;z<U;z++)R=b(g[z]),m.push(ec(x,r,R,l));return new ri(m);case"LineString":case"MultiLineString":return I=kr(g,u.type==="LineString"?0:1,b),new oi(I,l);case"Polygon":case"MultiPolygon":return I=kr(g,u.type==="Polygon"?1:2,b),new An(I,l);case"GeometryCollection":for(z=0,U=u.geometries.length;z<U;z++){var et=Or({geometry:u.geometries[z],type:"Feature",properties:r.properties},l);et&&m.push(et)}return new ri(m);case"FeatureCollection":for(z=0,U=u.features.length;z<U;z++){var ut=Or(u.features[z],l);ut&&m.push(ut)}return new ri(m);default:throw new Error("Invalid GeoJSON object.")}}function ec(r,l,u,g){return r?r(l,u):new Ir(u,g&&g.markersInheritOptions&&g)}function Ta(r){return new tt(r[1],r[0],r[2])}function kr(r,l,u){for(var g=[],m=0,x=r.length,b;m<x;m++)b=l?kr(r[m],l-1,u):(u||Ta)(r[m]),g.push(b);return g}function La(r,l){return r=it(r),r.alt!==void 0?[p(r.lng,l),p(r.lat,l),p(r.alt,l)]:[p(r.lng,l),p(r.lat,l)]}function Dr(r,l,u,g){for(var m=[],x=0,b=r.length;x<b;x++)m.push(l?Dr(r[x],ve(r[x])?0:l-1,u,g):La(r[x],g));return!l&&u&&m.length>0&&m.push(m[0].slice()),m}function On(r,l){return r.feature?s({},r.feature,{geometry:l}):Fr(l)}function Fr(r){return r.type==="Feature"||r.type==="FeatureCollection"?r:{type:"Feature",properties:{},geometry:r}}var Sa={toGeoJSON:function(r){return On(this,{type:"Point",coordinates:La(this.getLatLng(),r)})}};Ir.include(Sa),ba.include(Sa),Ar.include(Sa),oi.include({toGeoJSON:function(r){var l=!ve(this._latlngs),u=Dr(this._latlngs,l?1:0,!1,r);return On(this,{type:(l?"Multi":"")+"LineString",coordinates:u})}}),An.include({toGeoJSON:function(r){var l=!ve(this._latlngs),u=l&&!ve(this._latlngs[0]),g=Dr(this._latlngs,u?2:l?1:0,!0,r);return l||(g=[g]),On(this,{type:(u?"Multi":"")+"Polygon",coordinates:g})}}),Rn.include({toMultiPoint:function(r){var l=[];return this.eachLayer(function(u){l.push(u.toGeoJSON(r).geometry.coordinates)}),On(this,{type:"MultiPoint",coordinates:l})},toGeoJSON:function(r){var l=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(l==="MultiPoint")return this.toMultiPoint(r);var u=l==="GeometryCollection",g=[];return this.eachLayer(function(m){if(m.toGeoJSON){var x=m.toGeoJSON(r);if(u)g.push(x.geometry);else{var b=Fr(x);b.type==="FeatureCollection"?g.push.apply(g,b.features):g.push(b)}}}),u?On(this,{geometries:g,type:"GeometryCollection"}):{type:"FeatureCollection",features:g}}});function ic(r,l){return new ai(r,l)}var Ng=ic,zr=Ie.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(r,l,u){this._url=r,this._bounds=dt(l),w(this,u)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(ht(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Pt(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(r){return this.options.opacity=r,this._image&&this._updateOpacity(),this},setStyle:function(r){return r.opacity&&this.setOpacity(r.opacity),this},bringToFront:function(){return this._map&&Pn(this._image),this},bringToBack:function(){return this._map&&Mn(this._image),this},setUrl:function(r){return this._url=r,this._image&&(this._image.src=r),this},setBounds:function(r){return this._bounds=dt(r),this._map&&this._reset(),this},getEvents:function(){var r={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(r.zoomanim=this._animateZoom),r},setZIndex:function(r){return this.options.zIndex=r,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var r=this._url.tagName==="IMG",l=this._image=r?this._url:mt("img");if(ht(l,"leaflet-image-layer"),this._zoomAnimated&&ht(l,"leaflet-zoom-animated"),this.options.className&&ht(l,this.options.className),l.onselectstart=_,l.onmousemove=_,l.onload=a(this.fire,this,"load"),l.onerror=a(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(l.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),r){this._url=l.src;return}l.src=this._url,l.alt=this.options.alt},_animateZoom:function(r){var l=this._map.getZoomScale(r.zoom),u=this._map._latLngBoundsToNewLayerBounds(this._bounds,r.zoom,r.center).min;Hi(this._image,u,l)},_reset:function(){var r=this._image,l=new $(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),u=l.getSize();Dt(r,l.min),r.style.width=u.x+"px",r.style.height=u.y+"px"},_updateOpacity:function(){ye(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var r=this.options.errorOverlayUrl;r&&this._url!==r&&(this._url=r,this._image.src=r)},getCenter:function(){return this._bounds.getCenter()}}),Zg=function(r,l,u){return new zr(r,l,u)},nc=zr.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var r=this._url.tagName==="VIDEO",l=this._image=r?this._url:mt("video");if(ht(l,"leaflet-image-layer"),this._zoomAnimated&&ht(l,"leaflet-zoom-animated"),this.options.className&&ht(l,this.options.className),l.onselectstart=_,l.onmousemove=_,l.onloadeddata=a(this.fire,this,"load"),r){for(var u=l.getElementsByTagName("source"),g=[],m=0;m<u.length;m++)g.push(u[m].src);this._url=u.length>0?g:[l.src];return}M(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(l.style,"objectFit")&&(l.style.objectFit="fill"),l.autoplay=!!this.options.autoplay,l.loop=!!this.options.loop,l.muted=!!this.options.muted,l.playsInline=!!this.options.playsInline;for(var x=0;x<this._url.length;x++){var b=mt("source");b.src=this._url[x],l.appendChild(b)}}});function Gg(r,l,u){return new nc(r,l,u)}var sc=zr.extend({_initImage:function(){var r=this._image=this._url;ht(r,"leaflet-image-layer"),this._zoomAnimated&&ht(r,"leaflet-zoom-animated"),this.options.className&&ht(r,this.options.className),r.onselectstart=_,r.onmousemove=_}});function Bg(r,l,u){return new sc(r,l,u)}var je=Ie.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(r,l){r&&(r instanceof tt||M(r))?(this._latlng=it(r),w(this,l)):(w(this,r),this._source=l),this.options.content&&(this._content=this.options.content)},openOn:function(r){return r=arguments.length?r:this._source._map,r.hasLayer(this)||r.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(r){return this._map?this.close():(arguments.length?this._source=r:r=this._source,this._prepareOpen(),this.openOn(r._map)),this},onAdd:function(r){this._zoomAnimated=r._zoomAnimated,this._container||this._initLayout(),r._fadeAnimated&&ye(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),r._fadeAnimated&&ye(this._container,1),this.bringToFront(),this.options.interactive&&(ht(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(r){r._fadeAnimated?(ye(this._container,0),this._removeTimeout=setTimeout(a(Pt,void 0,this._container),200)):Pt(this._container),this.options.interactive&&(Ot(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(r){return this._latlng=it(r),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(r){return this._content=r,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var r={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(r.zoomanim=this._animateZoom),r},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Pn(this._container),this},bringToBack:function(){return this._map&&Mn(this._container),this},_prepareOpen:function(r){var l=this._source;if(!l._map)return!1;if(l instanceof ri){l=null;var u=this._source._layers;for(var g in u)if(u[g]._map){l=u[g];break}if(!l)return!1;this._source=l}if(!r)if(l.getCenter)r=l.getCenter();else if(l.getLatLng)r=l.getLatLng();else if(l.getBounds)r=l.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(r),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var r=this._contentNode,l=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof l=="string")r.innerHTML=l;else{for(;r.hasChildNodes();)r.removeChild(r.firstChild);r.appendChild(l)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var r=this._map.latLngToLayerPoint(this._latlng),l=j(this.options.offset),u=this._getAnchor();this._zoomAnimated?Dt(this._container,r.add(u)):l=l.add(r).add(u);var g=this._containerBottom=-l.y,m=this._containerLeft=-Math.round(this._containerWidth/2)+l.x;this._container.style.bottom=g+"px",this._container.style.left=m+"px"}},_getAnchor:function(){return[0,0]}});gt.include({_initOverlay:function(r,l,u,g){var m=l;return m instanceof r||(m=new r(g).setContent(l)),u&&m.setLatLng(u),m}}),Ie.include({_initOverlay:function(r,l,u,g){var m=u;return m instanceof r?(w(m,g),m._source=this):(m=l&&!g?l:new r(g,this),m.setContent(u)),m}});var Nr=je.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(r){return r=arguments.length?r:this._source._map,!r.hasLayer(this)&&r._popup&&r._popup.options.autoClose&&r.removeLayer(r._popup),r._popup=this,je.prototype.openOn.call(this,r)},onAdd:function(r){je.prototype.onAdd.call(this,r),r.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Pi||this._source.on("preclick",qi))},onRemove:function(r){je.prototype.onRemove.call(this,r),r.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Pi||this._source.off("preclick",qi))},getEvents:function(){var r=je.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(r.preclick=this.close),this.options.keepInView&&(r.moveend=this._adjustPan),r},_initLayout:function(){var r="leaflet-popup",l=this._container=mt("div",r+" "+(this.options.className||"")+" leaflet-zoom-animated"),u=this._wrapper=mt("div",r+"-content-wrapper",l);if(this._contentNode=mt("div",r+"-content",u),Cs(l),ma(this._contentNode),at(l,"contextmenu",qi),this._tipContainer=mt("div",r+"-tip-container",l),this._tip=mt("div",r+"-tip",this._tipContainer),this.options.closeButton){var g=this._closeButton=mt("a",r+"-close-button",l);g.setAttribute("role","button"),g.setAttribute("aria-label","Close popup"),g.href="#close",g.innerHTML='<span aria-hidden="true">&#215;</span>',at(g,"click",function(m){Ut(m),this.close()},this)}},_updateLayout:function(){var r=this._contentNode,l=r.style;l.width="",l.whiteSpace="nowrap";var u=r.offsetWidth;u=Math.min(u,this.options.maxWidth),u=Math.max(u,this.options.minWidth),l.width=u+1+"px",l.whiteSpace="",l.height="";var g=r.offsetHeight,m=this.options.maxHeight,x="leaflet-popup-scrolled";m&&g>m?(l.height=m+"px",ht(r,x)):Ot(r,x),this._containerWidth=this._container.offsetWidth},_animateZoom:function(r){var l=this._map._latLngToNewLayerPoint(this._latlng,r.zoom,r.center),u=this._getAnchor();Dt(this._container,l.add(u))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var r=this._map,l=parseInt(ys(this._container,"marginBottom"),10)||0,u=this._container.offsetHeight+l,g=this._containerWidth,m=new G(this._containerLeft,-u-this._containerBottom);m._add($i(this._container));var x=r.layerPointToContainerPoint(m),b=j(this.options.autoPanPadding),R=j(this.options.autoPanPaddingTopLeft||b),I=j(this.options.autoPanPaddingBottomRight||b),z=r.getSize(),U=0,et=0;x.x+g+I.x>z.x&&(U=x.x+g-z.x+I.x),x.x-U-R.x<0&&(U=x.x-R.x),x.y+u+I.y>z.y&&(et=x.y+u-z.y+I.y),x.y-et-R.y<0&&(et=x.y-R.y),(U||et)&&(this.options.keepInView&&(this._autopanning=!0),r.fire("autopanstart").panBy([U,et]))}},_getAnchor:function(){return j(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Wg=function(r,l){return new Nr(r,l)};gt.mergeOptions({closePopupOnClick:!0}),gt.include({openPopup:function(r,l,u){return this._initOverlay(Nr,r,l,u).openOn(this),this},closePopup:function(r){return r=arguments.length?r:this._popup,r&&r.close(),this}}),Ie.include({bindPopup:function(r,l){return this._popup=this._initOverlay(Nr,this._popup,r,l),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(r){return this._popup&&(this instanceof ri||(this._popup._source=this),this._popup._prepareOpen(r||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(r){return this._popup&&this._popup.setContent(r),this},getPopup:function(){return this._popup},_openPopup:function(r){if(!(!this._popup||!this._map)){Ji(r);var l=r.layer||r.target;if(this._popup._source===l&&!(l instanceof Pi)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(r.latlng);return}this._popup._source=l,this.openPopup(r.latlng)}},_movePopup:function(r){this._popup.setLatLng(r.latlng)},_onKeyPress:function(r){r.originalEvent.keyCode===13&&this._openPopup(r)}});var Zr=je.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(r){je.prototype.onAdd.call(this,r),this.setOpacity(this.options.opacity),r.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(r){je.prototype.onRemove.call(this,r),r.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var r=je.prototype.getEvents.call(this);return this.options.permanent||(r.preclick=this.close),r},_initLayout:function(){var r="leaflet-tooltip",l=r+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=mt("div",l),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+c(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(r){var l,u,g=this._map,m=this._container,x=g.latLngToContainerPoint(g.getCenter()),b=g.layerPointToContainerPoint(r),R=this.options.direction,I=m.offsetWidth,z=m.offsetHeight,U=j(this.options.offset),et=this._getAnchor();R==="top"?(l=I/2,u=z):R==="bottom"?(l=I/2,u=0):R==="center"?(l=I/2,u=z/2):R==="right"?(l=0,u=z/2):R==="left"?(l=I,u=z/2):b.x<x.x?(R="right",l=0,u=z/2):(R="left",l=I+(U.x+et.x)*2,u=z/2),r=r.subtract(j(l,u,!0)).add(U).add(et),Ot(m,"leaflet-tooltip-right"),Ot(m,"leaflet-tooltip-left"),Ot(m,"leaflet-tooltip-top"),Ot(m,"leaflet-tooltip-bottom"),ht(m,"leaflet-tooltip-"+R),Dt(m,r)},_updatePosition:function(){var r=this._map.latLngToLayerPoint(this._latlng);this._setPosition(r)},setOpacity:function(r){this.options.opacity=r,this._container&&ye(this._container,r)},_animateZoom:function(r){var l=this._map._latLngToNewLayerPoint(this._latlng,r.zoom,r.center);this._setPosition(l)},_getAnchor:function(){return j(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Xg=function(r,l){return new Zr(r,l)};gt.include({openTooltip:function(r,l,u){return this._initOverlay(Zr,r,l,u).openOn(this),this},closeTooltip:function(r){return r.close(),this}}),Ie.include({bindTooltip:function(r,l){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Zr,this._tooltip,r,l),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(r){if(!(!r&&this._tooltipHandlersAdded)){var l=r?"off":"on",u={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?u.add=this._openTooltip:(u.mouseover=this._openTooltip,u.mouseout=this.closeTooltip,u.click=this._openTooltip,this._map?this._addFocusListeners():u.add=this._addFocusListeners),this._tooltip.options.sticky&&(u.mousemove=this._moveTooltip),this[l](u),this._tooltipHandlersAdded=!r}},openTooltip:function(r){return this._tooltip&&(this instanceof ri||(this._tooltip._source=this),this._tooltip._prepareOpen(r)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(r){return this._tooltip&&this._tooltip.setContent(r),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(r){var l=typeof r.getElement=="function"&&r.getElement();l&&(at(l,"focus",function(){this._tooltip._source=r,this.openTooltip()},this),at(l,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(r){var l=typeof r.getElement=="function"&&r.getElement();l&&l.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(r){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var l=this;this._map.once("moveend",function(){l._openOnceFlag=!1,l._openTooltip(r)});return}this._tooltip._source=r.layer||r.target,this.openTooltip(this._tooltip.options.sticky?r.latlng:void 0)}},_moveTooltip:function(r){var l=r.latlng,u,g;this._tooltip.options.sticky&&r.originalEvent&&(u=this._map.mouseEventToContainerPoint(r.originalEvent),g=this._map.containerPointToLayerPoint(u),l=this._map.layerPointToLatLng(g)),this._tooltip.setLatLng(l)}});var rc=In.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(r){var l=r&&r.tagName==="DIV"?r:document.createElement("div"),u=this.options;if(u.html instanceof Element?(Tr(l),l.appendChild(u.html)):l.innerHTML=u.html!==!1?u.html:"",u.bgPos){var g=j(u.bgPos);l.style.backgroundPosition=-g.x+"px "+-g.y+"px"}return this._setIconStyles(l,"icon"),l},createShadow:function(){return null}});function jg(r){return new rc(r)}In.Default=Ts;var Ls=Ie.extend({options:{tileSize:256,opacity:1,updateWhenIdle:K.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(r){w(this,r)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(r){r._addZoomLimit(this)},onRemove:function(r){this._removeAllTiles(),Pt(this._container),r._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Pn(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Mn(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(r){return this.options.opacity=r,this._updateOpacity(),this},setZIndex:function(r){return this.options.zIndex=r,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var r=this._clampZoom(this._map.getZoom());r!==this._tileZoom&&(this._tileZoom=r,this._updateLevels()),this._update()}return this},getEvents:function(){var r={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=d(this._onMoveEnd,this.options.updateInterval,this)),r.move=this._onMove),this._zoomAnimated&&(r.zoomanim=this._animateZoom),r},createTile:function(){return document.createElement("div")},getTileSize:function(){var r=this.options.tileSize;return r instanceof G?r:new G(r,r)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(r){for(var l=this.getPane().children,u=-r(-1/0,1/0),g=0,m=l.length,x;g<m;g++)x=l[g].style.zIndex,l[g]!==this._container&&x&&(u=r(u,+x));isFinite(u)&&(this.options.zIndex=u+r(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!K.ielt9){ye(this._container,this.options.opacity);var r=+new Date,l=!1,u=!1;for(var g in this._tiles){var m=this._tiles[g];if(!(!m.current||!m.loaded)){var x=Math.min(1,(r-m.loaded)/200);ye(m.el,x),x<1?l=!0:(m.active?u=!0:this._onOpaqueTile(m),m.active=!0)}}u&&!this._noPrune&&this._pruneTiles(),l&&(W(this._fadeFrame),this._fadeFrame=X(this._updateOpacity,this))}},_onOpaqueTile:_,_initContainer:function(){this._container||(this._container=mt("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var r=this._tileZoom,l=this.options.maxZoom;if(r!==void 0){for(var u in this._levels)u=Number(u),this._levels[u].el.children.length||u===r?(this._levels[u].el.style.zIndex=l-Math.abs(r-u),this._onUpdateLevel(u)):(Pt(this._levels[u].el),this._removeTilesAtZoom(u),this._onRemoveLevel(u),delete this._levels[u]);var g=this._levels[r],m=this._map;return g||(g=this._levels[r]={},g.el=mt("div","leaflet-tile-container leaflet-zoom-animated",this._container),g.el.style.zIndex=l,g.origin=m.project(m.unproject(m.getPixelOrigin()),r).round(),g.zoom=r,this._setZoomTransform(g,m.getCenter(),m.getZoom()),_(g.el.offsetWidth),this._onCreateLevel(g)),this._level=g,g}},_onUpdateLevel:_,_onRemoveLevel:_,_onCreateLevel:_,_pruneTiles:function(){if(this._map){var r,l,u=this._map.getZoom();if(u>this.options.maxZoom||u<this.options.minZoom){this._removeAllTiles();return}for(r in this._tiles)l=this._tiles[r],l.retain=l.current;for(r in this._tiles)if(l=this._tiles[r],l.current&&!l.active){var g=l.coords;this._retainParent(g.x,g.y,g.z,g.z-5)||this._retainChildren(g.x,g.y,g.z,g.z+2)}for(r in this._tiles)this._tiles[r].retain||this._removeTile(r)}},_removeTilesAtZoom:function(r){for(var l in this._tiles)this._tiles[l].coords.z===r&&this._removeTile(l)},_removeAllTiles:function(){for(var r in this._tiles)this._removeTile(r)},_invalidateAll:function(){for(var r in this._levels)Pt(this._levels[r].el),this._onRemoveLevel(Number(r)),delete this._levels[r];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(r,l,u,g){var m=Math.floor(r/2),x=Math.floor(l/2),b=u-1,R=new G(+m,+x);R.z=+b;var I=this._tileCoordsToKey(R),z=this._tiles[I];return z&&z.active?(z.retain=!0,!0):(z&&z.loaded&&(z.retain=!0),b>g?this._retainParent(m,x,b,g):!1)},_retainChildren:function(r,l,u,g){for(var m=2*r;m<2*r+2;m++)for(var x=2*l;x<2*l+2;x++){var b=new G(m,x);b.z=u+1;var R=this._tileCoordsToKey(b),I=this._tiles[R];if(I&&I.active){I.retain=!0;continue}else I&&I.loaded&&(I.retain=!0);u+1<g&&this._retainChildren(m,x,u+1,g)}},_resetView:function(r){var l=r&&(r.pinch||r.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),l,l)},_animateZoom:function(r){this._setView(r.center,r.zoom,!0,r.noUpdate)},_clampZoom:function(r){var l=this.options;return l.minNativeZoom!==void 0&&r<l.minNativeZoom?l.minNativeZoom:l.maxNativeZoom!==void 0&&l.maxNativeZoom<r?l.maxNativeZoom:r},_setView:function(r,l,u,g){var m=Math.round(l);this.options.maxZoom!==void 0&&m>this.options.maxZoom||this.options.minZoom!==void 0&&m<this.options.minZoom?m=void 0:m=this._clampZoom(m);var x=this.options.updateWhenZooming&&m!==this._tileZoom;(!g||x)&&(this._tileZoom=m,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),m!==void 0&&this._update(r),u||this._pruneTiles(),this._noPrune=!!u),this._setZoomTransforms(r,l)},_setZoomTransforms:function(r,l){for(var u in this._levels)this._setZoomTransform(this._levels[u],r,l)},_setZoomTransform:function(r,l,u){var g=this._map.getZoomScale(u,r.zoom),m=r.origin.multiplyBy(g).subtract(this._map._getNewPixelOrigin(l,u)).round();K.any3d?Hi(r.el,m,g):Dt(r.el,m)},_resetGrid:function(){var r=this._map,l=r.options.crs,u=this._tileSize=this.getTileSize(),g=this._tileZoom,m=this._map.getPixelWorldBounds(this._tileZoom);m&&(this._globalTileRange=this._pxBoundsToTileRange(m)),this._wrapX=l.wrapLng&&!this.options.noWrap&&[Math.floor(r.project([0,l.wrapLng[0]],g).x/u.x),Math.ceil(r.project([0,l.wrapLng[1]],g).x/u.y)],this._wrapY=l.wrapLat&&!this.options.noWrap&&[Math.floor(r.project([l.wrapLat[0],0],g).y/u.x),Math.ceil(r.project([l.wrapLat[1],0],g).y/u.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(r){var l=this._map,u=l._animatingZoom?Math.max(l._animateToZoom,l.getZoom()):l.getZoom(),g=l.getZoomScale(u,this._tileZoom),m=l.project(r,this._tileZoom).floor(),x=l.getSize().divideBy(g*2);return new $(m.subtract(x),m.add(x))},_update:function(r){var l=this._map;if(l){var u=this._clampZoom(l.getZoom());if(r===void 0&&(r=l.getCenter()),this._tileZoom!==void 0){var g=this._getTiledPixelBounds(r),m=this._pxBoundsToTileRange(g),x=m.getCenter(),b=[],R=this.options.keepBuffer,I=new $(m.getBottomLeft().subtract([R,-R]),m.getTopRight().add([R,-R]));if(!(isFinite(m.min.x)&&isFinite(m.min.y)&&isFinite(m.max.x)&&isFinite(m.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var z in this._tiles){var U=this._tiles[z].coords;(U.z!==this._tileZoom||!I.contains(new G(U.x,U.y)))&&(this._tiles[z].current=!1)}if(Math.abs(u-this._tileZoom)>1){this._setView(r,u);return}for(var et=m.min.y;et<=m.max.y;et++)for(var ut=m.min.x;ut<=m.max.x;ut++){var Qt=new G(ut,et);if(Qt.z=this._tileZoom,!!this._isValidTile(Qt)){var Bt=this._tiles[this._tileCoordsToKey(Qt)];Bt?Bt.current=!0:b.push(Qt)}}if(b.sort(function(oe,Dn){return oe.distanceTo(x)-Dn.distanceTo(x)}),b.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var xe=document.createDocumentFragment();for(ut=0;ut<b.length;ut++)this._addTile(b[ut],xe);this._level.el.appendChild(xe)}}}},_isValidTile:function(r){var l=this._map.options.crs;if(!l.infinite){var u=this._globalTileRange;if(!l.wrapLng&&(r.x<u.min.x||r.x>u.max.x)||!l.wrapLat&&(r.y<u.min.y||r.y>u.max.y))return!1}if(!this.options.bounds)return!0;var g=this._tileCoordsToBounds(r);return dt(this.options.bounds).overlaps(g)},_keyToBounds:function(r){return this._tileCoordsToBounds(this._keyToTileCoords(r))},_tileCoordsToNwSe:function(r){var l=this._map,u=this.getTileSize(),g=r.scaleBy(u),m=g.add(u),x=l.unproject(g,r.z),b=l.unproject(m,r.z);return[x,b]},_tileCoordsToBounds:function(r){var l=this._tileCoordsToNwSe(r),u=new pt(l[0],l[1]);return this.options.noWrap||(u=this._map.wrapLatLngBounds(u)),u},_tileCoordsToKey:function(r){return r.x+":"+r.y+":"+r.z},_keyToTileCoords:function(r){var l=r.split(":"),u=new G(+l[0],+l[1]);return u.z=+l[2],u},_removeTile:function(r){var l=this._tiles[r];l&&(Pt(l.el),delete this._tiles[r],this.fire("tileunload",{tile:l.el,coords:this._keyToTileCoords(r)}))},_initTile:function(r){ht(r,"leaflet-tile");var l=this.getTileSize();r.style.width=l.x+"px",r.style.height=l.y+"px",r.onselectstart=_,r.onmousemove=_,K.ielt9&&this.options.opacity<1&&ye(r,this.options.opacity)},_addTile:function(r,l){var u=this._getTilePos(r),g=this._tileCoordsToKey(r),m=this.createTile(this._wrapCoords(r),a(this._tileReady,this,r));this._initTile(m),this.createTile.length<2&&X(a(this._tileReady,this,r,null,m)),Dt(m,u),this._tiles[g]={el:m,coords:r,current:!0},l.appendChild(m),this.fire("tileloadstart",{tile:m,coords:r})},_tileReady:function(r,l,u){l&&this.fire("tileerror",{error:l,tile:u,coords:r});var g=this._tileCoordsToKey(r);u=this._tiles[g],u&&(u.loaded=+new Date,this._map._fadeAnimated?(ye(u.el,0),W(this._fadeFrame),this._fadeFrame=X(this._updateOpacity,this)):(u.active=!0,this._pruneTiles()),l||(ht(u.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:u.el,coords:r})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),K.ielt9||!this._map._fadeAnimated?X(this._pruneTiles,this):setTimeout(a(this._pruneTiles,this),250)))},_getTilePos:function(r){return r.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(r){var l=new G(this._wrapX?f(r.x,this._wrapX):r.x,this._wrapY?f(r.y,this._wrapY):r.y);return l.z=r.z,l},_pxBoundsToTileRange:function(r){var l=this.getTileSize();return new $(r.min.unscaleBy(l).floor(),r.max.unscaleBy(l).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var r in this._tiles)if(!this._tiles[r].loaded)return!1;return!0}});function Yg(r){return new Ls(r)}var kn=Ls.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(r,l){this._url=r,l=w(this,l),l.detectRetina&&K.retina&&l.maxZoom>0?(l.tileSize=Math.floor(l.tileSize/2),l.zoomReverse?(l.zoomOffset--,l.minZoom=Math.min(l.maxZoom,l.minZoom+1)):(l.zoomOffset++,l.maxZoom=Math.max(l.minZoom,l.maxZoom-1)),l.minZoom=Math.max(0,l.minZoom)):l.zoomReverse?l.minZoom=Math.min(l.maxZoom,l.minZoom):l.maxZoom=Math.max(l.minZoom,l.maxZoom),typeof l.subdomains=="string"&&(l.subdomains=l.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(r,l){return this._url===r&&l===void 0&&(l=!0),this._url=r,l||this.redraw(),this},createTile:function(r,l){var u=document.createElement("img");return at(u,"load",a(this._tileOnLoad,this,l,u)),at(u,"error",a(this._tileOnError,this,l,u)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(u.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(u.referrerPolicy=this.options.referrerPolicy),u.alt="",u.src=this.getTileUrl(r),u},getTileUrl:function(r){var l={r:K.retina?"@2x":"",s:this._getSubdomain(r),x:r.x,y:r.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var u=this._globalTileRange.max.y-r.y;this.options.tms&&(l.y=u),l["-y"]=u}return T(this._url,s(l,this.options))},_tileOnLoad:function(r,l){K.ielt9?setTimeout(a(r,this,null,l),0):r(null,l)},_tileOnError:function(r,l,u){var g=this.options.errorTileUrl;g&&l.getAttribute("src")!==g&&(l.src=g),r(u,l)},_onTileRemove:function(r){r.tile.onload=null},_getZoomForUrl:function(){var r=this._tileZoom,l=this.options.maxZoom,u=this.options.zoomReverse,g=this.options.zoomOffset;return u&&(r=l-r),r+g},_getSubdomain:function(r){var l=Math.abs(r.x+r.y)%this.options.subdomains.length;return this.options.subdomains[l]},_abortLoading:function(){var r,l;for(r in this._tiles)if(this._tiles[r].coords.z!==this._tileZoom&&(l=this._tiles[r].el,l.onload=_,l.onerror=_,!l.complete)){l.src=P;var u=this._tiles[r].coords;Pt(l),delete this._tiles[r],this.fire("tileabort",{tile:l,coords:u})}},_removeTile:function(r){var l=this._tiles[r];if(l)return l.el.setAttribute("src",P),Ls.prototype._removeTile.call(this,r)},_tileReady:function(r,l,u){if(!(!this._map||u&&u.getAttribute("src")===P))return Ls.prototype._tileReady.call(this,r,l,u)}});function oc(r,l){return new kn(r,l)}var ac=kn.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(r,l){this._url=r;var u=s({},this.defaultWmsParams);for(var g in l)g in this.options||(u[g]=l[g]);l=w(this,l);var m=l.detectRetina&&K.retina?2:1,x=this.getTileSize();u.width=x.x*m,u.height=x.y*m,this.wmsParams=u},onAdd:function(r){this._crs=this.options.crs||r.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var l=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[l]=this._crs.code,kn.prototype.onAdd.call(this,r)},getTileUrl:function(r){var l=this._tileCoordsToNwSe(r),u=this._crs,g=N(u.project(l[0]),u.project(l[1])),m=g.min,x=g.max,b=(this._wmsVersion>=1.3&&this._crs===Qh?[m.y,m.x,x.y,x.x]:[m.x,m.y,x.x,x.y]).join(","),R=kn.prototype.getTileUrl.call(this,r);return R+C(this.wmsParams,R,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+b},setParams:function(r,l){return s(this.wmsParams,r),l||this.redraw(),this}});function Ug(r,l){return new ac(r,l)}kn.WMS=ac,oc.wms=Ug;var li=Ie.extend({options:{padding:.1},initialize:function(r){w(this,r),c(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),ht(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var r={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(r.zoomanim=this._onAnimZoom),r},_onAnimZoom:function(r){this._updateTransform(r.center,r.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(r,l){var u=this._map.getZoomScale(l,this._zoom),g=this._map.getSize().multiplyBy(.5+this.options.padding),m=this._map.project(this._center,l),x=g.multiplyBy(-u).add(m).subtract(this._map._getNewPixelOrigin(r,l));K.any3d?Hi(this._container,x,u):Dt(this._container,x)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var r in this._layers)this._layers[r]._reset()},_onZoomEnd:function(){for(var r in this._layers)this._layers[r]._project()},_updatePaths:function(){for(var r in this._layers)this._layers[r]._update()},_update:function(){var r=this.options.padding,l=this._map.getSize(),u=this._map.containerPointToLayerPoint(l.multiplyBy(-r)).round();this._bounds=new $(u,u.add(l.multiplyBy(1+r*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),lc=li.extend({options:{tolerance:0},getEvents:function(){var r=li.prototype.getEvents.call(this);return r.viewprereset=this._onViewPreReset,r},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){li.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var r=this._container=document.createElement("canvas");at(r,"mousemove",this._onMouseMove,this),at(r,"click dblclick mousedown mouseup contextmenu",this._onClick,this),at(r,"mouseout",this._handleMouseOut,this),r._leaflet_disable_events=!0,this._ctx=r.getContext("2d")},_destroyContainer:function(){W(this._redrawRequest),delete this._ctx,Pt(this._container),Tt(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var r;this._redrawBounds=null;for(var l in this._layers)r=this._layers[l],r._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){li.prototype._update.call(this);var r=this._bounds,l=this._container,u=r.getSize(),g=K.retina?2:1;Dt(l,r.min),l.width=g*u.x,l.height=g*u.y,l.style.width=u.x+"px",l.style.height=u.y+"px",K.retina&&this._ctx.scale(2,2),this._ctx.translate(-r.min.x,-r.min.y),this.fire("update")}},_reset:function(){li.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(r){this._updateDashArray(r),this._layers[c(r)]=r;var l=r._order={layer:r,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=l),this._drawLast=l,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(r){this._requestRedraw(r)},_removePath:function(r){var l=r._order,u=l.next,g=l.prev;u?u.prev=g:this._drawLast=g,g?g.next=u:this._drawFirst=u,delete r._order,delete this._layers[c(r)],this._requestRedraw(r)},_updatePath:function(r){this._extendRedrawBounds(r),r._project(),r._update(),this._requestRedraw(r)},_updateStyle:function(r){this._updateDashArray(r),this._requestRedraw(r)},_updateDashArray:function(r){if(typeof r.options.dashArray=="string"){var l=r.options.dashArray.split(/[, ]+/),u=[],g,m;for(m=0;m<l.length;m++){if(g=Number(l[m]),isNaN(g))return;u.push(g)}r.options._dashArray=u}else r.options._dashArray=r.options.dashArray},_requestRedraw:function(r){this._map&&(this._extendRedrawBounds(r),this._redrawRequest=this._redrawRequest||X(this._redraw,this))},_extendRedrawBounds:function(r){if(r._pxBounds){var l=(r.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new $,this._redrawBounds.extend(r._pxBounds.min.subtract([l,l])),this._redrawBounds.extend(r._pxBounds.max.add([l,l]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var r=this._redrawBounds;if(r){var l=r.getSize();this._ctx.clearRect(r.min.x,r.min.y,l.x,l.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var r,l=this._redrawBounds;if(this._ctx.save(),l){var u=l.getSize();this._ctx.beginPath(),this._ctx.rect(l.min.x,l.min.y,u.x,u.y),this._ctx.clip()}this._drawing=!0;for(var g=this._drawFirst;g;g=g.next)r=g.layer,(!l||r._pxBounds&&r._pxBounds.intersects(l))&&r._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(r,l){if(this._drawing){var u,g,m,x,b=r._parts,R=b.length,I=this._ctx;if(R){for(I.beginPath(),u=0;u<R;u++){for(g=0,m=b[u].length;g<m;g++)x=b[u][g],I[g?"lineTo":"moveTo"](x.x,x.y);l&&I.closePath()}this._fillStroke(I,r)}}},_updateCircle:function(r){if(!(!this._drawing||r._empty())){var l=r._point,u=this._ctx,g=Math.max(Math.round(r._radius),1),m=(Math.max(Math.round(r._radiusY),1)||g)/g;m!==1&&(u.save(),u.scale(1,m)),u.beginPath(),u.arc(l.x,l.y/m,g,0,Math.PI*2,!1),m!==1&&u.restore(),this._fillStroke(u,r)}},_fillStroke:function(r,l){var u=l.options;u.fill&&(r.globalAlpha=u.fillOpacity,r.fillStyle=u.fillColor||u.color,r.fill(u.fillRule||"evenodd")),u.stroke&&u.weight!==0&&(r.setLineDash&&r.setLineDash(l.options&&l.options._dashArray||[]),r.globalAlpha=u.opacity,r.lineWidth=u.weight,r.strokeStyle=u.color,r.lineCap=u.lineCap,r.lineJoin=u.lineJoin,r.stroke())},_onClick:function(r){for(var l=this._map.mouseEventToLayerPoint(r),u,g,m=this._drawFirst;m;m=m.next)u=m.layer,u.options.interactive&&u._containsPoint(l)&&(!(r.type==="click"||r.type==="preclick")||!this._map._draggableMoved(u))&&(g=u);this._fireEvent(g?[g]:!1,r)},_onMouseMove:function(r){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var l=this._map.mouseEventToLayerPoint(r);this._handleMouseHover(r,l)}},_handleMouseOut:function(r){var l=this._hoveredLayer;l&&(Ot(this._container,"leaflet-interactive"),this._fireEvent([l],r,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(r,l){if(!this._mouseHoverThrottled){for(var u,g,m=this._drawFirst;m;m=m.next)u=m.layer,u.options.interactive&&u._containsPoint(l)&&(g=u);g!==this._hoveredLayer&&(this._handleMouseOut(r),g&&(ht(this._container,"leaflet-interactive"),this._fireEvent([g],r,"mouseover"),this._hoveredLayer=g)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,r),this._mouseHoverThrottled=!0,setTimeout(a(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(r,l,u){this._map._fireDOMEvent(l,u||l.type,r)},_bringToFront:function(r){var l=r._order;if(l){var u=l.next,g=l.prev;if(u)u.prev=g;else return;g?g.next=u:u&&(this._drawFirst=u),l.prev=this._drawLast,this._drawLast.next=l,l.next=null,this._drawLast=l,this._requestRedraw(r)}},_bringToBack:function(r){var l=r._order;if(l){var u=l.next,g=l.prev;if(g)g.next=u;else return;u?u.prev=g:g&&(this._drawLast=g),l.prev=null,l.next=this._drawFirst,this._drawFirst.prev=l,this._drawFirst=l,this._requestRedraw(r)}}});function hc(r){return K.canvas?new lc(r):null}var Ss=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(r){return document.createElement("<lvml:"+r+' class="lvml">')}}catch{}return function(r){return document.createElement("<"+r+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Vg={_initContainer:function(){this._container=mt("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(li.prototype._update.call(this),this.fire("update"))},_initPath:function(r){var l=r._container=Ss("shape");ht(l,"leaflet-vml-shape "+(this.options.className||"")),l.coordsize="1 1",r._path=Ss("path"),l.appendChild(r._path),this._updateStyle(r),this._layers[c(r)]=r},_addPath:function(r){var l=r._container;this._container.appendChild(l),r.options.interactive&&r.addInteractiveTarget(l)},_removePath:function(r){var l=r._container;Pt(l),r.removeInteractiveTarget(l),delete this._layers[c(r)]},_updateStyle:function(r){var l=r._stroke,u=r._fill,g=r.options,m=r._container;m.stroked=!!g.stroke,m.filled=!!g.fill,g.stroke?(l||(l=r._stroke=Ss("stroke")),m.appendChild(l),l.weight=g.weight+"px",l.color=g.color,l.opacity=g.opacity,g.dashArray?l.dashStyle=M(g.dashArray)?g.dashArray.join(" "):g.dashArray.replace(/( *, *)/g," "):l.dashStyle="",l.endcap=g.lineCap.replace("butt","flat"),l.joinstyle=g.lineJoin):l&&(m.removeChild(l),r._stroke=null),g.fill?(u||(u=r._fill=Ss("fill")),m.appendChild(u),u.color=g.fillColor||g.color,u.opacity=g.fillOpacity):u&&(m.removeChild(u),r._fill=null)},_updateCircle:function(r){var l=r._point.round(),u=Math.round(r._radius),g=Math.round(r._radiusY||u);this._setPath(r,r._empty()?"M0 0":"AL "+l.x+","+l.y+" "+u+","+g+" 0,"+65535*360)},_setPath:function(r,l){r._path.v=l},_bringToFront:function(r){Pn(r._container)},_bringToBack:function(r){Mn(r._container)}},Gr=K.vml?Ss:Jt,Ps=li.extend({_initContainer:function(){this._container=Gr("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Gr("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Pt(this._container),Tt(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){li.prototype._update.call(this);var r=this._bounds,l=r.getSize(),u=this._container;(!this._svgSize||!this._svgSize.equals(l))&&(this._svgSize=l,u.setAttribute("width",l.x),u.setAttribute("height",l.y)),Dt(u,r.min),u.setAttribute("viewBox",[r.min.x,r.min.y,l.x,l.y].join(" ")),this.fire("update")}},_initPath:function(r){var l=r._path=Gr("path");r.options.className&&ht(l,r.options.className),r.options.interactive&&ht(l,"leaflet-interactive"),this._updateStyle(r),this._layers[c(r)]=r},_addPath:function(r){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(r._path),r.addInteractiveTarget(r._path)},_removePath:function(r){Pt(r._path),r.removeInteractiveTarget(r._path),delete this._layers[c(r)]},_updatePath:function(r){r._project(),r._update()},_updateStyle:function(r){var l=r._path,u=r.options;l&&(u.stroke?(l.setAttribute("stroke",u.color),l.setAttribute("stroke-opacity",u.opacity),l.setAttribute("stroke-width",u.weight),l.setAttribute("stroke-linecap",u.lineCap),l.setAttribute("stroke-linejoin",u.lineJoin),u.dashArray?l.setAttribute("stroke-dasharray",u.dashArray):l.removeAttribute("stroke-dasharray"),u.dashOffset?l.setAttribute("stroke-dashoffset",u.dashOffset):l.removeAttribute("stroke-dashoffset")):l.setAttribute("stroke","none"),u.fill?(l.setAttribute("fill",u.fillColor||u.color),l.setAttribute("fill-opacity",u.fillOpacity),l.setAttribute("fill-rule",u.fillRule||"evenodd")):l.setAttribute("fill","none"))},_updatePoly:function(r,l){this._setPath(r,de(r._parts,l))},_updateCircle:function(r){var l=r._point,u=Math.max(Math.round(r._radius),1),g=Math.max(Math.round(r._radiusY),1)||u,m="a"+u+","+g+" 0 1,0 ",x=r._empty()?"M0 0":"M"+(l.x-u)+","+l.y+m+u*2+",0 "+m+-u*2+",0 ";this._setPath(r,x)},_setPath:function(r,l){r._path.setAttribute("d",l)},_bringToFront:function(r){Pn(r._path)},_bringToBack:function(r){Mn(r._path)}});K.vml&&Ps.include(Vg);function cc(r){return K.svg||K.vml?new Ps(r):null}gt.include({getRenderer:function(r){var l=r.options.renderer||this._getPaneRenderer(r.options.pane)||this.options.renderer||this._renderer;return l||(l=this._renderer=this._createRenderer()),this.hasLayer(l)||this.addLayer(l),l},_getPaneRenderer:function(r){if(r==="overlayPane"||r===void 0)return!1;var l=this._paneRenderers[r];return l===void 0&&(l=this._createRenderer({pane:r}),this._paneRenderers[r]=l),l},_createRenderer:function(r){return this.options.preferCanvas&&hc(r)||cc(r)}});var uc=An.extend({initialize:function(r,l){An.prototype.initialize.call(this,this._boundsToLatLngs(r),l)},setBounds:function(r){return this.setLatLngs(this._boundsToLatLngs(r))},_boundsToLatLngs:function(r){return r=dt(r),[r.getSouthWest(),r.getNorthWest(),r.getNorthEast(),r.getSouthEast()]}});function Kg(r,l){return new uc(r,l)}Ps.create=Gr,Ps.pointsToPath=de,ai.geometryToLayer=Or,ai.coordsToLatLng=Ta,ai.coordsToLatLngs=kr,ai.latLngToCoords=La,ai.latLngsToCoords=Dr,ai.getFeature=On,ai.asFeature=Fr,gt.mergeOptions({boxZoom:!0});var dc=Xe.extend({initialize:function(r){this._map=r,this._container=r._container,this._pane=r._panes.overlayPane,this._resetStateTimeout=0,r.on("unload",this._destroy,this)},addHooks:function(){at(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Tt(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Pt(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(r){if(!r.shiftKey||r.which!==1&&r.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),vs(),la(),this._startPoint=this._map.mouseEventToContainerPoint(r),at(document,{contextmenu:Ji,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(r){this._moved||(this._moved=!0,this._box=mt("div","leaflet-zoom-box",this._container),ht(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(r);var l=new $(this._point,this._startPoint),u=l.getSize();Dt(this._box,l.min),this._box.style.width=u.x+"px",this._box.style.height=u.y+"px"},_finish:function(){this._moved&&(Pt(this._box),Ot(this._container,"leaflet-crosshair")),xs(),ha(),Tt(document,{contextmenu:Ji,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(r){if(!(r.which!==1&&r.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(a(this._resetState,this),0);var l=new pt(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(l).fire("boxzoomend",{boxZoomBounds:l})}},_onKeyDown:function(r){r.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});gt.addInitHook("addHandler","boxZoom",dc),gt.mergeOptions({doubleClickZoom:!0});var fc=Xe.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(r){var l=this._map,u=l.getZoom(),g=l.options.zoomDelta,m=r.originalEvent.shiftKey?u-g:u+g;l.options.doubleClickZoom==="center"?l.setZoom(m):l.setZoomAround(r.containerPoint,m)}});gt.addInitHook("addHandler","doubleClickZoom",fc),gt.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var gc=Xe.extend({addHooks:function(){if(!this._draggable){var r=this._map;this._draggable=new Si(r._mapPane,r._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),r.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),r.on("zoomend",this._onZoomEnd,this),r.whenReady(this._onZoomEnd,this))}ht(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Ot(this._map._container,"leaflet-grab"),Ot(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var r=this._map;if(r._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var l=dt(this._map.options.maxBounds);this._offsetLimit=N(this._map.latLngToContainerPoint(l.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(l.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;r.fire("movestart").fire("dragstart"),r.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(r){if(this._map.options.inertia){var l=this._lastTime=+new Date,u=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(u),this._times.push(l),this._prunePositions(l)}this._map.fire("move",r).fire("drag",r)},_prunePositions:function(r){for(;this._positions.length>1&&r-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var r=this._map.getSize().divideBy(2),l=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=l.subtract(r).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(r,l){return r-(r-l)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var r=this._draggable._newPos.subtract(this._draggable._startPos),l=this._offsetLimit;r.x<l.min.x&&(r.x=this._viscousLimit(r.x,l.min.x)),r.y<l.min.y&&(r.y=this._viscousLimit(r.y,l.min.y)),r.x>l.max.x&&(r.x=this._viscousLimit(r.x,l.max.x)),r.y>l.max.y&&(r.y=this._viscousLimit(r.y,l.max.y)),this._draggable._newPos=this._draggable._startPos.add(r)}},_onPreDragWrap:function(){var r=this._worldWidth,l=Math.round(r/2),u=this._initialWorldOffset,g=this._draggable._newPos.x,m=(g-l+u)%r+l-u,x=(g+l+u)%r-l-u,b=Math.abs(m+u)<Math.abs(x+u)?m:x;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=b},_onDragEnd:function(r){var l=this._map,u=l.options,g=!u.inertia||r.noInertia||this._times.length<2;if(l.fire("dragend",r),g)l.fire("moveend");else{this._prunePositions(+new Date);var m=this._lastPos.subtract(this._positions[0]),x=(this._lastTime-this._times[0])/1e3,b=u.easeLinearity,R=m.multiplyBy(b/x),I=R.distanceTo([0,0]),z=Math.min(u.inertiaMaxSpeed,I),U=R.multiplyBy(z/I),et=z/(u.inertiaDeceleration*b),ut=U.multiplyBy(-et/2).round();!ut.x&&!ut.y?l.fire("moveend"):(ut=l._limitOffset(ut,l.options.maxBounds),X(function(){l.panBy(ut,{duration:et,easeLinearity:b,noMoveStart:!0,animate:!0})}))}}});gt.addInitHook("addHandler","dragging",gc),gt.mergeOptions({keyboard:!0,keyboardPanDelta:80});var _c=Xe.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(r){this._map=r,this._setPanDelta(r.options.keyboardPanDelta),this._setZoomDelta(r.options.zoomDelta)},addHooks:function(){var r=this._map._container;r.tabIndex<=0&&(r.tabIndex="0"),at(r,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Tt(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var r=document.body,l=document.documentElement,u=r.scrollTop||l.scrollTop,g=r.scrollLeft||l.scrollLeft;this._map._container.focus(),window.scrollTo(g,u)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(r){var l=this._panKeys={},u=this.keyCodes,g,m;for(g=0,m=u.left.length;g<m;g++)l[u.left[g]]=[-1*r,0];for(g=0,m=u.right.length;g<m;g++)l[u.right[g]]=[r,0];for(g=0,m=u.down.length;g<m;g++)l[u.down[g]]=[0,r];for(g=0,m=u.up.length;g<m;g++)l[u.up[g]]=[0,-1*r]},_setZoomDelta:function(r){var l=this._zoomKeys={},u=this.keyCodes,g,m;for(g=0,m=u.zoomIn.length;g<m;g++)l[u.zoomIn[g]]=r;for(g=0,m=u.zoomOut.length;g<m;g++)l[u.zoomOut[g]]=-r},_addHooks:function(){at(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Tt(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(r){if(!(r.altKey||r.ctrlKey||r.metaKey)){var l=r.keyCode,u=this._map,g;if(l in this._panKeys){if(!u._panAnim||!u._panAnim._inProgress)if(g=this._panKeys[l],r.shiftKey&&(g=j(g).multiplyBy(3)),u.options.maxBounds&&(g=u._limitOffset(j(g),u.options.maxBounds)),u.options.worldCopyJump){var m=u.wrapLatLng(u.unproject(u.project(u.getCenter()).add(g)));u.panTo(m)}else u.panBy(g)}else if(l in this._zoomKeys)u.setZoom(u.getZoom()+(r.shiftKey?3:1)*this._zoomKeys[l]);else if(l===27&&u._popup&&u._popup.options.closeOnEscapeKey)u.closePopup();else return;Ji(r)}}});gt.addInitHook("addHandler","keyboard",_c),gt.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var mc=Xe.extend({addHooks:function(){at(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Tt(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(r){var l=Gh(r),u=this._map.options.wheelDebounceTime;this._delta+=l,this._lastMousePos=this._map.mouseEventToContainerPoint(r),this._startTime||(this._startTime=+new Date);var g=Math.max(u-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(a(this._performZoom,this),g),Ji(r)},_performZoom:function(){var r=this._map,l=r.getZoom(),u=this._map.options.zoomSnap||0;r._stop();var g=this._delta/(this._map.options.wheelPxPerZoomLevel*4),m=4*Math.log(2/(1+Math.exp(-Math.abs(g))))/Math.LN2,x=u?Math.ceil(m/u)*u:m,b=r._limitZoom(l+(this._delta>0?x:-x))-l;this._delta=0,this._startTime=null,b&&(r.options.scrollWheelZoom==="center"?r.setZoom(l+b):r.setZoomAround(this._lastMousePos,l+b))}});gt.addInitHook("addHandler","scrollWheelZoom",mc);var Hg=600;gt.mergeOptions({tapHold:K.touchNative&&K.safari&&K.mobile,tapTolerance:15});var pc=Xe.extend({addHooks:function(){at(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Tt(this._map._container,"touchstart",this._onDown,this)},_onDown:function(r){if(clearTimeout(this._holdTimeout),r.touches.length===1){var l=r.touches[0];this._startPos=this._newPos=new G(l.clientX,l.clientY),this._holdTimeout=setTimeout(a(function(){this._cancel(),this._isTapValid()&&(at(document,"touchend",Ut),at(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",l))},this),Hg),at(document,"touchend touchcancel contextmenu",this._cancel,this),at(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function r(){Tt(document,"touchend",Ut),Tt(document,"touchend touchcancel",r)},_cancel:function(){clearTimeout(this._holdTimeout),Tt(document,"touchend touchcancel contextmenu",this._cancel,this),Tt(document,"touchmove",this._onMove,this)},_onMove:function(r){var l=r.touches[0];this._newPos=new G(l.clientX,l.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(r,l){var u=new MouseEvent(r,{bubbles:!0,cancelable:!0,view:window,screenX:l.screenX,screenY:l.screenY,clientX:l.clientX,clientY:l.clientY});u._simulated=!0,l.target.dispatchEvent(u)}});gt.addInitHook("addHandler","tapHold",pc),gt.mergeOptions({touchZoom:K.touch,bounceAtZoomLimits:!0});var yc=Xe.extend({addHooks:function(){ht(this._map._container,"leaflet-touch-zoom"),at(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Ot(this._map._container,"leaflet-touch-zoom"),Tt(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(r){var l=this._map;if(!(!r.touches||r.touches.length!==2||l._animatingZoom||this._zooming)){var u=l.mouseEventToContainerPoint(r.touches[0]),g=l.mouseEventToContainerPoint(r.touches[1]);this._centerPoint=l.getSize()._divideBy(2),this._startLatLng=l.containerPointToLatLng(this._centerPoint),l.options.touchZoom!=="center"&&(this._pinchStartLatLng=l.containerPointToLatLng(u.add(g)._divideBy(2))),this._startDist=u.distanceTo(g),this._startZoom=l.getZoom(),this._moved=!1,this._zooming=!0,l._stop(),at(document,"touchmove",this._onTouchMove,this),at(document,"touchend touchcancel",this._onTouchEnd,this),Ut(r)}},_onTouchMove:function(r){if(!(!r.touches||r.touches.length!==2||!this._zooming)){var l=this._map,u=l.mouseEventToContainerPoint(r.touches[0]),g=l.mouseEventToContainerPoint(r.touches[1]),m=u.distanceTo(g)/this._startDist;if(this._zoom=l.getScaleZoom(m,this._startZoom),!l.options.bounceAtZoomLimits&&(this._zoom<l.getMinZoom()&&m<1||this._zoom>l.getMaxZoom()&&m>1)&&(this._zoom=l._limitZoom(this._zoom)),l.options.touchZoom==="center"){if(this._center=this._startLatLng,m===1)return}else{var x=u._add(g)._divideBy(2)._subtract(this._centerPoint);if(m===1&&x.x===0&&x.y===0)return;this._center=l.unproject(l.project(this._pinchStartLatLng,this._zoom).subtract(x),this._zoom)}this._moved||(l._moveStart(!0,!1),this._moved=!0),W(this._animRequest);var b=a(l._move,l,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=X(b,this,!0),Ut(r)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,W(this._animRequest),Tt(document,"touchmove",this._onTouchMove,this),Tt(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});gt.addInitHook("addHandler","touchZoom",yc),gt.BoxZoom=dc,gt.DoubleClickZoom=fc,gt.Drag=gc,gt.Keyboard=_c,gt.ScrollWheelZoom=mc,gt.TapHold=pc,gt.TouchZoom=yc,e.Bounds=$,e.Browser=K,e.CRS=bt,e.Canvas=lc,e.Circle=ba,e.CircleMarker=Ar,e.Class=Z,e.Control=Re,e.DivIcon=rc,e.DivOverlay=je,e.DomEvent=fg,e.DomUtil=ug,e.Draggable=Si,e.Evented=J,e.FeatureGroup=ri,e.GeoJSON=ai,e.GridLayer=Ls,e.Handler=Xe,e.Icon=In,e.ImageOverlay=zr,e.LatLng=tt,e.LatLngBounds=pt,e.Layer=Ie,e.LayerGroup=Rn,e.LineUtil=Lg,e.Map=gt,e.Marker=Ir,e.Mixin=xg,e.Path=Pi,e.Point=G,e.PolyUtil=wg,e.Polygon=An,e.Polyline=oi,e.Popup=Nr,e.PosAnimation=Bh,e.Projection=Sg,e.Rectangle=uc,e.Renderer=li,e.SVG=Ps,e.SVGOverlay=sc,e.TileLayer=kn,e.Tooltip=Zr,e.Transformation=wi,e.Util=Y,e.VideoOverlay=nc,e.bind=a,e.bounds=N,e.canvas=hc,e.circle=Dg,e.circleMarker=kg,e.control=Es,e.divIcon=jg,e.extend=s,e.featureGroup=Ig,e.geoJSON=ic,e.geoJson=Ng,e.gridLayer=Yg,e.icon=Ag,e.imageOverlay=Zg,e.latLng=it,e.latLngBounds=dt,e.layerGroup=Rg,e.map=gg,e.marker=Og,e.point=j,e.polygon=zg,e.polyline=Fg,e.popup=Wg,e.rectangle=Kg,e.setOptions=w,e.stamp=c,e.svg=cc,e.svgOverlay=Bg,e.tileLayer=oc,e.tooltip=Xg,e.transformation=ti,e.version=n,e.videoOverlay=Gg;var $g=window.L;e.noConflict=function(){return window.L=$g,this},window.L=e})}(Gs,Gs.exports)),Gs.exports}var Oe=y1();const on=m1(Oe);class yf{drawCustom(t,e,n,s,o){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,n){}drawFeature(t,e,n){}drawGeometryCollection(t,e,n){}drawLineString(t,e,n){}drawMultiLineString(t,e,n){}drawMultiPoint(t,e,n){}drawMultiPolygon(t,e,n){}drawPoint(t,e,n){}drawPolygon(t,e,n){}drawText(t,e,n){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}const H={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},to=[H.FILL],zi=[H.STROKE],un=[H.BEGIN_PATH],yu=[H.CLOSE_PATH];class pr extends yf{constructor(t,e,n,s){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=n,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(n){return n*e})}appendFlatPointCoordinates(t,e){const n=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,o=this.coordinates;let a=o.length;for(let h=0,c=t.length;h<c;h+=e)s[0]=t[h],s[1]=t[h+1],yn(n,s)&&(o[a++]=s[0],o[a++]=s[1]);return a}appendFlatLineCoordinates(t,e,n,s,o,a){const h=this.coordinates;let c=h.length;const d=this.getBufferedMaxExtent();a&&(e+=s);let f=t[e],_=t[e+1];const p=this.tmpCoordinate_;let y=!0,v,w,C;for(v=e+s;v<n;v+=s)p[0]=t[v],p[1]=t[v+1],C=ul(d,p),C!==w?(y&&(h[c++]=f,h[c++]=_,y=!1),h[c++]=p[0],h[c++]=p[1]):C===Wt.INTERSECTING?(h[c++]=p[0],h[c++]=p[1],y=!1):y=!0,f=p[0],_=p[1],w=C;return(o&&y||v===e+s)&&(h[c++]=f,h[c++]=_),c}drawCustomCoordinates_(t,e,n,s,o){for(let a=0,h=n.length;a<h;++a){const c=n[a],d=this.appendFlatLineCoordinates(t,e,c,s,!1,!1);o.push(d),e=c}return e}drawCustom(t,e,n,s,o){this.beginGeometry(t,e,o);const a=t.getType(),h=t.getStride(),c=this.coordinates.length;let d,f,_,p,y;switch(a){case"MultiPolygon":d=t.getOrientedFlatCoordinates(),p=[];const v=t.getEndss();y=0;for(let w=0,C=v.length;w<C;++w){const E=[];y=this.drawCustomCoordinates_(d,y,v[w],h,E),p.push(E)}this.instructions.push([H.CUSTOM,c,p,t,n,pl,o]),this.hitDetectionInstructions.push([H.CUSTOM,c,p,t,s||n,pl,o]);break;case"Polygon":case"MultiLineString":_=[],d=a=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),y=this.drawCustomCoordinates_(d,0,t.getEnds(),h,_),this.instructions.push([H.CUSTOM,c,_,t,n,Js,o]),this.hitDetectionInstructions.push([H.CUSTOM,c,_,t,s||n,Js,o]);break;case"LineString":case"Circle":d=t.getFlatCoordinates(),f=this.appendFlatLineCoordinates(d,0,d.length,h,!1,!1),this.instructions.push([H.CUSTOM,c,f,t,n,Fi,o]),this.hitDetectionInstructions.push([H.CUSTOM,c,f,t,s||n,Fi,o]);break;case"MultiPoint":d=t.getFlatCoordinates(),f=this.appendFlatPointCoordinates(d,h),f>c&&(this.instructions.push([H.CUSTOM,c,f,t,n,Fi,o]),this.hitDetectionInstructions.push([H.CUSTOM,c,f,t,s||n,Fi,o]));break;case"Point":d=t.getFlatCoordinates(),this.coordinates.push(d[0],d[1]),f=this.coordinates.length,this.instructions.push([H.CUSTOM,c,f,t,n,void 0,o]),this.hitDetectionInstructions.push([H.CUSTOM,c,f,t,s||n,void 0,o]);break}this.endGeometry(e)}beginGeometry(t,e,n){this.beginGeometryInstruction1_=[H.BEGIN_GEOMETRY,e,0,t,n],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[H.BEGIN_GEOMETRY,e,0,t,n],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const n=t.length;let s,o,a=-1;for(e=0;e<n;++e)s=t[e],o=s[0],o==H.END_GEOMETRY?a=e:o==H.BEGIN_GEOMETRY&&(s[2]=e,c_(this.hitDetectionInstructions,a,e),a=-1)}fillStyleToState(t,e={}){if(t){const n=t.getColor();e.fillPatternScale=n&&typeof n=="object"&&"src"in n?this.pixelRatio:1,e.fillStyle=$e(n||he)}else e.fillStyle=void 0;return e}strokeStyleToState(t,e={}){if(t){const n=t.getColor();e.strokeStyle=$e(n||er);const s=t.getLineCap();e.lineCap=s!==void 0?s:rs;const o=t.getLineDash();e.lineDash=o?o.slice():pi;const a=t.getLineDashOffset();e.lineDashOffset=a||yi;const h=t.getLineJoin();e.lineJoin=h!==void 0?h:os;const c=t.getWidth();e.lineWidth=c!==void 0?c:nr;const d=t.getMiterLimit();e.miterLimit=d!==void 0?d:tr,e.lineWidth>this.maxLineWidth&&(this.maxLineWidth=e.lineWidth,this.bufferedMaxExtent_=null)}else e.strokeStyle=void 0,e.lineCap=void 0,e.lineDash=null,e.lineDashOffset=void 0,e.lineJoin=void 0,e.lineWidth=void 0,e.miterLimit=void 0;return e}setFillStrokeStyle(t,e){const n=this.state;this.fillStyleToState(t,n),this.strokeStyleToState(e,n)}createFill(t){const e=t.fillStyle,n=[H.SET_FILL_STYLE,e];return typeof e!="string"&&n.push(t.fillPatternScale),n}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[H.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,t.lineDash?this.applyPixelRatio(t.lineDash):null,t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const n=t.fillStyle;(typeof n!="string"||t.currentFillStyle!=n)&&(n!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=n)}updateStrokeStyle(t,e){const n=t.strokeStyle,s=t.lineCap,o=t.lineDash,a=t.lineDashOffset,h=t.lineJoin,c=t.lineWidth,d=t.miterLimit;(t.currentStrokeStyle!=n||t.currentLineCap!=s||o!=t.currentLineDash&&!Ui(t.currentLineDash,o)||t.currentLineDashOffset!=a||t.currentLineJoin!=h||t.currentLineWidth!=c||t.currentMiterLimit!=d)&&(n!==void 0&&e.call(this,t),t.currentStrokeStyle=n,t.currentLineCap=s,t.currentLineDash=o,t.currentLineDashOffset=a,t.currentLineJoin=h,t.currentLineWidth=c,t.currentMiterLimit=d)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[H.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=od(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;Il(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class v1 extends pr{constructor(t,e,n,s){super(t,e,n,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,n){if(!this.image_||this.maxExtent&&!yn(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,n);const s=t.getFlatCoordinates(),o=t.getStride(),a=this.coordinates.length,h=this.appendFlatPointCoordinates(s,o);this.instructions.push([H.DRAW_IMAGE,a,h,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([H.DRAW_IMAGE,a,h,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,n){if(!this.image_)return;this.beginGeometry(t,e,n);const s=t.getFlatCoordinates(),o=[];for(let c=0,d=s.length;c<d;c+=t.getStride())(!this.maxExtent||yn(this.maxExtent,s.slice(c,c+2)))&&o.push(s[c],s[c+1]);const a=this.coordinates.length,h=this.appendFlatPointCoordinates(o,2);this.instructions.push([H.DRAW_IMAGE,a,h,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([H.DRAW_IMAGE,a,h,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const n=t.getAnchor(),s=t.getSize(),o=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=t.getOpacity(),this.originX_=o[0],this.originY_=o[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=s[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}class x1 extends pr{constructor(t,e,n,s){super(t,e,n,s)}drawFlatCoordinates_(t,e,n,s){const o=this.coordinates.length,a=this.appendFlatLineCoordinates(t,e,n,s,!1,!1),h=[H.MOVE_TO_LINE_TO,o,a];return this.instructions.push(h),this.hitDetectionInstructions.push(h),n}drawLineString(t,e,n){const s=this.state,o=s.strokeStyle,a=s.lineWidth;if(o===void 0||a===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,e,n),this.hitDetectionInstructions.push([H.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,pi,yi],un);const h=t.getFlatCoordinates(),c=t.getStride();this.drawFlatCoordinates_(h,0,h.length,c),this.hitDetectionInstructions.push(zi),this.endGeometry(e)}drawMultiLineString(t,e,n){const s=this.state,o=s.strokeStyle,a=s.lineWidth;if(o===void 0||a===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,e,n),this.hitDetectionInstructions.push([H.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,pi,yi],un);const h=t.getEnds(),c=t.getFlatCoordinates(),d=t.getStride();let f=0;for(let _=0,p=h.length;_<p;++_)f=this.drawFlatCoordinates_(c,f,h[_],d);this.hitDetectionInstructions.push(zi),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(zi),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(zi),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(un)}}class vu extends pr{constructor(t,e,n,s){super(t,e,n,s)}drawFlatCoordinatess_(t,e,n,s){const o=this.state,a=o.fillStyle!==void 0,h=o.strokeStyle!==void 0,c=n.length;this.instructions.push(un),this.hitDetectionInstructions.push(un);for(let d=0;d<c;++d){const f=n[d],_=this.coordinates.length,p=this.appendFlatLineCoordinates(t,e,f,s,!0,!h),y=[H.MOVE_TO_LINE_TO,_,p];this.instructions.push(y),this.hitDetectionInstructions.push(y),h&&(this.instructions.push(yu),this.hitDetectionInstructions.push(yu)),e=f}return a&&(this.instructions.push(to),this.hitDetectionInstructions.push(to)),h&&(this.instructions.push(zi),this.hitDetectionInstructions.push(zi)),e}drawCircle(t,e,n){const s=this.state,o=s.fillStyle,a=s.strokeStyle;if(o===void 0&&a===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([H.SET_FILL_STYLE,he]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([H.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,pi,yi]);const h=t.getFlatCoordinates(),c=t.getStride(),d=this.coordinates.length;this.appendFlatLineCoordinates(h,0,h.length,c,!1,!1);const f=[H.CIRCLE,d];this.instructions.push(un,f),this.hitDetectionInstructions.push(un,f),s.fillStyle!==void 0&&(this.instructions.push(to),this.hitDetectionInstructions.push(to)),s.strokeStyle!==void 0&&(this.instructions.push(zi),this.hitDetectionInstructions.push(zi)),this.endGeometry(e)}drawPolygon(t,e,n){const s=this.state,o=s.fillStyle,a=s.strokeStyle;if(o===void 0&&a===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([H.SET_FILL_STYLE,he]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([H.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,pi,yi]);const h=t.getEnds(),c=t.getOrientedFlatCoordinates(),d=t.getStride();this.drawFlatCoordinatess_(c,0,h,d),this.endGeometry(e)}drawMultiPolygon(t,e,n){const s=this.state,o=s.fillStyle,a=s.strokeStyle;if(o===void 0&&a===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([H.SET_FILL_STYLE,he]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([H.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,pi,yi]);const h=t.getEndss(),c=t.getOrientedFlatCoordinates(),d=t.getStride();let f=0;for(let _=0,p=h.length;_<p;++_)f=this.drawFlatCoordinatess_(c,f,h[_],d);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let n=0,s=e.length;n<s;++n)e[n]=rn(e[n],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}function w1(i,t,e,n,s){const o=[];let a=e,h=0,c=t.slice(e,2);for(;h<i&&a+s<n;){const[d,f]=c.slice(-2),_=t[a+s],p=t[a+s+1],y=Math.sqrt((_-d)*(_-d)+(p-f)*(p-f));if(h+=y,h>=i){const v=(i-h+y)/y,w=ge(d,_,v),C=ge(f,p,v);c.push(w,C),o.push(c),c=[w,C],h==i&&(a+=s),h=0}else if(h<i)c.push(t[a+s],t[a+s+1]),a+=s;else{const v=y-h,w=ge(d,_,v/y),C=ge(f,p,v/y);c.push(w,C),o.push(c),c=[w,C],h=0,a+=s}}return h>0&&o.push(c),o}function C1(i,t,e,n,s){let o=e,a=e,h=0,c=0,d=e,f,_,p,y,v,w,C,E,T,M;for(_=e;_<n;_+=s){const S=t[_],P=t[_+1];v!==void 0&&(T=S-v,M=P-w,y=Math.sqrt(T*T+M*M),C!==void 0&&(c+=p,f=Math.acos((C*T+E*M)/(p*y)),f>i&&(c>h&&(h=c,o=d,a=_),c=0,d=_-s)),p=y,C=T,E=M),v=S,w=P}return c+=y,c>h?[d,_]:[o,a]}const bo={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class E1 extends pr{constructor(t,e,n,s){super(t,e,n,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[he]={fillStyle:he},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,n){const s=this.textFillState_,o=this.textStrokeState_,a=this.textState_;if(this.text_===""||!a||!s&&!o)return;const h=this.coordinates;let c=h.length;const d=t.getType();let f=null,_=t.getStride();if(a.placement==="line"&&(d=="LineString"||d=="MultiLineString"||d=="Polygon"||d=="MultiPolygon")){if(!ee(this.maxExtent,t.getExtent()))return;let p;if(f=t.getFlatCoordinates(),d=="LineString")p=[f.length];else if(d=="MultiLineString")p=t.getEnds();else if(d=="Polygon")p=t.getEnds().slice(0,1);else if(d=="MultiPolygon"){const C=t.getEndss();p=[];for(let E=0,T=C.length;E<T;++E)p.push(C[E][0])}this.beginGeometry(t,e,n);const y=a.repeat,v=y?void 0:a.textAlign;let w=0;for(let C=0,E=p.length;C<E;++C){let T;y?T=w1(y*this.resolution,f,w,p[C],_):T=[f.slice(w,p[C])];for(let M=0,S=T.length;M<S;++M){const P=T[M];let A=0,D=P.length;if(v==null){const F=C1(a.maxAngle,P,0,P.length,2);A=F[0],D=F[1]}for(let F=A;F<D;F+=_)h.push(P[F],P[F+1]);const k=h.length;w=p[C],this.drawChars_(c,k),c=k}}this.endGeometry(e)}else{let p=a.overflow?null:[];switch(d){case"Point":case"MultiPoint":f=t.getFlatCoordinates();break;case"LineString":f=t.getFlatMidpoint();break;case"Circle":f=t.getCenter();break;case"MultiLineString":f=t.getFlatMidpoints(),_=2;break;case"Polygon":f=t.getFlatInteriorPoint(),a.overflow||p.push(f[2]/this.resolution),_=3;break;case"MultiPolygon":const S=t.getFlatInteriorPoints();f=[];for(let P=0,A=S.length;P<A;P+=3)a.overflow||p.push(S[P+2]/this.resolution),f.push(S[P],S[P+1]);if(f.length===0)return;_=2;break}const y=this.appendFlatPointCoordinates(f,_);if(y===c)return;if(p&&(y-c)/2!==f.length/_){let S=c/2;p=p.filter((P,A)=>{const D=h[(S+A)*2]===f[A*_]&&h[(S+A)*2+1]===f[A*_+1];return D||--S,D})}this.saveTextStates_();const v=a.backgroundFill?this.createFill(this.fillStyleToState(a.backgroundFill)):null,w=a.backgroundStroke?this.createStroke(this.strokeStyleToState(a.backgroundStroke)):null;this.beginGeometry(t,e,n);let C=a.padding;if(C!=cn&&(a.scale[0]<0||a.scale[1]<0)){let S=a.padding[0],P=a.padding[1],A=a.padding[2],D=a.padding[3];a.scale[0]<0&&(P=-P,D=-D),a.scale[1]<0&&(S=-S,A=-A),C=[S,P,A,D]}const E=this.pixelRatio;this.instructions.push([H.DRAW_IMAGE,c,y,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,C==cn?cn:C.map(function(S){return S*E}),v,w,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,p]);const T=1/E,M=v?v.slice(0):null;M&&(M[1]=he),this.hitDetectionInstructions.push([H.DRAW_IMAGE,c,y,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[T,T],NaN,this.declutterMode_,this.declutterImageWithText_,C,M,w,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?he:this.fillKey_,this.textOffsetX_,this.textOffsetY_,p]),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,n=this.textFillState_,s=this.strokeKey_;t&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const o=this.textKey_;o in this.textStates||(this.textStates[o]={font:e.font,textAlign:e.textAlign||ir,justify:e.justify,textBaseline:e.textBaseline||vo,scale:e.scale});const a=this.fillKey_;n&&(a in this.fillStates||(this.fillStates[a]={fillStyle:n.fillStyle}))}drawChars_(t,e){const n=this.textStrokeState_,s=this.textState_,o=this.strokeKey_,a=this.textKey_,h=this.fillKey_;this.saveTextStates_();const c=this.pixelRatio,d=bo[s.textBaseline],f=this.textOffsetY_*c,_=this.text_,p=n?n.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([H.DRAW_CHARS,t,e,d,s.overflow,h,s.maxAngle,c,f,o,p*c,_,a,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([H.DRAW_CHARS,t,e,d,s.overflow,h&&he,s.maxAngle,c,f,o,p*c,_,a,1/c,this.declutterMode_,this.textKeepUpright_])}setTextStyle(t,e){let n,s,o;if(!t)this.text_="";else{const a=t.getFill();a?(s=this.textFillState_,s||(s={},this.textFillState_=s),s.fillStyle=$e(a.getColor()||he)):(s=null,this.textFillState_=s);const h=t.getStroke();if(!h)o=null,this.textStrokeState_=o;else{o=this.textStrokeState_,o||(o={},this.textStrokeState_=o);const w=h.getLineDash(),C=h.getLineDashOffset(),E=h.getWidth(),T=h.getMiterLimit();o.lineCap=h.getLineCap()||rs,o.lineDash=w?w.slice():pi,o.lineDashOffset=C===void 0?yi:C,o.lineJoin=h.getLineJoin()||os,o.lineWidth=E===void 0?nr:E,o.miterLimit=T===void 0?tr:T,o.strokeStyle=$e(h.getColor()||er)}n=this.textState_;const c=t.getFont()||qd;s0(c);const d=t.getScaleArray();n.overflow=t.getOverflow(),n.font=c,n.maxAngle=t.getMaxAngle(),n.placement=t.getPlacement(),n.textAlign=t.getTextAlign(),n.repeat=t.getRepeat(),n.justify=t.getJustify(),n.textBaseline=t.getTextBaseline()||vo,n.backgroundFill=t.getBackgroundFill(),n.backgroundStroke=t.getBackgroundStroke(),n.padding=t.getPadding()||cn,n.scale=d===void 0?[1,1]:d;const f=t.getOffsetX(),_=t.getOffsetY(),p=t.getRotateWithView(),y=t.getKeepUpright(),v=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=f===void 0?0:f,this.textOffsetY_=_===void 0?0:_,this.textRotateWithView_=p===void 0?!1:p,this.textKeepUpright_=y===void 0?!0:y,this.textRotation_=v===void 0?0:v,this.strokeKey_=o?(typeof o.strokeStyle=="string"?o.strokeStyle:vt(o.strokeStyle))+o.lineCap+o.lineDashOffset+"|"+o.lineWidth+o.lineJoin+o.miterLimit+"["+o.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.repeat||"?")+(n.justify||"?")+(n.textBaseline||"?"),this.fillKey_=s&&s.fillStyle?typeof s.fillStyle=="string"?s.fillStyle:"|"+vt(s.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const b1={Circle:vu,Default:pr,Image:v1,LineString:x1,Polygon:vu,Text:E1};class T1{constructor(t,e,n,s){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=s,this.resolution_=n,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const n=this.buildersByZIndex_[e];for(const s in n){const o=n[s].finish();t[e][s]=o}}return t}getBuilder(t,e){const n=t!==void 0?t.toString():"0";let s=this.buildersByZIndex_[n];s===void 0&&(s={},this.buildersByZIndex_[n]=s);let o=s[e];if(o===void 0){const a=b1[e];o=new a(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[e]=o}return o}}function yh(i,t,e,n){let s=i[t],o=i[t+1],a=0;for(let h=t+n;h<e;h+=n){const c=i[h],d=i[h+1];a+=Math.sqrt((c-s)*(c-s)+(d-o)*(d-o)),s=c,o=d}return a}function L1(i,t,e,n,s,o,a,h,c,d,f,_,p=!0){let y=i[t],v=i[t+1],w=0,C=0,E=0,T=0;function M(){w=y,C=v,t+=n,y=i[t],v=i[t+1],T+=E,E=Math.sqrt((y-w)*(y-w)+(v-C)*(v-C))}do M();while(t<e-n&&T+E<o);let S=E===0?0:(o-T)/E;const P=ge(w,y,S),A=ge(C,v,S),D=t-n,k=T,F=o+h*c(d,s,f);for(;t<e-n&&T+E<F;)M();S=E===0?0:(F-T)/E;const B=ge(w,y,S),X=ge(C,v,S);let W=!1;if(p)if(_){const J=[P,A,B,X];Td(J,0,4,2,_,J,J),W=J[0]>J[2]}else W=P>B;const Y=Math.PI,Z=[],Q=D+n===t;t=D,E=0,T=k,y=i[t],v=i[t+1];let V;if(Q){M(),V=Math.atan2(v-C,y-w),W&&(V+=V>0?-Y:Y);const J=(B+P)/2,G=(X+A)/2;return Z[0]=[J,G,(F-o)/2,V,s],Z}s=s.replace(/\n/g," ");for(let J=0,G=s.length;J<G;){M();let ot=Math.atan2(v-C,y-w);if(W&&(ot+=ot>0?-Y:Y),V!==void 0){let tt=ot-V;if(tt+=tt>Y?-2*Y:tt<-Y?2*Y:0,Math.abs(tt)>a)return null}V=ot;const j=J;let $=0;for(;J<G;++J){const tt=W?G-J-1:J,it=h*c(d,s[tt],f);if(t+n<e&&T+E<o+$+it/2)break;$+=it}if(J===j)continue;const N=W?s.substring(G-j,G-J):s.substring(j,J);S=E===0?0:(o+$/2-T)/E;const pt=ge(w,y,S),dt=ge(C,v,S);Z.push([pt,dt,$/2,ot,N]),o+=$}return Z}const Wn=Le(),Ii=[],hi=[],ci=[],Ai=[];function xu(i){return i[3].declutterBox}const wu=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function Qa(i,t){return t==="start"?t=wu.test(i)?"right":"left":t==="end"&&(t=wu.test(i)?"left":"right"),bo[t]}function S1(i,t,e){return e>0&&i.push(`
`,""),i.push(t,""),i}function P1(i,t,e){return e%2===0&&(i+=t),i}class M1{constructor(t,e,n,s,o){this.overlaps=n,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=me(),this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=o?new uf:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,n,s){const o=t+e+n+s;if(this.labels_[o])return this.labels_[o];const a=s?this.strokeStates[s]:null,h=n?this.fillStates[n]:null,c=this.textStates[e],d=this.pixelRatio,f=[c.scale[0]*d,c.scale[1]*d],_=c.justify?bo[c.justify]:Qa(Array.isArray(t)?t[0]:t,c.textAlign||ir),p=s&&a.lineWidth?a.lineWidth:0,y=Array.isArray(t)?t:String(t).split(`
`).reduce(S1,[]),{width:v,height:w,widths:C,heights:E,lineWidths:T}=o0(c,y),M=v+p,S=[],P=(M+2)*f[0],A=(w+p)*f[1],D={width:P<0?Math.floor(P):Math.ceil(P),height:A<0?Math.floor(A):Math.ceil(A),contextInstructions:S};(f[0]!=1||f[1]!=1)&&S.push("scale",f),s&&(S.push("strokeStyle",a.strokeStyle),S.push("lineWidth",p),S.push("lineCap",a.lineCap),S.push("lineJoin",a.lineJoin),S.push("miterLimit",a.miterLimit),S.push("setLineDash",[a.lineDash]),S.push("lineDashOffset",a.lineDashOffset)),n&&S.push("fillStyle",h.fillStyle),S.push("textBaseline","middle"),S.push("textAlign","center");const k=.5-_;let F=_*M+k*p;const B=[],X=[];let W=0,Y=0,Z=0,Q=0,V;for(let J=0,G=y.length;J<G;J+=2){const ot=y[J];if(ot===`
`){Y+=W,W=0,F=_*M+k*p,++Q;continue}const j=y[J+1]||c.font;j!==V&&(s&&B.push("font",j),n&&X.push("font",j),V=j),W=Math.max(W,E[Z]);const $=[ot,F+k*C[Z]+_*(C[Z]-T[Q]),.5*(p+W)+Y];F+=C[Z],s&&B.push("strokeText",$),n&&X.push("fillText",$),++Z}return Array.prototype.push.apply(S,B),Array.prototype.push.apply(S,X),this.labels_[o]=D,D}replayTextBackground_(t,e,n,s,o,a,h){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,n),t.lineTo.apply(t,s),t.lineTo.apply(t,o),t.lineTo.apply(t,e),a&&(this.alignAndScaleFill_=a[2],t.fillStyle=a[1],this.fill_(t)),h&&(this.setStrokeStyle_(t,h),t.stroke())}calculateImageOrLabelDimensions_(t,e,n,s,o,a,h,c,d,f,_,p,y,v,w,C){h*=p[0],c*=p[1];let E=n-h,T=s-c;const M=o+d>t?t-d:o,S=a+f>e?e-f:a,P=v[3]+M*p[0]+v[1],A=v[0]+S*p[1]+v[2],D=E-v[3],k=T-v[0];(w||_!==0)&&(Ii[0]=D,Ai[0]=D,Ii[1]=k,hi[1]=k,hi[0]=D+P,ci[0]=hi[0],ci[1]=k+A,Ai[1]=ci[1]);let F;return _!==0?(F=Qe(me(),n,s,1,1,_,-n,-s),zt(F,Ii),zt(F,hi),zt(F,ci),zt(F,Ai),Wi(Math.min(Ii[0],hi[0],ci[0],Ai[0]),Math.min(Ii[1],hi[1],ci[1],Ai[1]),Math.max(Ii[0],hi[0],ci[0],Ai[0]),Math.max(Ii[1],hi[1],ci[1],Ai[1]),Wn)):Wi(Math.min(D,D+P),Math.min(k,k+A),Math.max(D,D+P),Math.max(k,k+A),Wn),y&&(E=Math.round(E),T=Math.round(T)),{drawImageX:E,drawImageY:T,drawImageW:M,drawImageH:S,originX:d,originY:f,declutterBox:{minX:Wn[0],minY:Wn[1],maxX:Wn[2],maxY:Wn[3],value:C},canvasTransform:F,scale:p}}replayImageOrLabel_(t,e,n,s,o,a,h){const c=!!(a||h),d=s.declutterBox,f=h?h[2]*s.scale[0]/2:0;return d.minX-f<=e[0]&&d.maxX+f>=0&&d.minY-f<=e[1]&&d.maxY+f>=0&&(c&&this.replayTextBackground_(t,Ii,hi,ci,Ai,a,h),a0(t,s.canvasTransform,o,n,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const n=zt(this.renderedTransform_,[0,0]),s=512*this.pixelRatio;t.save(),t.translate(n[0]%s,n[1]%s),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,n,s){const o=this.textStates[e],a=this.createLabel(t,e,s,n),h=this.strokeStates[n],c=this.pixelRatio,d=Qa(Array.isArray(t)?t[0]:t,o.textAlign||ir),f=bo[o.textBaseline||vo],_=h&&h.lineWidth?h.lineWidth:0,p=a.width/c-2*o.scale[0],y=d*p+2*(.5-d)*_,v=f*a.height/c+2*(.5-f)*_;return{label:a,anchorX:y,anchorY:v}}execute_(t,e,n,s,o,a,h,c){const d=this.zIndexContext_;let f;this.pixelCoordinates_&&Ui(n,this.renderedTransform_)?f=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),f=Gi(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),cm(this.renderedTransform_,n));let _=0;const p=s.length;let y=0,v,w,C,E,T,M,S,P,A,D,k,F,B,X=0,W=0;const Y=this.coordinateCache_,Z=this.viewRotation_,Q=Math.round(Math.atan2(-n[1],n[0])*1e12)/1e12,V={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:Z},J=this.instructions!=s||this.overlaps?0:200;let G,ot,j,$;for(;_<p;){const N=s[_];switch(N[0]){case H.BEGIN_GEOMETRY:G=N[1],$=N[3],G.getGeometry()?h!==void 0&&!ee(h,$.getExtent())?_=N[2]+1:++_:_=N[2],d&&(d.zIndex=N[4]);break;case H.BEGIN_PATH:X>J&&(this.fill_(t),X=0),W>J&&(t.stroke(),W=0),!X&&!W&&(t.beginPath(),T=NaN,M=NaN),++_;break;case H.CIRCLE:y=N[1];const dt=f[y],tt=f[y+1],it=f[y+2],bt=f[y+3],Nt=it-dt,ne=bt-tt,jt=Math.sqrt(Nt*Nt+ne*ne);t.moveTo(dt+jt,tt),t.arc(dt,tt,jt,0,2*Math.PI,!0),++_;break;case H.CLOSE_PATH:t.closePath(),++_;break;case H.CUSTOM:y=N[1],v=N[2];const wi=N[3],ti=N[4],ei=N[5];V.geometry=wi,V.feature=G,_ in Y||(Y[_]=[]);const ii=Y[_];ei?ei(f,y,v,2,ii):(ii[0]=f[y],ii[1]=f[y+1],ii.length=2),d&&(d.zIndex=N[6]),ti(ii,V),++_;break;case H.DRAW_IMAGE:y=N[1],v=N[2],A=N[3],w=N[4],C=N[5];let Jt=N[6];const de=N[7],Ze=N[8],Se=N[9],Vi=N[10];let Ge=N[11];const Be=N[12];let ni=N[13];E=N[14]||"declutter";const At=N[15];if(!A&&N.length>=20){D=N[19],k=N[20],F=N[21],B=N[22];const se=this.drawLabelWithPointPlacement_(D,k,F,B);A=se.label,N[3]=A;const si=N[23];w=(se.anchorX-si)*this.pixelRatio,N[4]=w;const re=N[24];C=(se.anchorY-re)*this.pixelRatio,N[5]=C,Jt=A.height,N[6]=Jt,ni=A.width,N[13]=ni}let us;N.length>25&&(us=N[25]);let ds,Ci,Ki;N.length>17?(ds=N[16],Ci=N[17],Ki=N[18]):(ds=cn,Ci=null,Ki=null),Vi&&Q?Ge+=Z:!Vi&&!Q&&(Ge-=Z);let vr=0;for(;y<v;y+=2){if(us&&us[vr++]<ni/this.pixelRatio)continue;const se=this.calculateImageOrLabelDimensions_(A.width,A.height,f[y],f[y+1],ni,Jt,w,C,Ze,Se,Ge,Be,o,ds,!!Ci||!!Ki,G),si=[t,e,A,se,de,Ci,Ki];if(c){let re,pe,Kt;if(At){const St=v-y;if(!At[St]){At[St]={args:si,declutterMode:E};continue}const Yt=At[St];re=Yt.args,pe=Yt.declutterMode,delete At[St],Kt=xu(re)}let Pe,Me;if(re&&(pe!=="declutter"||!c.collides(Kt))&&(Pe=!0),(E!=="declutter"||!c.collides(se.declutterBox))&&(Me=!0),pe==="declutter"&&E==="declutter"){const St=Pe&&Me;Pe=St,Me=St}Pe&&(pe!=="none"&&c.insert(Kt),this.replayImageOrLabel_.apply(this,re)),Me&&(E!=="none"&&c.insert(se.declutterBox),this.replayImageOrLabel_.apply(this,si))}else this.replayImageOrLabel_.apply(this,si)}++_;break;case H.DRAW_CHARS:const xr=N[1],fs=N[2],Tn=N[3],ea=N[4];B=N[5];const wr=N[6],Ln=N[7],gs=N[8];F=N[9];const _s=N[10];D=N[11],Array.isArray(D)&&(D=D.reduce(P1,"")),k=N[12];const Ei=[N[13],N[13]];E=N[14]||"declutter";const ia=N[15],ms=this.textStates[k],bi=ms.font,Ti=[ms.scale[0]*Ln,ms.scale[1]*Ln];let Li;bi in this.widths_?Li=this.widths_[bi]:(Li={},this.widths_[bi]=Li);const Cr=yh(f,xr,fs,2),Er=Math.abs(Ti[0])*iu(bi,D,Li);if(ea||Er<=Cr){const se=this.textStates[k].textAlign,si=(Cr-Er)*Qa(D,se),re=L1(f,xr,fs,2,D,si,wr,Math.abs(Ti[0]),iu,bi,Li,Q?0:this.viewRotation_,ia);t:if(re){const pe=[];let Kt,Pe,Me,St,Yt;if(F)for(Kt=0,Pe=re.length;Kt<Pe;++Kt){Yt=re[Kt],Me=Yt[4],St=this.createLabel(Me,k,"",F),w=Yt[2]+(Ti[0]<0?-_s:_s),C=Tn*St.height+(.5-Tn)*2*_s*Ti[1]/Ti[0]-gs;const kt=this.calculateImageOrLabelDimensions_(St.width,St.height,Yt[0],Yt[1],St.width,St.height,w,C,0,0,Yt[3],Ei,!1,cn,!1,G);if(c&&E==="declutter"&&c.collides(kt.declutterBox))break t;pe.push([t,e,St,kt,1,null,null])}if(B)for(Kt=0,Pe=re.length;Kt<Pe;++Kt){Yt=re[Kt],Me=Yt[4],St=this.createLabel(Me,k,B,""),w=Yt[2],C=Tn*St.height-gs;const kt=this.calculateImageOrLabelDimensions_(St.width,St.height,Yt[0],Yt[1],St.width,St.height,w,C,0,0,Yt[3],Ei,!1,cn,!1,G);if(c&&E==="declutter"&&c.collides(kt.declutterBox))break t;pe.push([t,e,St,kt,1,null,null])}c&&E!=="none"&&c.load(pe.map(xu));for(let kt=0,K=pe.length;kt<K;++kt)this.replayImageOrLabel_.apply(this,pe[kt])}}++_;break;case H.END_GEOMETRY:if(a!==void 0){G=N[1];const se=a(G,$,E);if(se)return se}++_;break;case H.FILL:J?X++:this.fill_(t),++_;break;case H.MOVE_TO_LINE_TO:for(y=N[1],v=N[2],ot=f[y],j=f[y+1],t.moveTo(ot,j),T=ot+.5|0,M=j+.5|0,y+=2;y<v;y+=2)ot=f[y],j=f[y+1],S=ot+.5|0,P=j+.5|0,(y==v-2||S!==T||P!==M)&&(t.lineTo(ot,j),T=S,M=P);++_;break;case H.SET_FILL_STYLE:this.alignAndScaleFill_=N[2],X&&(this.fill_(t),X=0,W&&(t.stroke(),W=0)),t.fillStyle=N[1],++_;break;case H.SET_STROKE_STYLE:W&&(t.stroke(),W=0),this.setStrokeStyle_(t,N),++_;break;case H.STROKE:J?W++:t.stroke(),++_;break;default:++_;break}}X&&this.fill_(t),W&&t.stroke()}execute(t,e,n,s,o,a){this.viewRotation_=s,this.execute_(t,e,n,this.instructions,o,void 0,void 0,a)}executeHitDetection(t,e,n,s,o){return this.viewRotation_=n,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,s,o)}}const Kn=["Polygon","Circle","LineString","Image","Text","Default"],vf=["Image","Text"],R1=Kn.filter(i=>!vf.includes(i));class I1{constructor(t,e,n,s,o,a,h){this.maxExtent_=t,this.overlaps_=s,this.pixelRatio_=n,this.resolution_=e,this.renderBuffer_=a,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=me(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(o,h)}clip(t,e){const n=this.getClipCoords(e);t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(n[2],n[3]),t.lineTo(n[4],n[5]),t.lineTo(n[6],n[7]),t.clip()}createExecutors_(t,e){for(const n in t){let s=this.executorsByZIndex_[n];s===void 0&&(s={},this.executorsByZIndex_[n]=s);const o=t[n];for(const a in o){const h=o[a];s[a]=new M1(this.resolution_,this.pixelRatio_,this.overlaps_,h,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const n=this.executorsByZIndex_[e];for(let s=0,o=t.length;s<o;++s)if(t[s]in n)return!0}return!1}forEachFeatureAtCoordinate(t,e,n,s,o,a){s=Math.round(s);const h=s*2+1,c=Qe(this.hitDetectionTransform_,s+.5,s+.5,1/e,-1/e,-n,-t[0],-t[1]),d=!this.hitDetectionContext_;d&&(this.hitDetectionContext_=Gt(h,h));const f=this.hitDetectionContext_;f.canvas.width!==h||f.canvas.height!==h?(f.canvas.width=h,f.canvas.height=h):d||f.clearRect(0,0,h,h);let _;this.renderBuffer_!==void 0&&(_=Le(),Ws(_,t),Il(_,e*(this.renderBuffer_+s),_));const p=A1(s);let y;function v(P,A,D){const k=f.getImageData(0,0,h,h).data;for(let F=0,B=p.length;F<B;F++)if(k[p[F]]>0){if(!a||D==="none"||y!=="Image"&&y!=="Text"||a.includes(P)){const X=(p[F]-3)/4,W=s-X%h,Y=s-(X/h|0),Z=o(P,A,W*W+Y*Y);if(Z)return Z}f.clearRect(0,0,h,h);break}}const w=Object.keys(this.executorsByZIndex_).map(Number);w.sort(mi);let C,E,T,M,S;for(C=w.length-1;C>=0;--C){const P=w[C].toString();for(T=this.executorsByZIndex_[P],E=Kn.length-1;E>=0;--E)if(y=Kn[E],M=T[y],M!==void 0&&(S=M.executeHitDetection(f,c,n,v,_),S))return S}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const n=e[0],s=e[1],o=e[2],a=e[3],h=[n,s,n,a,o,a,o,s];return Gi(h,0,8,2,t,h),h}isEmpty(){return mn(this.executorsByZIndex_)}execute(t,e,n,s,o,a,h){const c=Object.keys(this.executorsByZIndex_).map(Number);c.sort(h?h_:mi),a=a||Kn;const d=Kn.length;for(let f=0,_=c.length;f<_;++f){const p=c[f].toString(),y=this.executorsByZIndex_[p];for(let v=0,w=a.length;v<w;++v){const C=a[v],E=y[C];if(E!==void 0){const T=h===null?void 0:E.getZIndexContext(),M=T?T.getContext():t,S=this.maxExtent_&&C!=="Image"&&C!=="Text";if(S&&(M.save(),this.clip(M,n)),!T||C==="Text"||C==="Image"?E.execute(M,e,n,s,o,h):T.pushFunction(P=>E.execute(P,e,n,s,o,h)),S&&M.restore(),T){T.offset();const P=c[f]*d+v;this.deferredZIndexContexts_[P]||(this.deferredZIndexContexts_[P]=[]),this.deferredZIndexContexts_[P].push(T)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(mi);for(let n=0,s=e.length;n<s;++n)t[e[n]].forEach(o=>{o.draw(this.renderedContext_),o.clear()}),t[e[n]].length=0}}const tl={};function A1(i){if(tl[i]!==void 0)return tl[i];const t=i*2+1,e=i*i,n=new Array(e+1);for(let o=0;o<=i;++o)for(let a=0;a<=i;++a){const h=o*o+a*a;if(h>e)break;let c=n[h];c||(c=[],n[h]=c),c.push(((i+o)*t+(i+a))*4+3),o>0&&c.push(((i-o)*t+(i+a))*4+3),a>0&&(c.push(((i+o)*t+(i-a))*4+3),o>0&&c.push(((i-o)*t+(i-a))*4+3))}const s=[];for(let o=0,a=n.length;o<a;++o)n[o]&&s.push(...n[o]);return tl[i]=s,s}class O1 extends yf{constructor(t,e,n,s,o,a,h){super(),this.context_=t,this.pixelRatio_=e,this.extent_=n,this.transform_=s,this.transformRotation_=s?zo(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=o,this.squaredTolerance_=a,this.userTransform_=h,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=me()}drawImages_(t,e,n,s){if(!this.image_)return;const o=Gi(t,e,n,s,this.transform_,this.pixelCoordinates_),a=this.context_,h=this.tmpLocalTransform_,c=a.globalAlpha;this.imageOpacity_!=1&&(a.globalAlpha=c*this.imageOpacity_);let d=this.imageRotation_;this.transformRotation_===0&&(d-=this.viewRotation_),this.imageRotateWithView_&&(d+=this.viewRotation_);for(let f=0,_=o.length;f<_;f+=2){const p=o[f]-this.imageAnchorX_,y=o[f+1]-this.imageAnchorY_;if(d!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const v=p+this.imageAnchorX_,w=y+this.imageAnchorY_;Qe(h,v,w,1,1,d,-v,-w),a.save(),a.transform.apply(a,h),a.translate(v,w),a.scale(this.imageScale_[0],this.imageScale_[1]),a.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),a.restore()}else a.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,p,y,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(a.globalAlpha=c)}drawText_(t,e,n,s){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const o=Gi(t,e,n,s,this.transform_,this.pixelCoordinates_),a=this.context_;let h=this.textRotation_;for(this.transformRotation_===0&&(h-=this.viewRotation_),this.textRotateWithView_&&(h+=this.viewRotation_);e<n;e+=s){const c=o[e]+this.textOffsetX_,d=o[e+1]+this.textOffsetY_;h!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(a.save(),a.translate(c-this.textOffsetX_,d-this.textOffsetY_),a.rotate(h),a.translate(this.textOffsetX_,this.textOffsetY_),a.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&a.strokeText(this.text_,0,0),this.textFillState_&&a.fillText(this.text_,0,0),a.restore()):(this.textStrokeState_&&a.strokeText(this.text_,c,d),this.textFillState_&&a.fillText(this.text_,c,d))}}moveToLineTo_(t,e,n,s,o){const a=this.context_,h=Gi(t,e,n,s,this.transform_,this.pixelCoordinates_);a.moveTo(h[0],h[1]);let c=h.length;o&&(c-=2);for(let d=2;d<c;d+=2)a.lineTo(h[d],h[d+1]);return o&&a.closePath(),n}drawRings_(t,e,n,s){for(let o=0,a=n.length;o<a;++o)e=this.moveToLineTo_(t,e,n[o],s,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ee(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=pm(t,this.transform_,this.pixelCoordinates_),n=e[2]-e[0],s=e[3]-e[1],o=Math.sqrt(n*n+s*s),a=this.context_;a.beginPath(),a.arc(e[0],e[1],o,0,2*Math.PI),this.fillState_&&a.fill(),this.strokeState_&&a.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const n=e.getGeometryFunction()(t);n&&(this.setStyle(e),this.drawGeometry(n))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let n=0,s=e.length;n<s;++n)this.drawGeometry(e[n])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ee(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(ee(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const n=this.context_,s=t.getFlatCoordinates();let o=0;const a=t.getEnds(),h=t.getStride();n.beginPath();for(let c=0,d=a.length;c<d;++c)o=this.moveToLineTo_(s,o,a[c],h,!1);n.stroke()}if(this.text_!==""){const n=t.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ee(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ee(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getOrientedFlatCoordinates();let s=0;const o=t.getEndss(),a=t.getStride();e.beginPath();for(let h=0,c=o.length;h<c;++h){const d=o[h];s=this.drawRings_(n,s,d,a)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,e.lineCap=t.lineCap),Ui(n.lineDash,t.lineDash)||e.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,n=this.contextTextState_,s=t.textAlign?t.textAlign:ir;n?(n.font!=t.font&&(n.font=t.font,e.font=t.font),n.textAlign!=s&&(n.textAlign=s,e.textAlign=s),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=s,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:s,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const n=t.getColor();this.fillState_={fillStyle:$e(n||he)}}if(!e)this.strokeState_=null;else{const n=e.getColor(),s=e.getLineCap(),o=e.getLineDash(),a=e.getLineDashOffset(),h=e.getLineJoin(),c=e.getWidth(),d=e.getMiterLimit(),f=o||pi;this.strokeState_={lineCap:s!==void 0?s:rs,lineDash:this.pixelRatio_===1?f:f.map(_=>_*this.pixelRatio_),lineDashOffset:(a||yi)*this.pixelRatio_,lineJoin:h!==void 0?h:os,lineWidth:(c!==void 0?c:nr)*this.pixelRatio_,miterLimit:d!==void 0?d:tr,strokeStyle:$e(n||er)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const n=t.getPixelRatio(this.pixelRatio_),s=t.getAnchor(),o=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*n,this.imageAnchorY_=s[1]*n,this.imageHeight_=e[1]*n,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=o[0],this.imageOriginY_=o[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const a=t.getScaleArray();this.imageScale_=[a[0]*this.pixelRatio_/n,a[1]*this.pixelRatio_/n],this.imageWidth_=e[0]*n}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const y=e.getColor();this.textFillState_={fillStyle:$e(y||he)}}const n=t.getStroke();if(!n)this.textStrokeState_=null;else{const y=n.getColor(),v=n.getLineCap(),w=n.getLineDash(),C=n.getLineDashOffset(),E=n.getLineJoin(),T=n.getWidth(),M=n.getMiterLimit();this.textStrokeState_={lineCap:v!==void 0?v:rs,lineDash:w||pi,lineDashOffset:C||yi,lineJoin:E!==void 0?E:os,lineWidth:T!==void 0?T:nr,miterLimit:M!==void 0?M:tr,strokeStyle:$e(y||er)}}const s=t.getFont(),o=t.getOffsetX(),a=t.getOffsetY(),h=t.getRotateWithView(),c=t.getRotation(),d=t.getScaleArray(),f=t.getText(),_=t.getTextAlign(),p=t.getTextBaseline();this.textState_={font:s!==void 0?s:qd,textAlign:_!==void 0?_:ir,textBaseline:p!==void 0?p:vo},this.text_=f!==void 0?Array.isArray(f)?f.reduce((y,v,w)=>y+=w%2?" ":v,""):f:"",this.textOffsetX_=o!==void 0?this.pixelRatio_*o:0,this.textOffsetY_=a!==void 0?this.pixelRatio_*a:0,this.textRotateWithView_=h!==void 0?h:!1,this.textRotation_=c!==void 0?c:0,this.textScale_=[this.pixelRatio_*d[0],this.pixelRatio_*d[1]]}}}const Ve=.5;function k1(i,t,e,n,s,o,a,h,c){const d=s,f=i[0]*Ve,_=i[1]*Ve,p=Gt(f,_);p.imageSmoothingEnabled=!1;const y=p.canvas,v=new O1(p,Ve,s,null,a,h,null),w=e.length,C=Math.floor((256*256*256-1)/w),E={};for(let M=1;M<=w;++M){const S=e[M-1],P=S.getStyleFunction()||n;if(!P)continue;let A=P(S,o);if(!A)continue;Array.isArray(A)||(A=[A]);const k=(M*C).toString(16).padStart(7,"#00000");for(let F=0,B=A.length;F<B;++F){const X=A[F],W=X.getGeometryFunction()(S);if(!W||!ee(d,W.getExtent()))continue;const Y=X.clone(),Z=Y.getFill();Z&&Z.setColor(k);const Q=Y.getStroke();Q&&(Q.setColor(k),Q.setLineDash(null)),Y.setText(void 0);const V=X.getImage();if(V){const j=V.getImageSize();if(!j)continue;const $=Gt(j[0],j[1],void 0,{alpha:!1}),N=$.canvas;$.fillStyle=k,$.fillRect(0,0,N.width,N.height),Y.setImage(new _r({img:N,anchor:V.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:V.getOrigin(),opacity:1,size:V.getSize(),scale:V.getScale(),rotation:V.getRotation(),rotateWithView:V.getRotateWithView()}))}const J=Y.getZIndex()||0;let G=E[J];G||(G={},E[J]=G,G.Polygon=[],G.Circle=[],G.LineString=[],G.Point=[]);const ot=W.getType();if(ot==="GeometryCollection"){const j=W.getGeometriesArrayRecursive();for(let $=0,N=j.length;$<N;++$){const pt=j[$];G[pt.getType().replace("Multi","")].push(pt,Y)}}else G[ot.replace("Multi","")].push(W,Y)}}const T=Object.keys(E).map(Number).sort(mi);for(let M=0,S=T.length;M<S;++M){const P=E[T[M]];for(const A in P){const D=P[A];for(let k=0,F=D.length;k<F;k+=2){v.setStyle(D[k+1]);for(let B=0,X=t.length;B<X;++B)v.setTransform(t[B]),v.drawGeometry(D[k])}}}return p.getImageData(0,0,y.width,y.height)}function D1(i,t,e){const n=[];if(e){const s=Math.floor(Math.round(i[0])*Ve),o=Math.floor(Math.round(i[1])*Ve),a=(Mt(s,0,e.width-1)+Mt(o,0,e.height-1)*e.width)*4,h=e.data[a],c=e.data[a+1],f=e.data[a+2]+256*(c+256*h),_=Math.floor((256*256*256-1)/t.length);f&&f%_===0&&n.push(t[f/_-1])}return n}const F1=.5,xf={Point:j1,LineString:B1,Polygon:U1,MultiPoint:Y1,MultiLineString:W1,MultiPolygon:X1,GeometryCollection:G1,Circle:N1};function z1(i,t){return parseInt(vt(i),10)-parseInt(vt(t),10)}function Cu(i,t){const e=wf(i,t);return e*e}function wf(i,t){return F1*i/t}function N1(i,t,e,n,s){const o=e.getFill(),a=e.getStroke();if(o||a){const c=i.getBuilder(e.getZIndex(),"Circle");c.setFillStrokeStyle(o,a),c.drawCircle(t,n,s)}const h=e.getText();if(h&&h.getText()){const c=i.getBuilder(e.getZIndex(),"Text");c.setTextStyle(h),c.drawText(t,n)}}function Eu(i,t,e,n,s,o,a,h){const c=[],d=e.getImage();if(d){let p=!0;const y=d.getImageState();y==ct.LOADED||y==ct.ERROR?p=!1:y==ct.IDLE&&d.load(),p&&c.push(d.ready())}const f=e.getFill();f&&f.loading()&&c.push(f.ready());const _=c.length>0;return _&&Promise.all(c).then(()=>s(null)),Z1(i,t,e,n,o,a,h),_}function Z1(i,t,e,n,s,o,a){const h=e.getGeometryFunction()(t);if(!h)return;const c=h.simplifyTransformed(n,s);if(e.getRenderer())Cf(i,c,e,t,a);else{const f=xf[c.getType()];f(i,c,e,t,a,o)}}function Cf(i,t,e,n,s){if(t.getType()=="GeometryCollection"){const a=t.getGeometries();for(let h=0,c=a.length;h<c;++h)Cf(i,a[h],e,n,s);return}i.getBuilder(e.getZIndex(),"Default").drawCustom(t,n,e.getRenderer(),e.getHitDetectionRenderer(),s)}function G1(i,t,e,n,s,o){const a=t.getGeometriesArray();let h,c;for(h=0,c=a.length;h<c;++h){const d=xf[a[h].getType()];d(i,a[h],e,n,s,o)}}function B1(i,t,e,n,s){const o=e.getStroke();if(o){const h=i.getBuilder(e.getZIndex(),"LineString");h.setFillStrokeStyle(null,o),h.drawLineString(t,n,s)}const a=e.getText();if(a&&a.getText()){const h=i.getBuilder(e.getZIndex(),"Text");h.setTextStyle(a),h.drawText(t,n,s)}}function W1(i,t,e,n,s){const o=e.getStroke();if(o){const h=i.getBuilder(e.getZIndex(),"LineString");h.setFillStrokeStyle(null,o),h.drawMultiLineString(t,n,s)}const a=e.getText();if(a&&a.getText()){const h=i.getBuilder(e.getZIndex(),"Text");h.setTextStyle(a),h.drawText(t,n,s)}}function X1(i,t,e,n,s){const o=e.getFill(),a=e.getStroke();if(a||o){const c=i.getBuilder(e.getZIndex(),"Polygon");c.setFillStrokeStyle(o,a),c.drawMultiPolygon(t,n,s)}const h=e.getText();if(h&&h.getText()){const c=i.getBuilder(e.getZIndex(),"Text");c.setTextStyle(h),c.drawText(t,n,s)}}function j1(i,t,e,n,s,o){const a=e.getImage(),h=e.getText(),c=h&&h.getText(),d=o&&a&&c?{}:void 0;if(a){if(a.getImageState()!=ct.LOADED)return;const f=i.getBuilder(e.getZIndex(),"Image");f.setImageStyle(a,d),f.drawPoint(t,n,s)}if(c){const f=i.getBuilder(e.getZIndex(),"Text");f.setTextStyle(h,d),f.drawText(t,n,s)}}function Y1(i,t,e,n,s,o){const a=e.getImage(),h=a&&a.getOpacity()!==0,c=e.getText(),d=c&&c.getText(),f=o&&h&&d?{}:void 0;if(h){if(a.getImageState()!=ct.LOADED)return;const _=i.getBuilder(e.getZIndex(),"Image");_.setImageStyle(a,f),_.drawMultiPoint(t,n,s)}if(d){const _=i.getBuilder(e.getZIndex(),"Text");_.setTextStyle(c,f),_.drawText(t,n,s)}}function U1(i,t,e,n,s){const o=e.getFill(),a=e.getStroke();if(o||a){const c=i.getBuilder(e.getZIndex(),"Polygon");c.setFillStrokeStyle(o,a),c.drawPolygon(t,n,s)}const h=e.getText();if(h&&h.getText()){const c=i.getBuilder(e.getZIndex(),"Text");c.setTextStyle(h),c.drawText(t,n,s)}}class V1 extends _h{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Le(),this.wrappedRenderedExtent_=Le(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,n){const s=e.extent,o=e.viewState,a=o.center,h=o.resolution,c=o.projection,d=o.rotation,f=c.getExtent(),_=this.getLayer().getSource(),p=this.getLayer().getDeclutter(),y=e.pixelRatio,v=e.viewHints,w=!(v[qt.ANIMATING]||v[qt.INTERACTING]),C=this.context,E=Math.round(Ct(s)/h*y),T=Math.round(ie(s)/h*y),M=_.getWrapX()&&c.canWrapX(),S=M?Ct(f):null,P=M?Math.ceil((s[2]-f[2])/S)+1:1;let A=M?Math.floor((s[0]-f[0])/S):0;do{let D=this.getRenderTransform(a,h,0,y,E,T,A*S);e.declutter&&(D=D.slice(0)),t.execute(C,[C.canvas.width,C.canvas.height],D,d,w,n===void 0?Kn:n?vf:R1,n?p&&e.declutter[p]:void 0)}while(++A<P)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=Gt(this.context.canvas.width,this.context.canvas.height,gu))}resetDrawContext_(){if(this.opacity_!==1){const t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,Vo(this.context),gu.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(t,e){const n=t.layerStatesArray[t.layerIndex];this.opacity_=n.opacity;const s=t.viewState;this.prepareContainer(t,e);const o=this.context,a=this.replayGroup_;let h=a&&!a.isEmpty();if(!h&&!(this.getLayer().hasListener(Ce.PRERENDER)||this.getLayer().hasListener(Ce.POSTRENDER)))return this.container;if(this.setDrawContext_(),this.preRender(o,t),s.projection,this.clipped_=!1,h&&n.extent&&this.clipping){const c=He(n.extent);h=ee(c,t.extent),this.clipped_=h&&!an(c,t.extent),this.clipped_&&this.clipUnrotated(o,t,c)}return h&&this.renderWorlds(a,t,this.getLayer().getDeclutter()?!1:void 0),!t.declutter&&this.clipped_&&o.restore(),this.postRender(o,t),this.renderedRotation_!==s.rotation&&(this.renderedRotation_=s.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(e=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const n=this.frameState.size.slice(),s=this.renderedCenter_,o=this.renderedResolution_,a=this.renderedRotation_,h=this.renderedProjection_,c=this.wrappedRenderedExtent_,d=this.getLayer(),f=[],_=n[0]*Ve,p=n[1]*Ve;f.push(this.getRenderTransform(s,o,a,Ve,_,p,0).slice());const y=d.getSource(),v=h.getExtent();if(y.getWrapX()&&h.canWrapX()&&!an(v,c)){let w=c[0];const C=Ct(v);let E=0,T;for(;w<v[0];)--E,T=C*E,f.push(this.getRenderTransform(s,o,a,Ve,_,p,T).slice()),w+=C;for(E=0,w=c[2];w>v[2];)++E,T=C*E,f.push(this.getRenderTransform(s,o,a,Ve,_,p,T).slice()),w-=C}this.hitDetectionImageData_=k1(n,f,this.renderedFeatures_,d.getStyleFunction(),c,o,a,Cu(o,this.renderedPixelRatio_))}e(D1(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,n,s,o){var p,y;if(!this.replayGroup_)return;const a=e.viewState.resolution,h=e.viewState.rotation,c=this.getLayer(),d={},f=function(v,w,C){const E=vt(v),T=d[E];if(T){if(T!==!0&&C<T.distanceSq){if(C===0)return d[E]=!0,o.splice(o.lastIndexOf(T),1),s(v,c,w);T.geometry=w,T.distanceSq=C}}else{if(C===0)return d[E]=!0,s(v,c,w);o.push(d[E]={feature:v,layer:c,geometry:w,distanceSq:C,callback:s})}},_=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(t,a,h,n,f,_?(y=(p=e.declutter)==null?void 0:p[_])==null?void 0:y.all().map(v=>v.value):null)}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),n=e.getSource();if(!n)return!1;const s=t.viewHints[qt.ANIMATING],o=t.viewHints[qt.INTERACTING],a=e.getUpdateWhileAnimating(),h=e.getUpdateWhileInteracting();if(this.ready&&!a&&s||!h&&o)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const c=t.extent,d=t.viewState,f=d.projection,_=d.resolution,p=t.pixelRatio,y=e.getRevision(),v=e.getRenderBuffer();let w=e.getRenderOrder();w===void 0&&(w=z1);const C=d.center.slice(),E=Il(c,v*_),T=E.slice(),M=[E.slice()],S=f.getExtent();if(n.getWrapX()&&f.canWrapX()&&!an(S,t.extent)){const Z=Ct(S),Q=Math.max(Ct(E)/2,Z);E[0]=S[0]-Q,E[2]=S[2]+Q,gd(C,f);const V=dd(M[0],f);V[0]<S[0]&&V[2]<S[2]?M.push([V[0]+Z,V[1],V[2]+Z,V[3]]):V[0]>S[0]&&V[2]>S[2]&&M.push([V[0]-Z,V[1],V[2]-Z,V[3]])}if(this.ready&&this.renderedResolution_==_&&this.renderedRevision_==y&&this.renderedRenderOrder_==w&&this.renderedFrameDeclutter_===!!t.declutter&&an(this.wrappedRenderedExtent_,E))return Ui(this.renderedExtent_,T)||(this.hitDetectionImageData_=null,this.renderedExtent_=T),this.renderedCenter_=C,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const P=new T1(wf(_,p),E,_,p);let A;for(let Z=0,Q=M.length;Z<Q;++Z)n.loadFeatures(M[Z],_,f);const D=Cu(_,p);let k=!0;const F=(Z,Q)=>{let V;const J=Z.getStyleFunction()||e.getStyleFunction();if(J&&(V=J(Z,_)),V){const G=this.renderFeature(Z,D,V,P,A,this.getLayer().getDeclutter(),Q);k=k&&!G}},B=Ed(E),X=n.getFeaturesInExtent(B);w&&X.sort(w);for(let Z=0,Q=X.length;Z<Q;++Z)F(X[Z],Z);this.renderedFeatures_=X,this.ready=k;const W=P.finish(),Y=new I1(E,_,p,n.getOverlaps(),W,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=_,this.renderedRevision_=y,this.renderedRenderOrder_=w,this.renderedFrameDeclutter_=!!t.declutter,this.renderedExtent_=T,this.wrappedRenderedExtent_=E,this.renderedCenter_=C,this.renderedProjection_=f,this.renderedPixelRatio_=p,this.replayGroup_=Y,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,n,s,o,a,h){if(!n)return!1;let c=!1;if(Array.isArray(n))for(let d=0,f=n.length;d<f;++d)c=Eu(s,t,n[d],e,this.boundHandleStyleImageChange_,o,a,h)||c;else c=Eu(s,t,n,e,this.boundHandleStyleImageChange_,o,a,h);return c}}class K1 extends rf{constructor(t){super(t)}createRenderer(){return new V1(this)}}let H1=!1;function $1(i,t,e,n,s,o,a){const h=new XMLHttpRequest;h.open("GET",typeof i=="function"?i(e,n,s):i,!0),t.getType()=="arraybuffer"&&(h.responseType="arraybuffer"),h.withCredentials=H1,h.onload=function(c){if(!h.status||h.status>=200&&h.status<300){const d=t.getType();try{let f;d=="text"||d=="json"?f=h.responseText:d=="xml"?f=h.responseXML||h.responseText:d=="arraybuffer"&&(f=h.response),f?o(t.readFeatures(f,{extent:e,featureProjection:s}),t.readProjection(f)):a()}catch{a()}}else a()},h.onerror=a,h.send()}function bu(i,t){return function(e,n,s,o,a){$1(i,t,e,n,s,(h,c)=>{this.addFeatures(h),o!==void 0&&o(h)},()=>{this.changed(),a!==void 0&&a()})}}function q1(i,t){return[[-1/0,-1/0,1/0,1/0]]}class Qo extends Ne{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new Qo(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const n=this.getStyle();return n&&t.setStyle(n),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Lt(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=_t(t,rt.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?J1(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function J1(i){if(typeof i=="function")return i;let t;return Array.isArray(i)?t=i:(xt(typeof i.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[i]),function(){return t}}function Ef(i,t,e,n){const s=[];let o=Le();for(let a=0,h=e.length;a<h;++a){const c=e[a];o=Ol(i,t,c[0],n),s.push((o[0]+o[2])/2,(o[1]+o[3])/2),t=c[c.length-1]}return s}function To(i,t,e,n,s,o,a){let h,c;const d=(e-t)/n;if(d===1)h=t;else if(d===2)h=t,c=s;else if(d!==0){let f=i[t],_=i[t+1],p=0;const y=[0];for(let C=t+n;C<e;C+=n){const E=i[C],T=i[C+1];p+=Math.sqrt((E-f)*(E-f)+(T-_)*(T-_)),y.push(p),f=E,_=T}const v=s*p,w=l_(y,v);w<0?(c=(v-y[-w-2])/(y[-w-1]-y[-w-2]),h=t+(-w-2)*n):h=t+w*n}a=a>1?a:2,o=o||new Array(a);for(let f=0;f<a;++f)o[f]=h===void 0?NaN:c===void 0?i[h+f]:ge(i[h+f],i[h+n+f],c);return o}function Tl(i,t,e,n,s,o){if(e==t)return null;let a;if(s<i[t+n-1])return o?(a=i.slice(t,t+n),a[n-1]=s,a):null;if(i[e-1]<s)return o?(a=i.slice(e-n,e),a[n-1]=s,a):null;if(s==i[t+n-1])return i.slice(t,t+n);let h=t/n,c=e/n;for(;h<c;){const p=h+c>>1;s<i[(p+1)*n-1]?c=p:h=p+1}const d=i[h*n-1];if(s==d)return i.slice((h-1)*n,(h-1)*n+n);const f=i[(h+1)*n-1],_=(s-d)/(f-d);a=[];for(let p=0;p<n-1;++p)a.push(ge(i[(h-1)*n+p],i[h*n+p],_));return a.push(s),a}function Q1(i,t,e,n,s,o,a){if(a)return Tl(i,t,e[e.length-1],n,s,o);let h;if(s<i[n-1])return o?(h=i.slice(0,n),h[n-1]=s,h):null;if(i[i.length-1]<s)return o?(h=i.slice(i.length-n),h[n-1]=s,h):null;for(let c=0,d=e.length;c<d;++c){const f=e[c];if(t!=f){if(s<i[t+n-1])return null;if(s<=i[f-1])return Tl(i,t,f,n,s,!1);t=f}}return null}class Lo extends Ld{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(Lt),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const t=this.geometries_;for(let e=0,n=t.length;e<n;++e)this.changeEventsKeys_.push(_t(t[e],rt.CHANGE,this.changed,this))}clone(){const t=new Lo(el(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,n,s){if(s<xn(this.getExtent(),t,e))return s;const o=this.geometries_;for(let a=0,h=o.length;a<h;++a)s=o[a].closestPointXY(t,e,n,s);return s}containsXY(t,e){const n=this.geometries_;for(let s=0,o=n.length;s<o;++s)if(n[s].containsXY(t,e))return!0;return!1}computeExtent(t){lr(t);const e=this.geometries_;for(let n=0,s=e.length;n<s;++n)ld(t,e[n].getExtent());return t}getGeometries(){return el(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let n=0,s=e.length;n<s;++n)e[n].getType()===this.getType()?t=t.concat(e[n].getGeometriesArrayRecursive()):t.push(e[n]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],n=this.geometries_;let s=!1;for(let o=0,a=n.length;o<a;++o){const h=n[o],c=h.getSimplifiedGeometry(t);e.push(c),c!==h&&(s=!0)}return s?new Lo(e):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let n=0,s=e.length;n<s;++n)if(e[n].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const n=this.geometries_;for(let s=0,o=n.length;s<o;++s)n[s].rotate(t,e);this.changed()}scale(t,e,n){n||(n=Xi(this.getExtent()));const s=this.geometries_;for(let o=0,a=s.length;o<a;++o)s[o].scale(t,e,n);this.changed()}setGeometries(t){this.setGeometriesArray(el(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let n=0,s=e.length;n<s;++n)e[n].applyTransform(t);this.changed()}translate(t,e){const n=this.geometries_;for(let s=0,o=n.length;s<o;++s)n[s].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function el(i){return i.map(t=>t.clone())}class as extends Cn{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){qe(this.flatCoordinates,t),this.changed()}clone(){const t=new as(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,s){return s<xn(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Xl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Yl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,n,s))}forEachSegment(t){return Ad(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,Tl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return Fi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return To(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return yh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=jo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new as(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return Yo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,this.getExtent())}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Xo(this.flatCoordinates,0,t,this.stride),this.changed()}}class So extends Cn{constructor(t,e,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&n)this.setFlatCoordinates(e,t),this.ends_=n;else{const s=t,o=[],a=[];for(let c=0,d=s.length;c<d;++c){const f=s[c];qe(o,f.getFlatCoordinates()),a.push(o.length)}const h=s.length===0?this.getLayout():s[0].getLayout();this.setFlatCoordinates(h,o),this.ends_=a}}appendLineString(t){qe(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new So(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,s){return s<xn(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(jl(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ul(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,n,s))}getCoordinateAtM(t,e,n){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,n=n!==void 0?n:!1,Q1(this.flatCoordinates,0,this.ends_,this.stride,t,e,n))}getCoordinates(){return Js(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new as(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,n=this.layout,s=[];let o=0;for(let a=0,h=e.length;a<h;++a){const c=e[a],d=new as(t.slice(o,c),n);s.push(d),o=c}return s}getLength(){const t=this.ends_;let e=0,n=0;for(let s=0,o=t.length;s<o;++s)n+=yh(this.flatCoordinates,e,t[s],this.stride),e=t[s];return n}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let n=0;const s=this.ends_,o=this.stride;for(let a=0,h=s.length;a<h;++a){const c=s[a],d=To(e,n,c,o,.5);qe(t,d),n=c}return t}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=Rd(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,n),new So(e,"XY",n)}getType(){return"MultiLineString"}intersectsExtent(t){return Lm(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=ur(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}class ta extends Cn{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){qe(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new ta(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,s){if(s<xn(this.getExtent(),t,e))return s;const o=this.flatCoordinates,a=this.stride;for(let h=0,c=o.length;h<c;h+=a){const d=dn(t,e,o[h],o[h+1]);if(d<s){s=d;for(let f=0;f<a;++f)n[f]=o[h+f];n.length=a}}return s}getCoordinates(){return Fi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new ns(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,n=this.stride,s=[];for(let o=0,a=t.length;o<a;o+=n){const h=new ns(t.slice(o,o+n),e);s.push(h)}return s}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,n=this.stride;for(let s=0,o=e.length;s<o;s+=n){const a=e[s],h=e[s+1];if(Al(t,a,h))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Xo(this.flatCoordinates,0,t,this.stride),this.changed()}}class Po extends Cn{constructor(t,e,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(t[0])){const s=t,o=[],a=[];for(let h=0,c=s.length;h<c;++h){const d=s[h],f=o.length,_=d.getEnds();for(let p=0,y=_.length;p<y;++p)_[p]+=f;qe(o,d.getFlatCoordinates()),a.push(_)}e=s.length===0?this.getLayout():s[0].getLayout(),t=o,n=a}e!==void 0&&n?(this.setFlatCoordinates(e,t),this.endss_=n):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const n=this.flatCoordinates.length;qe(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let s=0,o=e.length;s<o;++s)e[s]+=n}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let s=0;s<t;++s)e[s]=this.endss_[s].slice();const n=new Po(this.flatCoordinates.slice(),this.layout,e);return n.applyProperties(this),n}closestPointXY(t,e,n,s){return s<xn(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(vm(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),xm(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,n,s))}containsXY(t,e){return Tm(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return ym(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),yl(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,pl(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=Ef(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Id(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new ta(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Dd(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=yl(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=Em(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,n),new Po(e,"XY",n)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const o=this.endss_[t-1];e=o[o.length-1]}const n=this.endss_[t].slice(),s=n[n.length-1];if(e!==0)for(let o=0,a=n.length;o<a;++o)n[o]-=e;return new ji(this.flatCoordinates.slice(e,s),this.layout,n)}getPolygons(){const t=this.layout,e=this.flatCoordinates,n=this.endss_,s=[];let o=0;for(let a=0,h=n.length;a<h;++a){const c=n[a].slice(),d=c[c.length-1];if(o!==0)for(let _=0,p=c.length;_<p;++_)c[_]-=o;const f=new ji(e.slice(o,d),t,c);s.push(f),o=d}return s}getType(){return"MultiPolygon"}intersectsExtent(t){return Sm(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const n=Md(this.flatCoordinates,0,t,this.stride,this.endss_);if(n.length===0)this.flatCoordinates.length=0;else{const s=n[n.length-1];this.flatCoordinates.length=s.length===0?0:s[s.length-1]}this.changed()}}const Tu=me();class _e{constructor(t,e,n,s,o,a){this.styleFunction,this.extent_,this.id_=a,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n||null,this.properties_=o,this.squaredTolerance_,this.stride_=s,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?ad(this.flatCoordinates_):Ol(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=Xi(this.getExtent());this.flatInteriorPoints_=Hl(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=Mm(this.flatCoordinates_,this.ends_),e=Ef(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=Id(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=To(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const n=this.ends_;for(let s=0,o=n.length;s<o;++s){const a=n[s],h=To(t,e,a,2,.5);qe(this.flatMidpoints_,h),e=a}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=It(t);const e=t.getExtent(),n=t.getWorldExtent();if(e&&n){const s=ie(n)/ie(e);Qe(Tu,n[0],n[3],s,-s,0,0,0),Gi(this.flatCoordinates_,0,this.flatCoordinates_.length,2,Tu,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var t;return new _e(this.type_,this.flatCoordinates_.slice(),(t=this.ends_)==null?void 0:t.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=ed((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const n=this.simplifiedGeometry_.getFlatCoordinates();let s;switch(this.type_){case"LineString":n.length=jo(n,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,n,0),s=[n.length];break;case"MultiLineString":s=[],n.length=Rd(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,n,0,s);break;case"Polygon":s=[],n.length=Vl(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),n,0,s);break}return s&&(this.simplifiedGeometry_=new _e(this.type_,n,s,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}_e.prototype.getFlatCoordinates=_e.prototype.getOrientedFlatCoordinates;class Lu{constructor(t){this.rbush_=new Yd(t),this.items_={}}insert(t,e){const n={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(n),this.items_[vt(e)]=n}load(t,e){const n=new Array(e.length);for(let s=0,o=e.length;s<o;s++){const a=t[s],h=e[s],c={minX:a[0],minY:a[1],maxX:a[2],maxY:a[3],value:h};n[s]=c,this.items_[vt(h)]=c}this.rbush_.load(n)}remove(t){const e=vt(t),n=this.items_[e];return delete this.items_[e],this.rbush_.remove(n)!==null}update(t,e){const n=this.items_[vt(e)],s=[n.minX,n.minY,n.maxX,n.maxY];Hs(s,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(s){return s.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let n;for(let s=0,o=t.length;s<o;s++)if(n=e(t[s]),n)return n;return n}isEmpty(){return mn(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return Wi(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}const we={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class Oi extends vi{constructor(t,e,n){super(t),this.feature=e,this.features=n}}class ty extends mf{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=Ks,this.format_=t.format||null,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(xt(this.format_,"`format` must be set when `url` is set"),this.loader_=bu(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:q1;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new Lu:null,this.loadedExtentsRtree_=new Lu,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let n,s;Array.isArray(t.features)?s=t.features:t.features&&(n=t.features,s=n.getArray()),!e&&n===void 0&&(n=new Ke(s)),s!==void 0&&this.addFeaturesInternal(s),n!==void 0&&this.bindFeaturesCollection_(n)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=vt(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const n=t.getGeometry();if(n){const s=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(s,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Oi(we.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof _e||(this.featureChangeKeys_[t]=[_t(e,rt.CHANGE,this.handleFeatureChange_,this),_t(e,es.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let n=!0;if(e.getId()!==void 0){const s=String(e.getId());if(!(s in this.idIndex_))this.idIndex_[s]=e;else if(e instanceof _e){const o=this.idIndex_[s];o instanceof _e?Array.isArray(o)?o.push(e):this.idIndex_[s]=[o,e]:n=!1}else n=!1}return n&&(xt(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),n}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],n=[],s=[];for(let o=0,a=t.length;o<a;o++){const h=t[o],c=vt(h);this.addToIndex_(c,h)&&n.push(h)}for(let o=0,a=n.length;o<a;o++){const h=n[o],c=vt(h);this.setupChangeEvents_(c,h);const d=h.getGeometry();if(d){const f=d.getExtent();e.push(f),s.push(h)}else this.nullGeometryFeatures_[c]=h}if(this.featuresRtree_&&this.featuresRtree_.load(e,s),this.hasListener(we.ADDFEATURE))for(let o=0,a=n.length;o<a;o++)this.dispatchEvent(new Oi(we.ADDFEATURE,n[o]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(we.ADDFEATURE,function(n){e||(e=!0,t.push(n.feature),e=!1)}),this.addEventListener(we.REMOVEFEATURE,function(n){e||(e=!0,t.remove(n.feature),e=!1)}),t.addEventListener(ae.ADD,n=>{e||(e=!0,this.addFeature(n.element),e=!1)}),t.addEventListener(ae.REMOVE,n=>{e||(e=!0,this.removeFeature(n.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const n in this.featureChangeKeys_)this.featureChangeKeys_[n].forEach(Lt);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(n=>{this.removeFeatureInternal(n)});for(const n in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[n])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new Oi(we.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const n=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(n,function(s){const o=s.getGeometry();if(o instanceof _e||o.intersectsCoordinate(t))return e(s)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(n){const s=n.getGeometry();if(s instanceof _e||s.intersectsExtent(t)){const o=e(n);if(o)return o}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),mn(this.nullGeometryFeatures_)||qe(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(n){e.push(n)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const s=fd(t,e);return[].concat(...s.map(o=>this.featuresRtree_.getInExtent(o)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const n=t[0],s=t[1];let o=null;const a=[NaN,NaN];let h=1/0;const c=[-1/0,-1/0,1/0,1/0];return e=e||Vs,this.featuresRtree_.forEachInExtent(c,function(d){if(e(d)){const f=d.getGeometry(),_=h;if(h=f instanceof _e?0:f.closestPointXY(n,s,a,h),h<_){o=d;const p=Math.sqrt(h);c[0]=n-p,c[1]=s-p,c[2]=n+p,c[3]=s+p}}}),o}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,n=vt(e),s=e.getGeometry();if(!s)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[n]=e);else{const a=s.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(a,e)):this.featuresRtree_&&this.featuresRtree_.update(a,e)}const o=e.getId();if(o!==void 0){const a=o.toString();this.idIndex_[a]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[a]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[n]=e;this.changed(),this.dispatchEvent(new Oi(we.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:vt(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&mn(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,n){const s=this.loadedExtentsRtree_,o=this.strategy_(t,e,n);for(let a=0,h=o.length;a<h;++a){const c=o[a];s.forEachInExtent(c,function(f){return an(f.extent,c)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Oi(we.FEATURESLOADSTART)),this.loader_.call(this,c,e,n,f=>{--this.loadingExtentsCount_,this.dispatchEvent(new Oi(we.FEATURESLOADEND,void 0,f))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Oi(we.FEATURESLOADERROR))}),s.insert(c,{extent:c.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_,n=e.forEachInExtent(t,function(s){if(Hs(s.extent,t))return s});n&&e.remove(n)}removeFeatures(t){let e=!1;for(let n=0,s=t.length;n<s;++n)e=this.removeFeatureInternal(t[n])||e;e&&this.changed()}removeFeature(t){if(!t)return;this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=vt(t);if(!(e in this.uidIndex_))return!1;e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t);const n=this.featureChangeKeys_[e];n==null||n.forEach(Lt),delete this.featureChangeKeys_[e];const s=t.getId();if(s!==void 0){const o=s.toString(),a=this.idIndex_[o];a===t?delete this.idIndex_[o]:Array.isArray(a)&&(a.splice(a.indexOf(t),1),a.length===1&&(this.idIndex_[o]=a[0]))}return delete this.uidIndex_[e],this.hasListener(we.REMOVEFEATURE)&&this.dispatchEvent(new Oi(we.REMOVEFEATURE,t)),!0}removeFromIdIndex_(t){for(const e in this.idIndex_)if(this.idIndex_[e]===t){delete this.idIndex_[e];break}}setLoader(t){this.loader_=t}setUrl(t){xt(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(bu(t,this.format_))}setOverlaps(t){this.overlaps_=t,this.changed()}}class ey{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=Qo,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let n=e.dataProjection?It(e.dataProjection):this.readProjection(t);e.extent&&n&&n.getUnits()==="tile-pixels"&&(n=It(n),n.setWorldExtent(e.extent)),e={dataProjection:n,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return st()}readFeature(t,e){return st()}readFeatures(t,e){return st()}readGeometry(t,e){return st()}readProjection(t){return st()}writeFeature(t,e){return st()}writeFeatures(t,e){return st()}writeGeometry(t,e){return st()}}function vh(i,t,e){const n=e?It(e.featureProjection):null,s=e?It(e.dataProjection):null;let o=i;if(n&&s&&!ro(n,s)){t&&(o=i.clone());const a=t?n:s,h=t?s:n;a.getUnits()==="tile-pixels"?o.transform(a,h):o.applyTransform(qs(a,h))}if(t&&e&&e.decimals!==void 0){const a=Math.pow(10,e.decimals),h=function(c){for(let d=0,f=c.length;d<f;++d)c[d]=Math.round(c[d]*a)/a;return c};o===i&&(o=i.clone()),o.applyTransform(h)}return o}const iy={Point:ns,LineString:as,Polygon:ji,MultiPoint:ta,MultiLineString:So,MultiPolygon:Po};function ny(i,t,e){return Array.isArray(t[0])?(Dd(i,0,t,e)||(i=i.slice(),yl(i,0,t,e)),i):(ql(i,0,t,e)||(i=i.slice(),po(i,0,t,e)),i)}function bf(i,t){var o;const e=i.geometry;if(!e)return[];if(Array.isArray(e))return e.map(a=>bf({...i,geometry:a})).flat();const n=e.type==="MultiPolygon"?"Polygon":e.type;if(n==="GeometryCollection"||n==="Circle")throw new Error("Unsupported geometry type: "+n);const s=e.layout.length;return vh(new _e(n,n==="Polygon"?ny(e.flatCoordinates,e.ends,s):e.flatCoordinates,(o=e.ends)==null?void 0:o.flat(),s,i.properties||{},i.id).enableSimplifyTransformed(),!1,t)}function xh(i,t){if(!i)return null;if(Array.isArray(i)){const n=i.map(s=>xh(s,t));return new Lo(n)}const e=iy[i.type];return vh(new e(i.flatCoordinates,i.layout||"XY",i.ends),!1,t)}class sy extends ey{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(eo(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(eo(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return st()}readFeaturesFromObject(t,e){return st()}readGeometry(t,e){return this.readGeometryFromObject(eo(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return st()}readProjection(t){return this.readProjectionFromObject(eo(t))}readProjectionFromObject(t){return st()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return st()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return st()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return st()}}function eo(i){if(typeof i=="string"){const t=JSON.parse(i);return t||null}return i!==null?i:null}class ry extends sy{constructor(t){t=t||{},super(),this.dataProjection=It(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=It(t.featureProjection)),t.featureClass&&(this.featureClass=t.featureClass),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let n=null;t.type==="Feature"?n=t:n={type:"Feature",geometry:t,properties:null};const s=wh(n.geometry);if(this.featureClass===_e)return bf({geometry:s,id:n.id,properties:n.properties},e);const o=new Qo;return this.geometryName_?o.setGeometryName(this.geometryName_):this.extractGeometryName_&&n.geometry_name&&o.setGeometryName(n.geometry_name),o.setGeometry(xh(s,e)),"id"in n&&o.setId(n.id),n.properties&&o.setProperties(n.properties,!0),o}readFeaturesFromObject(t,e){const n=t;let s=null;if(n.type==="FeatureCollection"){const o=t;s=[];const a=o.features;for(let h=0,c=a.length;h<c;++h){const d=this.readFeatureFromObject(a[h],e);d&&s.push(d)}}else s=[this.readFeatureFromObject(t,e)];return s.flat()}readGeometryFromObject(t,e){return oy(t,e)}readProjectionFromObject(t){const e=t.crs;let n;if(e)if(e.type=="name")n=It(e.properties.name);else if(e.type==="EPSG")n=It("EPSG:"+e.properties.code);else throw new Error("Unknown SRS type");else n=this.dataProjection;return n}writeFeatureObject(t,e){e=this.adaptOptions(e);const n={type:"Feature",geometry:null,properties:null},s=t.getId();if(s!==void 0&&(n.id=s),!t.hasProperties())return n;const o=t.getProperties(),a=t.getGeometry();return a&&(n.geometry=Ll(a,e),delete o[t.getGeometryName()]),mn(o)||(n.properties=o),n}writeFeaturesObject(t,e){e=this.adaptOptions(e);const n=[];for(let s=0,o=t.length;s<o;++s)n.push(this.writeFeatureObject(t[s],e));return{type:"FeatureCollection",features:n}}writeGeometryObject(t,e){return Ll(t,this.adaptOptions(e))}}function wh(i,t){if(!i)return null;let e;switch(i.type){case"Point":{e=ly(i);break}case"LineString":{e=hy(i);break}case"Polygon":{e=fy(i);break}case"MultiPoint":{e=uy(i);break}case"MultiLineString":{e=cy(i);break}case"MultiPolygon":{e=dy(i);break}case"GeometryCollection":{e=ay(i);break}default:throw new Error("Unsupported GeoJSON type: "+i.type)}return e}function oy(i,t){const e=wh(i);return xh(e,t)}function ay(i,t){return i.geometries.map(function(n){return wh(n)})}function ly(i){const t=i.coordinates;return{type:"Point",flatCoordinates:t,layout:En(t.length)}}function hy(i){var n;const t=i.coordinates,e=t.flat();return{type:"LineString",flatCoordinates:e,ends:[e.length],layout:En(((n=t[0])==null?void 0:n.length)||2)}}function cy(i){var o,a;const t=i.coordinates,e=((a=(o=t[0])==null?void 0:o[0])==null?void 0:a.length)||2,n=[],s=ur(n,0,t,e);return{type:"MultiLineString",flatCoordinates:n,ends:s,layout:En(e)}}function uy(i){var e;const t=i.coordinates;return{type:"MultiPoint",flatCoordinates:t.flat(),layout:En(((e=t[0])==null?void 0:e.length)||2)}}function dy(i){var o,a;const t=i.coordinates,e=[],n=((a=(o=t[0])==null?void 0:o[0])==null?void 0:a[0].length)||2,s=Md(e,0,t,n);return{type:"MultiPolygon",flatCoordinates:e,ends:s,layout:En(n)}}function fy(i){var o,a;const t=i.coordinates,e=[],n=(a=(o=t[0])==null?void 0:o[0])==null?void 0:a.length,s=ur(e,0,t,n);return{type:"Polygon",flatCoordinates:e,ends:s,layout:En(n)}}function Ll(i,t){i=vh(i,!0,t);const e=i.getType();let n;switch(e){case"Point":{n=vy(i);break}case"LineString":{n=_y(i);break}case"Polygon":{n=xy(i,t);break}case"MultiPoint":{n=py(i);break}case"MultiLineString":{n=my(i);break}case"MultiPolygon":{n=yy(i,t);break}case"GeometryCollection":{n=gy(i,t);break}case"Circle":{n={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return n}function gy(i,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:i.getGeometriesArray().map(function(n){return Ll(n,t)})}}function _y(i,t){return{type:"LineString",coordinates:i.getCoordinates()}}function my(i,t){return{type:"MultiLineString",coordinates:i.getCoordinates()}}function py(i,t){return{type:"MultiPoint",coordinates:i.getCoordinates()}}function yy(i,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:i.getCoordinates(e)}}function vy(i,t){return{type:"Point",coordinates:i.getCoordinates()}}function xy(i,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:i.getCoordinates(e)}}const Ht={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class wy extends Ne{constructor(t){super(),this.on,this.once,this.un,this.options=t,this.id=t.id,this.insertFirst=t.insertFirst!==void 0?t.insertFirst:!0,this.stopEvent=t.stopEvent!==void 0?t.stopEvent:!0,this.element=document.createElement("div"),this.element.className=t.className!==void 0?t.className:"ol-overlay-container "+Zm,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=t.autoPan===!0?{}:t.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(Ht.ELEMENT,this.handleElementChanged),this.addChangeListener(Ht.MAP,this.handleMapChanged),this.addChangeListener(Ht.OFFSET,this.handleOffsetChanged),this.addChangeListener(Ht.POSITION,this.handlePositionChanged),this.addChangeListener(Ht.POSITIONING,this.handlePositioningChanged),t.element!==void 0&&this.setElement(t.element),this.setOffset(t.offset!==void 0?t.offset:[0,0]),this.setPositioning(t.positioning||"top-left"),t.position!==void 0&&this.setPosition(t.position)}getElement(){return this.get(Ht.ELEMENT)}getId(){return this.id}getMap(){return this.get(Ht.MAP)||null}getOffset(){return this.get(Ht.OFFSET)}getPosition(){return this.get(Ht.POSITION)}getPositioning(){return this.get(Ht.POSITIONING)}handleElementChanged(){zd(this.element);const t=this.getElement();t&&this.element.appendChild(t)}handleMapChanged(){var e;this.mapPostrenderListenerKey&&((e=this.element)==null||e.remove(),Lt(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const t=this.getMap();if(t){this.mapPostrenderListenerKey=_t(t,gi.POSTRENDER,this.render,this),this.updatePixelPosition();const n=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?n.insertBefore(this.element,n.childNodes[0]||null):n.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(t){this.set(Ht.ELEMENT,t)}setMap(t){this.set(Ht.MAP,t)}setOffset(t){this.set(Ht.OFFSET,t)}setPosition(t){this.set(Ht.POSITION,t)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(t){const e=this.getMap();if(!e||!e.getTargetElement()||!this.get(Ht.POSITION))return;const n=this.getRect(e.getTargetElement(),e.getSize()),s=this.getElement(),o=this.getRect(s,[Bm(s),Wm(s)]);t=t||{};const a=t.margin===void 0?20:t.margin;if(!an(n,o)){const h=o[0]-n[0],c=n[2]-o[2],d=o[1]-n[1],f=n[3]-o[3],_=[0,0];if(h<0?_[0]=h-a:c<0&&(_[0]=Math.abs(c)+a),d<0?_[1]=d-a:f<0&&(_[1]=Math.abs(f)+a),_[0]!==0||_[1]!==0){const p=e.getView().getCenterInternal(),y=e.getPixelFromCoordinateInternal(p);if(!y)return;const v=[y[0]+_[0],y[1]+_[1]],w=t.animation||{};e.getView().animateInternal({center:e.getCoordinateFromPixelInternal(v),duration:w.duration,easing:w.easing})}}}getRect(t,e){const n=t.getBoundingClientRect(),s=n.left+window.pageXOffset,o=n.top+window.pageYOffset;return[s,o,s+e[0],o+e[1]]}setPositioning(t){this.set(Ht.POSITIONING,t)}setVisible(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)}updatePixelPosition(){const t=this.getMap(),e=this.getPosition();if(!t||!t.isRendered()||!e){this.setVisible(!1);return}const n=t.getPixelFromCoordinate(e),s=t.getSize();this.updateRenderedPosition(n,s)}updateRenderedPosition(t,e){const n=this.element.style,s=this.getOffset(),o=this.getPositioning();this.setVisible(!0);const a=Math.round(t[0]+s[0])+"px",h=Math.round(t[1]+s[1])+"px";let c="0%",d="0%";o=="bottom-right"||o=="center-right"||o=="top-right"?c="-100%":(o=="bottom-center"||o=="center-center"||o=="top-center")&&(c="-50%"),o=="bottom-left"||o=="bottom-center"||o=="bottom-right"?d="-100%":(o=="center-left"||o=="center-center"||o=="center-right")&&(d="-50%");const f=`translate(${c}, ${d}) translate(${a}, ${h})`;this.rendered.transform_!=f&&(this.rendered.transform_=f,n.transform=f)}getOptions(){return this.options}}const Cy={clear:'<svg width="128" height="128" viewBox="0 0 128 128" fill="none" xmlns="http://www.w3.org/2000/svg"> <path fill-rule="evenodd" clip-rule="evenodd" d="M111.955 66.5117C110.637 66.4438 109.63 65.3198 109.63 64C109.63 62.6802 110.637 61.5562 111.955 61.4883L117.005 61.2278C118.617 61.1446 120 62.3851 120 64C120 65.6149 118.617 66.8553 117.005 66.7722L111.955 66.5117ZM103.521 41.1787C104.182 42.3208 105.618 42.7936 106.793 42.1936L111.289 39.8982C112.732 39.1616 113.309 37.3865 112.497 35.9845C111.686 34.5825 109.864 34.2057 108.507 35.0892L104.276 37.8426C103.17 38.5623 102.861 40.0366 103.521 41.1787ZM86.8213 24.4786C87.9634 25.1395 89.4377 24.8305 90.1574 23.7245L92.9108 19.4933C93.7942 18.1356 93.4175 16.3141 92.0155 15.5028C90.6135 14.6915 88.8384 15.2684 88.1018 16.711L85.8064 21.2071C85.2064 22.3824 85.6792 23.8176 86.8213 24.4786ZM64 18.3704C65.3198 18.3704 66.4438 17.3633 66.5117 16.0453L66.7722 10.9954C66.8553 9.38262 65.6149 8 64 8C62.3851 8 61.1446 9.38262 61.2278 10.9954L61.4883 16.0453C61.5562 17.3633 62.6802 18.3704 64 18.3704ZM41.1787 24.4786C42.3208 23.8176 42.7936 22.3824 42.1936 21.2071L39.8982 16.711C39.1616 15.2684 37.3865 14.6915 35.9845 15.5028C34.5825 16.3141 34.2057 18.1356 35.0892 19.4933L37.8426 23.7245C38.5623 24.8305 40.0366 25.1395 41.1787 24.4786ZM24.4786 41.1787C25.1395 40.0366 24.8305 38.5623 23.7245 37.8426L19.4933 35.0892C18.1356 34.2058 16.3141 34.5825 15.5028 35.9845C14.6915 37.3865 15.2684 39.1616 16.711 39.8982L21.2071 42.1936C22.3824 42.7936 23.8176 42.3208 24.4786 41.1787ZM16.0453 61.4883C17.3633 61.5562 18.3704 62.6802 18.3704 64C18.3704 65.3198 17.3633 66.4438 16.0453 66.5117L10.9954 66.7722C9.38262 66.8554 8 65.6149 8 64C8 62.3851 9.38262 61.1446 10.9954 61.2278L16.0453 61.4883ZM24.4786 86.8213C23.8176 85.6792 22.3824 85.2064 21.2071 85.8064L16.711 88.1018C15.2684 88.8384 14.6915 90.6135 15.5028 92.0155C16.3141 93.4175 18.1356 93.7943 19.4933 92.9108L23.7245 90.1574C24.8305 89.4377 25.1395 87.9634 24.4786 86.8213ZM41.1787 103.521C40.0366 102.861 38.5623 103.17 37.8426 104.276L35.0892 108.507C34.2058 109.864 34.5825 111.686 35.9845 112.497C37.3865 113.309 39.1616 112.732 39.8982 111.289L42.1936 106.793C42.7936 105.618 42.3208 104.182 41.1787 103.521ZM64 109.63C62.6802 109.63 61.5562 110.637 61.4883 111.955L61.2278 117.005C61.1446 118.617 62.3851 120 64 120C65.6149 120 66.8554 118.617 66.7722 117.005L66.5117 111.955C66.4438 110.637 65.3198 109.63 64 109.63ZM86.8213 103.521C85.6792 104.182 85.2064 105.618 85.8064 106.793L88.1018 111.289C88.8384 112.732 90.6135 113.309 92.0155 112.497C93.4175 111.686 93.7943 109.864 92.9108 108.507L90.1574 104.276C89.4377 103.17 87.9634 102.861 86.8213 103.521ZM103.521 86.8213C102.861 87.9634 103.17 89.4377 104.276 90.1574L108.507 92.9108C109.864 93.7942 111.686 93.4175 112.497 92.0155C113.309 90.6135 112.732 88.8384 111.289 88.1018L106.793 85.8064C105.618 85.2064 104.182 85.6792 103.521 86.8213Z" fill="#FFD400"/> <path d="M102.37 64C102.37 85.1914 85.1914 102.37 64 102.37C42.8086 102.37 25.6296 85.1914 25.6296 64C25.6296 42.8086 42.8086 25.6296 64 25.6296C85.1914 25.6296 102.37 42.8086 102.37 64Z" fill="#FFD400"/> </svg>',clouds:'<svg width="128" height="128" viewBox="0 0 128 128" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M63.2655 28.5539C64.0663 29.0173 65.1 28.8007 65.6046 28.0252L67.5351 25.0585C68.1546 24.1066 67.8904 22.8294 66.9074 22.2606C65.9244 21.6917 64.6798 22.0962 64.1634 23.1077L62.5539 26.2601C62.1332 27.0842 62.4647 28.0905 63.2655 28.5539Z" fill="#FFD400"/> <path d="M47.2644 24.2712C48.1897 24.2712 48.9778 23.5651 49.0255 22.6409L49.2081 19.1002C49.2664 17.9694 48.3967 17 47.2644 17C46.1321 17 45.2623 17.9694 45.3207 19.1002L45.5033 22.6409C45.5509 23.5651 46.339 24.2712 47.2644 24.2712Z" fill="#FFD400"/> <path d="M31.2632 28.5539C32.064 28.0905 32.3955 27.0842 31.9748 26.2602L30.3654 23.1077C29.8489 22.0962 28.6043 21.6917 27.6213 22.2606C26.6383 22.8294 26.3741 24.1066 26.9936 25.0585L28.9241 28.0252C29.4287 28.8007 30.4624 29.0173 31.2632 28.5539Z" fill="#FFD400"/> <path d="M19.5539 40.2632C20.0173 39.4624 19.8007 38.4287 19.0252 37.9241L16.0585 35.9936C15.1066 35.3741 13.8294 35.6383 13.2606 36.6213C12.6917 37.6043 13.0962 38.8489 14.1077 39.3654L17.2601 40.9748C18.0842 41.3955 19.0905 41.064 19.5539 40.2632Z" fill="#FFD400"/> <path d="M13.6409 54.5033C14.5651 54.5509 15.2712 55.339 15.2712 56.2644C15.2712 57.1897 14.5651 57.9778 13.6409 58.0255L10.1002 58.2081C8.96943 58.2664 8 57.3967 8 56.2644C8 55.1321 8.96942 54.2623 10.1002 54.3207L13.6409 54.5033Z" fill="#FFD400"/> <path d="M65.4965 36.4809C60.7028 32.0609 54.2989 29.361 47.2644 29.361C32.4061 29.361 20.361 41.4061 20.361 56.2644C20.361 57.3502 20.4253 58.421 20.5504 59.4731C24.8985 56.6299 30.0953 54.977 35.6782 54.977C37.9422 54.977 40.146 55.2495 42.257 55.7644C46.9301 46.4848 55.3308 39.3996 65.4965 36.4809Z" fill="#FFD400"/> <path d="M35.6782 107.115C22.1694 107.115 11.2184 96.1639 11.2184 82.6552C11.2184 69.1464 22.1694 58.1954 35.6782 58.1954C38.6073 58.1954 41.4161 58.7103 44.0192 59.6545C49.155 47.0924 61.4979 38.2414 75.908 38.2414C94.9269 38.2414 110.345 53.6593 110.345 72.6782C110.345 73.516 110.315 74.3468 110.256 75.1697C116.007 77.8179 120 83.6324 120 90.3793C120 99.6222 112.507 107.115 103.264 107.115H35.6782Z" fill="white"/> </svg>',rain:'<svg width="128" height="128" viewBox="0 0 128 128" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M33.1834 81.9112C19.275 81.9112 8 70.6362 8 56.7278C8 42.8194 19.275 31.5444 33.1834 31.5444C36.1992 31.5444 39.0912 32.0745 41.7712 33.0466C47.059 20.1128 59.767 11 74.6035 11C94.1851 11 110.059 26.874 110.059 46.4556C110.059 47.3182 110.028 48.1737 109.968 49.0208C115.889 51.7474 120 57.7339 120 64.6805C120 74.1968 112.286 81.9112 102.769 81.9112H33.1834Z" fill="white"/> <path d="M92.9543 95.7094L89.5148 88.5385L86.0752 95.7096C85.7339 96.3071 85.5385 97.0018 85.5385 97.7429C85.5385 99.9797 87.3187 101.793 89.5148 101.793C91.7109 101.793 93.4911 99.9797 93.4911 97.7429C93.4911 97.0017 93.2956 96.307 92.9543 95.7094Z" fill="#64D2FF"/> <path d="M81.0255 110.29L77.5858 103.118L74.1465 110.289C73.805 110.887 73.6095 111.581 73.6095 112.323C73.6095 114.56 75.3897 116.373 77.5858 116.373C79.7819 116.373 81.5621 114.56 81.5621 112.323C81.5621 111.582 81.3667 110.887 81.0255 110.29Z" fill="#64D2FF"/> <path d="M69.0964 95.7095L65.6568 88.5385L62.2173 95.7094C61.876 96.307 61.6805 97.0017 61.6805 97.7429C61.6805 99.9797 63.4607 101.793 65.6568 101.793C67.8529 101.793 69.6331 99.9797 69.6331 97.7429C69.6331 97.0018 69.4377 96.3071 69.0964 95.7095Z" fill="#64D2FF"/> <path d="M57.8299 110.289L54.3905 103.118L50.9509 110.289C50.6097 110.887 50.4142 111.582 50.4142 112.323C50.4142 114.56 52.1945 116.373 54.3905 116.373C56.5866 116.373 58.3669 114.56 58.3669 112.323C58.3669 111.582 58.1713 110.887 57.8299 110.289Z" fill="#64D2FF"/> <path d="M45.9012 95.7097L42.4616 88.5385L39.0221 95.7092C38.6807 96.3069 38.4852 97.0016 38.4852 97.7429C38.4852 99.9797 40.2655 101.793 42.4615 101.793C44.6576 101.793 46.4379 99.9797 46.4379 97.7429C46.4379 97.0018 46.2424 96.3073 45.9012 95.7097Z" fill="#64D2FF"/> <path d="M33.972 110.289L30.5325 103.118L27.093 110.289C26.7517 110.887 26.5562 111.582 26.5562 112.323C26.5562 114.56 28.3365 116.373 30.5325 116.373C32.7286 116.373 34.5089 114.56 34.5089 112.323C34.5089 111.582 34.3134 110.887 33.972 110.289Z" fill="#64D2FF"/> </svg>',snowy:'<svg width="128" height="128" viewBox="0 0 128 128" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M46.8717 66.6318C46.8717 65.7731 47.5678 65.0769 48.4265 65.0769C49.2852 65.0769 49.9814 65.7731 49.9814 66.6318V72.2469L52.6952 69.8346C53.3324 69.2681 54.3149 69.3195 54.8895 69.9495C55.464 70.5795 55.4132 71.5495 54.7759 72.116L49.9814 76.3779V83.3408L56.4147 79.6739L57.6685 73.8506C57.8472 73.0208 58.6729 72.491 59.5128 72.6672C60.3528 72.8435 60.8889 73.6591 60.7102 74.4888L60.0386 77.6084L64.5897 75.0143C65.3286 74.5931 66.2757 74.8469 66.705 75.5811C67.1344 76.3152 66.8835 77.2518 66.1446 77.673L61.224 80.4776L64.6427 81.5742C65.4599 81.8363 65.9073 82.7025 65.6419 83.5087C65.3766 84.315 64.499 84.7561 63.6817 84.4939L57.6001 82.5431L51.6523 85.9332L58.0694 89.5908L63.7531 87.7677C64.5703 87.5055 65.4479 87.9466 65.7133 88.7529C65.9787 89.5591 65.5313 90.4252 64.714 90.6874L61.6932 91.6564L66.213 94.2325C66.9519 94.6537 67.2029 95.5903 66.7735 96.3245C66.3442 97.0586 65.3971 97.3124 64.6582 96.8912L59.7065 94.0688L60.465 97.592C60.6437 98.4218 60.1076 99.2374 59.2677 99.4136C58.4277 99.5899 57.602 99.0601 57.4233 98.2303L56.0826 92.0033L49.9814 88.5257V95.9842L54.4649 99.9697C55.1022 100.536 55.1531 101.506 54.5785 102.136C54.0039 102.766 53.0215 102.818 52.3842 102.251L49.9814 100.115V105.274C49.9814 106.132 49.2852 106.828 48.4265 106.828C47.5678 106.828 46.8717 106.132 46.8717 105.274V99.6943L44.1981 102.071C43.5608 102.637 42.5783 102.586 42.0038 101.956C41.4292 101.326 41.48 100.356 42.1173 99.7894L46.8717 95.5632V88.6581L40.3383 92.382L39.0959 98.1527C38.9172 98.9825 38.0915 99.5122 37.2515 99.336C36.4116 99.1597 35.8755 98.3442 36.0541 97.5144L36.7145 94.4475L32.1949 97.0236C31.456 97.4447 30.5089 97.191 30.0795 96.4568C29.6502 95.7226 29.9011 94.786 30.64 94.3649L35.5919 91.5424L32.1217 90.4293C31.3045 90.1671 30.8571 89.301 31.1224 88.4948C31.3878 87.6885 32.2654 87.2474 33.0826 87.5096L39.2158 89.4769L45.433 85.9332L38.8833 82.2001L33.1484 84.0397C32.3311 84.3019 31.4535 83.8608 31.1882 83.0545C30.9228 82.2483 31.3702 81.3822 32.1874 81.12L35.2595 80.1346L30.7085 77.5406C29.9696 77.1195 29.7187 76.1829 30.148 75.4487C30.5774 74.7145 31.5244 74.4608 32.2633 74.882L37.1838 77.6865L36.4364 74.2154C36.2578 73.3856 36.7939 72.5701 37.6338 72.3938C38.4737 72.2176 39.2995 72.7474 39.4781 73.5771L40.8076 79.752L46.8717 83.2084V75.8853L42.4283 71.9355C41.791 71.369 41.7402 70.3991 42.3148 69.7691C42.8893 69.1391 43.8718 69.0876 44.5091 69.6541L46.8717 71.7543V66.6318Z" fill="#64D2FF"/> <path d="M69.0954 92.9112C68.8252 92.6355 68.5123 92.3922 68.1592 92.1917L68.0136 92.109C68.9578 91.0292 69.3378 89.4955 68.8471 88.0102C68.5913 87.2359 68.1366 86.5899 67.5606 86.1046C68.1016 85.627 68.5284 85.0036 68.7732 84.2627C69.3012 82.6645 68.8211 81.0104 67.7149 79.9258L68.0882 79.7138C70.1381 78.5498 70.8366 75.9427 69.6432 73.9098C68.4649 71.9026 65.884 71.2111 63.8601 72.3604L63.6296 72.4912C63.1701 71.0858 61.9819 69.9707 60.4508 69.6506C59.6529 69.4838 58.8523 69.5519 58.1284 69.8116C57.9996 69.0324 57.6502 68.2796 57.0751 67.6514C55.9331 66.404 54.212 65.9889 52.6876 66.4468V66.0245C52.6876 63.6711 50.7798 61.7633 48.4264 61.7633C46.073 61.7633 44.1652 63.6711 44.1652 66.0245V66.1687C42.7368 65.8734 41.1933 66.3162 40.1412 67.4653C39.5832 68.0748 39.2377 68.8015 39.1 69.556C38.3575 69.2747 37.5304 69.1963 36.7062 69.3687C35.0771 69.7092 33.8362 70.9498 33.4482 72.4824L32.9927 72.2238C30.9687 71.0746 28.3879 71.766 27.2096 73.7732C26.0161 75.8062 26.7146 78.4133 28.7646 79.5773L28.917 79.6638C27.9526 80.7453 27.5603 82.2943 28.0558 83.7941C28.3191 84.591 28.793 85.252 29.3931 85.7418C28.7608 86.2366 28.2609 86.9171 27.9877 87.7439C27.4549 89.3568 27.9488 91.0267 29.0768 92.1106L28.6936 92.3282C28.6144 92.3732 28.5373 92.4203 28.4622 92.4694C16.8105 90.2595 8 80.0225 8 67.7278C8 53.8194 19.275 42.5444 33.1834 42.5444C36.1992 42.5444 39.0912 43.0745 41.7712 44.0466C47.059 31.1128 59.767 22 74.6035 22C94.1851 22 110.059 37.874 110.059 57.4556C110.059 58.3182 110.028 59.1737 109.968 60.0208C115.889 62.7474 120 68.7339 120 75.6805C120 85.1968 112.286 92.9112 102.769 92.9112H69.0954Z" fill="white"/> </svg>',thunderstorms:'<svg width="128" height="128" viewBox="0 0 128 128" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M89.2914 58.3905H82.2733C80.9693 58.3905 79.8146 59.2329 79.4165 60.4747L72.8766 80.876C72.256 82.8121 73.7003 84.7918 75.7334 84.7918H79.3153C80.4603 84.7918 81.3715 85.7511 81.3127 86.8946L80.2038 108.431C80.1761 108.969 80.9006 109.165 81.1474 108.686L96.5343 78.8757C97.5649 76.879 96.1154 74.4997 93.8684 74.4997H90.8733C89.5094 74.4997 88.5455 73.1644 88.9751 71.8699L92.1388 62.3353C92.7831 60.3934 91.3374 58.3905 89.2914 58.3905Z" fill="#FFD400"/> <path d="M98.1803 82.9112L100.241 78.9196C102.062 75.3909 99.5004 71.1862 95.5293 71.1862H92.6932L95.7252 62.0484C96.8639 58.6167 94.309 55.0769 90.6932 55.0769H81.5351C79.2305 55.0769 77.1899 56.5657 76.4864 58.7603L69.2978 81.1852C69.1122 81.7641 69.0311 82.3452 69.0418 82.9112L33.1834 82.9112C19.275 82.9112 8 71.6362 8 57.7278C8 43.8194 19.275 32.5444 33.1834 32.5444C36.1992 32.5444 39.0912 33.0745 41.7712 34.0466C47.059 21.1128 59.7671 12 74.6036 12C94.1852 12 110.059 27.874 110.059 47.4556C110.059 48.3182 110.028 49.1737 109.968 50.0208C115.889 52.7474 120 58.7339 120 65.6805C120 75.1967 112.285 82.9112 102.769 82.9112H98.1803Z" fill="white"/> <path d="M68.4332 109.963L64.994 102.793L61.5544 109.964C61.2132 110.562 61.0178 111.256 61.0178 111.997C61.0178 114.234 62.798 116.047 64.9941 116.047C67.1902 116.047 68.9704 114.234 68.9704 111.997C68.9704 111.256 68.7748 110.561 68.4332 109.963Z" fill="#64D2FF"/> <path d="M56.5048 96.7098L53.0651 89.5385L49.6259 96.7088C49.2843 97.3066 49.0887 98.0015 49.0887 98.7429C49.0887 100.98 50.869 102.793 53.065 102.793C55.2611 102.793 57.0414 100.98 57.0414 98.7429C57.0414 98.0019 56.846 97.3073 56.5048 96.7098Z" fill="#64D2FF"/> <path d="M44.5756 109.964L41.1361 102.793L37.6968 109.963C37.3554 110.561 37.1598 111.256 37.1598 111.997C37.1598 114.234 38.9401 116.047 41.1361 116.047C43.3322 116.047 45.1124 114.234 45.1124 111.997C45.1124 111.256 44.917 110.561 44.5756 109.964Z" fill="#64D2FF"/> <path d="M32.6464 96.7091L29.207 89.5385L25.7675 96.7095C25.4262 97.3071 25.2307 98.0017 25.2307 98.7429C25.2307 100.98 27.011 102.793 29.2071 102.793C31.4031 102.793 33.1834 100.98 33.1834 98.7429C33.1834 98.0016 32.9878 97.3068 32.6464 96.7091Z" fill="#64D2FF"/> </svg>'};function Ey(i){return Cy[i]}const Tf=i=>{const{clouds:t,temp:e,humidity:n,wind_speed:s}=i;let o="clear";return e<1&&n>70&&t>50&&(o="snowy"),n>80&&s>8&&t>60&&e>10&&(o="thunderstorms"),t>50&&n>60&&e>1&&(o="rain"),t>15&&(o="clouds"),Ey(o)},Mo=[{name:"Clouds",key:"clouds_new",url:"https://tile.openweathermap.org/map/clouds_new/{z}/{x}/{y}.png?appid="},{name:"Precipitation",key:"precipitation_new",url:"https://tile.openweathermap.org/map/precipitation_new/{z}/{x}/{y}.png?appid="},{name:"Sea level pressure",key:"pressure_new",url:"https://tile.openweathermap.org/map/pressure_new/{z}/{x}/{y}.png?appid="},{name:"Wind speed",key:"wind_new",url:"https://tile.openweathermap.org/map/wind_new/{z}/{x}/{y}.png?appid="},{name:"Temperature",key:"temp_new",url:"https://tile.openweathermap.org/map/temp_new/{z}/{x}/{y}.png?appid="}],by={clouds_new:"linear-gradient(to right, rgba(247, 247, 255, 0) 0%, rgba(251, 247, 255, 0) 10%, rgba(244, 248, 255, 0.1) 20%, rgba(240, 249, 255, 0.2) 30%, rgba(221, 250, 255, 0.4) 40%, rgba(224, 224, 224, 0.9) 50%, rgba(224, 224, 224, 0.76) 60%, rgba(228, 228, 228, 0.9) 70%, rgba(232, 232, 232, 0.9) 80%, rgb(214, 213, 213) 90%, rgb(210, 210, 210) 95%, rgb(183, 183, 183) 100%)",precipitation_new:"linear-gradient(to right, rgba(172, 170, 247, 0) 0%, rgba(172, 170, 247, 0.4) 0.5%, rgba(141, 138, 243, 0.9) 5%, rgb(112, 110, 194) 10%, rgb(86, 88, 255) 20%, rgb(91, 93, 177) 50%, rgb(62, 63, 133) 100%)",pressure_new:"linear-gradient(to right, rgb(0, 115, 255) 0%, rgb(0, 170, 255) 8%, rgb(75, 208, 214) 25%, rgb(141, 231, 199) 41%, rgb(176, 247, 32) 50%, rgb(240, 184, 0) 58%, rgb(251, 85, 21) 75%, rgb(243, 54, 59) 91%, rgb(198, 0, 0) 100%)",wind_new:"linear-gradient(to right, rgba(255, 255, 0, 0) 0%, rgba(170, 128, 177, 0.44) 1%, rgba(170, 128, 177, 0.54) 1.5%, rgba(176, 128, 177, 0.71) 3%, rgba(170, 128, 177, 0.84) 6%, rgb(164, 123, 170) 12.5%, rgba(116, 76, 172, 0.9) 25%, rgb(158, 128, 177) 50%, rgba(48, 6, 53, 0.82) 100%)",temp_new:"linear-gradient(to right, rgb(159, 85, 181) 0%, rgb(44, 106, 187) 8.75%, rgb(82, 139, 213) 12.5%, rgb(103, 163, 222) 18.75%, rgb(142, 202, 240) 25%, rgb(155, 213, 244) 31.25%, rgb(172, 225, 253) 37.5%, rgb(194, 234, 255) 43.75%, rgb(255, 255, 208) 50%, rgb(254, 248, 174) 56.25%, rgb(254, 232, 146) 62.5%, rgb(254, 226, 112) 68.75%, rgb(253, 212, 97) 75%, rgb(244, 168, 94) 82.5%, rgb(244, 129, 89) 87.5%, rgb(244, 104, 89) 93.75%, rgb(244, 76, 73) 100%)"},Ty={clouds_new:"%",precipitation_new:"mm",pressure_new:"hPa",wind_new:"m/s",temp_new:"°C"},Ly={clouds_new:{min:0,max:100},precipitation_new:{min:0,max:100},pressure_new:{min:950,max:1050},wind_new:{min:0,max:100},temp_new:{min:-40,max:40}},Lf=(i,t,e)=>{const n=document.querySelector(t);if(!n){console.warn("Legend container not found:",t);return}n.querySelectorAll("#ol-wms-legend-box"+i).forEach(a=>a.remove());const s=document.createElement("div");s.id="ol-wms-legend-box"+i,s.style.cssText=`z-index:10; width: 100%; height: 16px; position: relative; background: ${by[e.key]};`;const o=document.createElement("div");o.style.cssText="position:absolute;top:-30px;background:rgba(0,0,0,0.7);color:#fff;font-size:12px;padding:2px 6px;border-radius:4px;pointer-events:none;white-space:nowrap;display:none;",s.appendChild(o),s.addEventListener("mousemove",a=>{const h=s.getBoundingClientRect(),c=(a.clientX-h.left)/h.width*100,d=Ty[e.key]||"%",f=Ly[e.key];if(f){const _=(f.min+(f.max-f.min)*c/100).toFixed(1);o.innerText=`${_}${d}`}else o.innerText=`${c.toFixed(1)}${d}`;o.style.left=`${c}%`,o.style.transform="translateX(-50%)",o.style.display="block"}),s.addEventListener("mouseleave",()=>{o.style.display="none"}),n.appendChild(s)},Sf=i=>{document.querySelectorAll("#ol-wms-legend-box"+i).forEach(t=>t.remove())},Sy=Object.prototype.hasOwnProperty,sn=typeof Symbol<"u"?Symbol.toStringTag:void 0;function Py(i){if(i===null)return i===void 0?"[object Undefined]":"[object Null]";if(!(sn&&sn in Object(i)))return toString.call(i);const t=Sy.call(i,sn),e=i[sn];let n=!1;try{i[sn]=void 0,n=!0}catch{}const s=Object.prototype.toString.call(i);return n&&(t?i[sn]=e:delete i[sn]),s}function Os(i){if(!My(i))return!1;const t=Py(i);return t==="[object Function]"||t==="[object AsyncFunction]"||t==="[object GeneratorFunction]"||t==="[object Proxy]"}function My(i){const t=typeof i;return i!==null&&(t==="object"||t==="function")}function Ry(i){return i==null?!1:typeof i=="string"||i.constructor!==null&&i.constructor===String}function il(i){return Object.prototype.toString.call(i)==="[object Number]"&&!isNaN(i)}function Pf(i){return Array.isArray(i)}function js(i,...t){return Object.assign(i,...t)}function Iy(i,t){console.warn(`${t}: ${i}`)}const Su={};function Ay(i,t){Su[t]||(Iy(t,i),Su[t]=!0)}function Oy(i,t){return i-t*Math.floor(i/t)}function Ye(i){return i!=null&&!isNaN(i)}function Mf(i,t={}){let e,n;if(i.forEach(function(a){switch(a.header.parameterCategory+","+a.header.parameterNumber){case"1,2":case"2,2":e=a;break;case"1,3":case"2,3":n=a;break}}),!n||!e)return;const s=e.header;return new Rf({xmin:s.lo1,ymin:s.la1,xmax:s.lo2,ymax:s.la2,deltaX:s.dx,deltaY:s.dy,cols:s.nx,rows:s.ny,us:e.data,vs:n.data,...t})}function ky(i,t,e,n){if(typeof document<"u"){const s=document.createElement("canvas");return s.width=i*e,s.height=t*e,s}else return new n(i*e,t*e)}let Pu=class{constructor(t,e){this.u=t,this.v=e,this.m=this.magnitude()}magnitude(){return Math.sqrt(this.u**2+this.v**2)}directionTo(){let e=Math.atan2(this.u,this.v)*(180/Math.PI);return e<0&&(e+=360),e}directionFrom(){return(this.directionTo()+180)%360}};class Rf{constructor(t){this.grid=[],this.xmin=t.xmin,this.xmax=t.xmax,this.ymin=t.ymin,this.ymax=t.ymax,this.cols=t.cols,this.rows=t.rows,this.us=t.us,this.vs=t.vs,this.deltaX=t.deltaX,this.deltaY=t.deltaY,this.flipY=!!t.flipY,this.ymin=Math.min(t.ymax,t.ymin),this.ymax=Math.max(t.ymax,t.ymin),this.deltaY<0&&this.ymin<this.ymax||(t.flipY===void 0&&(this.flipY=!0),console.warn("[wind-core]: The data is flipY")),this.isFields=!0;const e=Math.ceil((this.xmax-this.xmin)/t.deltaX),n=Math.ceil((this.ymax-this.ymin)/t.deltaY);(e!==this.cols||n!==this.rows)&&console.warn("[wind-core]: The data grid not equal"),this.isContinuous=Math.floor(this.cols*t.deltaX)>=360,this.translateX="translateX"in t?t.translateX:this.xmax>180,"wrappedX"in t&&Ay("[wind-core]: ","`wrappedX` namespace will deprecated please use `translateX` instead！"),this.wrapX=!!t.wrapX,this.grid=this.buildGrid(),this.range=this.calculateRange()}buildGrid(){const t=[];let e=0;const{rows:n,cols:s,us:o,vs:a}=this;for(let h=0;h<n;h++){const c=[];for(let d=0;d<s;d++,e++){const f=o[e],_=a[e],p=this.isValid(f)&&this.isValid(_);c[d]=p?new Pu(f,_):null}this.isContinuous&&c.push(c[0]),t[h]=c}return t}release(){this.grid=[]}extent(){return[this.xmin,this.ymin,this.xmax,this.ymax]}bilinearInterpolateVector(t,e,n,s,o,a){const h=1-t,c=1-e,d=h*c,f=t*c,_=h*e,p=t*e,y=n.u*d+s.u*f+o.u*_+a.u*p,v=n.v*d+s.v*f+o.v*_+a.v*p;return new Pu(y,v)}calculateRange(){if(!this.grid||!this.grid[0])return;const t=this.grid.length,e=this.grid[0].length;let n,s;for(let o=0;o<t;o++)for(let a=0;a<e;a++){const h=this.grid[o][a];if(h!==null){const c=h.m||h.magnitude();n===void 0?n=c:s===void 0?(s=c,n=Math.min(n,s),s=Math.max(n,s)):(n=Math.min(c,n),s=Math.max(c,s))}}return[n,s]}isValid(t){return t!=null}getWrappedLongitudes(){let t=this.xmin,e=this.xmax;return this.translateX&&(this.isContinuous?(t=-180,e=180):(e=this.xmax-360,t=this.xmin-360)),[t,e]}contains(t,e){const[n,s]=this.getWrappedLongitudes();s>180&&t>=-180&&t<=s-360?t+=360:n<-180&&t<=180&&t>=n+360&&(t-=360);const o=t>=n&&t<=s;let a;return this.deltaY>=0?a=e>=this.ymin&&e<=this.ymax:a=e>=this.ymax&&e<=this.ymin,o&&a}getDecimalIndexes(t,e){const n=Oy(t-this.xmin,360)/this.deltaX;if(this.flipY){const s=(this.ymax-e)/this.deltaY;return[n,s]}else{const s=(this.ymin+e)/this.deltaY;return[n,s]}}valueAt(t,e){let n=!1;if((this.wrapX||this.contains(t,e))&&(n=!0),!n)return null;const s=this.getDecimalIndexes(t,e),o=Math.floor(s[0]),a=Math.floor(s[1]),h=this.clampColumnIndex(o),c=this.clampRowIndex(a);return this.valueAtIndexes(h,c)}interpolatedValueAt(t,e){let n=!1;if((this.wrapX||this.contains(t,e))&&(n=!0),!n)return null;const[s,o]=this.getDecimalIndexes(t,e);return this.interpolatePoint(s,o)}hasValueAt(t,e){return this.valueAt(t,e)!==null}interpolatePoint(t,e){const n=this.getFourSurroundingIndexes(t,e),[s,o,a,h]=n,c=this.getFourSurroundingValues(s,o,a,h);if(c){const[d,f,_,p]=c;return this.bilinearInterpolateVector(t-s,e-a,d,f,_,p)}return null}clampColumnIndex(t){let e=t;t<0&&(e=0);const n=this.cols-1;return t>n&&(e=n),e}clampRowIndex(t){let e=t;t<0&&(e=0);const n=this.rows-1;return t>n&&(e=n),e}getFourSurroundingIndexes(t,e){const n=Math.floor(t);let s=n+1;this.isContinuous&&s>=this.cols&&(s=0),s=this.clampColumnIndex(s);const o=this.clampRowIndex(Math.floor(e)),a=this.clampRowIndex(o+1);return[n,s,o,a]}getFourSurroundingValues(t,e,n,s){let o;if(o=this.grid[n]){const a=o[t],h=o[e];if(this.isValid(a)&&this.isValid(h)&&(o=this.grid[s])){const c=o[t],d=o[e];if(this.isValid(c)&&this.isValid(d))return[a,h,c,d]}}return null}valueAtIndexes(t,e){return this.grid[e][t]}lonLatAtIndexes(t,e){const n=this.longitudeAtX(t),s=this.latitudeAtY(e);return[n,s]}longitudeAtX(t){const e=this.deltaX/2;let n=this.xmin+e+t*this.deltaX;return this.translateX&&(n=n>180?n-360:n),n}latitudeAtY(t){const e=this.deltaY/2;return this.ymax-e-t*this.deltaY}randomize(t={},e,n,s){const o=Math.random()*(e||this.cols)|0,a=Math.random()*(n||this.rows)|0,h=s([o,a]);return h!==null?(t.x=h[0],t.y=h[1]):(t.x=this.longitudeAtX(o),t.y=this.latitudeAtY(a)),t}checkFields(){return this.isFields}}const Ch={globalAlpha:.9,lineWidth:1,colorScale:"#fff",velocityScale:1/25,maxAge:90,paths:800,frameRate:20,useCoordsDraw:!0};function Mu(i,t,e,n){return Math.max(0,Math.min(n.length-1,Math.round((i-t)/(e-t)*(n.length-1))))}const Th=class Th{constructor(t,e,n){if(this.particles=[],this.generated=!1,this.ctx=t,!this.ctx)throw new Error("ctx error");this.animate=this.animate.bind(this),this.setOptions(e),n&&this.updateData(n)}setOptions(t){this.options={...Ch,...t};const{width:e,height:n}=this.ctx.canvas;"particleAge"in t&&!("maxAge"in t)&&il(this.options.particleAge)&&(this.options.maxAge=this.options.particleAge),"particleMultiplier"in t&&!("paths"in t)&&il(this.options.particleMultiplier)&&(this.options.paths=Math.round(e*n*this.options.particleMultiplier)),this.prerender()}getOptions(){return this.options}updateData(t){this.field=t,this.generated&&(this.particles=this.prepareParticlePaths())}project(...t){throw new Error("project must be overriden")}unproject(...t){throw new Error("unproject must be overriden")}intersectsCoordinate(t){throw new Error("must be overriden")}clearCanvas(){this.stop(),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.forceStop=!1}isStop(){return!this.starting}start(){this.starting=!0,this.forceStop=!1,this.then=Date.now(),this.animate()}stop(){cancelAnimationFrame(this.animationLoop),this.starting=!1,this.forceStop=!0}animate(){this.animationLoop&&cancelAnimationFrame(this.animationLoop),this.animationLoop=requestAnimationFrame(this.animate);const t=Date.now(),e=t-this.then;e>this.options.frameRate&&(this.then=t-e%this.options.frameRate,this.render())}prerender(){this.generated=!1,this.field&&(this.particles=this.prepareParticlePaths(),this.generated=!0,!this.starting&&!this.forceStop&&(this.starting=!0,this.then=Date.now(),this.animate()))}render(){this.moveParticles(),this.drawParticles(),this.postrender()}postrender(){}moveParticles(){const{width:t,height:e}=this.ctx.canvas,n=this.particles,s=this.options.maxAge,o=Os(this.options.velocityScale)?this.options.velocityScale():this.options.velocityScale;let a=0;const h=n.length;for(;a<h;a++){const c=n[a];c.age>s&&(c.age=0,this.field.randomize(c,t,e,this.unproject));const d=c.x,f=c.y,_=this.field.interpolatedValueAt(d,f);if(_===null)c.age=s;else{const p=d+_.u*o,y=f+_.v*o;this.field.hasValueAt(p,y)?(c.xt=p,c.yt=y,c.m=_.m):(c.x=p,c.y=y,c.age=s)}c.age++}}fadeIn(){const t=this.ctx.globalCompositeOperation;this.ctx.globalCompositeOperation="destination-in",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.globalCompositeOperation=t}drawParticles(){const t=this.particles;this.fadeIn(),this.ctx.globalAlpha=this.options.globalAlpha,this.ctx.fillStyle=`rgba(0, 0, 0, ${this.options.globalAlpha})`,this.ctx.lineWidth=il(this.options.lineWidth)?this.options.lineWidth:1,this.ctx.strokeStyle=Ry(this.options.colorScale)?this.options.colorScale:"#fff";let e=0;const n=t.length;if(this.field&&n>0){let s,o;for(Ye(this.options.minVelocity)&&Ye(this.options.maxVelocity)?(s=this.options.minVelocity,o=this.options.maxVelocity):[s,o]=this.field.range;e<n;e++)this[this.options.useCoordsDraw?"drawCoordsParticle":"drawPixelParticle"](t[e],s,o)}}drawPixelParticle(t,e,n){const s=[t.x,t.y],o=[t.xt,t.yt];if(o&&s&&Ye(o[0])&&Ye(o[1])&&Ye(s[0])&&Ye(s[1])&&t.age<=this.options.maxAge){if(this.ctx.beginPath(),this.ctx.moveTo(s[0],s[1]),this.ctx.lineTo(o[0],o[1]),Os(this.options.colorScale))this.ctx.strokeStyle=this.options.colorScale(t.m);else if(Array.isArray(this.options.colorScale)){const a=Mu(t.m,e,n,this.options.colorScale);this.ctx.strokeStyle=this.options.colorScale[a]}Os(this.options.lineWidth)&&(this.ctx.lineWidth=this.options.lineWidth(t.m)),t.x=t.xt,t.y=t.yt,this.ctx.stroke()}}drawCoordsParticle(t,e,n){const s=[t.x,t.y],o=[t.xt,t.yt];if(o&&s&&Ye(o[0])&&Ye(o[1])&&Ye(s[0])&&Ye(s[1])&&this.intersectsCoordinate(o)&&t.age<=this.options.maxAge){const a=this.project(s),h=this.project(o);if(a&&h){if(this.ctx.beginPath(),this.ctx.moveTo(a[0],a[1]),this.ctx.lineTo(h[0],h[1]),t.x=t.xt,t.y=t.yt,Os(this.options.colorScale))this.ctx.strokeStyle=this.options.colorScale(t.m);else if(Array.isArray(this.options.colorScale)){const c=Mu(t.m,e,n,this.options.colorScale);this.ctx.strokeStyle=this.options.colorScale[c]}Os(this.options.lineWidth)&&(this.ctx.lineWidth=this.options.lineWidth(t.m)),this.ctx.stroke()}}}prepareParticlePaths(){const{width:t,height:e}=this.ctx.canvas,n=typeof this.options.paths=="function"?this.options.paths(this):this.options.paths,s=[];if(!this.field)return[];let o=0;for(;o<n;o++)s.push(this.field.randomize({age:this.randomize()},t,e,this.unproject));return s}randomize(){return Math.floor(Math.random()*this.options.maxAge)}};Th.Field=Rf;let Ro=Th;const Ru={ANIMATING:0,INTERACTING:1};class Dy extends _h{constructor(t){super(t),this.pixelTransform=me(),this.inversePixelTransform=me()}useContainer(t,e,n){super.useContainer(null,e,n)}getBackground(t){return super.getBackground?super.getBackground(t):""}prepareFrame(t){var a,h;const e=t.layerStatesArray[t.layerIndex],n=t.viewState,s=t.viewHints;let o=t.extent;return e.extent!==void 0&&(o=Zi(o,He(e.extent,n.projection))),!s[Ru.ANIMATING]&&!t.animate&&!s[Ru.INTERACTING]&&!hr(o)?((h=(a=this.wind)==null?void 0:a.isStop)!=null&&h.call(a)&&this.wind.start(),!0):this.getLayer().get("forceRender")}prepareContainer(t,e){const n=t.size,s=t.viewState.rotation,o=t.pixelRatio,a=Math.round(n[0]*o),h=Math.round(n[1]*o);Qe(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/o,1/o,s,-a/2,-h/2),Wl(this.inversePixelTransform,this.pixelTransform);const c=bd(this.pixelTransform);if(this.useContainer(e,c,this.getBackground(t)),!this.containerReused){const d=this.context.canvas;(d.width!=a||d.height!=h)&&(d.width=a,d.height=h),c!==d.style.transform&&(d.style.transform=c)}}getRenderContext(t){return this.context}renderFrame(t,e){const n=t.layerStatesArray[t.layerIndex],s=t.viewState;this.prepareContainer(t,e);const o=this.getRenderContext(t);o.imageSmoothingEnabled=!1,this.preRender(o,t);let a=!1,h=!0;if(n.extent){const _=He(n.extent,s.projection);h=ee(_,t.extent),a=h&&!an(_,t.extent),a&&this.clipUnrotated(o,t,_)}const c=this.getLayer(),d=c.getWindOptions(),f=c.getData();return this.execute(this.context,t,d,f),this.postRender(this.context,t),a&&o.restore(),o.imageSmoothingEnabled=!0,this.container}setOptions(t){this.wind&&this.wind.setOptions(t)}setData(t){this.wind&&this.wind.updateData(t)}execute(t,e,n,s){this.wind||(this.wind=new Ro(t,n,s),this.wind.project=this.getPixelFromCoordinateInternal.bind(this),this.wind.unproject=this.getCoordinateFromPixel.bind(this),this.wind.intersectsCoordinate=this.intersectsCoordinate.bind(this),this.wind.postrender=()=>{},this.wind.prerender())}getPixelFromCoordinateInternal(t){const e=this.frameState;if(e){const n=e.viewState,s=e.pixelRatio,o=gn(t,"EPSG:4326",n.projection),a=ke(o,n.projection),h=zt(e.coordinateToPixelTransform,a.slice(0,2));return[h[0]*s,h[1]*s]}else return null}getCoordinateFromPixel(t){const e=this.frameState;if(e){const n=e.viewState,s=zt(e.pixelToCoordinateTransform,t.slice(0,2)),o=mo(s,n.projection),a=gn(o,n.projection,"EPSG:4326");return[a[0],a[1]]}else return null}intersectsCoordinate(t){const e=this.frameState;if(e){const n=e.viewState,s=gn(t,"EPSG:4326",n.projection),o=ke(s,n.projection);return yn(e.extent,o.slice(0,2))}return!0}}const Fy={forceRender:!0,windOptions:{}};let zy=class extends gr{constructor(t,e){const n=js({},Fy,e);super(n),this.options=n,this.className_=e.className!==void 0?e.className:"wind-layer",this.pickWindOptions(),t&&this.setData(t,e.fieldOptions)}appendTo(t){t.addLayer(this)}onAdd(){var e;const t=this.getRenderer();t&&((e=t.wind)==null||e.start())}onRemove(){const t=this.getRenderer();t&&t.wind.stop()}createRenderer(){return new Dy(this)}getRenderer(){return super.getRenderer()}pickWindOptions(){Object.keys(Ch).forEach(t=>{t in this.options&&(this.options.windOptions===void 0&&(this.options.windOptions={}),this.options.windOptions[t]=this.options[t])})}getData(){return this.field}setData(t,e={}){t&&t.checkFields&&t.checkFields()?this.field=t:Pf(t)?this.field=Mf(t,e):console.error("Illegal data");const n=this.getRenderer();return n&&this.field&&n.setData(this.field),this.changed(),this}setWindOptions(t){const e=this.options.windOptions||{};this.options=js(this.options,{windOptions:js(e,t||{})});const n=this.getRenderer();if(n){const s=this.options.windOptions;n.setOptions(s)}this.changed()}getWindOptions(){return this.options.windOptions||{}}render(t,e){const n=this.getRenderer();return n&&n.prepareFrame(t)?(this.rendered=!0,n.renderFrame(t,e)):null}setMapInternal(t){super.setMapInternal(t),t?this.onAdd():this.onRemove()}setMap(t){super.setMap(t),t?this.onAdd():this.onRemove()}};var Et=1e-6,ze=typeof Float32Array<"u"?Float32Array:Array;function Ny(i){ze=i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});function Zy(){var i=new ze(9);return ze!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Gy(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}function By(i,t,e,n,s,o,a,h,c,d,f,_,p,y,v,w,C){return i[0]=t,i[1]=e,i[2]=n,i[3]=s,i[4]=o,i[5]=a,i[6]=h,i[7]=c,i[8]=d,i[9]=f,i[10]=_,i[11]=p,i[12]=y,i[13]=v,i[14]=w,i[15]=C,i}function If(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Wy(i,t){if(i===t){var e=t[1],n=t[2],s=t[3],o=t[6],a=t[7],h=t[11];i[1]=t[4],i[2]=t[8],i[3]=t[12],i[4]=e,i[6]=t[9],i[7]=t[13],i[8]=n,i[9]=o,i[11]=t[14],i[12]=s,i[13]=a,i[14]=h}else i[0]=t[0],i[1]=t[4],i[2]=t[8],i[3]=t[12],i[4]=t[1],i[5]=t[5],i[6]=t[9],i[7]=t[13],i[8]=t[2],i[9]=t[6],i[10]=t[10],i[11]=t[14],i[12]=t[3],i[13]=t[7],i[14]=t[11],i[15]=t[15];return i}function Xy(i,t){var e=t[0],n=t[1],s=t[2],o=t[3],a=t[4],h=t[5],c=t[6],d=t[7],f=t[8],_=t[9],p=t[10],y=t[11],v=t[12],w=t[13],C=t[14],E=t[15],T=e*h-n*a,M=e*c-s*a,S=e*d-o*a,P=n*c-s*h,A=n*d-o*h,D=s*d-o*c,k=f*w-_*v,F=f*C-p*v,B=f*E-y*v,X=_*C-p*w,W=_*E-y*w,Y=p*E-y*C,Z=T*Y-M*W+S*X+P*B-A*F+D*k;return Z?(Z=1/Z,i[0]=(h*Y-c*W+d*X)*Z,i[1]=(s*W-n*Y-o*X)*Z,i[2]=(w*D-C*A+E*P)*Z,i[3]=(p*A-_*D-y*P)*Z,i[4]=(c*B-a*Y-d*F)*Z,i[5]=(e*Y-s*B+o*F)*Z,i[6]=(C*S-v*D-E*M)*Z,i[7]=(f*D-p*S+y*M)*Z,i[8]=(a*W-h*B+d*k)*Z,i[9]=(n*B-e*W-o*k)*Z,i[10]=(v*A-w*S+E*T)*Z,i[11]=(_*S-f*A-y*T)*Z,i[12]=(h*F-a*X-c*k)*Z,i[13]=(e*X-n*F+s*k)*Z,i[14]=(w*M-v*P-C*T)*Z,i[15]=(f*P-_*M+p*T)*Z,i):null}function jy(i,t){var e=t[0],n=t[1],s=t[2],o=t[3],a=t[4],h=t[5],c=t[6],d=t[7],f=t[8],_=t[9],p=t[10],y=t[11],v=t[12],w=t[13],C=t[14],E=t[15];return i[0]=h*(p*E-y*C)-_*(c*E-d*C)+w*(c*y-d*p),i[1]=-(n*(p*E-y*C)-_*(s*E-o*C)+w*(s*y-o*p)),i[2]=n*(c*E-d*C)-h*(s*E-o*C)+w*(s*d-o*c),i[3]=-(n*(c*y-d*p)-h*(s*y-o*p)+_*(s*d-o*c)),i[4]=-(a*(p*E-y*C)-f*(c*E-d*C)+v*(c*y-d*p)),i[5]=e*(p*E-y*C)-f*(s*E-o*C)+v*(s*y-o*p),i[6]=-(e*(c*E-d*C)-a*(s*E-o*C)+v*(s*d-o*c)),i[7]=e*(c*y-d*p)-a*(s*y-o*p)+f*(s*d-o*c),i[8]=a*(_*E-y*w)-f*(h*E-d*w)+v*(h*y-d*_),i[9]=-(e*(_*E-y*w)-f*(n*E-o*w)+v*(n*y-o*_)),i[10]=e*(h*E-d*w)-a*(n*E-o*w)+v*(n*d-o*h),i[11]=-(e*(h*y-d*_)-a*(n*y-o*_)+f*(n*d-o*h)),i[12]=-(a*(_*C-p*w)-f*(h*C-c*w)+v*(h*p-c*_)),i[13]=e*(_*C-p*w)-f*(n*C-s*w)+v*(n*p-s*_),i[14]=-(e*(h*C-c*w)-a*(n*C-s*w)+v*(n*c-s*h)),i[15]=e*(h*p-c*_)-a*(n*p-s*_)+f*(n*c-s*h),i}function Yy(i){var t=i[0],e=i[1],n=i[2],s=i[3],o=i[4],a=i[5],h=i[6],c=i[7],d=i[8],f=i[9],_=i[10],p=i[11],y=i[12],v=i[13],w=i[14],C=i[15],E=t*a-e*o,T=t*h-n*o,M=t*c-s*o,S=e*h-n*a,P=e*c-s*a,A=n*c-s*h,D=d*v-f*y,k=d*w-_*y,F=d*C-p*y,B=f*w-_*v,X=f*C-p*v,W=_*C-p*w;return E*W-T*X+M*B+S*F-P*k+A*D}function io(i,t,e){var n=t[0],s=t[1],o=t[2],a=t[3],h=t[4],c=t[5],d=t[6],f=t[7],_=t[8],p=t[9],y=t[10],v=t[11],w=t[12],C=t[13],E=t[14],T=t[15],M=e[0],S=e[1],P=e[2],A=e[3];return i[0]=M*n+S*h+P*_+A*w,i[1]=M*s+S*c+P*p+A*C,i[2]=M*o+S*d+P*y+A*E,i[3]=M*a+S*f+P*v+A*T,M=e[4],S=e[5],P=e[6],A=e[7],i[4]=M*n+S*h+P*_+A*w,i[5]=M*s+S*c+P*p+A*C,i[6]=M*o+S*d+P*y+A*E,i[7]=M*a+S*f+P*v+A*T,M=e[8],S=e[9],P=e[10],A=e[11],i[8]=M*n+S*h+P*_+A*w,i[9]=M*s+S*c+P*p+A*C,i[10]=M*o+S*d+P*y+A*E,i[11]=M*a+S*f+P*v+A*T,M=e[12],S=e[13],P=e[14],A=e[15],i[12]=M*n+S*h+P*_+A*w,i[13]=M*s+S*c+P*p+A*C,i[14]=M*o+S*d+P*y+A*E,i[15]=M*a+S*f+P*v+A*T,i}function Uy(i,t,e){var n=e[0],s=e[1],o=e[2],a,h,c,d,f,_,p,y,v,w,C,E;return t===i?(i[12]=t[0]*n+t[4]*s+t[8]*o+t[12],i[13]=t[1]*n+t[5]*s+t[9]*o+t[13],i[14]=t[2]*n+t[6]*s+t[10]*o+t[14],i[15]=t[3]*n+t[7]*s+t[11]*o+t[15]):(a=t[0],h=t[1],c=t[2],d=t[3],f=t[4],_=t[5],p=t[6],y=t[7],v=t[8],w=t[9],C=t[10],E=t[11],i[0]=a,i[1]=h,i[2]=c,i[3]=d,i[4]=f,i[5]=_,i[6]=p,i[7]=y,i[8]=v,i[9]=w,i[10]=C,i[11]=E,i[12]=a*n+f*s+v*o+t[12],i[13]=h*n+_*s+w*o+t[13],i[14]=c*n+p*s+C*o+t[14],i[15]=d*n+y*s+E*o+t[15]),i}function Iu(i,t,e){var n=e[0],s=e[1],o=e[2];return i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i[3]=t[3]*n,i[4]=t[4]*s,i[5]=t[5]*s,i[6]=t[6]*s,i[7]=t[7]*s,i[8]=t[8]*o,i[9]=t[9]*o,i[10]=t[10]*o,i[11]=t[11]*o,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}function Vy(i,t,e,n){var s=n[0],o=n[1],a=n[2],h=Math.hypot(s,o,a),c,d,f,_,p,y,v,w,C,E,T,M,S,P,A,D,k,F,B,X,W,Y,Z,Q;return h<Et?null:(h=1/h,s*=h,o*=h,a*=h,c=Math.sin(e),d=Math.cos(e),f=1-d,_=t[0],p=t[1],y=t[2],v=t[3],w=t[4],C=t[5],E=t[6],T=t[7],M=t[8],S=t[9],P=t[10],A=t[11],D=s*s*f+d,k=o*s*f+a*c,F=a*s*f-o*c,B=s*o*f-a*c,X=o*o*f+d,W=a*o*f+s*c,Y=s*a*f+o*c,Z=o*a*f-s*c,Q=a*a*f+d,i[0]=_*D+w*k+M*F,i[1]=p*D+C*k+S*F,i[2]=y*D+E*k+P*F,i[3]=v*D+T*k+A*F,i[4]=_*B+w*X+M*W,i[5]=p*B+C*X+S*W,i[6]=y*B+E*X+P*W,i[7]=v*B+T*X+A*W,i[8]=_*Y+w*Z+M*Q,i[9]=p*Y+C*Z+S*Q,i[10]=y*Y+E*Z+P*Q,i[11]=v*Y+T*Z+A*Q,t!==i&&(i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i)}function Ky(i,t,e){var n=Math.sin(e),s=Math.cos(e),o=t[4],a=t[5],h=t[6],c=t[7],d=t[8],f=t[9],_=t[10],p=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=o*s+d*n,i[5]=a*s+f*n,i[6]=h*s+_*n,i[7]=c*s+p*n,i[8]=d*s-o*n,i[9]=f*s-a*n,i[10]=_*s-h*n,i[11]=p*s-c*n,i}function Hy(i,t,e){var n=Math.sin(e),s=Math.cos(e),o=t[0],a=t[1],h=t[2],c=t[3],d=t[8],f=t[9],_=t[10],p=t[11];return t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=o*s-d*n,i[1]=a*s-f*n,i[2]=h*s-_*n,i[3]=c*s-p*n,i[8]=o*n+d*s,i[9]=a*n+f*s,i[10]=h*n+_*s,i[11]=c*n+p*s,i}function $y(i,t,e){var n=Math.sin(e),s=Math.cos(e),o=t[0],a=t[1],h=t[2],c=t[3],d=t[4],f=t[5],_=t[6],p=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=o*s+d*n,i[1]=a*s+f*n,i[2]=h*s+_*n,i[3]=c*s+p*n,i[4]=d*s-o*n,i[5]=f*s-a*n,i[6]=_*s-h*n,i[7]=p*s-c*n,i}function qy(i,t){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=1,i}function Jy(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Qy(i,t,e){var n=e[0],s=e[1],o=e[2],a=Math.hypot(n,s,o),h,c,d;return a<Et?null:(a=1/a,n*=a,s*=a,o*=a,h=Math.sin(t),c=Math.cos(t),d=1-c,i[0]=n*n*d+c,i[1]=s*n*d+o*h,i[2]=o*n*d-s*h,i[3]=0,i[4]=n*s*d-o*h,i[5]=s*s*d+c,i[6]=o*s*d+n*h,i[7]=0,i[8]=n*o*d+s*h,i[9]=s*o*d-n*h,i[10]=o*o*d+c,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}function tv(i,t){var e=Math.sin(t),n=Math.cos(t);return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=n,i[6]=e,i[7]=0,i[8]=0,i[9]=-e,i[10]=n,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function ev(i,t){var e=Math.sin(t),n=Math.cos(t);return i[0]=n,i[1]=0,i[2]=-e,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=e,i[9]=0,i[10]=n,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function iv(i,t){var e=Math.sin(t),n=Math.cos(t);return i[0]=n,i[1]=e,i[2]=0,i[3]=0,i[4]=-e,i[5]=n,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function nv(i,t,e){var n=t[0],s=t[1],o=t[2],a=t[3],h=n+n,c=s+s,d=o+o,f=n*h,_=n*c,p=n*d,y=s*c,v=s*d,w=o*d,C=a*h,E=a*c,T=a*d;return i[0]=1-(y+w),i[1]=_+T,i[2]=p-E,i[3]=0,i[4]=_-T,i[5]=1-(f+w),i[6]=v+C,i[7]=0,i[8]=p+E,i[9]=v-C,i[10]=1-(f+y),i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}function sv(i,t){return i[0]=t[12],i[1]=t[13],i[2]=t[14],i}function Af(i,t){var e=t[0],n=t[1],s=t[2],o=t[4],a=t[5],h=t[6],c=t[8],d=t[9],f=t[10];return i[0]=Math.hypot(e,n,s),i[1]=Math.hypot(o,a,h),i[2]=Math.hypot(c,d,f),i}function rv(i,t){var e=new ze(3);Af(e,t);var n=1/e[0],s=1/e[1],o=1/e[2],a=t[0]*n,h=t[1]*s,c=t[2]*o,d=t[4]*n,f=t[5]*s,_=t[6]*o,p=t[8]*n,y=t[9]*s,v=t[10]*o,w=a+f+v,C=0;return w>0?(C=Math.sqrt(w+1)*2,i[3]=.25*C,i[0]=(_-y)/C,i[1]=(p-c)/C,i[2]=(h-d)/C):a>f&&a>v?(C=Math.sqrt(1+a-f-v)*2,i[3]=(_-y)/C,i[0]=.25*C,i[1]=(h+d)/C,i[2]=(p+c)/C):f>v?(C=Math.sqrt(1+f-a-v)*2,i[3]=(p-c)/C,i[0]=(h+d)/C,i[1]=.25*C,i[2]=(_+y)/C):(C=Math.sqrt(1+v-a-f)*2,i[3]=(h-d)/C,i[0]=(p+c)/C,i[1]=(_+y)/C,i[2]=.25*C),i}function ov(i,t,e,n){var s=t[0],o=t[1],a=t[2],h=t[3],c=s+s,d=o+o,f=a+a,_=s*c,p=s*d,y=s*f,v=o*d,w=o*f,C=a*f,E=h*c,T=h*d,M=h*f,S=n[0],P=n[1],A=n[2];return i[0]=(1-(v+C))*S,i[1]=(p+M)*S,i[2]=(y-T)*S,i[3]=0,i[4]=(p-M)*P,i[5]=(1-(_+C))*P,i[6]=(w+E)*P,i[7]=0,i[8]=(y+T)*A,i[9]=(w-E)*A,i[10]=(1-(_+v))*A,i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}function av(i,t){var e=t[0],n=t[1],s=t[2],o=t[3],a=e+e,h=n+n,c=s+s,d=e*a,f=n*a,_=n*h,p=s*a,y=s*h,v=s*c,w=o*a,C=o*h,E=o*c;return i[0]=1-_-v,i[1]=f+E,i[2]=p-C,i[3]=0,i[4]=f-E,i[5]=1-d-v,i[6]=y+w,i[7]=0,i[8]=p+C,i[9]=y-w,i[10]=1-d-_,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function lv(i,t,e,n,s){var o=1/Math.tan(t/2),a;return i[0]=o/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,s!=null&&s!==1/0?(a=1/(n-s),i[10]=(s+n)*a,i[14]=2*s*n*a):(i[10]=-1,i[14]=-2*n),i}var hv=lv;function cv(i,t,e,n,s,o,a){var h=1/(t-e),c=1/(n-s),d=1/(o-a);return i[0]=-2*h,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*c,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*d,i[11]=0,i[12]=(t+e)*h,i[13]=(s+n)*c,i[14]=(a+o)*d,i[15]=1,i}var uv=cv;function Au(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i[3]=t[3]+e[3],i[4]=t[4]+e[4],i[5]=t[5]+e[5],i[6]=t[6]+e[6],i[7]=t[7]+e[7],i[8]=t[8]+e[8],i[9]=t[9]+e[9],i[10]=t[10]+e[10],i[11]=t[11]+e[11],i[12]=t[12]+e[12],i[13]=t[13]+e[13],i[14]=t[14]+e[14],i[15]=t[15]+e[15],i}function Ou(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i[3]=t[3]-e[3],i[4]=t[4]-e[4],i[5]=t[5]-e[5],i[6]=t[6]-e[6],i[7]=t[7]-e[7],i[8]=t[8]-e[8],i[9]=t[9]-e[9],i[10]=t[10]-e[10],i[11]=t[11]-e[11],i[12]=t[12]-e[12],i[13]=t[13]-e[13],i[14]=t[14]-e[14],i[15]=t[15]-e[15],i}function dv(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i[4]=t[4]*e,i[5]=t[5]*e,i[6]=t[6]*e,i[7]=t[7]*e,i[8]=t[8]*e,i[9]=t[9]*e,i[10]=t[10]*e,i[11]=t[11]*e,i[12]=t[12]*e,i[13]=t[13]*e,i[14]=t[14]*e,i[15]=t[15]*e,i}function fv(i,t){var e=i[0],n=i[1],s=i[2],o=i[3],a=i[4],h=i[5],c=i[6],d=i[7],f=i[8],_=i[9],p=i[10],y=i[11],v=i[12],w=i[13],C=i[14],E=i[15],T=t[0],M=t[1],S=t[2],P=t[3],A=t[4],D=t[5],k=t[6],F=t[7],B=t[8],X=t[9],W=t[10],Y=t[11],Z=t[12],Q=t[13],V=t[14],J=t[15];return Math.abs(e-T)<=Et*Math.max(1,Math.abs(e),Math.abs(T))&&Math.abs(n-M)<=Et*Math.max(1,Math.abs(n),Math.abs(M))&&Math.abs(s-S)<=Et*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(o-P)<=Et*Math.max(1,Math.abs(o),Math.abs(P))&&Math.abs(a-A)<=Et*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(h-D)<=Et*Math.max(1,Math.abs(h),Math.abs(D))&&Math.abs(c-k)<=Et*Math.max(1,Math.abs(c),Math.abs(k))&&Math.abs(d-F)<=Et*Math.max(1,Math.abs(d),Math.abs(F))&&Math.abs(f-B)<=Et*Math.max(1,Math.abs(f),Math.abs(B))&&Math.abs(_-X)<=Et*Math.max(1,Math.abs(_),Math.abs(X))&&Math.abs(p-W)<=Et*Math.max(1,Math.abs(p),Math.abs(W))&&Math.abs(y-Y)<=Et*Math.max(1,Math.abs(y),Math.abs(Y))&&Math.abs(v-Z)<=Et*Math.max(1,Math.abs(v),Math.abs(Z))&&Math.abs(w-Q)<=Et*Math.max(1,Math.abs(w),Math.abs(Q))&&Math.abs(C-V)<=Et*Math.max(1,Math.abs(C),Math.abs(V))&&Math.abs(E-J)<=Et*Math.max(1,Math.abs(E),Math.abs(J))}function Of(){var i=new ze(3);return ze!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function kf(i){var t=i[0],e=i[1],n=i[2];return Math.hypot(t,e,n)}function ku(i,t,e){var n=new ze(3);return n[0]=i,n[1]=t,n[2]=e,n}function gv(i,t,e,n){return i[0]=t,i[1]=e,i[2]=n,i}function Du(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i}function nl(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i}function Fu(i,t,e){return i[0]=t[0]*e[0],i[1]=t[1]*e[1],i[2]=t[2]*e[2],i}function zu(i,t,e){return i[0]=t[0]/e[0],i[1]=t[1]/e[1],i[2]=t[2]/e[2],i}function _v(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i}function mv(i,t,e,n){return i[0]=t[0]+e[0]*n,i[1]=t[1]+e[1]*n,i[2]=t[2]+e[2]*n,i}function pv(i,t){var e=t[0]-i[0],n=t[1]-i[1],s=t[2]-i[2];return Math.hypot(e,n,s)}function yv(i,t){var e=t[0]-i[0],n=t[1]-i[1],s=t[2]-i[2];return e*e+n*n+s*s}function vv(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i}function xv(i,t){return i[0]=1/t[0],i[1]=1/t[1],i[2]=1/t[2],i}function Df(i,t){var e=t[0],n=t[1],s=t[2],o=e*e+n*n+s*s;return o>0&&(o=1/Math.sqrt(o)),i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i}function Eh(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]}function oo(i,t,e){var n=t[0],s=t[1],o=t[2],a=e[0],h=e[1],c=e[2];return i[0]=s*c-o*h,i[1]=o*a-n*c,i[2]=n*h-s*a,i}function wv(i,t,e,n){var s=t[0],o=t[1],a=t[2];return i[0]=s+n*(e[0]-s),i[1]=o+n*(e[1]-o),i[2]=a+n*(e[2]-a),i}function Cv(i,t,e){var n=t[0],s=t[1],o=t[2],a=e[3]*n+e[7]*s+e[11]*o+e[15];return a=a||1,i[0]=(e[0]*n+e[4]*s+e[8]*o+e[12])/a,i[1]=(e[1]*n+e[5]*s+e[9]*o+e[13])/a,i[2]=(e[2]*n+e[6]*s+e[10]*o+e[14])/a,i}function Ev(i,t,e){var n=t[0],s=t[1],o=t[2];return i[0]=n*e[0]+s*e[3]+o*e[6],i[1]=n*e[1]+s*e[4]+o*e[7],i[2]=n*e[2]+s*e[5]+o*e[8],i}function bv(i,t,e){var n=e[0],s=e[1],o=e[2],a=e[3],h=t[0],c=t[1],d=t[2],f=s*d-o*c,_=o*h-n*d,p=n*c-s*h,y=s*p-o*_,v=o*f-n*p,w=n*_-s*f,C=a*2;return f*=C,_*=C,p*=C,y*=2,v*=2,w*=2,i[0]=h+f+y,i[1]=c+_+v,i[2]=d+p+w,i}function Nu(i,t){var e=i[0],n=i[1],s=i[2],o=t[0],a=t[1],h=t[2],c=Math.sqrt(e*e+n*n+s*s),d=Math.sqrt(o*o+a*a+h*h),f=c*d,_=f&&Eh(i,t)/f;return Math.acos(Math.min(Math.max(_,-1),1))}function Tv(i,t){var e=i[0],n=i[1],s=i[2],o=t[0],a=t[1],h=t[2];return Math.abs(e-o)<=Et*Math.max(1,Math.abs(e),Math.abs(o))&&Math.abs(n-a)<=Et*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(s-h)<=Et*Math.max(1,Math.abs(s),Math.abs(h))}var Lv=kf;(function(){var i=Of();return function(t,e,n,s,o,a){var h,c;for(e||(e=3),n||(n=0),s?c=Math.min(s*e+n,t.length):c=t.length,h=n;h<c;h+=e)i[0]=t[h],i[1]=t[h+1],i[2]=t[h+2],o(i,i,a),t[h]=i[0],t[h+1]=i[1],t[h+2]=i[2];return t}})();function Sv(){var i=new ze(4);return ze!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0,i[3]=0),i}function Pv(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i}function Mv(i,t,e,n,s){return i[0]=t,i[1]=e,i[2]=n,i[3]=s,i}function Rv(i){var t=i[0],e=i[1],n=i[2],s=i[3];return Math.hypot(t,e,n,s)}function Iv(i,t){var e=t[0],n=t[1],s=t[2],o=t[3],a=e*e+n*n+s*s+o*o;return a>0&&(a=1/Math.sqrt(a)),i[0]=e*a,i[1]=n*a,i[2]=s*a,i[3]=o*a,i}function Av(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]}function Ov(i,t){var e=i[0],n=i[1],s=i[2],o=i[3],a=t[0],h=t[1],c=t[2],d=t[3];return Math.abs(e-a)<=Et*Math.max(1,Math.abs(e),Math.abs(a))&&Math.abs(n-h)<=Et*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(s-c)<=Et*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(o-d)<=Et*Math.max(1,Math.abs(o),Math.abs(d))}(function(){var i=Sv();return function(t,e,n,s,o,a){var h,c;for(e||(e=4),n||(n=0),s?c=Math.min(s*e+n,t.length):c=t.length,h=n;h<c;h+=e)i[0]=t[h],i[1]=t[h+1],i[2]=t[h+2],i[3]=t[h+3],o(i,i,a),t[h]=i[0],t[h+1]=i[1],t[h+2]=i[2],t[h+3]=i[3];return t}})();function Zu(){var i=new ze(4);return ze!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Ff(i,t,e){e=e*.5;var n=Math.sin(e);return i[0]=n*t[0],i[1]=n*t[1],i[2]=n*t[2],i[3]=Math.cos(e),i}function kv(i,t){var e=Math.acos(t[3])*2,n=Math.sin(e/2);return n>Et?(i[0]=t[0]/n,i[1]=t[1]/n,i[2]=t[2]/n):(i[0]=1,i[1]=0,i[2]=0),e}function Dv(i,t){var e=Nf(i,t);return Math.acos(2*e*e-1)}function Gu(i,t,e){var n=t[0],s=t[1],o=t[2],a=t[3],h=e[0],c=e[1],d=e[2],f=e[3];return i[0]=n*f+a*h+s*d-o*c,i[1]=s*f+a*c+o*h-n*d,i[2]=o*f+a*d+n*c-s*h,i[3]=a*f-n*h-s*c-o*d,i}function ao(i,t,e,n){var s=t[0],o=t[1],a=t[2],h=t[3],c=e[0],d=e[1],f=e[2],_=e[3],p,y,v,w,C;return y=s*c+o*d+a*f+h*_,y<0&&(y=-y,c=-c,d=-d,f=-f,_=-_),1-y>Et?(p=Math.acos(y),v=Math.sin(p),w=Math.sin((1-n)*p)/v,C=Math.sin(n*p)/v):(w=1-n,C=n),i[0]=w*s+C*c,i[1]=w*o+C*d,i[2]=w*a+C*f,i[3]=w*h+C*_,i}function Fv(i,t){var e=t[0],n=t[1],s=t[2],o=t[3],a=e*e+n*n+s*s+o*o,h=a?1/a:0;return i[0]=-e*h,i[1]=-n*h,i[2]=-s*h,i[3]=o*h,i}function zv(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i[3]=t[3],i}function zf(i,t){var e=t[0]+t[4]+t[8],n;if(e>0)n=Math.sqrt(e+1),i[3]=.5*n,n=.5/n,i[0]=(t[5]-t[7])*n,i[1]=(t[6]-t[2])*n,i[2]=(t[1]-t[3])*n;else{var s=0;t[4]>t[0]&&(s=1),t[8]>t[s*3+s]&&(s=2);var o=(s+1)%3,a=(s+2)%3;n=Math.sqrt(t[s*3+s]-t[o*3+o]-t[a*3+a]+1),i[s]=.5*n,n=.5/n,i[3]=(t[o*3+a]-t[a*3+o])*n,i[o]=(t[o*3+s]+t[s*3+o])*n,i[a]=(t[a*3+s]+t[s*3+a])*n}return i}function Nv(i,t,e,n){var s=.5*Math.PI/180;t*=s,e*=s,n*=s;var o=Math.sin(t),a=Math.cos(t),h=Math.sin(e),c=Math.cos(e),d=Math.sin(n),f=Math.cos(n);return i[0]=o*c*f-a*h*d,i[1]=a*h*f+o*c*d,i[2]=a*c*d-o*h*f,i[3]=a*c*f+o*h*d,i}var Zv=Pv,Gv=Mv,Nf=Av,Bv=Rv,bh=Iv;(function(){var i=Of(),t=ku(1,0,0),e=ku(0,1,0);return function(n,s,o){var a=Eh(s,o);return a<-.999999?(oo(i,t,s),Lv(i)<1e-6&&oo(i,e,s),Df(i,i),Ff(n,i,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(oo(i,s,o),n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=1+a,bh(n,n))}})();(function(){var i=Zu(),t=Zu();return function(e,n,s,o,a,h){return ao(i,n,a,h),ao(t,s,o,h),ao(e,i,t,2*h*(1-h)),e}})();(function(){var i=Zy();return function(t,e,n,s){return i[0]=n[0],i[3]=n[1],i[6]=n[2],i[1]=s[0],i[4]=s[1],i[7]=s[2],i[2]=-e[0],i[5]=-e[1],i[8]=-e[2],bh(t,zf(t,i))}})();var Wv={grad:.9,turn:360,rad:360/(2*Math.PI)},ui=function(i){return typeof i=="string"?i.length>0:typeof i=="number"},Xt=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*i)/e+0},be=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),i>e?e:i>t?i:t},Zf=function(i){return(i=isFinite(i)?i%360:0)>0?i:i+360},Bu=function(i){return{r:be(i.r,0,255),g:be(i.g,0,255),b:be(i.b,0,255),a:be(i.a)}},sl=function(i){return{r:Xt(i.r),g:Xt(i.g),b:Xt(i.b),a:Xt(i.a,3)}},Xv=/^#([0-9a-f]{3,8})$/i,no=function(i){var t=i.toString(16);return t.length<2?"0"+t:t},Gf=function(i){var t=i.r,e=i.g,n=i.b,s=i.a,o=Math.max(t,e,n),a=o-Math.min(t,e,n),h=a?o===t?(e-n)/a:o===e?2+(n-t)/a:4+(t-e)/a:0;return{h:60*(h<0?h+6:h),s:o?a/o*100:0,v:o/255*100,a:s}},Bf=function(i){var t=i.h,e=i.s,n=i.v,s=i.a;t=t/360*6,e/=100,n/=100;var o=Math.floor(t),a=n*(1-e),h=n*(1-(t-o)*e),c=n*(1-(1-t+o)*e),d=o%6;return{r:255*[n,h,a,a,c,n][d],g:255*[c,n,n,h,a,a][d],b:255*[a,a,c,n,n,h][d],a:s}},Wu=function(i){return{h:Zf(i.h),s:be(i.s,0,100),l:be(i.l,0,100),a:be(i.a)}},Xu=function(i){return{h:Xt(i.h),s:Xt(i.s),l:Xt(i.l),a:Xt(i.a,3)}},ju=function(i){return Bf((e=(t=i).s,{h:t.h,s:(e*=((n=t.l)<50?n:100-n)/100)>0?2*e/(n+e)*100:0,v:n+e,a:t.a}));var t,e,n},Ys=function(i){return{h:(t=Gf(i)).h,s:(s=(200-(e=t.s))*(n=t.v)/100)>0&&s<200?e*n/100/(s<=100?s:200-s)*100:0,l:s/2,a:t.a};var t,e,n,s},jv=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Yv=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Uv=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Vv=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Sl={string:[[function(i){var t=Xv.exec(i);return t?(i=t[1]).length<=4?{r:parseInt(i[0]+i[0],16),g:parseInt(i[1]+i[1],16),b:parseInt(i[2]+i[2],16),a:i.length===4?Xt(parseInt(i[3]+i[3],16)/255,2):1}:i.length===6||i.length===8?{r:parseInt(i.substr(0,2),16),g:parseInt(i.substr(2,2),16),b:parseInt(i.substr(4,2),16),a:i.length===8?Xt(parseInt(i.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(i){var t=Uv.exec(i)||Vv.exec(i);return t?t[2]!==t[4]||t[4]!==t[6]?null:Bu({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(i){var t=jv.exec(i)||Yv.exec(i);if(!t)return null;var e,n,s=Wu({h:(e=t[1],n=t[2],n===void 0&&(n="deg"),Number(e)*(Wv[n]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return ju(s)},"hsl"]],object:[[function(i){var t=i.r,e=i.g,n=i.b,s=i.a,o=s===void 0?1:s;return ui(t)&&ui(e)&&ui(n)?Bu({r:Number(t),g:Number(e),b:Number(n),a:Number(o)}):null},"rgb"],[function(i){var t=i.h,e=i.s,n=i.l,s=i.a,o=s===void 0?1:s;if(!ui(t)||!ui(e)||!ui(n))return null;var a=Wu({h:Number(t),s:Number(e),l:Number(n),a:Number(o)});return ju(a)},"hsl"],[function(i){var t=i.h,e=i.s,n=i.v,s=i.a,o=s===void 0?1:s;if(!ui(t)||!ui(e)||!ui(n))return null;var a=function(h){return{h:Zf(h.h),s:be(h.s,0,100),v:be(h.v,0,100),a:be(h.a)}}({h:Number(t),s:Number(e),v:Number(n),a:Number(o)});return Bf(a)},"hsv"]]},Yu=function(i,t){for(var e=0;e<t.length;e++){var n=t[e][0](i);if(n)return[n,t[e][1]]}return[null,void 0]},Kv=function(i){return typeof i=="string"?Yu(i.trim(),Sl.string):typeof i=="object"&&i!==null?Yu(i,Sl.object):[null,void 0]},rl=function(i,t){var e=Ys(i);return{h:e.h,s:be(e.s+100*t,0,100),l:e.l,a:e.a}},ol=function(i){return(299*i.r+587*i.g+114*i.b)/1e3/255},Uu=function(i,t){var e=Ys(i);return{h:e.h,s:e.s,l:be(e.l+100*t,0,100),a:e.a}},Pl=function(){function i(t){this.parsed=Kv(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return i.prototype.isValid=function(){return this.parsed!==null},i.prototype.brightness=function(){return Xt(ol(this.rgba),2)},i.prototype.isDark=function(){return ol(this.rgba)<.5},i.prototype.isLight=function(){return ol(this.rgba)>=.5},i.prototype.toHex=function(){return t=sl(this.rgba),e=t.r,n=t.g,s=t.b,a=(o=t.a)<1?no(Xt(255*o)):"","#"+no(e)+no(n)+no(s)+a;var t,e,n,s,o,a},i.prototype.toRgb=function(){return sl(this.rgba)},i.prototype.toRgbString=function(){return t=sl(this.rgba),e=t.r,n=t.g,s=t.b,(o=t.a)<1?"rgba("+e+", "+n+", "+s+", "+o+")":"rgb("+e+", "+n+", "+s+")";var t,e,n,s,o},i.prototype.toHsl=function(){return Xu(Ys(this.rgba))},i.prototype.toHslString=function(){return t=Xu(Ys(this.rgba)),e=t.h,n=t.s,s=t.l,(o=t.a)<1?"hsla("+e+", "+n+"%, "+s+"%, "+o+")":"hsl("+e+", "+n+"%, "+s+"%)";var t,e,n,s,o},i.prototype.toHsv=function(){return t=Gf(this.rgba),{h:Xt(t.h),s:Xt(t.s),v:Xt(t.v),a:Xt(t.a,3)};var t},i.prototype.invert=function(){return di({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},i.prototype.saturate=function(t){return t===void 0&&(t=.1),di(rl(this.rgba,t))},i.prototype.desaturate=function(t){return t===void 0&&(t=.1),di(rl(this.rgba,-t))},i.prototype.grayscale=function(){return di(rl(this.rgba,-1))},i.prototype.lighten=function(t){return t===void 0&&(t=.1),di(Uu(this.rgba,t))},i.prototype.darken=function(t){return t===void 0&&(t=.1),di(Uu(this.rgba,-t))},i.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},i.prototype.alpha=function(t){return typeof t=="number"?di({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):Xt(this.rgba.a,3);var e},i.prototype.hue=function(t){var e=Ys(this.rgba);return typeof t=="number"?di({h:t,s:e.s,l:e.l,a:e.a}):Xt(e.h)},i.prototype.isEqual=function(t){return this.toHex()===di(t).toHex()},i}(),di=function(i){return i instanceof Pl?i:new Pl(i)},Vu=[],Hv=function(i){i.forEach(function(t){Vu.indexOf(t)<0&&(t(Pl,Sl),Vu.push(t))})};function $v(i,t=[],e=[]){return i.replace(/#defines/,t.join(`
`)).replace(/#includes/,e.join(`
`))}function qv(i,t={}){return Object.keys(t).reduce((e,n)=>t[n]?`#define ${n} ${t[n]}
${e}`:e,i)}function Jv(i,t="unnamed"){const e=/#define\s*SHADER_NAME\s*([A-Za-z0-9_-]+)\s*/,n=i.match(e);return n?n[1]:t}function Qv(i,t,e,n){const s=new Set;if(n)for(let o=0,a=e;o<a;o+=3){const h=n[o],c=n[o+1],d=n[o+2],f=[h,c,c,d,d,h];for(let _=0;_<f.length;_+=2)Ml(f[_]*3,f[_+1]*3,i,s)&&t.push(f[_],f[_+1])}else for(let o=0,a=e;o<a;o+=3){const h=o,c=o+1,d=o+2,f=[h,c,c,d,d,h];for(let _=0;_<f.length;_+=2)Ml(f[_]*3,f[_+1]*3,i,s)&&t.push(f[_],f[_+1])}return t}function Ml(i,t,e,n){const s=`${e[i]},${e[i+1]},${e[i+2]}-${e[t]},${e[t+1]},${e[t+2]}`,o=`${e[t]},${e[t+1]},${e[t+2]}-${e[i]},${e[i+1]},${e[i+2]}`;return n.has(s)===!0||n.has(o)===!0?!1:(n.add(s),n.add(o),!0)}const Wf=Math.PI/180,Xf=180/Math.PI;function jf(i){return i*Wf}function lo(i){return i*Xf}function tx(i,t,e){return Math.min(Math.max(i,t),e)}function ex(i){return Math.log(i)/Math.LN2%1===0}let ho=Float32Array;function Yf(i,t=!0){i?ho=Float64Array:ho=Float32Array,t&&Ny(ho)}function cs(){return ho}function ix(i){return typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext||i!=null&&i.gl&&(i.gl instanceof WebGLRenderingContext||i.gl instanceof WebGL2RenderingContext)?!0:!!(i&&Number.isFinite(i._version))}function nx(i){return typeof WebGL2RenderingContext<"u"&&i instanceof WebGL2RenderingContext||i!=null&&i.gl&&i.gl instanceof WebGL2RenderingContext?!0:!!(i&&i._version===2)}function sx(i,t={},e=!1){var a,h;const n=["webgl2","webgl","experimental-webgl"];e||n.shift();let s=null;function o(c){console.error(c.statusMessage)}(a=i==null?void 0:i.addEventListener)==null||a.call(i,"webglcontextcreationerror",o,!1);for(let c=0;c<n.length;++c){try{s=i.getContext(n[c],t)}catch{}if(s)break}return(h=i==null?void 0:i.removeEventListener)==null||h.call(i,"webglcontextcreationerror",o,!1),s}const Uf=()=>(typeof performance>"u"?Date:performance).now();function yr(i){return Object.prototype.toString.call(i).slice(8,-1).toLowerCase()}function Vf(i){return yr(i)==="string"}function rx(i){return yr(i)==="undefined"}function ox(i){return Vf(i)&&i.includes("%")}function ax(i){return yr(i)==="number"}function lx(i){return yr(i)==="regexp"}function Bs(i){return i==null}function Kf(i){const t=typeof i;return i!==null&&(t==="object"||t==="function")}function hx(i,t){return Kf(i)?!Bs(i.value)&&(Bs(t)||i.value===t):!Bs(i)&&(Bs(t)||i===t)}const al={};function cx(i="id"){al[i]=al[i]||1;const t=al[i]++;return`${i}-${t}`}function ux(i,t=[]){return Object.keys(i).filter(e=>t.indexOf(e)<0).reduce((e,n)=>Object.assign(e,{[n]:i[n]}),{})}function dx(i,t=[]){return Object.keys(i).filter(e=>t.indexOf(e)>-1).reduce((e,n)=>Object.assign(e,{[n]:i[n]}),{})}const Qn=[],Ku=1e3/60;let Hu=performance.now();function Hf(){const i=Uf(),t=i-Hu;if(t>=Ku){Hu=i-t%Ku;const e=Qn.slice();Qn.length=0;for(let n=0;n<e.length;n++)e[n]&&e[n](i,t)}else setImmediate(Hf)}function fx(i){return Qn.push(i),Qn.length===1&&setImmediate(Hf),Qn.length-1}function gx(i){Qn[i]=void 0}function _x(i){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(i):fx(i)}function mx(i){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(i):gx(i)}var $f=Object.freeze({__proto__:null,DEG_TO_RAD:Wf,RAD_TO_DEG:Xf,cancelAnimationFrame:mx,clamp:tx,defineShader:qv,degToRad:jf,getContext:sx,getFloatArrayConstructor:cs,getShaderName:Jv,getWireframeIndex:Qv,hasValue:hx,highPrecision:Yf,isHex:ox,isNull:Bs,isNumber:ax,isObject:Kf,isPowerOfTwo:ex,isRegexp:lx,isString:Vf,isUndef:rx,isUniqueEdge:Ml,isWebGL:ix,isWebGL2:nx,now:Uf,omit:ux,parseShader:$v,pick:dx,radToDeg:lo,requestAnimationFrame:_x,typeOf:yr,uid:cx});class qf{constructor(){tn(this,"elements",new(cs())(2))}fromArray(t,e=0){let n=0;for(;n<this.elements.length;n++)this.elements[n]=t[e+n];return this}toArray(t=[],e=0){let n=0;for(;n<this.elements.length;n++)t[e+n]=this.elements[n];return t}}const so=[];var ts;const Lh=class Lh extends qf{constructor(e=0,n=0,s=0,o=0){super();tn(this,"elements",new(cs())(4));Ec(this,ts,[]);const a=this.elements;a[0]=e,a[1]=n,a[2]=s,a[3]=o}get x(){return this.elements[0]}set x(e){this.elements[0]=e,this.triggerChange()}get y(){return this.elements[1]}set y(e){this.elements[1]=e,this.triggerChange()}get z(){return this.elements[2]}set z(e){this.elements[2]=e,this.triggerChange()}get w(){return this.elements[3]}set w(e){this.elements[3]=e,this.triggerChange()}fromObject({x:e,y:n,z:s,w:o}){return e!==void 0&&(this.x=e),n!==void 0&&(this.y=n),s!==void 0&&(this.z=s),o!==void 0&&(this.w=o),this.triggerChange(),this}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}fromAxisAngle(e,n){return Ff(this.elements,e.elements,n),this.triggerChange(),this}getAxisAngle(e=new Yi){const n=kv(so,this.elements);return e.set(so[0],so[1],so[2]),n}fromEuler(e){return Nv(this.elements,lo(e.x),lo(e.y),lo(e.z)),this.triggerChange(),this}fromMat3(e){return zf(this.elements,e),this}set(e,n,s,o){return Gv(this.elements,e,n,s,o),this.triggerChange(),this}length(){return Bv(this.elements)}multiply(e,n){return n?Gu(this.elements,e.elements,n.elements):Gu(this.elements,this.elements,e.elements),this.triggerChange(),this}slerp(e,n){return ao(this.elements,this.elements,e.elements,n),this.triggerChange(),this}invert(){return Fv(this.elements,this.elements),this.triggerChange(),this}conjugate(){return zv(this.elements,this.elements),this.triggerChange(),this}normalize(){return bh(this.elements,this.elements),this.triggerChange(),this}dot(e){return Nf(this.elements,e.elements)}angleTo(e){return Dv(this.elements,e.elements)}clone(){return new Lh().copy(this)}copy(e){return Zv(this.elements,e.elements),this.triggerChange(),this}equals(e){return Ov(this.elements,e.elements)}onChange(e){Wr(this,ts).includes(e)||Wr(this,ts).push(e)}triggerChange(){Wr(this,ts).forEach(e=>e())}toString(){return`${this.constructor.name}(${this.elements.join(", ")})`}};ts=new WeakMap;let Io=Lh;class Yi extends qf{constructor(e=0,n=0,s=0){super();tn(this,"elements",new(cs())(3));const o=this.elements;o[0]=e,o[1]=n,o[2]=s}get x(){return this.elements[0]}set x(e){this.elements[0]=e}get y(){return this.elements[1]}set y(e){this.elements[1]=e}get z(){return this.elements[2]}set z(e){this.elements[2]=e}fromObject(e){const{x:n,y:s,z:o}=e;return n!==void 0&&(this.x=n),s!==void 0&&(this.y=s),o!==void 0&&(this.z=o),this}toObject(){return{x:this.x,y:this.y,z:this.z}}set(e,n,s){return gv(this.elements,e,n,s),this}setScalar(e){return this.set(e,e,e)}length(){return kf(this.elements)}add(e){return Du(this.elements,this.elements,e.elements),this}addScalar(e){return Du(this.elements,this.elements,[e,e,e]),this}subtract(e){return nl(this.elements,this.elements,e.elements),this}subtractScalar(e){return nl(this.elements,this.elements,[e,e,e]),this}subVectors(e,n){return nl(this.elements,e.elements,n.elements),this}multiply(e){return Fu(this.elements,this.elements,e.elements),this}multiplyScalar(e){return Fu(this.elements,this.elements,[e,e,e]),this}divide(e){return zu(this.elements,this.elements,e.elements),this}divideScalar(e){return zu(this.elements,this.elements,[e,e,e]),this}scale(e){return _v(this.elements,this.elements,e),this}scaleAndAdd(e,n){return mv(this.elements,this.elements,e.elements,n),this}distanceTo(e){return pv(this.elements,e.elements)}distanceToSquared(e){return yv(this.elements,e.elements)}angle(e){return Nu(this.elements,[1,0,0])}angleTo(e){return Nu(this.elements,e.elements)}dot(e){return Eh(this.elements,e.elements)}equals(e){return Tv(this.elements,e.elements)}cross(e){return oo(this.elements,this.elements,e.elements),this}negate(){return vv(this.elements,this.elements),this}inverse(){return xv(this.elements,this.elements),this}lerp(e,n){return wv(this.elements,this.elements,e.elements,n),this}normalize(){return Df(this.elements,this.elements),this}applyEuler(e){const n=new Io().fromEuler(e);return this.applyQuaternion(n)}applyMatrix3(e){return Ev(this.elements,this.elements,e.elements),this}applyMatrix4(e){return Cv(this.elements,this.elements,e.elements),this}applyQuaternion(e){return bv(this.elements,this.elements,e.elements),this}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new Yi(this.x,this.y,this.z)}toString(){return`${this.constructor.name}(${this.elements.join(", ")})`}}class px{constructor(){tn(this,"elements",new(cs())(16))}fromArray(t,e=0){let n=0;for(;n<this.elements.length;n++)this.elements[n]=t[e+n];return this}toArray(t=[],e=0){let n=0;for(;n<this.elements.length;n++)t[e+n]=this.elements[n];return t}}const fe=[];class Ao extends px{constructor(e=1,n=0,s=0,o=0,a=0,h=1,c=0,d=0,f=0,_=0,p=1,y=0,v=0,w=0,C=0,E=1){super();tn(this,"elements",new(cs())(16));const T=this.elements;T[0]=e,T[1]=n,T[2]=s,T[3]=o,T[4]=a,T[5]=h,T[6]=c,T[7]=d,T[8]=f,T[9]=_,T[10]=p,T[11]=y,T[12]=v,T[13]=w,T[14]=C,T[15]=E}get x(){return this.elements[12]}get y(){return this.elements[13]}get z(){return this.elements[14]}get w(){return this.elements[15]}static get identity(){return new Ao().fromArray(If([]))}set(e,n,s,o,a,h,c,d,f,_,p,y,v,w,C,E){return By(this.elements,e,n,s,o,a,h,c,d,f,_,p,y,v,w,C,E),this}transpose(){return Wy(this.elements,this.elements),this}invert(e=this){return Xy(this.elements,e.elements),this}adjoint(e=this){return jy(this.elements,e.elements),this}determinant(){return Yy(this.elements)}add(e,n){return n?Au(this.elements,e.elements,n.elements):Au(this.elements,this.elements,e.elements),this}subtract(e,n){return n?Ou(this.elements,e.elements,n.elements):Ou(this.elements,this.elements,e.elements),this}multiply(e,n){return n?io(this.elements,e.elements,n.elements):io(this.elements,this.elements,e.elements),this}multiplyScalar(e=this,n){return dv(this.elements,e.elements,n),this}premultiply(e,n){return n?io(this.elements,n.elements,e.elements):io(this.elements,e.elements,this.elements),this}translate(e){return Uy(this.elements,this.elements,e.elements),this}rotate(e){return Vy(this.elements,this.elements,e),this}scale(e){return Iu(this.elements,this.elements,e.elements),this}scaleScalar(e){return Iu(this.elements,this.elements,[e,e,e]),this}fromTranslation(e){return qy(this.elements,e.elements),this}fromRotation(e,n){return Qy(this.elements,e,n),this}fromRotationX(e){return tv(this.elements,e),this}fromRotationY(e){return ev(this.elements,e),this}fromRotationZ(e){return iv(this.elements,e),this}fromScale(e){return Jy(this.elements,e.elements),this}fromRotationTranslation(e,n){return nv(this.elements,e.elements,n.elements),this}fromPerspective(e,n,s,o){return hv(this.elements,jf(e),n,s,o),this}fromOrthogonal(e,n,s,o,a,h){return uv(this.elements,e,n,s,o,a,h),this}fromQuat(e){return av(this.elements,e.elements),this}equals(e){return fv(this.elements,e.value)}getRotation(e=new Io){return rv(fe,this.elements),e.set(fe[0],fe[1],fe[2],fe[3]),e}getScale(e=new Yi){return Af(fe,this.elements),e.set(fe[0],fe[1],fe[2]),e}getTranslation(e=new Yi){return sv(fe,this.elements),e.set(fe[0],fe[1],fe[2]),e}rotateX(e){return Ky(this.elements,this.elements,e),this}rotateY(e){return Hy(this.elements,this.elements,e),this}rotateZ(e){return $y(this.elements,this.elements,e),this}compose(e,n,s){return ov(this.elements,n.elements,e.elements,s.elements),this}decompose(){return{rotation:this.getRotation(),scale:this.getScale(),translation:this.getTranslation()}}copy(e){return Gy(this.elements,e.elements),this}clone(){return new Ao().copy(this)}toString(){return`${this.constructor.name}(${this.elements.join(", ")})`}}function yx(i,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},n={};for(var s in e)n[e[s]]=s;var o={};i.prototype.toName=function(a){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var h,c,d=n[this.toHex()];if(d)return d;if(a!=null&&a.closest){var f=this.toRgb(),_=1/0,p="black";if(!o.length)for(var y in e)o[y]=new i(e[y]).toRgb();for(var v in e){var w=(h=f,c=o[v],Math.pow(h.r-c.r,2)+Math.pow(h.g-c.g,2)+Math.pow(h.b-c.b,2));w<_&&(_=w,p=v)}return p}},t.string.push([function(a){var h=a.toLowerCase(),c=h==="transparent"?"#0000":e[h];return c?new i(c).toRgb():null},"name"])}Hv([yx]);new Yi;new Ao;new Yi;new Yi;class vx extends Oe.Layer{constructor(t,e,n){super(t,e,n)}initialize(t,e,n){if(!t)throw Error("layer id must be specified");this._layerId=t,Oe.Util.setOptions(this,n),this.devicePixelRatio=this.options.devicePixelRatio||window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI}_createCanvas(t,e){const n=ky(this._width,this._height,this.devicePixelRatio);n.id=String(t);const s=this._map.getPanes();return s&&s.overlayPane&&s.overlayPane.appendChild(n),n}_reset(){const t=this._map.containerPointToLayerPoint([0,0]);Oe.DomUtil.setPosition(this.canvas,t),this._redraw()}_onResize(t){this.canvas.style.width=t.newSize.x+"px",this.canvas.style.height=t.newSize.y+"px",this._width=t.newSize.x,this._height=t.newSize.y,this._resizeCanvas(this.devicePixelRatio)}_zoomStart(){this._moveStart()}_moveStart(){this._updating||(this._updating=!0)}_animateZoom(t){const e=this._map.getZoomScale(t.zoom,this._map.getZoom()),n=this._map._latLngToNewLayerPoint(this._map.getBounds().getNorthWest(),t.zoom,t.center);Oe.DomUtil.setTransform(this.canvas,n,e)}_resizeCanvas(t){this.canvas.width=this._width*t,this.canvas.height=this._height*t}_redraw(){this._render()}_render(){}project(t){const e=this._map.latLngToContainerPoint(new Oe.LatLng(t[1],t[0]));return[e.x*this.devicePixelRatio,e.y*this.devicePixelRatio]}unproject(t){const e=this._map.containerPointToLatLng(new Oe.Point(t[0],t[1]));return[e.lng,e.lat]}intersectsCoordinate(t){return this._map.getBounds().contains(Oe.latLng(t[1],t[0]))}onAdd(t){this._map=t;const e=t.getSize();this._width=e.x,this._height=e.y,this.canvas=this._createCanvas(this._layerId,this.options.zIndex||1);const n=this._map.options.zoomAnimation&&Oe.Browser.any3d;return Oe.DomUtil.addClass(this.canvas,"leaflet-zoom-"+(n?"animated":"hide")),this._map.on(this.getEvents(),this),this._resetView(),this._render(),this}_resetView(t){}onMoveEnd(){this._reset()}onRemove(){const t=this._map.getPanes();return t&&t.overlayPane&&t.overlayPane.removeChild(this.canvas),this._map.off(this.getEvents(),this),this.canvas=null,this}getEvents(){const t={resize:this._onResize,viewreset:this._render,moveend:this.onMoveEnd,zoomstart:this._render,zoomend:this._render};return this._map.options.zoomAnimation&&Oe.Browser.any3d&&(t.zoomanim=this._animateZoom),t}}class xx extends vx{initialize(t,e,n){super.initialize(t,e,n),this.field=void 0,this.pickWindOptions(),e&&this.setData(e,n.fieldOptions)}_redraw(){this._render()}_render(){const t=this.getWindOptions();if(!this.wind&&this._map){const e=this.canvas.getContext("2d"),n=this.getData();this.wind=new Ro(e,t,n),this.wind.project=this.project.bind(this),this.wind.unproject=this.unproject.bind(this),this.wind.intersectsCoordinate=this.intersectsCoordinate.bind(this),this.wind.postrender=()=>{}}this.wind.prerender(),this.wind.render()}onRemove(){return this.wind&&(this.wind.stop(),this.wind=null),super.onRemove()}pickWindOptions(){Object.keys(Ch).forEach(t=>{t in this.options&&(this.options.windOptions===void 0&&(this.options.windOptions={}),this.options.windOptions[t]=this.options[t])})}getData(){return this.field}setData(t,e={}){var n;return t&&t.checkFields&&t.checkFields()?this.field=t:Pf(t)?this.field=Mf(t,e):console.error("Illegal data"),this.field&&((n=this==null?void 0:this.wind)==null||n.updateData(this.field)),this}setWindOptions(t){const e=this.options.windOptions||{};if(this.options=js(this.options,{windOptions:js(e,t||{})}),this.wind){const n=this.options.windOptions;this.wind.setOptions(n),this.wind.prerender()}}getWindOptions(){return this.options.windOptions||{}}}const{clamp:kx}=$f,{degToRad:Dx,radToDeg:Fx}=$f;Yf(!0);If([]);function wx(i,t,e){if(i==="openlayers")return new zy(t,e);if(i==="leaflet")return new xx("wind",t,e);throw new Error("Unknown map type")}class Jf{constructor(t,e){this.map=t,this.properties=e,this.layer=null,this.zoomListenerKey=null}getActive(){return!!this.layer}start(t){var e,n;return this.layer||(this.layer=wx(this.map.type,t,{windOptions:{velocityScale:.03,projection:((e=this.properties)===null||e===void 0?void 0:e.projection)||"EPSG:4326",colorScale:[((n=this.properties)===null||n===void 0?void 0:n.color)||"rgb(36,104, 180)"],lineWidth:1,generateParticleOption:!0,fadeOpacity:.95},fieldOptions:{wrapX:!1}}),this.map.addLayer(this.layer),this.zoomListenerKey=this.map.onZoomChange(()=>{const a=this.map.getZoom(),h=.03*Math.pow(1.1,3-a);this.layer&&this.layer.setWindOptions({velocityScale:h})})),!0}stop(){return this.layer&&(this.map.removeLayer(this.layer),this.layer=null),this.zoomListenerKey&&(this.map.offZoomChange(this.zoomListenerKey),this.zoomListenerKey=null),!1}}class Cx{constructor(t){this.map=t,this.type="openlayers"}getZoom(){return this.map.getView().getZoom()}onZoomChange(t){return this.map.getView().on("change:resolution",t)}offZoomChange(t){this.map.getView().un("change:resolution",t)}addLayer(t){t.appendTo(this.map)}removeLayer(t){this.map.removeLayer(t)}}function $u(i,t,e){const n=Math.floor((i+180)/360*Math.pow(2,e)),s=Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e));return{x:n,y:s}}function qu(i,t){const e=(i+t)*1e3,n=new Date(e),s=n.getUTCHours().toString().padStart(2,"0"),o=n.getUTCMinutes().toString().padStart(2,"0");return`${s}:${o}`}const Ex={lang:"en",legend:!0,legendElement:"#map",windDataURL:null};class bx{constructor(t,e,n=Ex){this.tileLayer=null,this.activeKey=null,this.activeWind=!1,this.onMapClick=()=>{this.popupOverlay&&this.popupOverlay.setPosition(void 0)},this.onMapDoubleClick=async s=>{const o=Ra(s.coordinate),[a,h]=o,c=`https://api.openweathermap.org/data/2.5/weather?lat=${h}&lon=${a}&units=metric&lang=${this.properties.lang}&appid=${this.owmKey}`;try{const f=await(await fetch(c)).json(),{name:_,weather:p,main:y,wind:v,sys:w,timezone:C,clouds:E,visibility:T}=f,M=p[0],S=M.description,P=M.main,A=qu(w.sunrise,C),D=qu(w.sunset,C);this.popupElement.innerHTML=`
  <div style="font-family: 'Segoe UI', sans-serif; color: #1a1a1a; min-width: 240px;">
    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px;">
      <img src="https://openweathermap.org/img/wn/${p==null?void 0:p[0].icon}@2x.png" alt="${P}" width="48" height="48" style=" object-position: center;
    object-fit: cover;
    width: 48px;
    height: 48px;
    background: #404040;
    border-radius: 10px;
    " />
      <div>
        <div style="font-size: 16px; font-weight: 600;">${_||"Unknown"}, ${w.country}</div>
        <div style="font-size: 13px; color: #666;">${S}</div>
      </div>
    </div>

    <div style="font-size: 14px; line-height: 1.7;">
      🌡️ <b>Temperature:</b> ${y.temp.toFixed(1)}°C<br />
      🤒 <b>Feels like:</b> ${y.feels_like.toFixed(1)}°C<br />
      📈 <b>Max/Min:</b> ${y.temp_max.toFixed(1)}°C / ${y.temp_min.toFixed(1)}°C<br />
      💧 <b>Humidity:</b> ${y.humidity}%<br />
      🧭 <b>Pressure:</b> ${y.pressure} hPa<br />
      ☁️ <b>Cloudiness:</b> ${E.all}%<br />
      👁 <b>Visibility:</b> ${(T/1e3).toFixed(1)} km<br />
      🌬️ <b>Wind:</b> ${v.speed.toFixed(1)} m/s ${v.gust?`(gusts up to ${v.gust.toFixed(1)} m/s)`:""}<br />
      ↗ <b>Direction:</b> ${v.deg}°<br />
      🌅 <b>Sunrise:</b> ${A}<br />
      🌇 <b>Sunset:</b> ${D}
    </div>
  </div>
`,this.popupOverlay.setPosition(s.coordinate)}catch(d){console.warn("Ошибка запроса погоды:",d)}},this.map=t,this.owmKey=e,this.properties=n,this.wind=new Jf(new Cx(t),n.windProperties),this.onMoveEnd=()=>{this.update()}}status(){return!!this.layer}layers(){return Mo.map(t=>({name:t.name,key:t.key}))}setLayer(t){if(t===this.activeKey||(this.tileLayer&&(Sf("-ol"),this.map.removeLayer(this.tileLayer),this.tileLayer=null,this.activeKey=null),!t))return;const e=Mo.find(o=>o.key===t);if(!e)return;const n=new pf({url:e.url+this.owmKey}),s=new df({source:n,zIndex:50});this.map.addLayer(s),this.tileLayer=s,this.activeKey=t,this.properties.legend&&this.properties.legendElement&&Lf("-ol",this.properties.legendElement,e)}toggleWind(){this.properties.windDataURL&&(this.wind.getActive()?this.activeWind=this.wind.stop():fetch(this.properties.windDataURL).then(t=>t.json()).then(t=>{this.activeWind=this.wind.start(t)}))}async show(){this.doubleClickZoom=this.map.getInteractions().getArray().find(t=>t instanceof Nd),this.doubleClickZoom&&this.map.removeInteraction(this.doubleClickZoom),this.popupElement=document.createElement("div"),this.popupElement.style.cssText=`
    background: white;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    min-width: 200px;
    font-family: sans-serif;
    `,this.popupOverlay=new wy({element:this.popupElement,positioning:"bottom-center",stopEvent:!1,offset:[0,-15]}),this.map.addOverlay(this.popupOverlay),this.map.on("moveend",this.onMoveEnd),this.map.on("dblclick",this.onMapDoubleClick),this.map.on("click",this.onMapClick),await this.update()}hide(){this.map.un("dblclick",this.onMapDoubleClick),this.map.un("click",this.onMapClick),this.popupOverlay&&this.map.removeOverlay(this.popupOverlay),this.doubleClickZoom&&this.map.addInteraction(this.doubleClickZoom),this.layer&&(this.map.removeLayer(this.layer),this.layer=void 0)}async update(){var t;const e=this.map.getView(),n=Math.floor((t=e.getZoom())!==null&&t!==void 0?t:6),s=e.calculateExtent(this.map.getSize()),o=Ra([s[0],s[3]]),a=Ra([s[2],s[1]]),h=$u(o[0],o[1],n),c=$u(a[0],a[1],n),d=[],f=[];for(let y=h.x;y<=c.x;y++)for(let v=h.y;v<=c.y;v++){const w=`${n}/${y}/${v}`,C=`https://b.maps.owm.io/weather/cities/${w}.geojson?appid=${this.owmKey}&lang=${this.properties.lang}`;f.push(fetch(C).then(E=>E.json()).then(E=>{const T=new ry().readFeatures(E,{featureProjection:e.getProjection()});d.push(...T)}).catch(E=>{console.warn(`Ошибка загрузки тайла ${w}:`,E)}))}await Promise.all(f);const _=new ty({features:d}),p=y=>{const{city:v,wind_speed:w,temp:C}=y.getProperties(),E=Tf(y.getProperties()),T=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(E)}`;return[new Je({image:new _r({src:T,scale:.2}),text:new $n({text:v,font:"12px sans-serif",fill:new Bi({color:"white"}),stroke:new _n({color:"black",width:2}),offsetY:20})}),new Je({text:new $n({text:parseInt(C)+"°C",font:"12px sans-serif",fill:new Bi({color:"white"}),stroke:new _n({color:"black",width:2}),offsetY:-16}),zIndex:9999999999}),new Je({text:new $n({text:w.toFixed(1)+"м/с",font:"10px sans-serif",fill:new Bi({color:"white"}),stroke:new _n({color:"black",width:2}),offsetY:32}),zIndex:9999999999})]};this.layer?this.layer.setSource(_):(this.layer=new K1({source:_,style:p,zIndex:100}),this.map.addLayer(this.layer),this.map.on("dblclick",this.onMapDoubleClick))}}class Tx{constructor(t){this.map=t,this.type="leaflet"}getZoom(){return this.map.getZoom()}onZoomChange(t){return this.map.on("zoomend",t),t}offZoomChange(t){this.map.off("zoomend",t)}addLayer(t){this.map.addLayer(t)}removeLayer(t){this.map.removeLayer(t)}}const Lx={lang:"en",legend:!0};function Ju(i,t,e){const n=Math.floor((i+180)/360*Math.pow(2,e)),s=Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e));return{x:n,y:s}}function Qu(i,t){const e=(i+t)*1e3,n=new Date(e),s=n.getUTCHours().toString().padStart(2,"0"),o=n.getUTCMinutes().toString().padStart(2,"0");return`${s}:${o}`}class Sx{constructor(t,e,n=Lx){this.activeTileLayer=null,this.activeKey=null,this.activeWind=!1,this.update=async()=>{const s=Math.floor(this.map.getZoom()),o=this.map.getBounds(),a=Ju(o.getWest(),o.getNorth(),s),h=Ju(o.getEast(),o.getSouth(),s),c=[],d=[];for(let f=a.x;f<=h.x;f++)for(let _=a.y;_<=h.y;_++){const p=`${s}/${f}/${_}`,y=`https://b.maps.owm.io/weather/cities/${p}.geojson?appid=${this.owmKey}`;d.push(fetch(y).then(v=>v.json()).then(v=>{c.push(...v.features)}).catch(v=>{console.warn(`Ошибка загрузки тайла ${p}:`,v)}))}await Promise.all(d),this.layerGroup?this.layerGroup.clearLayers():(this.layerGroup=on.layerGroup(),this.map.addLayer(this.layerGroup));for(const f of c){const{geometry:_,properties:p}=f,[y,v]=_.coordinates,{city:w,wind_speed:C=0,temp:E=0}=p,T=Tf(p),M=on.divIcon({className:"",html:`
          <div style="
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transform: translateY(-10px);
          ">
           <div style="
              color: #000;
              font-size: 10px;
              font-weight: 600;
              line-height: 1.2;
              text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff,
               -1px 1px 0 #fff, 1px 1px 0 #fff;
              margin-top: 2px;
            ">
              ${parseInt(E)}°C
            </div>
            <img src="data:image/svg+xml;charset=utf-8,${encodeURIComponent(T)}" style="width: 32px; height: 32px; object-fit: cover;" alt="weather" />
            <div style="
              color: #000;
              font-size: 10px;
              font-weight: 600;
              line-height: 1.2;
              text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff,
               -1px 1px 0 #fff, 1px 1px 0 #fff;
              margin-top: 2px;
            ">
              ${w}<br/>${C.toFixed(1)}м/с
            </div>
          </div>
        `});on.marker([v,y],{icon:M}).addTo(this.layerGroup)}},this.onMapDoubleClick=async s=>{const{lat:o,lng:a}=s.latlng,h=`https://api.openweathermap.org/data/2.5/weather?lat=${o}&lon=${a}&units=metric&lang=en&appid=${this.owmKey}`;try{const d=await(await fetch(h)).json(),{name:f,weather:_,main:p,wind:y,sys:v,timezone:w,clouds:C,visibility:E}=d,T=`
      <div style="font-family: 'Segoe UI', sans-serif; color: #1a1a1a; min-width: 240px;">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px;">
          <img src="https://openweathermap.org/img/wn/${_==null?void 0:_[0].icon}@2x.png" width="48" height="48" style="
              background: #404040;
              border-radius: 10px;
            "/>
          <div>
            <div style="font-size: 16px; font-weight: 600;">${f||"Unknown"}, ${v.country}</div>
            <div style="font-size: 13px; color: #666;">${_==null?void 0:_[0].description}</div>
          </div>
        </div>
        <div style="font-size: 14px; line-height: 1.7;">
          🌡️ <b>Temperature:</b> ${p.temp.toFixed(1)}°C<br />
          🤒 <b>Feels like:</b> ${p.feels_like.toFixed(1)}°C<br />
          📈 <b>Max/Min:</b> ${p.temp_max.toFixed(1)}°C / ${p.temp_min.toFixed(1)}°C<br />
          💧 <b>Humidity:</b> ${p.humidity}%<br />
          🧭 <b>Pressure:</b> ${p.pressure} hPa<br />
          ☁️ <b>Cloudiness:</b> ${C.all}%<br />
          👁 <b>Visibility:</b> ${(E/1e3).toFixed(1)} km<br />
          🌬️ <b>Wind:</b> ${y.speed.toFixed(1)} m/s ${y.gust?`(gusts up to ${y.gust.toFixed(1)} m/s)`:""}<br />
          ↗ <b>Direction:</b> ${y.deg}°<br />
          🌅 <b>Sunrise:</b> ${Qu(v.sunrise,w)}<br />
          🌇 <b>Sunset:</b> ${Qu(v.sunset,w)}
        </div>
      </div>
      `;this.popup.setLatLng([o,a]).setContent(T).openOn(this.map)}catch(c){console.warn("Ошибка запроса погоды:",c)}},this.map=t,this.owmKey=e,this.properties=n,this.popup=on.popup(),this.wind=new Jf(new Tx(t),n.windProperties)}status(){return!!this.layerGroup}layers(){return Mo.map(t=>({name:t.name,key:t.key}))}setLayer(t){if(t===this.activeKey||(this.activeTileLayer&&(Sf("-l"),this.map.removeLayer(this.activeTileLayer),this.activeTileLayer=null,this.activeKey=null),!t))return;const e=Mo.find(s=>s.key===t);if(!e){console.warn("Layer not found for key:",t);return}const n=on.tileLayer(e.url+this.owmKey,{opacity:.7,attribution:"&copy; <a href='https://openweathermap.org/'>OpenWeatherMap</a>"});setTimeout(()=>{this.properties.legend&&this.properties.legendElement&&Lf("-l",this.properties.legendElement,e)},0),n.addTo(this.map),this.activeTileLayer=n,this.activeKey=t}toggleWind(){this.properties.windDataURL&&(this.wind.getActive()?this.activeWind=this.wind.stop():fetch(this.properties.windDataURL).then(t=>t.json()).then(t=>{this.activeWind=this.wind.start(t)}))}async show(){this.map.doubleClickZoom.disable(),this.map.on("moveend",this.update),this.map.on("dblclick",this.onMapDoubleClick),this.map.on("click",()=>{this.map.closePopup()}),await this.update()}hide(){this.map.doubleClickZoom.enable(),this.map.off("moveend",this.update),this.map.off("dblclick",this.onMapDoubleClick),this.layerGroup&&this.map.removeLayer(this.layerGroup)}}const Px=new M0({target:"map-ol",layers:[new df({source:new _1})],view:new Ue({center:lm([30.52,50.45]),zoom:6})}),Us=new bx(Px,"b1b15e88fa797225412429c1c50c122a1",{lang:"ru",legend:!0,legendElement:"#map-ol",windDataURL:"https://blog.sakitam.com/wind-layer/data/wind.json",windProperties:{color:"red"}});Us.show();const Qf=on.map("map-leaflet").setView([50.4501,30.5234],7);on.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:18,attribution:"&copy; OpenStreetMap contributors"}).addTo(Qf);const Oo=new Sx(Qf,"b1b15e88fa797225412429c1c50c122a1",{lang:"ru",legend:!0,legendElement:"#map-leaflet",windDataURL:"https://blog.sakitam.com/wind-layer/data/wind.json",windProperties:{color:"blue"}});Oo.show();const ll=document.getElementById("layerControls");if(ll){Us.layers().forEach(t=>{const e=document.createElement("button");e.textContent=t.name,e.onclick=()=>{Us.setLayer(t.key),Oo.setLayer(t.key)},ll.appendChild(e)});const i=document.createElement("button");i.textContent="null",i.onclick=()=>{Us.setLayer(null),Oo.setLayer(null)},ll.appendChild(i)}const td=document.querySelector("#toggle-wind");td&&td.addEventListener("click",()=>{Us.toggleWind(),Oo.toggleWind()});
