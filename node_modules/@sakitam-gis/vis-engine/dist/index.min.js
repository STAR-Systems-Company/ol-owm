!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).ve={})}(this,(function(t){"use strict";function e(t,e=[],s=[]){return t.replace(/#defines/,e.join("\n")).replace(/#includes/,s.join("\n"))}function s(t,e="unnamed"){const s=t.match(/#define\s*SHADER_NAME\s*([A-Za-z0-9_-]+)\s*/);return s?s[1]:e}function i(t,e,s,i){const n=new Set;if(i)for(let a=0,h=s;a<h;a+=3){const s=i[a],h=i[a+1],o=i[a+2],l=[s,h,h,o,o,s];for(let s=0;s<l.length;s+=2)r(3*l[s],3*l[s+1],t,n)&&e.push(l[s],l[s+1])}else for(let i=0,a=s;i<a;i+=3){const s=i+1,a=i+2,h=[i,s,s,a,a,i];for(let s=0;s<h.length;s+=2)r(3*h[s],3*h[s+1],t,n)&&e.push(h[s],h[s+1])}return e}function r(t,e,s,i){const r=`${s[t]},${s[t+1]},${s[t+2]}-${s[e]},${s[e+1]},${s[e+2]}`,n=`${s[e]},${s[e+1]},${s[e+2]}-${s[t]},${s[t+1]},${s[t+2]}`;return!0!==i.has(r)&&!0!==i.has(n)&&(i.add(r),i.add(n),!0)}var n=1e-6,a="undefined"!=typeof Float32Array?Float32Array:Array;function h(t,e,s){var i=e[0],r=e[1],n=e[2],a=e[3],h=e[4],o=e[5],l=e[6],u=e[7],d=e[8],c=s[0],m=s[1],g=s[2],f=s[3],p=s[4],b=s[5],x=s[6],y=s[7],M=s[8];return t[0]=c*i+m*a+g*l,t[1]=c*r+m*h+g*u,t[2]=c*n+m*o+g*d,t[3]=f*i+p*a+b*l,t[4]=f*r+p*h+b*u,t[5]=f*n+p*o+b*d,t[6]=x*i+y*a+M*l,t[7]=x*r+y*h+M*u,t[8]=x*n+y*o+M*d,t}function o(t,e){var s=e[0],i=e[1],r=e[2],n=e[3],a=e[4],h=e[5],o=e[6],l=e[7],u=e[8],d=e[9],c=e[10],m=e[11],g=e[12],f=e[13],p=e[14],b=e[15],x=s*h-i*a,y=s*o-r*a,M=s*l-n*a,w=i*o-r*h,v=i*l-n*h,E=r*l-n*o,A=u*f-d*g,T=u*p-c*g,_=u*b-m*g,S=d*p-c*f,F=d*b-m*f,R=c*b-m*p,C=x*R-y*F+M*S+w*_-v*T+E*A;return C?(C=1/C,t[0]=(h*R-o*F+l*S)*C,t[1]=(o*_-a*R-l*T)*C,t[2]=(a*F-h*_+l*A)*C,t[3]=(r*F-i*R-n*S)*C,t[4]=(s*R-r*_+n*T)*C,t[5]=(i*_-s*F-n*A)*C,t[6]=(f*E-p*v+b*w)*C,t[7]=(p*M-g*E-b*y)*C,t[8]=(g*v-f*M+b*x)*C,t):null}function l(t,e,s){return t[0]=e[0]+s[0],t[1]=e[1]+s[1],t[2]=e[2]+s[2],t[3]=e[3]+s[3],t[4]=e[4]+s[4],t[5]=e[5]+s[5],t[6]=e[6]+s[6],t[7]=e[7]+s[7],t[8]=e[8]+s[8],t}function u(t,e,s){return t[0]=e[0]-s[0],t[1]=e[1]-s[1],t[2]=e[2]-s[2],t[3]=e[3]-s[3],t[4]=e[4]-s[4],t[5]=e[5]-s[5],t[6]=e[6]-s[6],t[7]=e[7]-s[7],t[8]=e[8]-s[8],t}function d(t,e){var s=t[0],i=t[1],r=t[2],a=t[3],h=t[4],o=t[5],l=t[6],u=t[7],d=t[8],c=e[0],m=e[1],g=e[2],f=e[3],p=e[4],b=e[5],x=e[6],y=e[7],M=e[8];return Math.abs(s-c)<=n*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(i-m)<=n*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(r-g)<=n*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(a-f)<=n*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(h-p)<=n*Math.max(1,Math.abs(h),Math.abs(p))&&Math.abs(o-b)<=n*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(l-x)<=n*Math.max(1,Math.abs(l),Math.abs(x))&&Math.abs(u-y)<=n*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(d-M)<=n*Math.max(1,Math.abs(d),Math.abs(M))}function c(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function m(t,e,s){var i=e[0],r=e[1],n=e[2],a=e[3],h=e[4],o=e[5],l=e[6],u=e[7],d=e[8],c=e[9],m=e[10],g=e[11],f=e[12],p=e[13],b=e[14],x=e[15],y=s[0],M=s[1],w=s[2],v=s[3];return t[0]=y*i+M*h+w*d+v*f,t[1]=y*r+M*o+w*c+v*p,t[2]=y*n+M*l+w*m+v*b,t[3]=y*a+M*u+w*g+v*x,y=s[4],M=s[5],w=s[6],v=s[7],t[4]=y*i+M*h+w*d+v*f,t[5]=y*r+M*o+w*c+v*p,t[6]=y*n+M*l+w*m+v*b,t[7]=y*a+M*u+w*g+v*x,y=s[8],M=s[9],w=s[10],v=s[11],t[8]=y*i+M*h+w*d+v*f,t[9]=y*r+M*o+w*c+v*p,t[10]=y*n+M*l+w*m+v*b,t[11]=y*a+M*u+w*g+v*x,y=s[12],M=s[13],w=s[14],v=s[15],t[12]=y*i+M*h+w*d+v*f,t[13]=y*r+M*o+w*c+v*p,t[14]=y*n+M*l+w*m+v*b,t[15]=y*a+M*u+w*g+v*x,t}function g(t,e,s){var i=s[0],r=s[1],n=s[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function f(t,e){var s=e[0],i=e[1],r=e[2],n=e[4],a=e[5],h=e[6],o=e[8],l=e[9],u=e[10];return t[0]=Math.hypot(s,i,r),t[1]=Math.hypot(n,a,h),t[2]=Math.hypot(o,l,u),t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var p=function(t,e,s,i,r){var n,a=1/Math.tan(e/2);return t[0]=a/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(n=1/(i-r),t[10]=(r+i)*n,t[14]=2*r*i*n):(t[10]=-1,t[14]=-2*i),t};var b=function(t,e,s,i,r,n,a){var h=1/(e-s),o=1/(i-r),l=1/(n-a);return t[0]=-2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+s)*h,t[13]=(r+i)*o,t[14]=(a+n)*l,t[15]=1,t};function x(t,e,s){return t[0]=e[0]+s[0],t[1]=e[1]+s[1],t[2]=e[2]+s[2],t[3]=e[3]+s[3],t[4]=e[4]+s[4],t[5]=e[5]+s[5],t[6]=e[6]+s[6],t[7]=e[7]+s[7],t[8]=e[8]+s[8],t[9]=e[9]+s[9],t[10]=e[10]+s[10],t[11]=e[11]+s[11],t[12]=e[12]+s[12],t[13]=e[13]+s[13],t[14]=e[14]+s[14],t[15]=e[15]+s[15],t}function y(t,e,s){return t[0]=e[0]-s[0],t[1]=e[1]-s[1],t[2]=e[2]-s[2],t[3]=e[3]-s[3],t[4]=e[4]-s[4],t[5]=e[5]-s[5],t[6]=e[6]-s[6],t[7]=e[7]-s[7],t[8]=e[8]-s[8],t[9]=e[9]-s[9],t[10]=e[10]-s[10],t[11]=e[11]-s[11],t[12]=e[12]-s[12],t[13]=e[13]-s[13],t[14]=e[14]-s[14],t[15]=e[15]-s[15],t}function M(){var t=new a(3);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function w(t){var e=t[0],s=t[1],i=t[2];return Math.hypot(e,s,i)}function v(t,e,s){var i=new a(3);return i[0]=t,i[1]=e,i[2]=s,i}function E(t,e,s){return t[0]=e[0]+s[0],t[1]=e[1]+s[1],t[2]=e[2]+s[2],t}function A(t,e,s){return t[0]=e[0]-s[0],t[1]=e[1]-s[1],t[2]=e[2]-s[2],t}function T(t,e,s){return t[0]=e[0]*s[0],t[1]=e[1]*s[1],t[2]=e[2]*s[2],t}function _(t,e,s){return t[0]=e[0]/s[0],t[1]=e[1]/s[1],t[2]=e[2]/s[2],t}function S(t,e){var s=e[0],i=e[1],r=e[2],n=s*s+i*i+r*r;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function F(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function R(t,e,s){var i=e[0],r=e[1],n=e[2],a=s[0],h=s[1],o=s[2];return t[0]=r*o-n*h,t[1]=n*a-i*o,t[2]=i*h-r*a,t}function C(t,e){var s=t[0],i=t[1],r=t[2],n=e[0],a=e[1],h=e[2],o=Math.sqrt(s*s+i*i+r*r)*Math.sqrt(n*n+a*a+h*h),l=o&&F(t,e)/o;return Math.acos(Math.min(Math.max(l,-1),1))}function N(t,e,s,i,r){return t[0]=e,t[1]=s,t[2]=i,t[3]=r,t}function O(t,e,s){return t[0]=e[0]+s[0],t[1]=e[1]+s[1],t[2]=e[2]+s[2],t[3]=e[3]+s[3],t}function B(t,e,s){return t[0]=e[0]-s[0],t[1]=e[1]-s[1],t[2]=e[2]-s[2],t[3]=e[3]-s[3],t}function L(t,e,s){return t[0]=e[0]*s[0],t[1]=e[1]*s[1],t[2]=e[2]*s[2],t[3]=e[3]*s[3],t}function I(t,e,s){return t[0]=e[0]/s[0],t[1]=e[1]/s[1],t[2]=e[2]/s[2],t[3]=e[3]/s[3],t}function U(t){var e=t[0],s=t[1],i=t[2],r=t[3];return Math.hypot(e,s,i,r)}function P(t,e){var s=e[0],i=e[1],r=e[2],n=e[3],a=s*s+i*i+r*r+n*n;return a>0&&(a=1/Math.sqrt(a)),t[0]=s*a,t[1]=i*a,t[2]=r*a,t[3]=n*a,t}function D(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function G(t,e){var s=t[0],i=t[1],r=t[2],a=t[3],h=e[0],o=e[1],l=e[2],u=e[3];return Math.abs(s-h)<=n*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(i-o)<=n*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-l)<=n*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(a-u)<=n*Math.max(1,Math.abs(a),Math.abs(u))}function k(){var t=new a(4);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function z(t,e,s){s*=.5;var i=Math.sin(s);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(s),t}function W(t,e,s){var i=e[0],r=e[1],n=e[2],a=e[3],h=s[0],o=s[1],l=s[2],u=s[3];return t[0]=i*u+a*h+r*l-n*o,t[1]=r*u+a*o+n*h-i*l,t[2]=n*u+a*l+i*o-r*h,t[3]=a*u-i*h-r*o-n*l,t}function j(t,e,s,i){var r,a,h,o,l,u=e[0],d=e[1],c=e[2],m=e[3],g=s[0],f=s[1],p=s[2],b=s[3];return(a=u*g+d*f+c*p+m*b)<0&&(a=-a,g=-g,f=-f,p=-p,b=-b),1-a>n?(r=Math.acos(a),h=Math.sin(r),o=Math.sin((1-i)*r)/h,l=Math.sin(i*r)/h):(o=1-i,l=i),t[0]=o*u+l*g,t[1]=o*d+l*f,t[2]=o*c+l*p,t[3]=o*m+l*b,t}function V(t,e){var s,i=e[0]+e[4]+e[8];if(i>0)s=Math.sqrt(i+1),t[3]=.5*s,s=.5/s,t[0]=(e[5]-e[7])*s,t[1]=(e[6]-e[2])*s,t[2]=(e[1]-e[3])*s;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var n=(r+1)%3,a=(r+2)%3;s=Math.sqrt(e[3*r+r]-e[3*n+n]-e[3*a+a]+1),t[r]=.5*s,s=.5/s,t[3]=(e[3*n+a]-e[3*a+n])*s,t[n]=(e[3*n+r]+e[3*r+n])*s,t[a]=(e[3*a+r]+e[3*r+a])*s}return t}M(),function(){var t,e=(t=new a(4),a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var H,q=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},$=N,Y=D,X=U,Z=P;function K(t,e,s){return t[0]=e[0]+s[0],t[1]=e[1]+s[1],t}function Q(t,e,s){return t[0]=e[0]-s[0],t[1]=e[1]-s[1],t}function J(t,e,s){return t[0]=e[0]*s[0],t[1]=e[1]*s[1],t}function tt(t,e,s){return t[0]=e[0]/s[0],t[1]=e[1]/s[1],t}function et(t,e){var s=t[0],i=t[1],r=e[0],n=e[1],a=Math.sqrt(s*s+i*i)*Math.sqrt(r*r+n*n),h=a&&(s*r+i*n)/a;return Math.acos(Math.min(Math.max(h,-1),1))}M(),v(1,0,0),v(0,1,0),k(),k(),H=new a(9),a!=Float32Array&&(H[1]=0,H[2]=0,H[3]=0,H[5]=0,H[6]=0,H[7]=0),H[0]=1,H[4]=1,H[8]=1,function(){var t=function(){var t=new a(2);return a!=Float32Array&&(t[0]=0,t[1]=0),t}()}();const st=Math.PI/180,it=180/Math.PI;function rt(t){return t*st}function nt(t){return t*it}function at(t,e,s){return Math.min(Math.max(t,e),s)}function ht(t){return Math.log(t)/Math.LN2%1==0}let ot=Float32Array;function lt(t,e=!0){ot=t?Float64Array:Float32Array,e&&(a=ot)}function ut(){return ot}function dt(t){return"undefined"!=typeof WebGLRenderingContext&&t instanceof WebGLRenderingContext||("undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||(!(!t?.gl||!(t.gl instanceof WebGLRenderingContext||t.gl instanceof WebGL2RenderingContext))||Boolean(t&&Number.isFinite(t._version))))}function ct(t){return"undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||(!!(t?.gl&&t.gl instanceof WebGL2RenderingContext)||Boolean(t&&2===t._version))}function mt(t,e={},s=!1){const i=["webgl2","webgl","experimental-webgl"];s||i.shift();let r=null;function n(t){console.error(t.statusMessage)}t?.addEventListener?.("webglcontextcreationerror",n,!1);for(let s=0;s<i.length;++s){try{r=t.getContext(i[s],e)}catch(t){}if(r)break}return t?.removeEventListener?.("webglcontextcreationerror",n,!1),r}const gt=()=>("undefined"==typeof performance?Date:performance).now();function ft(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function pt(t){return"string"===ft(t)}function bt(t){return"undefined"===ft(t)}function xt(t){return pt(t)&&t.includes("%")}function yt(t){return"number"===ft(t)}function Mt(t){return"regexp"===ft(t)}function wt(t){return null==t}function vt(t){const e=typeof t;return null!==t&&("object"===e||"function"===e)}const Et={};function At(t="id"){Et[t]=Et[t]||1;return`${t}-${Et[t]++}`}function Tt(t,e=[]){return Object.keys(t).filter((t=>e.indexOf(t)<0)).reduce(((e,s)=>Object.assign(e,{[s]:t[s]})),{})}const _t=[],St=1e3/60;let Ft=performance.now();function Rt(){const t=gt(),e=t-Ft;if(e>=St){Ft=t-e%St;const s=_t.slice();_t.length=0;for(let i=0;i<s.length;i++)s[i]&&s[i](t,e)}else setImmediate(Rt)}function Ct(t){return"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(t):(e=t,_t.push(e),1===_t.length&&setImmediate(Rt),_t.length-1);var e}function Nt(t){return"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):void(_t[t]=void 0)}var Ot=Object.freeze({__proto__:null,DEG_TO_RAD:st,RAD_TO_DEG:it,cancelAnimationFrame:Nt,clamp:at,defineShader:function(t,e={}){return Object.keys(e).reduce(((t,s)=>e[s]?`#define ${s} ${e[s]}\n${t}`:t),t)},degToRad:rt,getContext:mt,getFloatArrayConstructor:ut,getShaderName:s,getWireframeIndex:i,hasValue:function(t,e){return vt(t)?!wt(t.value)&&(wt(e)||t.value===e):!wt(t)&&(wt(e)||t===e)},highPrecision:lt,isHex:xt,isNull:wt,isNumber:yt,isObject:vt,isPowerOfTwo:ht,isRegexp:Mt,isString:pt,isUndef:bt,isUniqueEdge:r,isWebGL:dt,isWebGL2:ct,now:gt,omit:Tt,parseShader:e,pick:function(t,e=[]){return Object.keys(t).filter((t=>e.indexOf(t)>-1)).reduce(((e,s)=>Object.assign(e,{[s]:t[s]})),{})},radToDeg:nt,requestAnimationFrame:Ct,typeOf:ft,uid:At});class Bt{#t=0;#e=0;#s=!1;running;constructor(t=!0){this.running=t}start(){this.#s||(this.reset(),this.#s=!0)}stop(){this.getElapsedTime(),this.#s=!1,this.running=!1}reset(){this.#t=gt(),this.#e=0}getElapsedTime(){return this.getDelta(),this.#e}getDelta(){let t=0;if(this.running&&!this.#s)return this.start(),0;if(this.#s){const e=gt();t=(e-this.#t)/1e3,this.#t=e,this.#e=this.#e+t}return t}}const Lt={autoStart:!0};class It{type;constructor(t,e={}){this.type=t,(Object.getOwnPropertyNames(e)||[]).forEach((t=>{this[t]=e[t]}))}}class Ut{elements=new(ut())(2);fromArray(t,e=0){let s=0;for(;s<this.elements.length;s++)this.elements[s]=t[e+s];return this}toArray(t=[],e=0){let s=0;for(;s<this.elements.length;s++)t[e+s]=this.elements[s];return t}}class Pt extends Ut{elements=new(ut())(2);constructor(t=0,e=0){super();const s=this.elements;s[0]=t,s[1]=e}get x(){return this.elements[0]}set x(t){this.elements[0]=t}get y(){return this.elements[1]}set y(t){this.elements[1]=t}fromObject(t){const{x:e,y:s}=t;return void 0!==e&&(this.x=e),void 0!==s&&(this.y=s),this}toObject(){return{x:this.x,y:this.y}}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.set(t,t)}add(t){return K(this.elements,this.elements,t.elements),this}addScalar(t){return K(this.elements,this.elements,[t,t]),this}subtract(t){return Q(this.elements,this.elements,t.elements),this}subtractScalar(t){return Q(this.elements,this.elements,[t,t]),this}multiply(t){return J(this.elements,this.elements,t.elements),this}multiplyScalar(t){return J(this.elements,this.elements,[t,t]),this}divide(t){return tt(this.elements,this.elements,t.elements),this}divideScalar(t){return tt(this.elements,this.elements,[t,t]),this}scale(t){return function(t,e,s){t[0]=e[0]*s,t[1]=e[1]*s}(this.elements,this.elements,t),this}distanceTo(t){return function(t,e){var s=e[0]-t[0],i=e[1]-t[1];return Math.hypot(s,i)}(this.elements,t.elements)}length(){return function(t){var e=t[0],s=t[1];return Math.hypot(e,s)}(this.elements)}distanceToSquared(t){return function(t,e){var s=e[0]-t[0],i=e[1]-t[1];return s*s+i*i}(t.elements,this.elements)}angle(){return et(this.elements,[1,0])}angleTo(t){return et(this.elements,t.elements)}dot(t){return function(t,e){return t[0]*e[0]+t[1]*e[1]}(this.elements,t.elements)}equals(t){return function(t,e){var s=t[0],i=t[1],r=e[0],a=e[1];return Math.abs(s-r)<=n*Math.max(1,Math.abs(s),Math.abs(r))&&Math.abs(i-a)<=n*Math.max(1,Math.abs(i),Math.abs(a))}(this.elements,t.elements)}cross(t){return function(t,e,s){var i=e[0]*s[1]-e[1]*s[0];t[0]=t[1]=0,t[2]=i}(this.elements,this.elements,t.elements),this}negate(){return function(t,e){t[0]=-e[0],t[1]=-e[1]}(this.elements,this.elements),this}inverse(){return function(t,e){t[0]=1/e[0],t[1]=1/e[1]}(this.elements,this.elements),this}lerp(t,e){return function(t,e,s,i){var r=e[0],n=e[1];t[0]=r+i*(s[0]-r),t[1]=n+i*(s[1]-n)}(this.elements,this.elements,t.elements,e),this}normalize(){return function(t,e){var s=e[0],i=e[1],r=s*s+i*i;r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r}(this.elements,this.elements),this}applyMatrix3(t){return function(t,e,s){var i=e[0],r=e[1];t[0]=s[0]*i+s[3]*r+s[6],t[1]=s[1]*i+s[4]*r+s[7]}(this.elements,this.elements,t.elements),this}applyMatrix4(t){return function(t,e,s){var i=e[0],r=e[1];t[0]=s[0]*i+s[4]*r+s[12],t[1]=s[1]*i+s[5]*r+s[13]}(this.elements,this.elements,t.elements),this}copy(t){return this.x=t.x,this.y=t.y,this}clone(){return new Pt(this.x,this.y)}toString(){return`${this.constructor.name}(${this.elements.join(", ")})`}}const Dt=[];class Gt extends Ut{elements=new(ut())(4);#i=[];constructor(t=0,e=0,s=0,i=0){super();const r=this.elements;r[0]=t,r[1]=e,r[2]=s,r[3]=i}get x(){return this.elements[0]}set x(t){this.elements[0]=t,this.triggerChange()}get y(){return this.elements[1]}set y(t){this.elements[1]=t,this.triggerChange()}get z(){return this.elements[2]}set z(t){this.elements[2]=t,this.triggerChange()}get w(){return this.elements[3]}set w(t){this.elements[3]=t,this.triggerChange()}fromObject({x:t,y:e,z:s,w:i}){return void 0!==t&&(this.x=t),void 0!==e&&(this.y=e),void 0!==s&&(this.z=s),void 0!==i&&(this.w=i),this.triggerChange(),this}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}fromAxisAngle(t,e){return z(this.elements,t.elements,e),this.triggerChange(),this}getAxisAngle(t=new kt){const e=function(t,e){var s=2*Math.acos(e[3]),i=Math.sin(s/2);return i>n?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),s}(Dt,this.elements);return t.set(Dt[0],Dt[1],Dt[2]),e}fromEuler(t){return function(t,e,s,i){var r=.5*Math.PI/180;e*=r,s*=r,i*=r;var n=Math.sin(e),a=Math.cos(e),h=Math.sin(s),o=Math.cos(s),l=Math.sin(i),u=Math.cos(i);t[0]=n*o*u-a*h*l,t[1]=a*h*u+n*o*l,t[2]=a*o*l-n*h*u,t[3]=a*o*u+n*h*l}(this.elements,nt(t.x),nt(t.y),nt(t.z)),this.triggerChange(),this}fromMat3(t){return V(this.elements,t),this}set(t,e,s,i){return $(this.elements,t,e,s,i),this.triggerChange(),this}length(){return X(this.elements)}multiply(t,e){return e?W(this.elements,t.elements,e.elements):W(this.elements,this.elements,t.elements),this.triggerChange(),this}slerp(t,e){return j(this.elements,this.elements,t.elements,e),this.triggerChange(),this}invert(){return function(t,e){var s=e[0],i=e[1],r=e[2],n=e[3],a=s*s+i*i+r*r+n*n,h=a?1/a:0;t[0]=-s*h,t[1]=-i*h,t[2]=-r*h,t[3]=n*h}(this.elements,this.elements),this.triggerChange(),this}conjugate(){return function(t,e){t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3]}(this.elements,this.elements),this.triggerChange(),this}normalize(){return Z(this.elements,this.elements),this.triggerChange(),this}dot(t){return Y(this.elements,t.elements)}angleTo(t){return function(t,e){var s=Y(t,e);return Math.acos(2*s*s-1)}(this.elements,t.elements)}clone(){return(new Gt).copy(this)}copy(t){return q(this.elements,t.elements),this.triggerChange(),this}equals(t){return G(this.elements,t.elements)}onChange(t){this.#i.includes(t)||this.#i.push(t)}triggerChange(){this.#i.forEach((t=>t()))}toString(){return`${this.constructor.name}(${this.elements.join(", ")})`}}class kt extends Ut{elements=new(ut())(3);constructor(t=0,e=0,s=0){super();const i=this.elements;i[0]=t,i[1]=e,i[2]=s}get x(){return this.elements[0]}set x(t){this.elements[0]=t}get y(){return this.elements[1]}set y(t){this.elements[1]=t}get z(){return this.elements[2]}set z(t){this.elements[2]=t}fromObject(t){const{x:e,y:s,z:i}=t;return void 0!==e&&(this.x=e),void 0!==s&&(this.y=s),void 0!==i&&(this.z=i),this}toObject(){return{x:this.x,y:this.y,z:this.z}}set(t,e,s){return function(t,e,s,i){t[0]=e,t[1]=s,t[2]=i}(this.elements,t,e,s),this}setScalar(t){return this.set(t,t,t)}length(){return w(this.elements)}add(t){return E(this.elements,this.elements,t.elements),this}addScalar(t){return E(this.elements,this.elements,[t,t,t]),this}subtract(t){return A(this.elements,this.elements,t.elements),this}subtractScalar(t){return A(this.elements,this.elements,[t,t,t]),this}subVectors(t,e){return A(this.elements,t.elements,e.elements),this}multiply(t){return T(this.elements,this.elements,t.elements),this}multiplyScalar(t){return T(this.elements,this.elements,[t,t,t]),this}divide(t){return _(this.elements,this.elements,t.elements),this}divideScalar(t){return _(this.elements,this.elements,[t,t,t]),this}scale(t){return function(t,e,s){t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s}(this.elements,this.elements,t),this}scaleAndAdd(t,e){return function(t,e,s,i){t[0]=e[0]+s[0]*i,t[1]=e[1]+s[1]*i,t[2]=e[2]+s[2]*i}(this.elements,this.elements,t.elements,e),this}distanceTo(t){return function(t,e){var s=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return Math.hypot(s,i,r)}(this.elements,t.elements)}distanceToSquared(t){return function(t,e){var s=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return s*s+i*i+r*r}(this.elements,t.elements)}angle(t){return C(this.elements,[1,0,0])}angleTo(t){return C(this.elements,t.elements)}dot(t){return F(this.elements,t.elements)}equals(t){return function(t,e){var s=t[0],i=t[1],r=t[2],a=e[0],h=e[1],o=e[2];return Math.abs(s-a)<=n*Math.max(1,Math.abs(s),Math.abs(a))&&Math.abs(i-h)<=n*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(r-o)<=n*Math.max(1,Math.abs(r),Math.abs(o))}(this.elements,t.elements)}cross(t){return R(this.elements,this.elements,t.elements),this}negate(){return function(t,e){t[0]=-e[0],t[1]=-e[1],t[2]=-e[2]}(this.elements,this.elements),this}inverse(){return function(t,e){t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2]}(this.elements,this.elements),this}lerp(t,e){return function(t,e,s,i){var r=e[0],n=e[1],a=e[2];t[0]=r+i*(s[0]-r),t[1]=n+i*(s[1]-n),t[2]=a+i*(s[2]-a)}(this.elements,this.elements,t.elements,e),this}normalize(){return S(this.elements,this.elements),this}applyEuler(t){const e=(new Gt).fromEuler(t);return this.applyQuaternion(e)}applyMatrix3(t){return function(t,e,s){var i=e[0],r=e[1],n=e[2];t[0]=i*s[0]+r*s[3]+n*s[6],t[1]=i*s[1]+r*s[4]+n*s[7],t[2]=i*s[2]+r*s[5]+n*s[8]}(this.elements,this.elements,t.elements),this}applyMatrix4(t){return function(t,e,s){var i=e[0],r=e[1],n=e[2],a=s[3]*i+s[7]*r+s[11]*n+s[15];a=a||1,t[0]=(s[0]*i+s[4]*r+s[8]*n+s[12])/a,t[1]=(s[1]*i+s[5]*r+s[9]*n+s[13])/a,t[2]=(s[2]*i+s[6]*r+s[10]*n+s[14])/a}(this.elements,this.elements,t.elements),this}applyQuaternion(t){return function(t,e,s){var i=s[0],r=s[1],n=s[2],a=s[3],h=e[0],o=e[1],l=e[2],u=r*l-n*o,d=n*h-i*l,c=i*o-r*h,m=r*c-n*d,g=n*u-i*c,f=i*d-r*u,p=2*a;u*=p,d*=p,c*=p,m*=2,g*=2,f*=2,t[0]=h+u+m,t[1]=o+d+g,t[2]=l+c+f}(this.elements,this.elements,t.elements),this}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}clone(){return new kt(this.x,this.y,this.z)}toString(){return`${this.constructor.name}(${this.elements.join(", ")})`}}class zt extends Ut{elements=new(ut())(4);constructor(t=0,e=0,s=0,i=0){super();const r=this.elements;r[0]=t,r[1]=e,r[2]=s,r[3]=i}get x(){return this.elements[0]}set x(t){this.elements[0]=t}get y(){return this.elements[1]}set y(t){this.elements[1]=t}get z(){return this.elements[2]}set z(t){this.elements[2]=t}get w(){return this.elements[3]}set w(t){this.elements[3]=t}fromObject(t){const{x:e,y:s,z:i,w:r}=t;return void 0!==e&&(this.x=e),void 0!==s&&(this.y=s),void 0!==i&&(this.z=i),void 0!==r&&(this.w=r),this}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}set(t,e,s,i){return N(this.elements,t,e,s,i),this}setScalar(t){return this.set(t,t,t,t)}add(t){return O(this.elements,this.elements,t.elements),this}addScalar(t){return O(this.elements,this.elements,[t,t,t,t]),this}subtract(t){return B(this.elements,this.elements,t.elements),this}subtractScalar(t){return B(this.elements,this.elements,[t,t,t,t]),this}subVectors(t,e){return B(this.elements,t.elements,e.elements),this}multiply(t){return L(this.elements,this.elements,t.elements),this}multiplyScalar(t){return L(this.elements,this.elements,[t,t,t,t]),this}divide(t){return I(this.elements,this.elements,t.elements),this}divideScalar(t){return I(this.elements,this.elements,[t,t,t,t]),this}scale(t){return function(t,e,s){t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s}(this.elements,this.elements,t),this}scaleAndAdd(t,e){return function(t,e,s,i){t[0]=e[0]+s[0]*i,t[1]=e[1]+s[1]*i,t[2]=e[2]+s[2]*i,t[3]=e[3]+s[3]*i}(this.elements,this.elements,t.elements,e),this}distanceTo(t){return function(t,e){var s=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2],n=e[3]-t[3];return Math.hypot(s,i,r,n)}(this.elements,t.elements)}distanceToSquared(t){return function(t,e){var s=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2],n=e[3]-t[3];return s*s+i*i+r*r+n*n}(this.elements,t.elements)}length(){return U(this.elements)}dot(t){return D(this.elements,t.elements)}equals(t){return G(this.elements,t.elements)}cross(t){return function(t,e,s,i){var r=s[0]*i[1]-s[1]*i[0],n=s[0]*i[2]-s[2]*i[0],a=s[0]*i[3]-s[3]*i[0],h=s[1]*i[2]-s[2]*i[1],o=s[1]*i[3]-s[3]*i[1],l=s[2]*i[3]-s[3]*i[2],u=e[0],d=e[1],c=e[2],m=e[3];t[0]=d*l-c*o+m*h,t[1]=-u*l+c*a-m*n,t[2]=u*o-d*a+m*r,t[3]=-u*h+d*n-c*r}(this.elements,this.elements,t.elements),this}negate(){return function(t,e){t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3]}(this.elements,this.elements),this}inverse(){return function(t,e){t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3]}(this.elements,this.elements),this}lerp(t,e){return function(t,e,s,i){var r=e[0],n=e[1],a=e[2],h=e[3];t[0]=r+i*(s[0]-r),t[1]=n+i*(s[1]-n),t[2]=a+i*(s[2]-a),t[3]=h+i*(s[3]-h)}(this.elements,this.elements,t.elements,e),this}normalize(){return P(this.elements,this.elements),this}applyMatrix4(t){return function(t,e,s){var i=e[0],r=e[1],n=e[2],a=e[3];t[0]=s[0]*i+s[4]*r+s[8]*n+s[12]*a,t[1]=s[1]*i+s[5]*r+s[9]*n+s[13]*a,t[2]=s[2]*i+s[6]*r+s[10]*n+s[14]*a,t[3]=s[3]*i+s[7]*r+s[11]*n+s[15]*a}(this.elements,this.elements,t.elements),this}applyQuaternion(t){return function(t,e,s){var i=e[0],r=e[1],n=e[2],a=s[0],h=s[1],o=s[2],l=s[3],u=l*i+h*n-o*r,d=l*r+o*i-a*n,c=l*n+a*r-h*i,m=-a*i-h*r-o*n;t[0]=u*l+m*-a+d*-o-c*-h,t[1]=d*l+m*-h+c*-a-u*-o,t[2]=c*l+m*-o+u*-h-d*-a,t[3]=e[3]}(this.elements,this.elements,t.elements),this}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}clone(){return new zt(this.x,this.y,this.z,this.w)}toString(){return`${this.constructor.name}(${this.elements.join(", ")})`}}class Wt{elements=new(ut())(16);fromArray(t,e=0){let s=0;for(;s<this.elements.length;s++)this.elements[s]=t[e+s];return this}toArray(t=[],e=0){let s=0;for(;s<this.elements.length;s++)t[e+s]=this.elements[s];return t}}class jt extends Wt{elements=new(ut())(9);constructor(t=1,e=0,s=0,i=0,r=1,n=0,a=0,h=0,o=1){super();const l=this.elements;l[0]=t,l[1]=e,l[2]=s,l[3]=i,l[4]=r,l[5]=n,l[6]=a,l[7]=h,l[8]=o}get x(){return this.elements[2]}get y(){return this.elements[5]}get z(){return this.elements[8]}static get identity(){return(new jt).fromArray(function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}([]))}set(t,e,s,i,r,n,a,h,o){return function(t,e,s,i,r,n,a,h,o,l){t[0]=e,t[1]=s,t[2]=i,t[3]=r,t[4]=n,t[5]=a,t[6]=h,t[7]=o,t[8]=l}(this.elements,t,e,s,i,r,n,a,h,o),this}transpose(){return function(t,e){if(t===e){var s=e[1],i=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=s,t[5]=e[7],t[6]=i,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8]}(this.elements,this.elements),this}invert(t=this){return function(t,e){var s=e[0],i=e[1],r=e[2],n=e[3],a=e[4],h=e[5],o=e[6],l=e[7],u=e[8],d=u*a-h*l,c=-u*n+h*o,m=l*n-a*o,g=s*d+i*c+r*m;g&&(g=1/g,t[0]=d*g,t[1]=(-u*i+r*l)*g,t[2]=(h*i-r*a)*g,t[3]=c*g,t[4]=(u*s-r*o)*g,t[5]=(-h*s+r*n)*g,t[6]=m*g,t[7]=(-l*s+i*o)*g,t[8]=(a*s-i*n)*g)}(this.elements,t.elements),this}adjoint(t=this){return function(t,e){var s=e[0],i=e[1],r=e[2],n=e[3],a=e[4],h=e[5],o=e[6],l=e[7],u=e[8];t[0]=a*u-h*l,t[1]=r*l-i*u,t[2]=i*h-r*a,t[3]=h*o-n*u,t[4]=s*u-r*o,t[5]=r*n-s*h,t[6]=n*l-a*o,t[7]=i*o-s*l,t[8]=s*a-i*n}(this.elements,t.elements),this}determinant(){return function(t){var e=t[0],s=t[1],i=t[2],r=t[3],n=t[4],a=t[5],h=t[6],o=t[7],l=t[8];return e*(l*n-a*o)+s*(-l*r+a*h)+i*(o*r-n*h)}(this.elements)}multiply(t,e){return e?h(this.elements,t.elements,e.elements):h(this.elements,this.elements,t.elements),this}premultiply(t,e){return e?h(this.elements,e.elements,t.elements):h(this.elements,t.elements,this.elements),this}translate(t){return function(t,e,s){var i=e[0],r=e[1],n=e[2],a=e[3],h=e[4],o=e[5],l=e[6],u=e[7],d=e[8],c=s[0],m=s[1];t[0]=i,t[1]=r,t[2]=n,t[3]=a,t[4]=h,t[5]=o,t[6]=c*i+m*a+l,t[7]=c*r+m*h+u,t[8]=c*n+m*o+d}(this.elements,this.elements,t.elements),this}rotate(t){return function(t,e,s){var i=e[0],r=e[1],n=e[2],a=e[3],h=e[4],o=e[5],l=e[6],u=e[7],d=e[8],c=Math.sin(s),m=Math.cos(s);t[0]=m*i+c*a,t[1]=m*r+c*h,t[2]=m*n+c*o,t[3]=m*a-c*i,t[4]=m*h-c*r,t[5]=m*o-c*n,t[6]=l,t[7]=u,t[8]=d}(this.elements,this.elements,t),this}scale(t){return function(t,e,s){var i=s[0],r=s[1];t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]}(this.elements,this.elements,t.elements),this}fromTranslation(t){return function(t,e){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1}(this.elements,t.elements),this}fromRotation(t){return function(t,e){var s=Math.sin(e),i=Math.cos(e);t[0]=i,t[1]=s,t[2]=0,t[3]=-s,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1}(this.elements,t),this}fromScaling(t){return function(t,e){t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1}(this.elements,t.elements),this}fromQuat(t){return function(t,e){var s=e[0],i=e[1],r=e[2],n=e[3],a=s+s,h=i+i,o=r+r,l=s*a,u=i*a,d=i*h,c=r*a,m=r*h,g=r*o,f=n*a,p=n*h,b=n*o;t[0]=1-d-g,t[3]=u-b,t[6]=c+p,t[1]=u+b,t[4]=1-l-g,t[7]=m-f,t[2]=c-p,t[5]=m+f,t[8]=1-l-d}(this.elements,t.elements),this}normalFromMat4(t){return o(this.elements,t.elements),this}fromMat4(t){return function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10]}(this.elements,t.elements),this}frob(){return function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}(this.elements)}add(t,e){return e?l(this.elements,t.elements,e.elements):l(this.elements,this.elements,t.elements),this}subtract(t,e){return e?u(this.elements,t.elements,e.elements):u(this.elements,this.elements,t.elements),this}equals(t,e){return e?d(t.elements,e.elements):d(this.elements,t.elements)}fromRotationTranslationScale(t,e,s,i,r){const n=Math.cos(t),a=Math.sin(t);return this.set(i*n,-r*a,0,i*a,r*n,0,e,s,1),this}getNormalMatrix(t){return o(this.elements,t.elements),this}copy(t){return function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]}(this.elements,t.elements),this}clone(){return(new jt).copy(this)}toString(){return`${this.constructor.name}(${this.elements.join(", ")})`}}const Vt=[];class Ht extends Wt{elements=new(ut())(16);constructor(t=1,e=0,s=0,i=0,r=0,n=1,a=0,h=0,o=0,l=0,u=1,d=0,c=0,m=0,g=0,f=1){super();const p=this.elements;p[0]=t,p[1]=e,p[2]=s,p[3]=i,p[4]=r,p[5]=n,p[6]=a,p[7]=h,p[8]=o,p[9]=l,p[10]=u,p[11]=d,p[12]=c,p[13]=m,p[14]=g,p[15]=f}get x(){return this.elements[12]}get y(){return this.elements[13]}get z(){return this.elements[14]}get w(){return this.elements[15]}static get identity(){return(new Ht).fromArray(c([]))}set(t,e,s,i,r,n,a,h,o,l,u,d,c,m,g,f){return function(t,e,s,i,r,n,a,h,o,l,u,d,c,m,g,f,p){t[0]=e,t[1]=s,t[2]=i,t[3]=r,t[4]=n,t[5]=a,t[6]=h,t[7]=o,t[8]=l,t[9]=u,t[10]=d,t[11]=c,t[12]=m,t[13]=g,t[14]=f,t[15]=p}(this.elements,t,e,s,i,r,n,a,h,o,l,u,d,c,m,g,f),this}transpose(){return function(t,e){if(t===e){var s=e[1],i=e[2],r=e[3],n=e[6],a=e[7],h=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=s,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=n,t[11]=e[14],t[12]=r,t[13]=a,t[14]=h}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(this.elements,this.elements),this}invert(t=this){return function(t,e){var s=e[0],i=e[1],r=e[2],n=e[3],a=e[4],h=e[5],o=e[6],l=e[7],u=e[8],d=e[9],c=e[10],m=e[11],g=e[12],f=e[13],p=e[14],b=e[15],x=s*h-i*a,y=s*o-r*a,M=s*l-n*a,w=i*o-r*h,v=i*l-n*h,E=r*l-n*o,A=u*f-d*g,T=u*p-c*g,_=u*b-m*g,S=d*p-c*f,F=d*b-m*f,R=c*b-m*p,C=x*R-y*F+M*S+w*_-v*T+E*A;C&&(C=1/C,t[0]=(h*R-o*F+l*S)*C,t[1]=(r*F-i*R-n*S)*C,t[2]=(f*E-p*v+b*w)*C,t[3]=(c*v-d*E-m*w)*C,t[4]=(o*_-a*R-l*T)*C,t[5]=(s*R-r*_+n*T)*C,t[6]=(p*M-g*E-b*y)*C,t[7]=(u*E-c*M+m*y)*C,t[8]=(a*F-h*_+l*A)*C,t[9]=(i*_-s*F-n*A)*C,t[10]=(g*v-f*M+b*x)*C,t[11]=(d*M-u*v-m*x)*C,t[12]=(h*T-a*S-o*A)*C,t[13]=(s*S-i*T+r*A)*C,t[14]=(f*y-g*w-p*x)*C,t[15]=(u*w-d*y+c*x)*C)}(this.elements,t.elements),this}adjoint(t=this){return function(t,e){var s=e[0],i=e[1],r=e[2],n=e[3],a=e[4],h=e[5],o=e[6],l=e[7],u=e[8],d=e[9],c=e[10],m=e[11],g=e[12],f=e[13],p=e[14],b=e[15];t[0]=h*(c*b-m*p)-d*(o*b-l*p)+f*(o*m-l*c),t[1]=-(i*(c*b-m*p)-d*(r*b-n*p)+f*(r*m-n*c)),t[2]=i*(o*b-l*p)-h*(r*b-n*p)+f*(r*l-n*o),t[3]=-(i*(o*m-l*c)-h*(r*m-n*c)+d*(r*l-n*o)),t[4]=-(a*(c*b-m*p)-u*(o*b-l*p)+g*(o*m-l*c)),t[5]=s*(c*b-m*p)-u*(r*b-n*p)+g*(r*m-n*c),t[6]=-(s*(o*b-l*p)-a*(r*b-n*p)+g*(r*l-n*o)),t[7]=s*(o*m-l*c)-a*(r*m-n*c)+u*(r*l-n*o),t[8]=a*(d*b-m*f)-u*(h*b-l*f)+g*(h*m-l*d),t[9]=-(s*(d*b-m*f)-u*(i*b-n*f)+g*(i*m-n*d)),t[10]=s*(h*b-l*f)-a*(i*b-n*f)+g*(i*l-n*h),t[11]=-(s*(h*m-l*d)-a*(i*m-n*d)+u*(i*l-n*h)),t[12]=-(a*(d*p-c*f)-u*(h*p-o*f)+g*(h*c-o*d)),t[13]=s*(d*p-c*f)-u*(i*p-r*f)+g*(i*c-r*d),t[14]=-(s*(h*p-o*f)-a*(i*p-r*f)+g*(i*o-r*h)),t[15]=s*(h*c-o*d)-a*(i*c-r*d)+u*(i*o-r*h)}(this.elements,t.elements),this}determinant(){return function(t){var e=t[0],s=t[1],i=t[2],r=t[3],n=t[4],a=t[5],h=t[6],o=t[7],l=t[8],u=t[9],d=t[10],c=t[11],m=t[12],g=t[13],f=t[14],p=t[15];return(e*a-s*n)*(d*p-c*f)-(e*h-i*n)*(u*p-c*g)+(e*o-r*n)*(u*f-d*g)+(s*h-i*a)*(l*p-c*m)-(s*o-r*a)*(l*f-d*m)+(i*o-r*h)*(l*g-u*m)}(this.elements)}add(t,e){return e?x(this.elements,t.elements,e.elements):x(this.elements,this.elements,t.elements),this}subtract(t,e){return e?y(this.elements,t.elements,e.elements):y(this.elements,this.elements,t.elements),this}multiply(t,e){return e?m(this.elements,t.elements,e.elements):m(this.elements,this.elements,t.elements),this}multiplyScalar(t=this,e){return function(t,e,s){t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12]*s,t[13]=e[13]*s,t[14]=e[14]*s,t[15]=e[15]*s}(this.elements,t.elements,e),this}premultiply(t,e){return e?m(this.elements,e.elements,t.elements):m(this.elements,t.elements,this.elements),this}translate(t){return function(t,e,s){var i,r,n,a,h,o,l,u,d,c,m,g,f=s[0],p=s[1],b=s[2];e===t?(t[12]=e[0]*f+e[4]*p+e[8]*b+e[12],t[13]=e[1]*f+e[5]*p+e[9]*b+e[13],t[14]=e[2]*f+e[6]*p+e[10]*b+e[14],t[15]=e[3]*f+e[7]*p+e[11]*b+e[15]):(i=e[0],r=e[1],n=e[2],a=e[3],h=e[4],o=e[5],l=e[6],u=e[7],d=e[8],c=e[9],m=e[10],g=e[11],t[0]=i,t[1]=r,t[2]=n,t[3]=a,t[4]=h,t[5]=o,t[6]=l,t[7]=u,t[8]=d,t[9]=c,t[10]=m,t[11]=g,t[12]=i*f+h*p+d*b+e[12],t[13]=r*f+o*p+c*b+e[13],t[14]=n*f+l*p+m*b+e[14],t[15]=a*f+u*p+g*b+e[15])}(this.elements,this.elements,t.elements),this}rotate(t){return function(t,e,s,i){var r,a,h,o,l,u,d,c,m,g,f,p,b,x,y,M,w,v,E,A,T,_,S,F,R=i[0],C=i[1],N=i[2],O=Math.hypot(R,C,N);O<n||(R*=O=1/O,C*=O,N*=O,r=Math.sin(s),h=1-(a=Math.cos(s)),o=e[0],l=e[1],u=e[2],d=e[3],c=e[4],m=e[5],g=e[6],f=e[7],p=e[8],b=e[9],x=e[10],y=e[11],M=R*R*h+a,w=C*R*h+N*r,v=N*R*h-C*r,E=R*C*h-N*r,A=C*C*h+a,T=N*C*h+R*r,_=R*N*h+C*r,S=C*N*h-R*r,F=N*N*h+a,t[0]=o*M+c*w+p*v,t[1]=l*M+m*w+b*v,t[2]=u*M+g*w+x*v,t[3]=d*M+f*w+y*v,t[4]=o*E+c*A+p*T,t[5]=l*E+m*A+b*T,t[6]=u*E+g*A+x*T,t[7]=d*E+f*A+y*T,t[8]=o*_+c*S+p*F,t[9]=l*_+m*S+b*F,t[10]=u*_+g*S+x*F,t[11]=d*_+f*S+y*F,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this.elements,this.elements,t),this}scale(t){return g(this.elements,this.elements,t.elements),this}scaleScalar(t){return g(this.elements,this.elements,[t,t,t]),this}fromTranslation(t){return function(t,e){t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1}(this.elements,t.elements),this}fromRotation(t,e){return function(t,e,s){var i,r,a,h=s[0],o=s[1],l=s[2],u=Math.hypot(h,o,l);u<n||(h*=u=1/u,o*=u,l*=u,i=Math.sin(e),a=1-(r=Math.cos(e)),t[0]=h*h*a+r,t[1]=o*h*a+l*i,t[2]=l*h*a-o*i,t[3]=0,t[4]=h*o*a-l*i,t[5]=o*o*a+r,t[6]=l*o*a+h*i,t[7]=0,t[8]=h*l*a+o*i,t[9]=o*l*a-h*i,t[10]=l*l*a+r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1)}(this.elements,t,e),this}fromRotationX(t){return function(t,e){var s=Math.sin(e),i=Math.cos(e);t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=s,t[7]=0,t[8]=0,t[9]=-s,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this.elements,t),this}fromRotationY(t){return function(t,e){var s=Math.sin(e),i=Math.cos(e);t[0]=i,t[1]=0,t[2]=-s,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=s,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this.elements,t),this}fromRotationZ(t){return function(t,e){var s=Math.sin(e),i=Math.cos(e);t[0]=i,t[1]=s,t[2]=0,t[3]=0,t[4]=-s,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this.elements,t),this}fromScale(t){return function(t,e){t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this.elements,t.elements),this}fromRotationTranslation(t,e){return function(t,e,s){var i=e[0],r=e[1],n=e[2],a=e[3],h=i+i,o=r+r,l=n+n,u=i*h,d=i*o,c=i*l,m=r*o,g=r*l,f=n*l,p=a*h,b=a*o,x=a*l;t[0]=1-(m+f),t[1]=d+x,t[2]=c-b,t[3]=0,t[4]=d-x,t[5]=1-(u+f),t[6]=g+p,t[7]=0,t[8]=c+b,t[9]=g-p,t[10]=1-(u+m),t[11]=0,t[12]=s[0],t[13]=s[1],t[14]=s[2],t[15]=1}(this.elements,t.elements,e.elements),this}fromPerspective(t,e,s,i){return p(this.elements,rt(t),e,s,i),this}fromOrthogonal(t,e,s,i,r,n){return b(this.elements,t,e,s,i,r,n),this}fromQuat(t){return function(t,e){var s=e[0],i=e[1],r=e[2],n=e[3],a=s+s,h=i+i,o=r+r,l=s*a,u=i*a,d=i*h,c=r*a,m=r*h,g=r*o,f=n*a,p=n*h,b=n*o;t[0]=1-d-g,t[1]=u+b,t[2]=c-p,t[3]=0,t[4]=u-b,t[5]=1-l-g,t[6]=m+f,t[7]=0,t[8]=c+p,t[9]=m-f,t[10]=1-l-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this.elements,t.elements),this}equals(t){return function(t,e){var s=t[0],i=t[1],r=t[2],a=t[3],h=t[4],o=t[5],l=t[6],u=t[7],d=t[8],c=t[9],m=t[10],g=t[11],f=t[12],p=t[13],b=t[14],x=t[15],y=e[0],M=e[1],w=e[2],v=e[3],E=e[4],A=e[5],T=e[6],_=e[7],S=e[8],F=e[9],R=e[10],C=e[11],N=e[12],O=e[13],B=e[14],L=e[15];return Math.abs(s-y)<=n*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(i-M)<=n*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(r-w)<=n*Math.max(1,Math.abs(r),Math.abs(w))&&Math.abs(a-v)<=n*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(h-E)<=n*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(o-A)<=n*Math.max(1,Math.abs(o),Math.abs(A))&&Math.abs(l-T)<=n*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(u-_)<=n*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(d-S)<=n*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(c-F)<=n*Math.max(1,Math.abs(c),Math.abs(F))&&Math.abs(m-R)<=n*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(g-C)<=n*Math.max(1,Math.abs(g),Math.abs(C))&&Math.abs(f-N)<=n*Math.max(1,Math.abs(f),Math.abs(N))&&Math.abs(p-O)<=n*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(b-B)<=n*Math.max(1,Math.abs(b),Math.abs(B))&&Math.abs(x-L)<=n*Math.max(1,Math.abs(x),Math.abs(L))}(this.elements,t.value)}getRotation(t=new Gt){return function(t,e){var s=new a(3);f(s,e);var i=1/s[0],r=1/s[1],n=1/s[2],h=e[0]*i,o=e[1]*r,l=e[2]*n,u=e[4]*i,d=e[5]*r,c=e[6]*n,m=e[8]*i,g=e[9]*r,p=e[10]*n,b=h+d+p,x=0;b>0?(x=2*Math.sqrt(b+1),t[3]=.25*x,t[0]=(c-g)/x,t[1]=(m-l)/x,t[2]=(o-u)/x):h>d&&h>p?(x=2*Math.sqrt(1+h-d-p),t[3]=(c-g)/x,t[0]=.25*x,t[1]=(o+u)/x,t[2]=(m+l)/x):d>p?(x=2*Math.sqrt(1+d-h-p),t[3]=(m-l)/x,t[0]=(o+u)/x,t[1]=.25*x,t[2]=(c+g)/x):(x=2*Math.sqrt(1+p-h-d),t[3]=(o-u)/x,t[0]=(m+l)/x,t[1]=(c+g)/x,t[2]=.25*x)}(Vt,this.elements),t.set(Vt[0],Vt[1],Vt[2],Vt[3]),t}getScale(t=new kt){return f(Vt,this.elements),t.set(Vt[0],Vt[1],Vt[2]),t}getTranslation(t=new kt){return function(t,e){t[0]=e[12],t[1]=e[13],t[2]=e[14]}(Vt,this.elements),t.set(Vt[0],Vt[1],Vt[2]),t}rotateX(t){return function(t,e,s){var i=Math.sin(s),r=Math.cos(s),n=e[4],a=e[5],h=e[6],o=e[7],l=e[8],u=e[9],d=e[10],c=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*r+l*i,t[5]=a*r+u*i,t[6]=h*r+d*i,t[7]=o*r+c*i,t[8]=l*r-n*i,t[9]=u*r-a*i,t[10]=d*r-h*i,t[11]=c*r-o*i}(this.elements,this.elements,t),this}rotateY(t){return function(t,e,s){var i=Math.sin(s),r=Math.cos(s),n=e[0],a=e[1],h=e[2],o=e[3],l=e[8],u=e[9],d=e[10],c=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*r-l*i,t[1]=a*r-u*i,t[2]=h*r-d*i,t[3]=o*r-c*i,t[8]=n*i+l*r,t[9]=a*i+u*r,t[10]=h*i+d*r,t[11]=o*i+c*r}(this.elements,this.elements,t),this}rotateZ(t){return function(t,e,s){var i=Math.sin(s),r=Math.cos(s),n=e[0],a=e[1],h=e[2],o=e[3],l=e[4],u=e[5],d=e[6],c=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*r+l*i,t[1]=a*r+u*i,t[2]=h*r+d*i,t[3]=o*r+c*i,t[4]=l*r-n*i,t[5]=u*r-a*i,t[6]=d*r-h*i,t[7]=c*r-o*i}(this.elements,this.elements,t),this}compose(t,e,s){return function(t,e,s,i){var r=e[0],n=e[1],a=e[2],h=e[3],o=r+r,l=n+n,u=a+a,d=r*o,c=r*l,m=r*u,g=n*l,f=n*u,p=a*u,b=h*o,x=h*l,y=h*u,M=i[0],w=i[1],v=i[2];t[0]=(1-(g+p))*M,t[1]=(c+y)*M,t[2]=(m-x)*M,t[3]=0,t[4]=(c-y)*w,t[5]=(1-(d+p))*w,t[6]=(f+b)*w,t[7]=0,t[8]=(m+x)*v,t[9]=(f-b)*v,t[10]=(1-(d+g))*v,t[11]=0,t[12]=s[0],t[13]=s[1],t[14]=s[2],t[15]=1}(this.elements,e.elements,t.elements,s.elements),this}decompose(){return{rotation:this.getRotation(),scale:this.getScale(),translation:this.getTranslation()}}copy(t){return function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(this.elements,t.elements),this}clone(){return(new Ht).copy(this)}toString(){return`${this.constructor.name}(${this.elements.join(", ")})`}}class qt extends Ut{elements=new(ut())(3);#i=[];#r="xyz";constructor(t=0,e=0,s=0,i="xyz"){super();const r=this.elements;r[0]=t,r[1]=e,r[2]=s,this.#r=i}get x(){return this.elements[0]}set x(t){this.elements[0]=t,this.triggerChange()}get y(){return this.elements[1]}set y(t){this.elements[1]=t,this.triggerChange()}get z(){return this.elements[2]}set z(t){this.elements[2]=t,this.triggerChange()}get order(){return this.#r}set order(t){this.#r=t,this.triggerChange()}get roll(){return this.x}set roll(t){this.x=t}get pitch(){return this.y}set pitch(t){this.y=t}get yaw(){return this.z}set yaw(t){this.z=t}fromObject({x:t,y:e,z:s,order:i}){return void 0!==t&&(this.x=t),void 0!==e&&(this.y=e),void 0!==s&&(this.z=s),void 0!==i&&(this.order=i),this.triggerChange(),this}toObject(){return{x:this.x,y:this.y,z:this.z,order:this.order}}fromRotationMatrix(t,e=this.#r,s=!0){const i=t.toArray(),r=i[0],n=i[4],a=i[8],h=i[1],o=i[5],l=i[9],u=i[2],d=i[6],c=i[10];switch(e){case"xyz":this.y=Math.asin(at(a,-1,1)),Math.abs(a)<.9999999?(this.x=Math.atan2(-l,c),this.z=Math.atan2(-n,r)):(this.x=Math.atan2(d,o),this.z=0);break;case"yxz":this.x=Math.asin(-at(l,-1,1)),Math.abs(l)<.9999999?(this.y=Math.atan2(a,c),this.z=Math.atan2(h,o)):(this.y=Math.atan2(-u,r),this.z=0);break;case"zxy":this.x=Math.asin(at(d,-1,1)),Math.abs(d)<.9999999?(this.y=Math.atan2(-u,c),this.z=Math.atan2(-n,o)):(this.y=0,this.z=Math.atan2(h,r));break;case"zyx":this.y=Math.asin(-at(u,-1,1)),Math.abs(u)<.9999999?(this.x=Math.atan2(d,c),this.z=Math.atan2(h,r)):(this.x=0,this.z=Math.atan2(-n,o));break;case"yzx":this.z=Math.asin(at(h,-1,1)),Math.abs(h)<.9999999?(this.x=Math.atan2(-l,o),this.y=Math.atan2(-u,r)):(this.x=0,this.y=Math.atan2(a,c));break;case"xzy":this.z=Math.asin(-at(n,-1,1)),Math.abs(n)<.9999999?(this.x=Math.atan2(d,o),this.y=Math.atan2(a,r)):(this.x=Math.atan2(-l,c),this.y=0);break;default:throw new Error("Unknown Euler angle order")}return this.#r=e,s&&this.triggerChange(),this}fromQuaternion(t){const[e,s,i,r]=t.elements,n=s*s,a=-2*(n+i*i)+1,h=2*(e*s+r*i);let o=-2*(e*i-r*s);const l=2*(s*i+r*e),u=-2*(e*e+n)+1;o=o>1?1:o,o=o<-1?-1:o;const d=Math.atan2(l,u),c=Math.asin(o),m=Math.atan2(h,a);return new qt(d,c,m,"zyx")}fromVector3(t,e=this.#r){return this.set(t.x,t.y,t.z,e)}toQuaternion(){const t=Math.cos(.5*this.yaw),e=Math.sin(.5*this.yaw),s=Math.cos(.5*this.roll),i=Math.sin(.5*this.roll),r=Math.cos(.5*this.pitch),n=Math.sin(.5*this.pitch);return new Gt(t*i*r-e*s*n,t*s*n+e*i*r,e*s*r-t*i*n,t*s*r+e*i*n)}toVector3(){return new kt(this.x,this.y,this.z)}set(t,e,s,i=this.#r){return this.elements[0]=t,this.elements[1]=e,this.elements[2]=s,this.#r=i,this.triggerChange(),this}clone(){return(new qt).copy(this)}copy(t){let e=0;for(;e<this.elements.length;e++)this.elements[e]=t.elements[e];return this.#r=t.order,this.triggerChange(),this}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.order===t.order}onChange(t){this.#i.includes(t)||this.#i.push(t)}triggerChange(){this.#i.forEach((t=>t()))}toString(){return`${this.constructor.name}(${this.elements.join(", ")})`}}var $t={grad:.9,turn:360,rad:360/(2*Math.PI)},Yt=function(t){return"string"==typeof t?t.length>0:"number"==typeof t},Xt=function(t,e,s){return void 0===e&&(e=0),void 0===s&&(s=Math.pow(10,e)),Math.round(s*t)/s+0},Zt=function(t,e,s){return void 0===e&&(e=0),void 0===s&&(s=1),t>s?s:t>e?t:e},Kt=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},Qt=function(t){return{r:Zt(t.r,0,255),g:Zt(t.g,0,255),b:Zt(t.b,0,255),a:Zt(t.a)}},Jt=function(t){return{r:Xt(t.r),g:Xt(t.g),b:Xt(t.b),a:Xt(t.a,3)}},te=/^#([0-9a-f]{3,8})$/i,ee=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},se=function(t){var e=t.r,s=t.g,i=t.b,r=t.a,n=Math.max(e,s,i),a=n-Math.min(e,s,i),h=a?n===e?(s-i)/a:n===s?2+(i-e)/a:4+(e-s)/a:0;return{h:60*(h<0?h+6:h),s:n?a/n*100:0,v:n/255*100,a:r}},ie=function(t){var e=t.h,s=t.s,i=t.v,r=t.a;e=e/360*6,s/=100,i/=100;var n=Math.floor(e),a=i*(1-s),h=i*(1-(e-n)*s),o=i*(1-(1-e+n)*s),l=n%6;return{r:255*[i,h,a,a,o,i][l],g:255*[o,i,i,h,a,a][l],b:255*[a,a,o,i,i,h][l],a:r}},re=function(t){return{h:Kt(t.h),s:Zt(t.s,0,100),l:Zt(t.l,0,100),a:Zt(t.a)}},ne=function(t){return{h:Xt(t.h),s:Xt(t.s),l:Xt(t.l),a:Xt(t.a,3)}},ae=function(t){return ie((s=(e=t).s,{h:e.h,s:(s*=((i=e.l)<50?i:100-i)/100)>0?2*s/(i+s)*100:0,v:i+s,a:e.a}));var e,s,i},he=function(t){return{h:(e=se(t)).h,s:(r=(200-(s=e.s))*(i=e.v)/100)>0&&r<200?s*i/100/(r<=100?r:200-r)*100:0,l:r/2,a:e.a};var e,s,i,r},oe=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,le=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ue=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,de=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ce={string:[[function(t){var e=te.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:4===t.length?Xt(parseInt(t[3]+t[3],16)/255,2):1}:6===t.length||8===t.length?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:8===t.length?Xt(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=ue.exec(t)||de.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:Qt({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:void 0===e[7]?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=oe.exec(t)||le.exec(t);if(!e)return null;var s,i,r=re({h:(s=e[1],i=e[2],void 0===i&&(i="deg"),Number(s)*($t[i]||1)),s:Number(e[3]),l:Number(e[4]),a:void 0===e[5]?1:Number(e[5])/(e[6]?100:1)});return ae(r)},"hsl"]],object:[[function(t){var e=t.r,s=t.g,i=t.b,r=t.a,n=void 0===r?1:r;return Yt(e)&&Yt(s)&&Yt(i)?Qt({r:Number(e),g:Number(s),b:Number(i),a:Number(n)}):null},"rgb"],[function(t){var e=t.h,s=t.s,i=t.l,r=t.a,n=void 0===r?1:r;if(!Yt(e)||!Yt(s)||!Yt(i))return null;var a=re({h:Number(e),s:Number(s),l:Number(i),a:Number(n)});return ae(a)},"hsl"],[function(t){var e=t.h,s=t.s,i=t.v,r=t.a,n=void 0===r?1:r;if(!Yt(e)||!Yt(s)||!Yt(i))return null;var a=function(t){return{h:Kt(t.h),s:Zt(t.s,0,100),v:Zt(t.v,0,100),a:Zt(t.a)}}({h:Number(e),s:Number(s),v:Number(i),a:Number(n)});return ie(a)},"hsv"]]},me=function(t,e){for(var s=0;s<e.length;s++){var i=e[s][0](t);if(i)return[i,e[s][1]]}return[null,void 0]},ge=function(t,e){var s=he(t);return{h:s.h,s:Zt(s.s+100*e,0,100),l:s.l,a:s.a}},fe=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},pe=function(t,e){var s=he(t);return{h:s.h,s:s.s,l:Zt(s.l+100*e,0,100),a:s.a}},be=function(){function t(t){this.parsed=function(t){return"string"==typeof t?me(t.trim(),ce.string):"object"==typeof t&&null!==t?me(t,ce.object):[null,void 0]}(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return null!==this.parsed},t.prototype.brightness=function(){return Xt(fe(this.rgba),2)},t.prototype.isDark=function(){return fe(this.rgba)<.5},t.prototype.isLight=function(){return fe(this.rgba)>=.5},t.prototype.toHex=function(){return e=(t=Jt(this.rgba)).r,s=t.g,i=t.b,n=(r=t.a)<1?ee(Xt(255*r)):"","#"+ee(e)+ee(s)+ee(i)+n;var t,e,s,i,r,n},t.prototype.toRgb=function(){return Jt(this.rgba)},t.prototype.toRgbString=function(){return e=(t=Jt(this.rgba)).r,s=t.g,i=t.b,(r=t.a)<1?"rgba("+e+", "+s+", "+i+", "+r+")":"rgb("+e+", "+s+", "+i+")";var t,e,s,i,r},t.prototype.toHsl=function(){return ne(he(this.rgba))},t.prototype.toHslString=function(){return e=(t=ne(he(this.rgba))).h,s=t.s,i=t.l,(r=t.a)<1?"hsla("+e+", "+s+"%, "+i+"%, "+r+")":"hsl("+e+", "+s+"%, "+i+"%)";var t,e,s,i,r},t.prototype.toHsv=function(){return t=se(this.rgba),{h:Xt(t.h),s:Xt(t.s),v:Xt(t.v),a:Xt(t.a,3)};var t},t.prototype.invert=function(){return xe({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},t.prototype.saturate=function(t){return void 0===t&&(t=.1),xe(ge(this.rgba,t))},t.prototype.desaturate=function(t){return void 0===t&&(t=.1),xe(ge(this.rgba,-t))},t.prototype.grayscale=function(){return xe(ge(this.rgba,-1))},t.prototype.lighten=function(t){return void 0===t&&(t=.1),xe(pe(this.rgba,t))},t.prototype.darken=function(t){return void 0===t&&(t=.1),xe(pe(this.rgba,-t))},t.prototype.rotate=function(t){return void 0===t&&(t=15),this.hue(this.hue()+t)},t.prototype.alpha=function(t){return"number"==typeof t?xe({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):Xt(this.rgba.a,3);var e},t.prototype.hue=function(t){var e=he(this.rgba);return"number"==typeof t?xe({h:t,s:e.s,l:e.l,a:e.a}):Xt(e.h)},t.prototype.isEqual=function(t){return this.toHex()===xe(t).toHex()},t}(),xe=function(t){return t instanceof be?t:new be(t)},ye=[];!function(t){t.forEach((function(t){ye.indexOf(t)<0&&(t(be,ce),ye.push(t))}))}([function(t,e){var s={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var r in s)i[s[r]]=r;var n={};t.prototype.toName=function(e){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var r,a,h=i[this.toHex()];if(h)return h;if(null==e?void 0:e.closest){var o=this.toRgb(),l=1/0,u="black";if(!n.length)for(var d in s)n[d]=new t(s[d]).toRgb();for(var c in s){var m=(r=o,a=n[c],Math.pow(r.r-a.r,2)+Math.pow(r.g-a.g,2)+Math.pow(r.b-a.b,2));m<l&&(l=m,u=c)}return u}},e.string.push([function(e){var i=e.toLowerCase(),r="transparent"===i?"#0000":s[i];return r?new t(r).toRgb():null},"name"])}]);const Me=(t,e,s)=>{const i=xt(t),r=s-e;let n=at(Number.parseFloat(`${t}`),e,s);return i&&(n=Number.parseInt(""+t*s,10)/100),Math.abs(n-s)<1e-6?1:t%r/r};class we{r;g;b;a;constructor(t=255,e,s,i=1,r=!1){if(this.r=1,this.g=1,this.b=1,this.a=1,bt(e)&&bt(s))if(yt(t)&&t<=255)this.setRGBA(t,t,t,this.a,r);else{const e=xe(t).toRgb();e?this.setRGBA(e.r,e.g,e.b,e.a):console.error("Unsupported color value {".concat(String(t),"} provided"))}else this.setRGBA(t,e,s,i)}fromColor(t){const e=xe(t).toRgb();return this.setRGBA(e.r,e.g,e.b,e.a)}fromHSL(t,e,s,i=1){const r=xe({h:t,s:e,l:s,a:i}).toRgb();return this.setRGBA(r.r,r.g,r.b,r.a)}fromHSV(t,e,s,i=1){const r=xe({h:t,s:e,v:s,a:i}).toRgb();return this.setRGBA(r.r,r.g,r.b,r.a)}setRGB(t,e,s){return this.setRGBA(t,e,s,this.a),this}setRGBA(t,e,s,i,r){return this.r=r?t:Me(t,0,255),this.g=r?e:Me(e,0,255),this.b=r?s:Me(s,0,255),this.setAlpha(i),this}setAlpha(t){return this.a=t>1?Me(t,0,255):t,this}toHex(){return xe(this.toObject()).toHex()}toHSL(){return xe(this.toObject()).toHsl()}toHSV(){return xe(this.toObject()).toHsv()}toObject(t=!1){const e=t?1:255;return{r:this.r*e,g:this.g*e,b:this.b*e,a:this.a}}toArray(){return[this.r,this.g,this.b,this.a]}toVector(){return(new zt).fromArray(this.toArray())}toVector3(){return(new kt).fromArray(this.toArray())}toString(){return`${this.constructor.name}(${this.r}, ${this.g}, ${this.b}, ${this.a})`}}class ve extends Ht{frustum(t,e,s,i,r,n,a){return function(t,e,s,i,r,n,a){var h=1/(s-e),o=1/(r-i),l=1/(n-a);t[0]=2*n*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*n*o,t[6]=0,t[7]=0,t[8]=(s+e)*h,t[9]=(r+i)*o,t[10]=(a+n)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*n*2*l,t[15]=0}(t.elements,e,s,r,i,n,a),this}orthographic(t,e,s,i,r,n){return b(this.elements,t,e,i,s,r,n),this}perspective(t,e,s,i){return p(this.elements,t,e,s,i),this}lookAt(t,e=new kt(0,0,0),s=new kt(0,1,0)){return function(t,e,s,i){var r,a,h,o,l,u,d,m,g,f,p=e[0],b=e[1],x=e[2],y=i[0],M=i[1],w=i[2],v=s[0],E=s[1],A=s[2];Math.abs(p-v)<n&&Math.abs(b-E)<n&&Math.abs(x-A)<n?c(t):(d=p-v,m=b-E,g=x-A,r=M*(g*=f=1/Math.hypot(d,m,g))-w*(m*=f),a=w*(d*=f)-y*g,h=y*m-M*d,(f=Math.hypot(r,a,h))?(r*=f=1/f,a*=f,h*=f):(r=0,a=0,h=0),o=m*h-g*a,l=g*r-d*h,u=d*a-m*r,(f=Math.hypot(o,l,u))?(o*=f=1/f,l*=f,u*=f):(o=0,l=0,u=0),t[0]=r,t[1]=o,t[2]=d,t[3]=0,t[4]=a,t[5]=l,t[6]=m,t[7]=0,t[8]=h,t[9]=u,t[10]=g,t[11]=0,t[12]=-(r*p+a*b+h*x),t[13]=-(o*p+l*b+u*x),t[14]=-(d*p+m*b+g*x),t[15]=1)}(this.elements,t.elements,e.elements,s.elements),this}toString(){return`${this.constructor.name}(${this.elements.join(", ")})`}}class Ee{visible;localMatrix;worldMatrix;matrixAutoUpdate;position;scale;rotation;quaternion;up;children;parent;worldMatrixNeedsUpdate;constructor(){this.visible=!0,this.localMatrix=new ve,this.worldMatrix=new ve,this.matrixAutoUpdate=!0,this.position=new kt,this.scale=new kt(1,1,1),this.rotation=new qt,this.quaternion=new Gt,this.up=new kt(0,1,0),this.parent=null,this.children=[],this.worldMatrixNeedsUpdate=!1,this.rotation.onChange((()=>{this.quaternion.fromEuler(this.rotation)})),this.quaternion.onChange((()=>{this.rotation.fromQuaternion(this.quaternion)}))}add(t,e=!0){this.contains(t)||this.children.push(t),e&&t.setParent(this,!1)}remove(t,e=!0){this.contains(t)&&this.children.splice(this.children.indexOf(t),1),e&&t.setParent(null,!1)}contains(t){return this.children.includes(t)}setParent(t,e=!0){this.parent&&t!==this.parent&&this.parent.remove(this,!1),this.parent=t,e&&t&&t.add(this,!1)}traverse(t){if(!t(this))for(let e=0,s=this.children.length;e<s;e++)this.children[e].traverse(t)}lookAt(t,e){e?this.localMatrix.lookAt(this.position,t,this.up):this.localMatrix.lookAt(t,this.position,this.up),this.localMatrix.getRotation(this.quaternion),this.rotation.fromQuaternion(this.quaternion)}updateMatrixWorld(t){let e=t;this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||e)&&(null===this.parent?this.worldMatrix.copy(this.localMatrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.localMatrix),this.worldMatrixNeedsUpdate=!1,e=!0);for(let t=0,s=this.children.length;t<s;t++){this.children[t].updateMatrixWorld(e)}}updateMatrix(){this.localMatrix.compose(this.position,this.quaternion,this.scale),this.worldMatrixNeedsUpdate=!0}decompose(){this.localMatrix.getTranslation(this.position),this.localMatrix.getRotation(this.quaternion),this.localMatrix.getScale(this.scale),this.rotation.fromQuaternion(this.quaternion)}clone(){return(new Ee).copy(this,!1)}copy(t,e){if(this.visible=t.visible,this.position.copy(t.position),this.scale.copy(t.scale),this.rotation.copy(t.rotation),this.quaternion.copy(t.quaternion),this.up.copy(t.up),this.localMatrix.copy(t.localMatrix),this.worldMatrix.copy(t.worldMatrix),this.matrixAutoUpdate=t.matrixAutoUpdate,e)for(let e=0,s=t.children.length;e<s;e++){const s=t.children[e];this.add(s.clone())}return this}}class Ae{renderer;constructor(t){this.renderer=t}get gl(){return this.renderer.gl}get rendererState(){return this.renderer.state}}class Te{id;data;type;size;instanced;stride;offset;divisor;normalized;needsUpdate;count;usage;target;buffer;constructor(t,e){const s=Object.assign({},{size:1,normalized:!0,stride:0,offset:0,divisor:0,usage:t.gl.STATIC_DRAW},e);if(this.id=At("attribute"),this.needsUpdate=!1,!e.data||Array.isArray(e.data))throw new TypeError("BufferAttribute: data should be a typed array");var i,r;this.data=s.data,this.size=s.size||1,this.type=s.type||(i=t.gl,(r=s.data)instanceof Float32Array||r instanceof Float64Array?i.FLOAT:r instanceof Uint16Array?i.UNSIGNED_SHORT:r instanceof Uint8Array||r instanceof Uint8ClampedArray?i.UNSIGNED_BYTE:r instanceof Uint32Array?i.UNSIGNED_INT:r instanceof Int8Array?i.BYTE:r instanceof Int16Array?i.SHORT:r instanceof Int32Array?i.INT:void 0),this.normalized=s.normalized||!1,this.stride=s.stride||0,this.offset=s.offset||0,this.divisor=s.divisor||0,this.instanced=s.divisor>0,this.usage=s.usage||t.gl.STATIC_DRAW,s.target&&(this.target=s.target);let n=s.count;void 0!==s.count&&null!==s.count||(n=s.stride?s.data.byteLength/s.stride:s.data.length/s.size),this.count=n}}const _e=new kt;class Se extends Ae{#n;#a;#h;#o;drawRange;instancedCount;isInstanced;drawMode;constructor(t,e={}){super(t),this.drawRange={start:0,count:0},this.instancedCount=0,this.isInstanced=!1,this.#a=new Map,this.#h=new Map,this.#n=At("geometry"),this.drawMode=this.gl.TRIANGLES,t.bindVertexArray(null),t.state.setActiveGeometry(null);for(const t in e){const s=e[t];if(s instanceof Te)"index"===t?this.setIndex(s):this.addAttribute(t,s);else if(s.data){const e=new Te(this.renderer,s);"index"===t?this.setIndex(e):this.addAttribute(t,e)}}}get id(){return this.#n}get attributes(){return this.#a}get attributesData(){const t={},e=this.#a.entries();for(let s=0;s<this.#a.size;s++){const s=e.next().value;t[s[0]]=Tt(s[1],["id","buffer"])}return t}get index(){return this.attributes.get("index")}get bounds(){return this.#o}set bounds(t){this.#o=t}addAttribute(t,e){if(e.target||(e.target="index"===t?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER),e.needsUpdate=!1,this.attributes.set(t,e),e.buffer||(e.buffer=this.gl.createBuffer(),this.updateAttribute(e)),e.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==e.count*e.divisor)return this.instancedCount=Math.min(this.instancedCount,e.count*e.divisor),console.warn(`Geometry has multiple instanced buffers of different length - instancedCount: ${this.instancedCount}, count: ${e.count}, divisor: ${e.divisor}, attribute: ${t}`);this.instancedCount=e.count*e.divisor}else"index"===t?this.drawRange.count=e.count:this.index||(this.drawRange.count=Math.max(this.drawRange.count,e.count))}getAttribute(t){return this.attributes.get(t)}setAttributeData(t,e){const s=this.getAttribute(t);s&&(s.data=e,s.needsUpdate=!0)}updateAttribute(t){!t.buffer&&(t.buffer=this.gl.createBuffer()),this.rendererState.boundBuffer!==t.buffer&&(this.gl.bindBuffer(t.target,t.buffer),this.rendererState.boundBuffer=t.buffer),this.gl.bufferData(t.target,t.data,t.usage),t.needsUpdate=!1}removeAttribute(t){this.attributes.delete(t)}setIndex(t){if(t instanceof Te)t.size=1,this.addAttribute("index",t);else{const e=new Te(this.renderer,{data:t.length>65535?new Uint32Array(t):new Uint16Array(t),size:1});this.addAttribute("index",e)}this.drawRange.count=this.index?.count}setVertices(t){const e=[],s=t.length;for(let i=0;i<s;i++){const s=t[i];e.push(s[0],s[1],s[2])}this.addAttribute("position",new Te(this.renderer,{data:new Float32Array(e),size:3}))}setNormals(t){this.addAttribute("normal",new Te(this.renderer,{data:new Float32Array(t),size:2}))}setUVs(t){this.addAttribute("uv",new Te(this.renderer,{data:new Float32Array(t),size:2}))}setColors(t){const e=[];for(let s=0;s<t.length;s++){let i=t[s];i&&(i instanceof kt||i instanceof zt)&&(i=i.toArray()),e.push(i[0],i[1],i[2],i[3]||1)}this.addAttribute("color",new Te(this.renderer,{data:new Float32Array(e),size:4}))}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}setInstancedCount(t){this.instancedCount=t}createVAO(t){const{attributeOrder:e}=t,s=this.renderer.createVertexArray();this.renderer.bindVertexArray(s),this.#h.set(e,s),this.bindAttributes(t)}bindAttributes(t){t.attributeLocations.forEach(((t,{name:e,type:s})=>{const i=this.attributes.get(e);if(!i)return;this.gl.bindBuffer(i.target,i.buffer),this.rendererState.boundBuffer=i.buffer;let r=1;s===this.gl.FLOAT_MAT2&&(r=2),s===this.gl.FLOAT_MAT3&&(r=3),s===this.gl.FLOAT_MAT4&&(r=4);const n=i.size/r,a=1===r?0:r*r*r,h=1===r?0:r*r;for(let e=0;e<r;e++){const s=t+e;this.gl.vertexAttribPointer(s,n,i.type,i.normalized,i.stride+a,i.offset+h),this.gl.enableVertexAttribArray(s),this.renderer.vertexAttribDivisor(s,i.divisor)}}));const e=this.attributes.get("index");e&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,e.buffer)}computeBoundingBox(t){const{data:e,offset:s=0,stride:i,size:r}=this.attributes.get("position");this.#o||(this.#o={min:new kt,max:new kt,center:new kt,scale:new kt,radius:Number.POSITIVE_INFINITY}),this.#o.min.setScalar(+Number.POSITIVE_INFINITY),this.#o.max.setScalar(Number.NEGATIVE_INFINITY);const n=t||e,a=i||r;for(let t=s;t<n.length;t+=a){const e=n[t+0],s=n[t+1],i=n[t+2];this.#o.min.x=Math.min(e,this.#o.min.x),this.#o.min.y=Math.min(s,this.#o.min.y),this.#o.min.z=Math.min(i,this.#o.min.z),this.#o.max.x=Math.max(e,this.#o.max.x),this.#o.max.y=Math.max(s,this.#o.max.y),this.#o.max.z=Math.max(i,this.#o.max.z)}return this.#o.scale.subVectors(this.#o.max,this.#o.min),this.#o.center.add(this.#o.min).add(this.#o.max).divideScalar(2),this.#o}computeBoundingSphere(t){const{data:e,offset:s=0,stride:i,size:r}=this.attributes.get("position");this.#o||this.computeBoundingBox(t);const n=t||e;let a=0;const h=i||r,o=n.length;for(let t=s;t<o;t+=h)_e.fromArray(n,t),a=Math.max(a,this.#o.center.distanceToSquared(_e));this.#o.radius=Math.sqrt(a)}draw(t,e=this.drawMode){const{start:s,count:i}=this.drawRange,r=`${this.id}_${t.attributeOrder}`;if(this.rendererState.activeGeometryId!==r){this.#h.get(t.attributeOrder)||this.createVAO(t),this.renderer.bindVertexArray(this.#h.get(t.attributeOrder)),this.rendererState.activeGeometryId=r}if(t.attributeLocations.forEach(((t,{name:e})=>{const s=this.getAttribute(e);s&&s.needsUpdate&&this.updateAttribute(s)})),this.isInstanced)if(this.index){const t=this.index.offset+2*s;this.renderer.drawElementsInstanced(e,i,this.index.type,t,this.instancedCount)}else this.renderer.drawArraysInstanced(e,s,i,this.instancedCount);else if(this.index){const t=this.index.offset+2*s;this.gl.drawElements(e,i,this.index.type,t)}else this.gl.drawArrays(e,s,i)}copy(t){const e=t.attributesData;for(const t in e){const s=e[t];if(s instanceof Te)"index"===t?this.setIndex(s):this.addAttribute(t,s);else if(s.data){const e=new Te(this.renderer,s);"index"===t?this.setIndex(e):this.addAttribute(t,e)}}return t.bounds&&(this.bounds={min:(new kt).copy(t.bounds.min),max:(new kt).copy(t.bounds.max),center:(new kt).copy(t.bounds.center),scale:(new kt).copy(t.bounds.scale),radius:t.bounds.radius}),this}clone(){const t=new Se(this.renderer,{}).copy(this);return t.drawMode=this.drawMode,t}destroy(){this.#h.forEach((t=>{this.renderer.deleteVertexArray(t)})),this.#h.clear(),this.#a.forEach((t=>{this.gl.deleteBuffer(t.buffer)})),this.#a.clear()}}class Fe extends Ee{gl;modelViewMatrix;normalMatrix;renderOrder;zDepth;frustumCulled;mode;renderer;#n;#l;#u;#d;#c;#m;constructor(t,e={}){super();const s=Object.assign({},{mode:t.gl.TRIANGLES,frustumCulled:!0,renderOrder:0},e);this.renderer=t,this.gl=this.renderer.gl,this.modelViewMatrix=new Ht,this.normalMatrix=new jt,this.renderOrder=s.renderOrder,this.frustumCulled=s.frustumCulled,this.zDepth=0,this.#n=s.id||At("mesh"),this.#u=s.geometry,this.#d=s.program,this.#c=Boolean(s.wireframe),this.mode=s.mode,this.#l=s.mode,this.#c&&(this.mode=this.gl.LINES,this.updateWireframeGeometry(this.#c))}get id(){return this.#n}get geometry(){return this.#c?this.#m:this.#u}get program(){return this.#d}set wireframe(t){this.mode=t?this.gl.LINES:this.#l,this.#c=t,this.updateWireframeGeometry(this.#c)}get wireframe(){return this.#c}draw(t={}){const{camera:e,target:s}=t,i={};e?(Object.assign(i,{projectionMatrix:e.projectionMatrix,cameraPosition:e.worldPosition,viewMatrix:e.viewMatrix}),this.modelViewMatrix.multiply(e.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix)):this.modelViewMatrix.copy(this.worldMatrix),Object.assign(i,{resolution:new Pt(this.renderer.state?.viewport?.width||1,this.renderer.state?.viewport?.height||1),modelMatrix:this.worldMatrix,modelViewMatrix:this.modelViewMatrix,normalMatrix:this.normalMatrix}),Object.keys(i).forEach((t=>{Object.hasOwn(this.program.uniforms,t)||(this.program.uniforms[t]={value:null}),this.program.uniforms[t].value=i[t]})),s&&s.bind(),this.program.use(),this.geometry.draw(this.program,this.mode),s&&s.unbind()}updateWireframeGeometry(t,e=!1){if(this.#u&&(e||!this.#m)){this.#m&&this.#m.destroy();const t=this.#u.attributes.get("position")?.data,e=this.#u.index?.data,s=e?e.length:Math.floor(t.length/3),r=[];this.#u.index?e&&i(t,r,s,e):i(t,r,s);const n=r.length>65536?new Uint32Array(r):new Uint16Array(r);this.#m=new Se(this.renderer,{...this.#u.attributesData,index:{data:n}})}}updateGeometry(t,e=!0){e&&this.#u&&this.#u.destroy(),this.#u=t,this.updateWireframeGeometry(this.#c,!0)}updateProgram(t,e=!0){e&&this.#d&&this.#d.destroy(),this.#d=t}destroy(){this.program.destroy(),this.geometry.destroy()}clone(){return new Fe(this.gl,{geometry:this.geometry,program:this.program,frustumCulled:this.frustumCulled,mode:this.mode,renderOrder:this.renderOrder}).copy(this)}copy(t,e=!0){return super.copy(t,e),this.modelViewMatrix.copy(t.modelViewMatrix),this.normalMatrix.copy(t.normalMatrix),this.mode=t.mode,this.renderOrder=t.renderOrder,this.zDepth=t.zDepth,this}}class Re extends Ee{clone(){return(new Re).copy(this,!1)}copy(t,e){return super.copy(t,e),this.matrixAutoUpdate=t.matrixAutoUpdate,this}}var Ce=(t=>(t[t.NoBlending=0]="NoBlending",t[t.NormalBlending=1]="NormalBlending",t[t.AdditiveBlending=2]="AdditiveBlending",t[t.SubtractiveBlending=3]="SubtractiveBlending",t[t.MultiplyBlending=4]="MultiplyBlending",t[t.CustomBlending=5]="CustomBlending",t))(Ce||{});class Ne extends Ae{#g;constructor(t,e){super(t);const{gl:s}=t;this.#g={viewport:{x:0,y:0,width:0,height:0}},this.apply(e||{frontFace:s.CCW,depthTest:!1,depthWrite:!0,depthMask:!0,depthFunc:s.LESS,blending:1,blendFunc:{src:s.ONE,dst:s.ZERO},blendEquation:{modeRGB:s.FUNC_ADD},premultiplyAlpha:!1,unpackAlignment:4,flipY:!1,framebuffer:null,textureUnits:[],activeTextureUnit:-1,activeGeometryId:-1,currentProgramId:-1,clearAlpha:1,clearColor:new we(0),stencil:{func:{},opFront:{},opBack:{}}})}get state(){return this.#g}get viewport(){return this.#g.viewport}get textureUnits(){return this.#g.textureUnits}get activeTextureUnit(){return this.#g.activeTextureUnit}set activeTextureUnit(t){this.#g.activeTextureUnit=t}get currentProgramId(){return this.#g.currentProgramId}set currentProgramId(t){this.#g.currentProgramId=t}get activeGeometryId(){return this.#g.activeGeometryId}set activeGeometryId(t){this.#g.activeGeometryId=t}set flipY(t){this.#g.flipY=t}get flipY(){return this.#g.flipY}set unpackAlignment(t){this.#g.unpackAlignment=t}get unpackAlignment(){return this.#g.unpackAlignment}set premultiplyAlpha(t){this.#g.premultiplyAlpha=t}get premultiplyAlpha(){return this.#g.premultiplyAlpha}set boundBuffer(t){this.#g.boundBuffer=t}get boundBuffer(){return this.#g.boundBuffer}set anisotropy(t){this.#g.anisotropy=t}get anisotropy(){return this.#g.anisotropy}apply(t){if(void 0!==t.blending&&null!==t.blending)this.setBlending(t.blending,t);else{if(t.blendFunc){const{src:e,dst:s,srcAlpha:i,dstAlpha:r}=t.blendFunc;this.setBlendFunc(e,s,i,r),this.enable(this.gl.BLEND)}else this.disable(this.gl.BLEND);if(t.blendEquation){const{modeRGB:e,modeAlpha:s}=t.blendEquation;this.setBlendEquation(e,s)}}bt(t.cullFace)||wt(t.cullFace)||this.setCullFace(t.cullFace),bt(t.frontFace)||wt(t.frontFace)||this.setFrontFace(t.frontFace),t.depthTest?this.enable(this.gl.DEPTH_TEST):this.disable(this.gl.DEPTH_TEST),bt(t.depthMask)||wt(t.depthMask)||this.setDepthMask(t.depthMask),bt(t.depthWrite)||wt(t.depthWrite)||this.setDepthMask(t.depthWrite),bt(t.depthFunc)||wt(t.depthFunc)||this.setDepthFunc(t.depthFunc),bt(t.lineWidth)||wt(t.lineWidth)||this.setLineWidth(t.lineWidth),this.#g=Object.assign(this.#g,t)}enable(t){!0!==this.#g[t]&&(this.gl.enable(t),this.#g[t]=!0)}disable(t){!1!==this.#g[t]&&(this.gl.disable(t),this.#g[t]=!1)}setViewport(t,e,s=0,i=0){this.#g.viewport.width===t&&this.#g.viewport.height===e||(this.gl.viewport(s,i,t,e),this.#g.viewport={width:t,height:e,x:s,y:i})}setMask(t){this.#g.colorMask!==t&&(this.gl.colorMask(t,t,t,t),this.#g.colorMask=t)}setBlending(t,e){if(this.#g.blending=t,0!==t)if(this.enable(this.gl.BLEND),2===t)this.#g.premultiplyAlpha?(this.setBlendEquation(this.gl.FUNC_ADD,this.gl.FUNC_ADD),this.setBlendFunc(this.gl.ONE,this.gl.ONE,this.gl.ONE,this.gl.ONE)):(this.setBlendEquation(this.gl.FUNC_ADD),this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE));else if(3===t)this.#g.premultiplyAlpha?(this.setBlendEquation(this.gl.FUNC_ADD,this.gl.FUNC_ADD),this.setBlendFunc(this.gl.ZERO,this.gl.ZERO,this.gl.ONE_MINUS_SRC_COLOR,this.gl.ONE_MINUS_SRC_ALPHA)):(this.setBlendEquation(this.gl.FUNC_ADD),this.setBlendFunc(this.gl.ZERO,this.gl.ONE_MINUS_SRC_COLOR));else if(4===t)this.#g.premultiplyAlpha?(this.setBlendEquation(this.gl.FUNC_ADD,this.gl.FUNC_ADD),this.setBlendFunc(this.gl.ZERO,this.gl.SRC_COLOR,this.gl.ZERO,this.gl.SRC_ALPHA)):(this.setBlendEquation(this.gl.FUNC_ADD),this.setBlendFunc(this.gl.ZERO,this.gl.SRC_COLOR));else if(1===t)this.#g.premultiplyAlpha?(this.setBlendEquation(this.gl.FUNC_ADD,this.gl.FUNC_ADD),this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)):(this.setBlendEquation(this.gl.FUNC_ADD,this.gl.FUNC_ADD),this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA));else if(5===t){if(e?.blendFunc){const{src:t,dst:s,srcAlpha:i,dstAlpha:r}=e.blendFunc;this.setBlendFunc(t,s,i,r),this.enable(this.gl.BLEND)}if(e?.blendEquation){const{modeRGB:t,modeAlpha:s}=e.blendEquation;this.setBlendEquation(t,s)}}else console.error("State: Invalid blending: ",t);else this.disable(this.gl.BLEND)}setBlendFunc(t,e,s,i){t===this.#g.blendFunc?.src&&e===this.#g.blendFunc?.dst&&s===this.#g.blendFunc?.srcAlpha&&i===this.#g.blendFunc?.dstAlpha||(this.#g.blendFunc={src:t,dst:e,srcAlpha:s,dstAlpha:i},bt(s)||wt(s)||bt(i)||wt(i)?this.gl.blendFunc(t,e):this.gl.blendFuncSeparate(t,e,s,i))}setBlendEquation(t,e){t===this.#g.blendEquation?.modeRGB&&e===this.#g.blendEquation?.modeAlpha||(this.#g.blendEquation={modeRGB:t,modeAlpha:e},bt(e)||wt(e)?this.gl.blendEquation(t):this.gl.blendEquationSeparate(t,e))}setClearAlpha(t){this.#g.clearAlpha!==t&&(this.#g.clearAlpha=t)}setClearColor(t,e){this.#g.clearAlpha===e&&this.#g.clearColor===t||(this.#g.clearColor=t,bt(e)||wt(e)?this.#g.clearAlpha=t.a:this.#g.clearAlpha=e,this.gl.clearColor(t.r,t.g,t.b,this.#g.clearAlpha))}setCullFace(t){this.#g.cullFace!==t&&(t?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.#g.cullFace=t,this.gl.cullFace(t))}setFrontFace(t){this.#g.frontFace!==t&&(this.#g.frontFace=t,this.gl.frontFace(t))}setDepthMask(t){this.#g.depthMask!==t&&(this.#g.depthMask=t,this.gl.depthMask(t))}setDepthFunc(t){this.#g.depthFunc!==t&&(this.#g.depthFunc=t,this.gl.depthFunc(t))}setDepthTest(t){this.#g.depthTest!==t&&(this.#g.depthTest=t,t?this.enable(this.gl.DEPTH_TEST):this.disable(this.gl.DEPTH_TEST))}setStencilFunc(t,e,s,i){this.#g?.stencil?.func?.cmp===t&&this.#g?.stencil?.func?.ref===e&&this.#g?.stencil?.func?.mask===s||(this.#g?.stencil||(this.#g.stencil={}),this.#g?.stencil?.func||(this.#g.stencil.func={}),this.#g.stencil.func={ref:e,mask:s,cmp:t},i?this.gl.stencilFuncSeparate(i,t,e,s):this.gl.stencilFunc(t,e,s))}setStencilOp(t,e,s,i){return this.#g?.stencil||(this.#g.stencil={}),i&&i!==this.gl.FRONT_AND_BACK?i===this.gl.FRONT?this.#g.stencil?.opFront?.fail!==t||this.#g.stencil?.opFront?.zFail!==e||this.#g.stencil?.opFront?.zPass!==s:i===this.gl.BACK?this.#g.stencil?.opBack?.fail!==t||this.#g.stencil?.opBack?.zFail!==e||this.#g.stencil?.opBack?.zPass!==s:void 0:this.#g.stencil?.opFront?.fail!==t||this.#g.stencil?.opFront?.zFail!==e||this.#g.stencil?.opFront?.zPass!==s||this.#g.stencil?.opBack?.fail!==t||this.#g.stencil?.opBack?.zFail!==e||this.#g.stencil?.opBack?.zPass!==s}setStencilMask(t,e){this.#g.stencil?.mask!==t&&(this.#g.stencil={...this.#g.stencil,mask:t},e?this.gl.stencilMaskSeparate(e,t):this.gl.stencilMask(t))}setActiveTexture(t){this.#g.activeTextureUnit!==t&&(this.#g.activeTextureUnit=t,this.gl.activeTexture(this.gl.TEXTURE0+t))}setLineWidth(t){this.#g.lineWidth!==t&&(this.#g.lineWidth=t,this.gl.lineWidth(t))}setPolygonOffset(t,e,s){t?(this.enable(this.gl.POLYGON_OFFSET_FILL),this.#g.polygonOffsetFactor===e&&this.#g.polygonOffsetUnits===s||(this.gl.polygonOffset(e,s),this.#g.polygonOffsetFactor=e,this.#g.polygonOffsetUnits=s)):this.disable(this.gl.POLYGON_OFFSET_FILL)}bindFramebuffer(t={}){const{target:e=this.gl.FRAMEBUFFER,buffer:s=null}=t;this.#g.framebuffer!==s&&(this.#g.framebuffer=s,this.gl.bindFramebuffer(e,s))}setActiveGeometry(t){this.#g.activeGeometryId=t}reset(t=!0){const e=Object.keys(this.#g);t?(e.filter((t=>["viewport","premultiplyAlpha"].indexOf(t)<0)).forEach((t=>{delete this.#g[t]})),this.bindFramebuffer({buffer:null}),this.apply({frontFace:this.gl.CCW,depthTest:!1,depthWrite:!0,depthMask:!0,depthFunc:this.gl.LESS,blending:1,blendFunc:{src:this.gl.ONE,dst:this.gl.ZERO},blendEquation:{modeRGB:this.gl.FUNC_ADD},premultiplyAlpha:!1,unpackAlignment:4,flipY:!1,framebuffer:null,textureUnits:[],activeTextureUnit:-1,activeGeometryId:-1,currentProgramId:-1,clearAlpha:1,clearColor:new we(0),stencil:{func:{},opFront:{},opBack:{}}})):(e.filter((t=>["flipY","framebuffer","textureUnits","activeTextureUnit","activeGeometryId","currentProgramId"].indexOf(t)>-1)).forEach((t=>{delete this.#g[t]})),this.bindFramebuffer({buffer:null}),this.#g.flipY=!1,this.#g.activeGeometryId=-1,this.#g.activeTextureUnit=-1,this.#g.currentProgramId=-1,this.#g.textureUnits=[],this.#g.boundBuffer=null)}}const Oe=["WEBGL_depth_texture","OES_texture_half_float","OES_texture_float","OES_standard_derivatives","OES_element_index_uint","EXT_frag_depth","EXT_blend_minmax","EXT_shader_texture_lod","WEBGL_draw_buffers","WEBGL_color_buffer_float"],Be=["EXT_color_buffer_float"],Le=["WEBGL_lose_context","OES_texture_half_float_linear","OES_texture_float_linear","EXT_color_buffer_half_float","WEBGL_debug_renderer_info","EXT_texture_filter_anisotropic"];const Ie="Resource subclass must define virtual methods";class Ue extends Ae{#f;#p;id;name;userData;byteLength;options;constructor(t,e={}){super(t),this.id=e?.id||At(this.constructor.name),this.name=e?.name,this.userData=e?.userData,this.#f=e?.handle,this.options=e,void 0===this.#f&&(this.#f=this.createHandle()),this.byteLength=0}get handle(){return this.#f}swapHandle(t){this.#p=this.#f,this.#f=t}restoreHandle(){this.#f=this.#p}destroy(){this.delete()}delete({deleteChildren:t=!1}={}){const e=this.handle&&this.deleteHandle(this.handle);return this.handle&&this.removeStats(),this.#f=null,e&&t&&e.filter(Boolean).forEach((t=>t.delete())),this}bind(t=this.handle){throw new Error(Ie)}unbind(){this.bind(null)}removeStats(){throw new Error(Ie)}createHandle(){throw new Error(Ie)}deleteHandle(){throw new Error(Ie)}toString(){return`${this.constructor.name}(${this.id})`}}class Pe extends Ue{width;height;#b;constructor(t,e={}){super(t,{...e,format:e.format||t.gl.DEPTH_COMPONENT16}),this.#b=this.options.format,this.width=this.options.width,this.height=this.options.height,console.assert(this.width>0&&this.height>0,"Renderbuffer object requires valid width and height greater than zero"),this.bind(),t.gl.renderbufferStorage(t.gl.RENDERBUFFER,this.#b,this.width,this.height)}resize(t,e){t===this.width&&e===this.height||(this.width=t,this.height=e,this.bind(),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.#b,t,e),this.unbind())}bind(){this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.handle)}unbind(){this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null)}removeStats(){}destroy(){this.unbind(),this.deleteHandle()}createHandle(){return this.gl.createRenderbuffer()}deleteHandle(){this.handle&&this.gl.deleteRenderbuffer(this.handle)}}const De=new Uint8Array(4);class Ge extends Ue{needsUpdate=!1;textureUnit=0;image;width;height;target;#g={};constructor(t,e={},s=!0){const{gl:i}=t,r={target:i.TEXTURE_2D,type:i.UNSIGNED_BYTE,format:i.RGBA,internalFormat:e.format||i.RGBA,wrapS:i.CLAMP_TO_EDGE,wrapT:i.CLAMP_TO_EDGE,generateMipmaps:!0,minFilter:i.LINEAR,magFilter:i.LINEAR,premultiplyAlpha:!1,unpackAlignment:4,anisotropy:0,flipY:!1,level:0};super(t,Object.assign({},r,e)),this.textureUnit=0,this.image=this.options.image,this.width=this.options.width,this.height=this.options.height,this.target=this.options.target,this.#g.version=-1,this.needsUpdate=Boolean(s),this.needsUpdate&&this.update()}setData(t,e=this.width,s=this.height){this.image=t,this.width=e,this.height=s,this.needsUpdate=!0}setOptions(t){this.options=Object.assign(this.options,t),this.width=this.options.width,this.height=this.options.height,this.needsUpdate=!0}fromSrc(t){return new Promise(((e,s)=>{const i=new Image;i.onload=()=>{this.setData(i,i.width,i.height),e(this)},i.onerror=t=>{s(t)},i.crossOrigin="*",i.src=t}))}update(t=0){const e=!(this.image===this.#g.image&&!this.needsUpdate);if((e||this.rendererState.textureUnits[t]!==this.id||this.rendererState.activeTextureUnit!==t)&&(this.rendererState.setActiveTexture(t),this.bind(t)),e){if(this.needsUpdate=!1,this.options.wrapS!==this.#g.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.options.wrapS),this.#g.wrapS=this.options.wrapS),this.options.wrapT!==this.#g.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.options.wrapT),this.#g.wrapT=this.options.wrapT),this.options.minFilter!==this.#g.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.options.minFilter),this.#g.minFilter=this.options.minFilter),this.options.magFilter!==this.#g.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.options.magFilter),this.#g.magFilter=this.options.magFilter),this.options.flipY!==this.rendererState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.options.flipY),this.rendererState.flipY=this.options.flipY),this.options.premultiplyAlpha!==this.rendererState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.options.premultiplyAlpha),this.rendererState.premultiplyAlpha=this.options.premultiplyAlpha),this.options.unpackAlignment!==this.rendererState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.options.unpackAlignment),this.rendererState.unpackAlignment=this.options.unpackAlignment),this.options.anisotropy&&this.options.anisotropy!==this.rendererState.anisotropy){const t=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic");if(t){const e=this.gl.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT);let s=this.options.anisotropy;this.options.anisotropy>e&&(s=e,console.warn(`[Texture]: Texture.anisotropy option exceeded the maximum allowed value ${e} of the device`)),this.gl.texParameterf(this.target,t.TEXTURE_MAX_ANISOTROPY_EXT,s)}this.rendererState.anisotropy=this.options.anisotropy}this.image?(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.renderer.isWebGL2&&yt(this.options.offset)?this.gl.texImage2D(this.target,this.options.level,this.options.internalFormat,this.width,this.height,0,this.options.format,this.options.type,this.image,this.options.offset):ArrayBuffer.isView(this.image)?this.gl.texImage2D(this.target,this.options.level,this.options.internalFormat,this.width,this.height,0,this.options.format,this.options.type,this.image):this.gl.texImage2D(this.target,this.options.level,this.options.internalFormat,this.options.format,this.options.type,this.image),this.options.generateMipmaps&&(this.renderer.isWebGL2||ht(this.image.width)&&ht(this.image.height)?this.gl.generateMipmap(this.target):(this.options.generateMipmaps=!1,this.options.wrapS=this.gl.CLAMP_TO_EDGE,this.options.wrapT=this.options.wrapS,this.options.minFilter=this.gl.LINEAR))):this.renderer.isWebGL2&&yt(this.options.offset)?this.width>0?this.gl.texImage2D(this.target,this.options.level,this.options.internalFormat,this.width,this.height,0,this.options.format,this.options.type,this.options.offset):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,De,this.options.offset):this.width>0?this.gl.texImage2D(this.target,this.options.level,this.options.internalFormat,this.width,this.height,0,this.options.format,this.options.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,De),this.#g.image=this.image,this.#g.version+=1}}bind(t=this.textureUnit){this.rendererState.textureUnits[this.rendererState.activeTextureUnit]!==this.id&&(this.textureUnit=t,this.rendererState.textureUnits[this.textureUnit]=this.id,this.gl.bindTexture(this.target,this.handle))}unbind(){this.gl.activeTexture(this.gl.TEXTURE0+this.textureUnit),this.gl.bindTexture(this.target,null),delete this.rendererState.textureUnits[this.textureUnit]}destroy(){this.unbind(),super.destroy()}removeStats(){this.#g={version:-1}}createHandle(){return this.gl.createTexture()}deleteHandle(){this.handle&&this.gl.deleteTexture(this.handle)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}}class ke extends Ge{needsUpdate=!0;constructor(t,e={}){super(t,{...e,image:e.data,premultiplyAlpha:!0,flipY:!1,unpackAlignment:1})}}function ze(t,e,s,i,r=1,n=1,a=0,h=1,o=1,l=0,u=1,d=2,c=1,m=-1,g=0,f=0){const p=g,b=r/2,x=n/2,y=a/2,M=Math.floor(h),w=Math.floor(o),v=M+1,E=w+1,A=r/M,T=n/w;for(let r=0;r<E;r++){const n=r*T-x;for(let h=0;h<v;h++){if(t[3*g+l]=(h*A-b)*c,t[3*g+u]=n*m,t[3*g+d]=y,e[3*g+l]=0,e[3*g+u]=0,e[3*g+d]=a>=0?1:-1,s[2*g]=h/M,s[2*g+1]=1-r/w,g++,r===w||h===M)continue;const o=p+h+v*r,x=p+h+v*(r+1),E=p+h+1+v*(r+1),T=p+h+1+v*r;i[6*f]=o,i[6*f+1]=x,i[6*f+2]=T,i[6*f+3]=x,i[6*f+4]=E,i[6*f+5]=T,f++}}}const We={};function je(t="id"){We[t]=We[t]||1;const e=We[t];return We[t]+=1,"".concat(t,"-").concat(e)}const Ve=(t,e)=>{switch(e){case t.VERTEX_SHADER:return"vertex-shader";case t.FRAGMENT_SHADER:return"fragment-shader";default:return"unknown"}};class He extends Ue{#x;#y;sourceCode;constructor(t,e,i,r={}){const n=((t,e)=>{switch(e){case"fragment":return t.FRAGMENT_SHADER;case"vertex":return t.VERTEX_SHADER;default:return}})(t.gl,i);super(t,{name:s(e)||je(Ve(t,n))}),console.assert("string"==typeof e,"Shader: GLSL source code must be a JavaScript string"),this.#y=r,this.#x=n,this.sourceCode=this.injectShaderModule(e,r||{}).replace(/\n\n+/gm,"\n\n"),this.createShader(this.sourceCode)}injectShaderModule(t,e={}){return t.replace(/^[\t ]*#glsl_include +<([\w.]+)>/gm,((t,s)=>{let i=e[s];if(void 0===i)throw new Error("Cannot resolve #include <".concat(s,">"));return i=i.replace(/#include </g,"#glsl_include <"),this.injectShaderModule(i,e)}))}createShader(t=this.source){let e=t.replace(/#include </g,"#glsl_include <");if(e=this.injectShaderModule(e,this.#y||{}).replace(/\n\n+/gm,"\n\n"),this.gl.shaderSource(this.handle,e),this.gl.compileShader(this.handle),!this.gl.getShaderParameter(this.handle,this.gl.COMPILE_STATUS)){const t=this.gl.getShaderInfoLog(this.handle)||"";throw this.gl.deleteShader(this.handle),new Error(`${this.toString()}\n${t}\n${function(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(e)}`)}}get source(){return this.sourceCode}get shaderType(){return this.#x}getSource(){return this.gl.getShaderSource(this.handle)}setSource(t){const e=s(t);e&&(this.name=je(e)),this.createShader(t)}removeStats(){}deleteHandle(){this.gl.deleteShader(this.handle)}toString(){return`${Ve(this.gl,this.shaderType)}:${this.id}`}}class qe extends He{constructor(t,e,s){super(t,e,"vertex",s)}createHandle(){return this.gl.createShader(this.gl.VERTEX_SHADER)}}class $e extends He{constructor(t,e,s){super(t,e,"fragment",s)}createHandle(){return this.gl.createShader(this.gl.FRAGMENT_SHADER)}}const Ye={};function Xe(t,e,s,i){i=i.length?function(t){const e=t.length,s=t[0].length;if(void 0===s)return t;const i=e*s;let r=Ye[i];r||(Ye[i]=r=new Float32Array(i));for(let i=0;i<e;i++)r.set(t[i],i*s);return r}(i):i;const r=i.length;switch(e){case WebGLRenderingContext.FLOAT:return r?t.uniform1fv(s,i):t.uniform1f(s,i);case WebGLRenderingContext.FLOAT_VEC2:return t.uniform2fv(s,i);case WebGLRenderingContext.FLOAT_VEC3:return t.uniform3fv(s,i);case WebGLRenderingContext.FLOAT_VEC4:return t.uniform4fv(s,i);case WebGLRenderingContext.BOOL:case WebGLRenderingContext.INT:case WebGLRenderingContext.SAMPLER_2D:case WebGLRenderingContext.SAMPLER_CUBE:return r?t.uniform1iv(s,i):t.uniform1i(s,i);case WebGLRenderingContext.BOOL_VEC2:case WebGLRenderingContext.INT_VEC2:return t.uniform2iv(s,i);case WebGLRenderingContext.BOOL_VEC3:case WebGLRenderingContext.INT_VEC3:return t.uniform3iv(s,i);case WebGLRenderingContext.BOOL_VEC4:case WebGLRenderingContext.INT_VEC4:return t.uniform4iv(s,i);case WebGLRenderingContext.FLOAT_MAT2:return t.uniformMatrix2fv(s,!1,i);case WebGLRenderingContext.FLOAT_MAT3:return t.uniformMatrix3fv(s,!1,i);case WebGLRenderingContext.FLOAT_MAT4:return t.uniformMatrix4fv(s,!1,i)}}const Ze=new Ht,Ke=new kt,Qe=new kt;class Je extends Ee{cameraType;projectionMatrix;viewMatrix;projectionViewMatrix;worldPosition;#M;#w;#v;#E;#A;#o;frustum;constructor({near:t=.1,far:e=100,fov:s=45,aspect:i=1,bounds:r,zoom:n=1}={}){super(),this.cameraType="perspective",this.projectionMatrix=new ve,this.viewMatrix=new Ht,this.projectionViewMatrix=new ve,this.worldPosition=new kt,this.frustum=new Ht,this.#M=t,this.#w=e,this.#v=s,this.#E=i,this.#o=r,this.#A=n;const{left:a,right:h,top:o,bottom:l}=r||{};this.cameraType=a||h?"orthographic":"perspective","orthographic"===this.cameraType?this.orthographic(a,h,o,l,t,e,n):this.perspective(s,i,t,e)}get near(){return this.#M}set near(t){this.#M=t,this.updateProjectionMatrix()}get far(){return this.#w}set far(t){this.#w=t,this.updateProjectionMatrix()}get fov(){return this.#v}set fov(t){this.#v=t,this.updateProjectionMatrix()}get aspect(){return this.#E}set aspect(t){this.#E=t,this.updateProjectionMatrix()}get zoom(){return this.#A}set zoom(t){this.#A=t,this.updateProjectionMatrix()}get bounds(){return this.#o}set bounds(t){this.#o=t,this.updateProjectionMatrix()}perspective(t=this.fov,e=this.aspect,s=this.near,i=this.far){this.#v=t,this.#E=e,this.#M=s,this.#w=i,this.projectionMatrix.fromPerspective(t,e,s,i),this.cameraType="perspective"}orthographic(t,e,s,i,r=this.near,n=this.far,a=1){this.#o={left:t,right:e,top:s,bottom:i},this.near=r,this.far=n,this.projectionMatrix.orthographic(t/a,e/a,s/a,i/a,r,n),this.cameraType="orthographic",this.projectionMatrix.frustum(this.frustum,this.#o.left,this.#o.right,this.#o.top,this.#o.bottom,this.#M,this.#w)}lookAt(t){return super.lookAt(t,!0),this}updateMatrixWorld(){return super.updateMatrixWorld(),this.viewMatrix.invert(this.worldMatrix),this.worldMatrix.getTranslation(this.worldPosition),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this}frustumIntersectsMesh(t,e=t.worldMatrix){if(!t.geometry.attributes.position)return!0;if(t.geometry.bounds&&t.geometry.bounds.radius!==1/0||t.geometry.computeBoundingSphere(),!t.geometry.bounds)return!0;const s=Ke;s.copy(t.geometry.bounds.center),s.applyMatrix4(e);const i=t.geometry.bounds.radius*e.getMaxScaleOnAxis();return this.frustumIntersectsSphere(s,i)}frustumIntersectsSphere(t,e){const s=Qe;for(let i=0;i<6;i++){const r=this.frustum[i];if(s.copy(r).dot(t)+r.constant<-e)return!1}return!0}project(t){return t.applyMatrix4(this.viewMatrix),t.applyMatrix4(this.projectionMatrix),this}unproject(t){return t.applyMatrix4(Ze.invert(this.projectionMatrix)),t.applyMatrix4(this.worldMatrix),this}updateProjectionMatrix(){throw new Error("Camera subclass must define virtual methods")}}t.BlendType=Ce,t.Box=class extends Se{constructor(t,{width:e=1,height:s=1,depth:i=1,widthSegments:r=1,heightSegments:n=1,depthSegments:a=1,attributes:h={}}={}){const o=Math.floor(r),l=Math.floor(n),u=Math.floor(a),d=o+1,c=l+1,m=u+1,g=d*c*2+d*m*2+c*m*2,f=6*(o*l*2+o*u*2+l*u*2),p=new Float32Array(3*g),b=new Float32Array(3*g),x=new Float32Array(2*g),y=g>65536?new Uint32Array(f):new Uint16Array(f);let M=0,w=0;const v=m*c,E=d*m,A=d*c,T=u*l,_=o*u,S=o*l;ze(p,b,x,y,i,s,e,a,n,2,1,0,-1,-1,M,w),M+=v,w+=T,ze(p,b,x,y,i,s,-e,a,n,2,1,0,1,-1,M,w),M+=v,w+=T,ze(p,b,x,y,e,i,s,a,r,0,2,1,1,1,M,w),M+=E,w+=_,ze(p,b,x,y,e,i,-s,a,r,0,2,1,1,-1,M,w),M+=E,w+=_,ze(p,b,x,y,e,s,-i,r,n,0,1,2,-1,-1,M,w),M+=A,w+=S,ze(p,b,x,y,e,s,i,r,n,0,1,2,1,-1,M,w),super(t,{...h,position:{size:3,data:p},normal:{size:3,data:b},uv:{size:2,data:x},index:{data:y}})}},t.BufferAttribute=Te,t.Camera=Je,t.Clock=Bt,t.Color=we,t.DataTexture=ke,t.Euler=qt,t.EventEmitter=class{fns;validateEventTypes;constructor({validEventTypes:t=[/.*/]}={}){this.fns=new Map,this.validateEventTypes=t}validateEventType(t){let e=this.validateEventTypes;Array.isArray(this.validateEventTypes)||(e=[this.validateEventTypes]);let s=!0;if(e.forEach((e=>{Mt(e)&&!e.test(t)&&(s=!1)})),!s)throw new Error(`Invalid Event Type: '${t}'.\nEvent type should be any of: ${e}.`)}on(t,e,s){if(this.validateEventType(t),pt(t)){const i=t.split(" ");if(i.length>1)return i.forEach((t=>{this.on(t,e,s)})),this}return this.has(t)||this.fns.set(t,[]),this.fns.get(t).push(e),this}once(t,e,s){if(this.validateEventType(t),pt(t)){const i=t.split(" ");if(i.length>1)return i.forEach((t=>{this.once(t,e,s)})),this}const i=(...r)=>{this.off(t,i),e.call(s||this,...r)};return this.on(t,i,s)}off(t,e,s){if(this.validateEventType(t),pt(t)){const i=t.split(" ");if(i.length>1)return i.forEach((t=>{this.off(t,e,s)})),this}const i=this.has(t);if(i)if(e){const s=i.filter((t=>t!==e));this.fns.set(t,s)}else this.fns.delete(t);return this}emit(t,e){const s=t instanceof It?t:new It(t,e);this.validateEventType(s.type);const i=this.has(s.type);if(i)return i.map((t=>t.call(this,s)))}has(t){return this.fns.get(t)}clear(){return this.fns.clear(),this}},t.Geometry=Se,t.Matrix3=jt,t.Matrix4=Ht,t.Mesh=Fe,t.Object3D=Ee,t.OrthographicCamera=class extends Je{constructor(t,e,s,i,r,n,a=1){super({bounds:{left:t,right:e,top:s,bottom:i},near:r,far:n,zoom:a})}updateProjectionMatrix(){const{left:t,right:e,top:s,bottom:i}=this.bounds,{zoom:r}=this;this.projectionMatrix.orthographic(t/r,e/r,s/r,i/r,this.near,this.far)}},t.PerspectiveCamera=class extends Je{constructor(t,e,s,i){super({fov:t,aspect:e,near:s,far:i})}updateProjectionMatrix(){this.projectionMatrix.fromPerspective(this.fov,this.aspect,this.near,this.far)}},t.Plane=class extends Se{constructor(t,{width:e=1,height:s=1,widthSegments:i=1,heightSegments:r=1,attributes:n={}}={}){const a=Math.floor(i),h=Math.floor(r),o=(a+1)*(h+1),l=a*h*6,u=new Float32Array(3*o),d=new Float32Array(3*o),c=new Float32Array(2*o),m=o>65536?new Uint32Array(l):new Uint16Array(l);ze(u,d,c,m,e,s,0,i,r),super(t,{...n,position:{size:3,data:u},normal:{size:3,data:d},uv:{size:2,data:c},index:{data:m}})}},t.Program=class extends Ue{attributeOrder;uniforms;#T;#_;#S;#F;#R;constructor(t,s={}){super(t,s);const{id:i,vertexShader:r,fragmentShader:n,uniforms:a={},transparent:h=!1,defines:o=[],includes:l={},cullFace:u,frontFace:d=t.gl.CCW,depthTest:c=!0,depthWrite:m=!0,depthFunc:g=t.gl.LESS,blending:f=1,blendFunc:p,blendEquation:b}=s;this.id=i||At("program");const x=[...[].map((t=>"#define ".concat(t))),...o].map((t=>t.startsWith("#define ")?t:"#define ".concat(t)));if(!r||!n)throw new Error(`Program: ${this.id}must provide vertexShader and fragmentShader`);if(this.#S="string"==typeof r?new qe(t,e(r,x),l):r,this.#F="string"==typeof n?new $e(t,e(n,x),l):n,this.gl.attachShader(this.handle,this.#S.handle),this.gl.attachShader(this.handle,this.#F.handle),this.gl.linkProgram(this.handle),this.gl.validateProgram(this.handle),!this.gl.getProgramParameter(this.handle,this.gl.LINK_STATUS))throw new Error("Program:".concat(this.id,": Error linking ").concat(this.gl.getProgramInfoLog(this.handle)));this.uniforms=a,this.#R={blending:f,cullFace:u,frontFace:d,depthTest:c,depthWrite:m,depthFunc:g,blendFunc:p,blendEquation:b},this.#T=new Map,this.#_=new Map,this.#C(a),this.#N(),h&&!p?.src&&(this.renderer.premultipliedAlpha?this.#R.blendFunc={...p,src:this.gl.ONE,dst:this.gl.ONE_MINUS_SRC_ALPHA}:this.#R.blendFunc={...p,src:this.gl.SRC_ALPHA,dst:this.gl.ONE_MINUS_SRC_ALPHA})}get uniformLocations(){return this.#T}get attributeLocations(){return this.#_}get vertexShader(){return this.#S}get fragmentShader(){return this.#F}use(){const t=this.rendererState.currentProgramId===this.id;let e=-1;t||(this.gl.useProgram(this.handle),this.rendererState.currentProgramId=this.id),this.#T.forEach(((t,s)=>{const i=s.name,r=this.uniforms[i];if(!r)return void console.warn("Program:".concat(this.id,": Active uniform ").concat(i," has not been supplied"));if(r&&(bt(r.value)||wt(r.value)))return void console.warn("Program:".concat(this.id,": Uniform ").concat(i," is missing a value parameter"));let n=r?.value;if(n instanceof Ge)return e+=1,r.value.update(e),Xe(this.gl,s.type,t.location,e);if((n instanceof Wt||n instanceof Ut||n instanceof we)&&(n=r.value.toArray()),n&&n.length>0&&n[0]instanceof Ge){const i=[];for(let t=0;t<r.value.length;t++){const s=n[t];e+=1,s.update(e),i.push(e)}return Xe(this.gl,s.type,t.location,i)}Xe(this.gl,s.type,t.location,n)})),this.applyState()}setStates(t,e=!0){e?(this.#R={...this.#R,...Tt(t,["blendFunc","blendEquation"])},t.blendFunc&&(this.#R.blendFunc={...this.#R.blendFunc,...t.blendFunc}),t.blendEquation&&(this.#R.blendEquation={...this.#R.blendEquation,...t.blendEquation})):this.#R=t}applyState(){this.rendererState.apply(this.#R)}setUniform(t,e){this.uniforms[t]&&(this.uniforms[t].value=e)}bind(){this.gl.useProgram(this.handle)}unbind(){this.gl.useProgram(null)}createHandle(){return this.gl.createProgram()}deleteHandle(){this.gl.deleteProgram(this.handle)}#C(t={}){const e=this.gl.getProgramParameter(this.handle,this.gl.ACTIVE_UNIFORMS);for(let s=0;s<e;s++){const e=this.gl.getActiveUniform(this.handle,s);if(!e)break;const i=e.name,r=i.match(/(\w+)/g),n={location:this.gl.getUniformLocation(this.handle,i),type:e.type,name:r[0],isStruct:!1};3===r.length?(n.isStructArray=!0,n.structIndex=Number(r[1]),n.structProperty=r[2]):2===r.length&&isNaN(Number(r[1]))&&(n.isStruct=!0,n.structProperty=r[1]);const a=t[i]?.value;bt(a)||wt(a)||(n.value=t[i].value),this.uniforms[i]=n,this.#T.set(e,n)}}#N(){const t=this.gl.getProgramParameter(this.handle,this.gl.ACTIVE_ATTRIBUTES),e=[];for(let s=0;s<t;s++){const t=this.gl.getActiveAttrib(this.handle,s);if(!t)break;const i=this.gl.getAttribLocation(this.handle,t.name);e[i]=t.name,this.#_.set(t,i)}this.attributeOrder=e.join("")}destroy(){this.unbind(),this.deleteHandle()}},t.ProjectionMatrix=ve,t.Quaternion=Gt,t.Raf=class{options;#O;#B;#L;#I;#U;constructor(t,e={}){this.options={...e,...Lt},this.#I=new Bt,this.reset(),this.onVisibilityChange=this.onVisibilityChange.bind(this),this.#U=()=>{const e=this.#I.getElapsedTime();t&&t(e)},this.options.autoStart&&this.start()}get visible(){return this.#L}get animating(){return this.#B}reset(){this.#B=!1,this.#L=!0,void 0!==this.#O&&Nt(this.#O)}get elapsedTime(){return this.#I.getElapsedTime()}start(){this.#B||(this.#B=!0,this.#I.start(),this.tick(),"undefined"!=typeof window&&window.document&&window.document.addEventListener("visibilitychange",this.onVisibilityChange,!1))}stop(){this.#I.stop(),this.reset(),"undefined"!=typeof window&&window.document&&window.document.removeEventListener("visibilitychange",this.onVisibilityChange,!1)}tick(){this.#B&&this.#L&&(this.#O=Ct((()=>{this.tick()})),this.#U())}onVisibilityChange(){"undefined"!=typeof window&&window.document&&(this.#L=!window.document.hidden),this.#L&&(this.reset(),this.start())}},t.RenderBuffer=Pe,t.RenderTarget=class extends Ue{#P;#D;depth;width;height;viewport;drawBuffersChanged;drawBuffers;#G;#k;#z;constructor(t,e={}){super(t,{color:1,depth:!0,depthTexture:!1,stencil:!1,...e}),this.#D=new Map,this.#P=new Map,this.depth=Boolean(e.depth),this.drawBuffers=[],this.drawBuffersChanged=!1,this.width=this.options.width,this.height=this.options.height,this.viewport=new zt(0,0,this.width,this.height),this.name=this.options.name;const s=this.options.attachments||[];if(0===s.length){for(let i=0;i<this.options.color;i++){const r={wrapS:this.gl.CLAMP_TO_EDGE,wrapT:this.gl.CLAMP_TO_EDGE,minFilter:this.gl.LINEAR,magFilter:this.gl.LINEAR,type:this.gl.UNSIGNED_BYTE,format:this.gl.RGBA,flipY:!1,generateMipmaps:!1,...e};let n;n=r.data?new ke(t,r):new Ge(t,Tt(r,["data","name","attachments","depthTexture"])),s.push([this.gl.COLOR_ATTACHMENT0+i,n])}if(e.depthTexture&&(t.isWebGL2||!t.isWebGL2&&t.gl.getExtension("WEBGL_depth_texture"))){const e=new Ge(t,{width:this.width,height:this.height,minFilter:this.gl.NEAREST,magFilter:this.gl.NEAREST,format:this.gl.DEPTH_COMPONENT,internalFormat:t.isWebGL2?this.gl.DEPTH_COMPONENT16:this.gl.DEPTH_COMPONENT,type:this.gl.UNSIGNED_INT});s.push([this.gl.DEPTH_ATTACHMENT,e])}else{const{depth:i,stencil:r}=e;if(i&&!r){const e=new Pe(t,{format:this.gl.DEPTH_COMPONENT16,width:this.width,height:this.height});s.push([this.gl.DEPTH_ATTACHMENT,e])}else if(r&&!i){const e=new Pe(t,{format:this.gl.STENCIL_INDEX8,width:this.width,height:this.height});s.push([this.gl.STENCIL_ATTACHMENT,e])}else if(i&&r){const e=new Pe(t,{format:this.gl.DEPTH_STENCIL,width:this.width,height:this.height});s.push([this.gl.DEPTH_STENCIL_ATTACHMENT,e])}}}this.create(s)}get texture(){return this.#P.values().next().value}set clearColors(t){this.#G=t}get clearColors(){return this.#G}set clearDepth(t){this.#k=t}get clearDepth(){return this.#k}set clearStencil(t){this.#z=t}get clearStencil(){return this.#z}create(t){this.#G=[],this.#k=1,this.#z=0;for(const e of t){const t=e[0],s=e[1];s instanceof Pe?this.#D.set(t,s):s instanceof Ge&&(this.#P.set(t,s),this.drawBuffers.push(t));const i=t-this.gl.COLOR_ATTACHMENT0;this.#G[i]=[0,0,0,0]}if(this.options.color>1)if(this.renderer.isWebGL2)this.gl.drawBuffers(this.drawBuffers);else{const t=this.renderer.extension("WEBGL_draw_buffers");if(!t||!t.drawBuffersWEBGL)throw new Error("Please open the corresponding extension [WEBGL_draw_buffers](https://developer.mozilla.org/en-US/docs/Web/API/WEBGL_draw_buffers#browser_compatibility) and check whether the browser supports it");t.drawBuffersWEBGL(this.drawBuffers)}this.drawBuffersChanged=!0,this.bind(),this.#D.forEach(((t,e)=>{this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,e,this.gl.RENDERBUFFER,t.handle)})),this.#P.forEach(((t,e)=>{this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,e,this.gl.TEXTURE_2D,t.handle,0)})),this.unbind();const e=this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER);if(e!==this.gl.FRAMEBUFFER_COMPLETE)switch(e){case this.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw new Error("The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete");case this.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw new Error("There is no attachment");case this.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw new Error(" Height and width of the attachment are not the same.");case this.gl.FRAMEBUFFER_UNSUPPORTED:throw new Error("The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer")}return this.handle}clear(){this.bind();let t=0;if(this.clearColors[0]){const e=this.clearColors[0];this.gl.clearColor(e[0],e[1],e[2],e[3]),t|=this.gl.COLOR_BUFFER_BIT}yt(this.#k)&&(this.gl.clearDepth(this.#k),t|=this.gl.DEPTH_BUFFER_BIT),yt(this.#z)&&(this.gl.clearStencil(this.#z),t|=this.gl.STENCIL_BUFFER_BIT),this.gl.clear(t),this.unbind()}getTexture(t){return this.#P.get(t)}resize(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.#P.forEach((s=>{s.width===t&&s.height===e||(s.width=t,s.height=e,s.needsUpdate=!0,s.update())})),this.#D.forEach((s=>{s.resize(t,e)})),this.viewport.set(0,0,t,e))}bind(t=this.gl.FRAMEBUFFER){this.gl.bindFramebuffer(t,this.handle)}unbind(t=this.gl.FRAMEBUFFER){this.gl.bindFramebuffer(t,null)}removeStats(){}destroy(){this.#P.forEach((t=>{t.destroy()})),this.#D.forEach((t=>{t.destroy()})),this.deleteHandle()}createHandle(){return this.gl.createFramebuffer()}deleteHandle(){this.handle&&this.gl.deleteFramebuffer(this.handle)}toString(){return`RenderTarget(${this.id},${this.width}x${this.height})`}},t.Renderer=class{#W;#g;#j;#V;#H;#q;#$;#Y;#X;#Z;#K;#Q;#J;vertexAttribDivisor;drawArraysInstanced;drawElementsInstanced;createVertexArray;bindVertexArray;deleteVertexArray;width;height;constructor(t,e={}){const s=Object.assign({},{autoClear:!0,depth:!0,alpha:!1,stencil:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,requestWebGl2:!0,extensions:[]},e);this.#V=Boolean(s.autoClear),this.#H=s.depth,this.#q=s.alpha,this.#$=s.stencil,this.#Y=s.antialias,this.#X=s.premultipliedAlpha,this.#Z=s.preserveDrawingBuffer,this.#W=dt(t)||ct(t)?t:mt(t,{alpha:this.#q,depth:this.#H,stencil:this.#$,antialias:this.#Y,powerPreference:s.powerPreference,premultipliedAlpha:this.#X,preserveDrawingBuffer:this.#Z},s.requestWebGl2);const i=this.#W?.getContextAttributes(),r=this.#W?.getParameter(this.#W.VIEWPORT),n=this.#W?.getParameter(this.#W.UNPACK_FLIP_Y_WEBGL);this.#g=new Ne(this),i&&(this.#H=Boolean(i.depth),this.#Y=Boolean(i.antialias),this.#q=Boolean(i.alpha),this.#$=Boolean(i.stencil),this.#X=Boolean(i.premultipliedAlpha),this.#Z=Boolean(i.preserveDrawingBuffer)),this.#g.flipY=Boolean(n),this.#g.setViewport(r[2],r[3],r[0],r[1]),this.#g.premultiplyAlpha=this.#X,this.#K=!0,this.#Q=s.dpr||1,this.width=this.gl.canvas.width/this.#Q,this.height=this.gl.canvas.height/this.#Q,this.#J=!!s.frustumCull,this.#j={},this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),s.extensions&&(s.extensions.filter((t=>Oe.findIndex((e=>e===t))>-1)).forEach((t=>{this.#j[t]||this.isWebGL2||(this.#j[t]=this.gl.getExtension(t))})),s.extensions.filter((t=>Be.findIndex((e=>e===t))>-1)).forEach((t=>{!this.#j[t]&&this.isWebGL2&&(this.#j[t]=this.gl.getExtension(t))})),s.extensions.filter((t=>Le.findIndex((e=>e===t))>-1)).forEach((t=>{this.#j[t]||(this.#j[t]=this.gl.getExtension(t))})))}get gl(){return this.#W}get attributes(){return{dpr:this.#Q,flipY:this.#g.flipY,depth:this.#H,color:this.#K,antialias:this.#Y,alpha:this.#q,stencil:this.#$,autoClear:this.#V,frustumCull:this.#J,premultipliedAlpha:this.#X,preserveDrawingBuffer:this.#Z}}get canvas(){return this.#W.canvas}get isWebGL(){return dt(this.gl)}get isWebGL2(){return ct(this.gl)}get extensions(){return this.#j}extension(t){return this.#j[t]}get size(){return{width:"clientWidth"in this.canvas?this.canvas.clientWidth:this.canvas.width,height:"clientHeight"in this.canvas?this.canvas.clientHeight:this.canvas.height}}get state(){return this.#g}get premultipliedAlpha(){return this.#X}setSize(t,e){this.width=t,this.height=e,this.gl.canvas.width=t*this.#Q,this.gl.canvas.height=e*this.#Q}setViewport(t,e,s=0,i=0){this.#g.setViewport(t,e,s,i)}getExtension(t,e,s){const i=this.gl[e];if(e&&i)return i.bind(this.gl);this.#j[t]||(this.#j[t]=this.gl.getExtension(t));const r=this.#j[t];return e?r?r[s].bind(r):null:r}getRenderList({scene:t,camera:e}){const s=[];return t.traverse((t=>{if(!t.visible)return!0;t.draw&&(this.#J&&t.frustumCulled&&e&&!e.frustumIntersectsMesh(t)||s.push(t))})),s}render(t){const{scene:e,camera:s,target:i=null,update:r=!0,clear:n}=t;null===i?(this.#g.bindFramebuffer({buffer:null}),this.setViewport(this.width*this.#Q,this.height*this.#Q)):(i.bind(),this.setViewport(i.width,i.height)),(n||this.#V&&!1!==n)&&(!this.#H||i&&!i.depth||(this.#g.enable(this.gl.DEPTH_TEST),this.#g.setDepthMask(!0)),this.clear(this.#K,this.#H,this.#$)),r&&e.updateMatrixWorld(),s&&s.updateMatrixWorld();const a=this.getRenderList({scene:e,camera:s});let h=0;const o=a.length;for(;h<o;h++){a[h].draw({camera:s})}i&&i.unbind()}clear(t=this.#K,e=this.#H,s=this.#$){let i=0;t&&(i|=this.gl.COLOR_BUFFER_BIT),e&&(i|=this.gl.DEPTH_BUFFER_BIT),s&&(i|=this.gl.STENCIL_BUFFER_BIT),this.gl.clear(i)}resetState(t=!0,e=null){this.#g.reset(t),this.bindVertexArray(e)}},t.Resource=Ue,t.Scene=Re,t.State=Ne,t.Texture=Ge,t.Texture3D=class extends Ge{needsUpdate=!1;textureUnit=0;depth;#g={};constructor(t,e={}){const s=t.gl,i={target:s.TEXTURE_3D,type:s.UNSIGNED_BYTE,format:s.RGBA,internalFormat:e.format||s.RGBA,wrapS:s.CLAMP_TO_EDGE,wrapT:s.CLAMP_TO_EDGE,wrapR:s.CLAMP_TO_EDGE,generateMipmaps:!0,minFilter:s.LINEAR,magFilter:s.LINEAR,premultiplyAlpha:!1,unpackAlignment:4,flipY:!1,level:0,depth:0};super(t,Object.assign({},i,e),!1),this.needsUpdate=!0,this.depth=this.options.depth,this.#g.version=-1,this.update()}get gl(){return this.renderer.gl}setData(t,e=this.width,s=this.height,i=this.depth){this.image=t,this.width=e,this.height=s,this.depth=i,this.needsUpdate=!0}setOptions(t){this.options=Object.assign(this.options,t),this.width=this.options.width,this.height=this.options.height,this.depth=this.options.depth,this.needsUpdate=!0}update(t=0){const e=!(this.image===this.#g.image&&!this.needsUpdate);if((e||this.rendererState.textureUnits[t]!==this.id||this.rendererState.activeTextureUnit!==t)&&(this.rendererState.setActiveTexture(t),this.bind(t)),e){if(this.needsUpdate=!1,this.options.wrapS!==this.#g.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.options.wrapS),this.#g.wrapS=this.options.wrapS),this.options.wrapT!==this.#g.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.options.wrapT),this.#g.wrapT=this.options.wrapT),this.options.wrapR!==this.#g.wrapR&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_R,this.options.wrapR),this.#g.wrapR=this.options.wrapR),this.options.minFilter!==this.#g.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.options.minFilter),this.#g.minFilter=this.options.minFilter),this.options.magFilter!==this.#g.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.options.magFilter),this.#g.magFilter=this.options.magFilter),this.options.flipY!==this.rendererState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.options.flipY),this.rendererState.flipY=this.options.flipY),this.options.premultiplyAlpha!==this.rendererState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.options.premultiplyAlpha),this.rendererState.premultiplyAlpha=this.options.premultiplyAlpha),this.options.unpackAlignment!==this.rendererState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.options.unpackAlignment),this.rendererState.unpackAlignment=this.options.unpackAlignment),this.options.anisotropy&&this.options.anisotropy!==this.rendererState.anisotropy){const t=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic");if(t){const e=this.gl.getParameter(t.MAX_TEXTURE_MAX_ANISOTROPY_EXT);let s=this.options.anisotropy;this.options.anisotropy>e&&(s=e,console.warn(`[Texture]: Texture.anisotropy option exceeded the maximum allowed value ${e} of the device`)),this.gl.texParameterf(this.target,t.TEXTURE_MAX_ANISOTROPY_EXT,s)}this.rendererState.anisotropy=this.options.anisotropy}this.image?(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.renderer.isWebGL2&&yt(this.options.offset)?this.gl.texImage3D(this.target,this.options.level,this.options.internalFormat,this.width,this.height,this.depth,0,this.options.format,this.options.type,this.image,this.options.offset):(ArrayBuffer.isView(this.image),this.gl.texImage3D(this.target,this.options.level,this.options.internalFormat,this.width,this.height,this.depth,0,this.options.format,this.options.type,this.image)),this.options.generateMipmaps&&(this.renderer.isWebGL2||ht(this.image.width)&&ht(this.image.height)?this.gl.generateMipmap(this.target):(this.options.generateMipmaps=!1,this.options.wrapS=this.gl.CLAMP_TO_EDGE,this.options.wrapT=this.options.wrapS,this.options.minFilter=this.gl.LINEAR))):this.width>0?this.gl.texImage3D(this.target,this.options.level,this.options.internalFormat,this.width,this.height,this.depth,0,this.options.format,this.options.type,null):this.gl.texImage3D(this.target,0,this.gl.RGBA,1,1,this.depth,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,De),this.#g.image=this.image,this.#g.version+=1}}removeStats(){this.#g={version:-1}}toString(){return`Texture3D(${this.id},${this.width}x${this.height})`}},t.Vector2=Pt,t.Vector3=kt,t.Vector4=zt,t.getPlaneBuffer=ze,t.highPrecision=lt,t.utils=Ot}));
